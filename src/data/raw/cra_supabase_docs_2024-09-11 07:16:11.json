{
  "input_url": "https://supabase.com/docs/guides/ai",
  "total_pages": 38,
  "unique_links": [
    "https://supabase.com/docs/guides/ai/langchain",
    "https://supabase.com/docs/guides/ai/structured-unstructured",
    "https://supabase.com/docs/guides/ai/python/collections",
    "https://supabase.com/docs/guides/ai/quickstarts/hello-world",
    "https://supabase.com/docs/guides/ai/vecs-python-client",
    "https://supabase.com/docs/guides/ai/vector-columns",
    "https://supabase.com/docs/guides/ai/examples/semantic-image-search-amazon-titan",
    "https://supabase.com/docs/guides/ai/quickstarts/face-similarity",
    "https://supabase.com/docs/guides/ai/vector-indexes",
    "https://supabase.com/docs/guides/ai",
    "https://supabase.com/docs/guides/ai/examples/openai",
    "https://supabase.com/docs/guides/ai/examples/building-chatgpt-plugins",
    "https://supabase.com/docs/guides/ai/semantic-search",
    "https://supabase.com/docs/guides/ai/engineering-for-scale",
    "https://supabase.com/docs/guides/ai/python/api",
    "https://supabase.com/docs/guides/ai/examples/mixpeek-video-search",
    "https://supabase.com/docs/guides/ai/examples/headless-vector-search",
    "https://supabase.com/docs/guides/ai/choosing-compute-addon",
    "https://supabase.com/docs/guides/ai/vector-indexes/hnsw-indexes",
    "https://supabase.com/docs/guides/ai/google-colab",
    "https://supabase.com/docs/guides/ai/hugging-face",
    "https://supabase.com/docs/guides/ai/quickstarts/generate-text-embeddings",
    "https://supabase.com/docs/guides/ai/examples/image-search-openai-clip",
    "https://supabase.com/docs/guides/ai/vector-indexes/ivf-indexes",
    "https://supabase.com/docs/guides/ai/python-clients",
    "https://supabase.com/docs/guides/ai/integrations/roboflow",
    "https://supabase.com/docs/guides/ai/integrations/llamaindex",
    "https://supabase.com/docs/guides/ai/concepts",
    "https://supabase.com/docs/guides/ai/python/metadata",
    "https://supabase.com/docs/guides/ai/examples/nextjs-vector-search",
    "https://supabase.com/docs/guides/ai/quickstarts/text-deduplication",
    "https://supabase.com/docs/guides/ai/integrations/amazon-bedrock",
    "https://supabase.com/docs/guides/ai/going-to-prod",
    "https://supabase.com/docs/guides/ai/hybrid-search",
    "https://supabase.com/docs/guides/ai/rag-with-permissions",
    "https://supabase.com/docs/guides/ai/examples/huggingface-image-captioning",
    "https://supabase.com/docs/guides/ai/keyword-search",
    "https://supabase.com/docs/guides/ai/python/indexes"
  ],
  "data": [
    {
      "markdown": "AI & Vectors\n\n# Vector search with Next.js and OpenAI\n\n## Learn how to build a ChatGPT-style doc search powered by Next.js, OpenAI, and Supabase.\n\n* * *\n\nWhile our [Headless Vector search](/docs/guides/ai/examples/headless-vector-search) provides a toolkit for generative Q&A, in this tutorial we'll go more in-depth, build a custom ChatGPT-like search experience from the ground-up using Next.js. You will:\n\n1. Convert your markdown into embeddings using OpenAI.\n2. Store you embeddings in Postgres using pgvector.\n3. Deploy a function for answering your users' questions.\n\nYou can read our [Supabase Clippy](https://supabase.com/blog/chatgpt-supabase-docs) blog post for a full example.\n\nWe assume that you have a Next.js project with a collection of `.mdx` files nested inside your `pages` directory. We will start developing locally with the Supabase CLI and then push our local database changes to our hosted Supabase project. You can find the [full Next.js example on GitHub](https://github.com/supabase-community/nextjs-openai-doc-search).\n\n## Create a project [\\#](\\#create-a-project)\n\n1. [Create a new project](https://supabase.com/dashboard) in the Supabase Dashboard.\n2. Enter your project details.\n3. Wait for the new database to launch.\n\n## Prepare the database [\\#](\\#prepare-the-database)\n\nLet's prepare the database schema. We can use the \"OpenAI Vector Search\" quickstart in the [SQL Editor](https://supabase.com/dashboard/project/_/sql), or you can copy/paste the SQL below and run it yourself.\n\nDashboardSQL\n\n1. Go to the [SQL Editor](https://supabase.com/dashboard/project/_/sql) page in the Dashboard.\n2. Click **OpenAI Vector Search**.\n3. Click **Run**.\n\n## Pre-process the knowledge base at build time [\\#](\\#pre-process-the-knowledge-base-at-build-time)\n\nWith our database set up, we need to process and store all `.mdx` files in the `pages` directory. You can find the full script [here](https://github.com/supabase-community/nextjs-openai-doc-search/blob/main/lib/generate-embeddings.ts), or follow the steps below:\n\n1\n\n### Generate Embeddings\n\nCreate a new file `lib/generate-embeddings.ts` and copy the code over from [GitHub](https://github.com/supabase-community/nextjs-openai-doc-search/blob/main/lib/generate-embeddings.ts).\n\n`\n1\ncurl \\\n2\nhttps://raw.githubusercontent.com/supabase-community/nextjs-openai-doc-search/main/lib/generate-embeddings.ts \\\n3\n-o \"lib/generate-embeddings.ts\"\n`\n\n2\n\n### Set up environment variables\n\nWe need some environment variables to run the script. Add them to your `.env` file and make sure your `.env` file is not committed to source control!\nYou can get your local Supabase credentials by running `supabase status`.\n\n`\n1\nNEXT_PUBLIC_SUPABASE_URL=\n2\nNEXT_PUBLIC_SUPABASE_ANON_KEY=\n3\nSUPABASE_SERVICE_ROLE_KEY=\n4\n5\n# Get your key at https://platform.openai.com/account/api-keys\n6\nOPENAI_API_KEY=\n`\n\n3\n\n### Run script at build time\n\nInclude the script in your `package.json` script commands to enable Vercel to automaticall run it at build time.\n\n`\n1\n\"scripts\": {\n2\n\"dev\": \"next dev\",\n3\n\"build\": \"pnpm run embeddings && next build\",\n4\n\"start\": \"next start\",\n5\n\"embeddings\": \"tsx lib/generate-embeddings.ts\"\n6\n},\n`\n\n## Create text completion with OpenAI API [\\#](\\#create-text-completion-with-openai-api)\n\nAnytime a user asks a question, we need to create an embedding for their question, perform a similarity search, and then send a text completion request to the OpenAI API with the query and then context content merged together into a prompt.\n\nAll of this is glued together in a [Vercel Edge Function](https://vercel.com/docs/concepts/functions/edge-functions), the code for which can be found on [GitHub](https://github.com/supabase-community/nextjs-openai-doc-search/blob/main/pages/api/vector-search.ts).\n\n1\n\n### Create Embedding for Question\n\nIn order to perform similarity search we need to turn the question into an embedding.\n\n``\n1\nconst embeddingResponse = await fetch('https://api.openai.com/v1/embeddings', {\n2\nmethod: 'POST',\n3\nheaders: {\n4\n    Authorization: `Bearer ${openAiKey}`,\n5\n    'Content-Type': 'application/json',\n6\n},\n7\nbody: JSON.stringify({\n8\n    model: 'text-embedding-ada-002',\n9\n    input: sanitizedQuery.replaceAll('\\n', ' '),\n10\n}),\n11\n})\n12\n13\nif (embeddingResponse.status !== 200) {\n14\nthrow new ApplicationError('Failed to create embedding for question', embeddingResponse)\n15\n}\n16\n17\nconst {\n18\ndata: [{ embedding }],\n19\n} = await embeddingResponse.json()\n``\n\n2\n\n### Perform similarity search\n\nUsing the `embeddingResponse` we can now perform similarity search by performing an remote procedure call (RPC) to the database function we created earlier.\n\n`\n1\nconst { error: matchError, data: pageSections } = await supabaseClient.rpc(\n2\n'match_page_sections',\n3\n{\n4\n    embedding,\n5\n    match_threshold: 0.78,\n6\n    match_count: 10,\n7\n    min_content_length: 50,\n8\n}\n9\n)\n`\n\n3\n\n### Perform text completion request\n\nWith the relevant content for the user's question identified, we can now build the prompt and make a text completion request via the OpenAI API.\n\nIf successful, the OpenAI API will respond with a `text/event-stream` response that we can simply forward to the client where we'll process the event stream to smoothly print the answer to the user.\n\n``\n1\nconst prompt = codeBlock`\n2\n${oneLine`\n3\n    You are a very enthusiastic Supabase representative who loves\n4\n    to help people! Given the following sections from the Supabase\n5\n    documentation, answer the question using only that information,\n6\n    outputted in markdown format. If you are unsure and the answer\n7\n    is not explicitly written in the documentation, say\n8\n    \"Sorry, I don't know how to help with that.\"\n9\n`}\n10\n11\nContext sections:\n12\n${contextText}\n13\n14\nQuestion: \"\"\"\n15\n${sanitizedQuery}\n16\n\"\"\"\n17\n18\nAnswer as markdown (including related code snippets if available):\n19\n`\n20\n21\nconst completionOptions: CreateCompletionRequest = {\n22\nmodel: 'gpt-3.5-turbo-instruct',\n23\nprompt,\n24\nmax_tokens: 512,\n25\ntemperature: 0,\n26\nstream: true,\n27\n}\n28\n29\nconst response = await fetch('https://api.openai.com/v1/completions', {\n30\nmethod: 'POST',\n31\nheaders: {\n32\n    Authorization: `Bearer ${openAiKey}`,\n33\n    'Content-Type': 'application/json',\n34\n},\n35\nbody: JSON.stringify(completionOptions),\n36\n})\n37\n38\nif (!response.ok) {\n39\nconst error = await response.json()\n40\nthrow new ApplicationError('Failed to generate completion', error)\n41\n}\n42\n43\n// Proxy the streamed SSE response from OpenAI\n44\nreturn new Response(response.body, {\n45\nheaders: {\n46\n    'Content-Type': 'text/event-stream',\n47\n},\n48\n})\n``\n\n## Display the answer on the frontend [\\#](\\#display-the-answer-on-the-frontend)\n\nIn a last step, we need to process the event stream from the OpenAI API and print the answer to the user. The full code for this can be found on [GitHub](https://github.com/supabase-community/nextjs-openai-doc-search/blob/main/components/SearchDialog.tsx).\n\n``\n1\nconst handleConfirm = React.useCallback(\n2\nasync (query: string) => {\n3\n    setAnswer(undefined)\n4\n    setQuestion(query)\n5\n    setSearch('')\n6\n    dispatchPromptData({ index: promptIndex, answer: undefined, query })\n7\n    setHasError(false)\n8\n    setIsLoading(true)\n9\n10\n    const eventSource = new SSE(`api/vector-search`, {\n11\n      headers: {\n12\n        apikey: process.env.NEXT_PUBLIC_SUPABASE_ANON_KEY ?? '',\n13\n        Authorization: `Bearer ${process.env.NEXT_PUBLIC_SUPABASE_ANON_KEY}`,\n14\n        'Content-Type': 'application/json',\n15\n      },\n16\n      payload: JSON.stringify({ query }),\n17\n    })\n18\n19\n    function handleError<T>(err: T) {\n20\n      setIsLoading(false)\n21\n      setHasError(true)\n22\n      console.error(err)\n23\n    }\n24\n25\n    eventSource.addEventListener('error', handleError)\n26\n    eventSource.addEventListener('message', (e: any) => {\n27\n      try {\n28\n        setIsLoading(false)\n29\n30\n        if (e.data === '[DONE]') {\n31\n          setPromptIndex((x) => {\n32\n            return x + 1\n33\n          })\n34\n          return\n35\n        }\n36\n37\n        const completionResponse: CreateCompletionResponse = JSON.parse(e.data)\n38\n        const text = completionResponse.choices[0].text\n39\n40\n        setAnswer((answer) => {\n41\n          const currentAnswer = answer ?? ''\n42\n43\n          dispatchPromptData({\n44\n            index: promptIndex,\n45\n            answer: currentAnswer + text,\n46\n          })\n47\n48\n          return (answer ?? '') + text\n49\n        })\n50\n      } catch (err) {\n51\n        handleError(err)\n52\n      }\n53\n    })\n54\n55\n    eventSource.stream()\n56\n57\n    eventSourceRef.current = eventSource\n58\n59\n    setIsLoading(true)\n60\n},\n61\n[promptIndex, promptData]\n62\n)\n``\n\n## Learn more [\\#](\\#learn-more)\n\nWant to learn more about the awesome tech that is powering this?\n\n- Read about how we built [ChatGPT for the Supabase Docs](https://supabase.com/blog/chatgpt-supabase-docs).\n- Read the pgvector Docs for [Embeddings and vector similarity](https://supabase.com/docs/guides/database/extensions/pgvector)\n- Watch Greg's video for a full breakdown:\n\nWatch video guide\n\n![Video guide preview](https://supabase.com/docs/_next/image?url=http%3A%2F%2Fimg.youtube.com%2Fvi%2FxmfNUCjszh4%2F0.jpg&w=3840&q=75&dpl=dpl_8T75GeYs2RqN59z5hY7ru4dxhiVp)\n\n### Is this helpful?\n\nYesNo\n\nThanks for your feedback!\n\nOn this page\n\n- [Create a project](#create-a-project)\n- [Prepare the database](#prepare-the-database)\n- [Pre-process the knowledge base at build time](#pre-process-the-knowledge-base-at-build-time)\n- [Create text completion with OpenAI API](#create-text-completion-with-openai-api)\n- [Display the answer on the frontend](#display-the-answer-on-the-frontend)\n- [Learn more](#learn-more)\n\n1. We only collect analytics essential to ensuring smooth operation of our services. [Learn more](https://supabase.com/privacy)\n\n\n\n\n\n   AcceptOpt out[Learn more](https://supabase.com/privacy)",
      "html": "<!DOCTYPE html><html lang=\"en\" data-theme=\"light\" style=\"color-scheme: light;\"><body><div class=\"flex flex-col\"><div class=\"grow\"><div class=\"flex flex-col h-full w-full\"><div class=\"hidden lg:sticky w-full lg:flex top-0 left-0 right-0 z-50\"></div><div class=\"flex flex-row h-full relative\"><main id=\"docs-content-container\" class=\"w-full transition-all ease-out relative lg:ml-0\"><div class=\"flex flex-col sticky top-0\"><div class=\"flex lg:hidden w-full top-0 left-0 right-0 z-50\"></div><div class=\"sticky transition-all top-0 z-10 backdrop-blur backdrop-filter bg-background\"><div class=\"lg:hidden px-3.5 border-b z-10 transition-all ease-out top-0 flex items-center gap-1\"><button class=\"h-8 w-8 flex group items-center justify-center mr-1\"><div class=\"space-y-1 cursor-pointer relative w-4 h-[8px]\"><span class=\"transition-all ease-out block h-px bg-foreground-muted group-hover:bg-foreground w-4\"></span><span class=\"transition-all ease-out block h-px bg-foreground-muted group-hover:bg-foreground w-3 group-hover:w-4\"></span></div></button><span class=\"transition-all duration-200 text-foreground text-sm\">AI &amp; Vectors</span></div></div><div class=\"grow\"><div class=\"max-w-7xl px-5 mx-auto py-8 pb-0\"><div class=\"grid grid-cols-12 relative gap-4\"><div class=\"relative transition-all ease-out duration-100 col-span-12 md:col-span-9\"><article id=\"sb-docs-guide-main-article\" class=\"prose max-w-none\"><h1 class=\"mb-0\">Vector search with Next.js and OpenAI</h1><h2 class=\"mt-3 text-xl text-foreground-light\">Learn how to build a ChatGPT-style doc search powered by Next.js, OpenAI, and Supabase.</h2><hr class=\"not-prose border-t-0 border-b my-8\">\n<p>While our <a href=\"/docs/guides/ai/examples/headless-vector-search\">Headless Vector search</a> provides a toolkit for generative Q&amp;A, in this tutorial we'll go more in-depth, build a custom ChatGPT-like search experience from the ground-up using Next.js. You will:</p>\n<ol>\n<li>Convert your markdown into embeddings using OpenAI.</li>\n<li>Store you embeddings in Postgres using pgvector.</li>\n<li>Deploy a function for answering your users' questions.</li>\n</ol>\n<p>You can read our <a href=\"https://supabase.com/blog/chatgpt-supabase-docs\">Supabase Clippy</a> blog post for a full example.</p>\n<p>We assume that you have a Next.js project with a collection of <code>.mdx</code> files nested inside your <code>pages</code> directory. We will start developing locally with the Supabase CLI and then push our local database changes to our hosted Supabase project. You can find the <a href=\"https://github.com/supabase-community/nextjs-openai-doc-search\">full Next.js example on GitHub</a>.</p>\n<h2 id=\"create-a-project\" class=\"group scroll-mt-24\">Create a project<a href=\"#create-a-project\" aria-hidden=\"true\" class=\"ml-2 opacity-0 group-hover:opacity-100 transition\"><span aria-hidden=\"true\">#</span></a></h2>\n<ol>\n<li><a href=\"https://supabase.com/dashboard\">Create a new project</a> in the Supabase Dashboard.</li>\n<li>Enter your project details.</li>\n<li>Wait for the new database to launch.</li>\n</ol>\n<h2 id=\"prepare-the-database\" class=\"group scroll-mt-24\">Prepare the database<a href=\"#prepare-the-database\" aria-hidden=\"true\" class=\"ml-2 opacity-0 group-hover:opacity-100 transition\"><span aria-hidden=\"true\">#</span></a></h2>\n<p>Let's prepare the database schema. We can use the \"OpenAI Vector Search\" quickstart in the <a href=\"https://supabase.com/dashboard/project/_/sql\">SQL Editor</a>, or you can copy/paste the SQL below and run it yourself.</p>\n<div dir=\"ltr\" data-orientation=\"horizontal\" class=\"w-full justify-between space-y-4 \"><div role=\"tablist\" aria-orientation=\"horizontal\" class=\" flex items-center border-b border-secondary  overflow-auto whitespace-nowrap no-scrollbar mask-fadeout-right flex-wrap\" tabindex=\"0\" data-orientation=\"horizontal\" style=\"outline:none\"><button type=\"button\" role=\"tab\" aria-selected=\"true\" aria-controls=\"radix-:Rae9jtsn7qb6ra:-content-dashboard\" data-state=\"active\" id=\"radix-:Rae9jtsn7qb6ra:-trigger-dashboard\" class=\" relative cursor-pointer text-foreground-lighter flex items-center space-x-2 text-center transition focus:outline-none focus-visible:ring focus-visible:ring-foreground-muted focus-visible:border-foreground-muted  text-sm leading-4 px-3 py-2  !text-foreground border-b-2 border-foreground \" tabindex=\"-1\" data-orientation=\"horizontal\" data-radix-collection-item=\"\"><span>Dashboard</span></button><button type=\"button\" role=\"tab\" aria-selected=\"false\" aria-controls=\"radix-:Rae9jtsn7qb6ra:-content-sql\" data-state=\"inactive\" id=\"radix-:Rae9jtsn7qb6ra:-trigger-sql\" class=\" relative cursor-pointer text-foreground-lighter flex items-center space-x-2 text-center transition focus:outline-none focus-visible:ring focus-visible:ring-foreground-muted focus-visible:border-foreground-muted  text-sm leading-4 px-3 py-2  hover:text-foreground \" tabindex=\"-1\" data-orientation=\"horizontal\" data-radix-collection-item=\"\"><span>SQL</span></button></div><div data-state=\"active\" data-orientation=\"horizontal\" role=\"tabpanel\" aria-labelledby=\"radix-:Rae9jtsn7qb6ra:-trigger-dashboard\" id=\"radix-:Rae9jtsn7qb6ra:-content-dashboard\" tabindex=\"0\" class=\"focus:outline-none transition-height \" style=\"animation-duration:0s\"><ol>\n<li>Go to the <a href=\"https://supabase.com/dashboard/project/_/sql\">SQL Editor</a> page in the Dashboard.</li>\n<li>Click <strong>OpenAI Vector Search</strong>.</li>\n<li>Click <strong>Run</strong>.</li>\n</ol></div><div data-state=\"inactive\" data-orientation=\"horizontal\" role=\"tabpanel\" aria-labelledby=\"radix-:Rae9jtsn7qb6ra:-trigger-sql\" hidden=\"\" id=\"radix-:Rae9jtsn7qb6ra:-content-sql\" tabindex=\"0\" class=\"focus:outline-none transition-height \"></div></div>\n<h2 id=\"pre-process-the-knowledge-base-at-build-time\" class=\"group scroll-mt-24\">Pre-process the knowledge base at build time<a href=\"#pre-process-the-knowledge-base-at-build-time\" aria-hidden=\"true\" class=\"ml-2 opacity-0 group-hover:opacity-100 transition\"><span aria-hidden=\"true\">#</span></a></h2>\n<p>With our database set up, we need to process and store all <code>.mdx</code> files in the <code>pages</code> directory. You can find the full script <a href=\"https://github.com/supabase-community/nextjs-openai-doc-search/blob/main/lib/generate-embeddings.ts\">here</a>, or follow the steps below:</p>\n<div class=\"py-8\"><div class=\"relative pb-8 group\"><div class=\" absolute w-px left-[11px] pt-1 h-full \"><div class=\" absolute w-full h-full py-1 bg-border-control group-last:bg-transparent \"></div></div><div class=\" absolute left-0 flex gap-3 items-center not-prose \"><div class=\"flex items-center gap-6\"><div class=\"border bg-surface-100 border-control flex items-center justify-center rounded-full w-6 h-6 text-xs text-foreground font-normal font-mono dropshadow-sm \">1</div></div></div><div class=\"grid grid-cols-1 lg:grid-cols-12 lg:gap-10 lg:ml-12\"><div class=\"col-span-5 ml-12 lg:ml-0\"><h3 class=\"mt-0 text-foreground text-base\">Generate Embeddings</h3><p>Create a new file <code>lib/generate-embeddings.ts</code> and copy the code over from <a href=\"https://github.com/supabase-community/nextjs-openai-doc-search/blob/main/lib/generate-embeddings.ts\">GitHub</a>.</p></div><div class=\"col-span-7 not-prose\"><div class=\"ch-codeblock not-prose \" data-ch-theme=\"supabase\"><div class=\"ch-code-wrapper ch-code\" data-ch-measured=\"true\"><code class=\"ch-code-scroll-parent\" data-ch-lang=\"bash\" style=\"width: 495.5px; height: 112px; position: relative; overflow: auto;\"><div class=\"ch-code-scroll-content\" style=\"position: absolute; top: 0px; left: 0px; transform-origin: left top; width: 808.5px; height: 95px; overflow: hidden;\"><div style=\"position: absolute; top: 0px; left: 0px; transform: translateX(0px) translateY(19px) scale(1); transform-origin: left top; width: 808.5px; height: 57px;\"><span class=\"ch-code-line-number\" style=\"position: absolute; top: 0px; left: 0px; transform: translate(0px, 0px); width: 31.5px; opacity: 0.99;\">1</span><div style=\"position: absolute; top: 0px; left: 0px; transform: translate(31.5px, 0px); width: 777px;\"><div style=\"display: inline-block; width: 100%;\"><span style=\"opacity: 0.99;\"><span style=\"color: var(--ch-3);\">curl </span><span style=\"color: var(--ch-2);\">\\</span></span><br></div></div><span class=\"ch-code-line-number\" style=\"position: absolute; top: 0px; left: 0px; transform: translate(0px, 19px); width: 31.5px; opacity: 0.99;\">2</span><div style=\"position: absolute; top: 0px; left: 0px; transform: translate(31.5px, 19px); width: 777px;\"><div style=\"display: inline-block; width: 100%;\"><span style=\"opacity: 0.99;\"><span style=\"color: var(--ch-4);\">https://raw.githubusercontent.com/supabase-community/nextjs-openai-doc-search/main/lib/generate-embeddings.ts </span><span style=\"color: var(--ch-2);\">\\</span></span><br></div></div><span class=\"ch-code-line-number\" style=\"position: absolute; top: 0px; left: 0px; transform: translate(0px, 38px); width: 31.5px; opacity: 0.99;\">3</span><div style=\"position: absolute; top: 0px; left: 0px; transform: translate(31.5px, 38px); width: 777px;\"><div style=\"display: inline-block; width: 100%;\"><span style=\"opacity: 0.99;\"><span style=\"color: var(--ch-4);\">-o </span><span style=\"color: var(--ch-8);\">\"lib/generate-embeddings.ts\"</span></span><br></div></div></div></div></code><button type=\"button\" title=\"Copy code\" class=\"ch-code-button\"><svg fill=\"none\" stroke=\"currentColor\" viewBox=\"0 0 24 24\" xmlns=\"http://www.w3.org/2000/svg\"><path stroke-linecap=\"round\" stroke-linejoin=\"round\" stroke-width=\"1.6px\" d=\"M8 16H6a2 2 0 01-2-2V6a2 2 0 012-2h8a2 2 0 012 2v2m-6 12h8a2 2 0 002-2v-8a2 2 0 00-2-2h-8a2 2 0 00-2 2v8a2 2 0 002 2z\"></path></svg></button></div></div></div></div></div><div class=\"relative pb-8 group\"><div class=\" absolute w-px left-[11px] pt-1 h-full \"><div class=\" absolute w-full h-full py-1 bg-border-control group-last:bg-transparent \"></div></div><div class=\" absolute left-0 flex gap-3 items-center not-prose \"><div class=\"flex items-center gap-6\"><div class=\"border bg-surface-100 border-control flex items-center justify-center rounded-full w-6 h-6 text-xs text-foreground font-normal font-mono dropshadow-sm \">2</div></div></div><div class=\"grid grid-cols-1 lg:grid-cols-12 lg:gap-10 lg:ml-12\"><div class=\"col-span-5 ml-12 lg:ml-0\"><h3 class=\"mt-0 text-foreground text-base\">Set up environment variables</h3><p>We need some environment variables to run the script. Add them to your <code>.env</code> file and make sure your <code>.env</code> file is not committed to source control!\nYou can get your local Supabase credentials by running <code>supabase status</code>.</p></div><div class=\"col-span-7 not-prose\"><div class=\"ch-codeblock not-prose \" data-ch-theme=\"supabase\"><div class=\"ch-code-wrapper ch-code\" data-ch-measured=\"true\"><code class=\"ch-code-scroll-parent\" data-ch-lang=\"bash\" style=\"width: 495.5px; height: 154px; position: relative; overflow: auto;\"><div class=\"ch-code-scroll-content\" style=\"position: absolute; top: 0px; left: 0px; transform-origin: left top; width: 493.5px; height: 152px; overflow: hidden;\"><div style=\"position: absolute; top: 0px; left: 0px; transform: translateX(0px) translateY(19px) scale(1); transform-origin: left top; width: 493.5px; height: 114px;\"><span class=\"ch-code-line-number\" style=\"position: absolute; top: 0px; left: 0px; transform: translate(0px, 0px); width: 31.5px; opacity: 0.99;\">1</span><div style=\"position: absolute; top: 0px; left: 0px; transform: translate(31.5px, 0px); width: 434px;\"><div style=\"display: inline-block; width: 100%;\"><span style=\"opacity: 0.99;\"><span style=\"color: var(--ch-4);\">NEXT_PUBLIC_SUPABASE_URL</span><span style=\"color: var(--ch-7);\">=</span></span><br></div></div><span class=\"ch-code-line-number\" style=\"position: absolute; top: 0px; left: 0px; transform: translate(0px, 19px); width: 31.5px; opacity: 0.99;\">2</span><div style=\"position: absolute; top: 0px; left: 0px; transform: translate(31.5px, 19px); width: 434px;\"><div style=\"display: inline-block; width: 100%;\"><span style=\"opacity: 0.99;\"><span style=\"color: var(--ch-4);\">NEXT_PUBLIC_SUPABASE_ANON_KEY</span><span style=\"color: var(--ch-7);\">=</span></span><br></div></div><span class=\"ch-code-line-number\" style=\"position: absolute; top: 0px; left: 0px; transform: translate(0px, 38px); width: 31.5px; opacity: 0.99;\">3</span><div style=\"position: absolute; top: 0px; left: 0px; transform: translate(31.5px, 38px); width: 434px;\"><div style=\"display: inline-block; width: 100%;\"><span style=\"opacity: 0.99;\"><span style=\"color: var(--ch-4);\">SUPABASE_SERVICE_ROLE_KEY</span><span style=\"color: var(--ch-7);\">=</span></span><br></div></div><span class=\"ch-code-line-number\" style=\"position: absolute; top: 0px; left: 0px; transform: translate(0px, 57px); width: 31.5px; opacity: 0.99;\">4</span><div style=\"position: absolute; top: 0px; left: 0px; transform: translate(31.5px, 57px); width: 434px;\"><div style=\"display: inline-block; width: 100%;\"><span style=\"opacity: 0.99;\"><span style=\"color: var(--ch-4);\"></span></span><br></div></div><span class=\"ch-code-line-number\" style=\"position: absolute; top: 0px; left: 0px; transform: translate(0px, 76px); width: 31.5px; opacity: 0.99;\">5</span><div style=\"position: absolute; top: 0px; left: 0px; transform: translate(31.5px, 76px); width: 434px;\"><div style=\"display: inline-block; width: 100%;\"><span style=\"opacity: 0.99;\"><span style=\"color: var(--ch-1);\"># Get your key at https://platform.openai.com/account/api-keys</span></span><br></div></div><span class=\"ch-code-line-number\" style=\"position: absolute; top: 0px; left: 0px; transform: translate(0px, 95px); width: 31.5px; opacity: 0.99;\">6</span><div style=\"position: absolute; top: 0px; left: 0px; transform: translate(31.5px, 95px); width: 434px;\"><div style=\"display: inline-block; width: 100%;\"><span style=\"opacity: 0.99;\"><span style=\"color: var(--ch-4);\">OPENAI_API_KEY</span><span style=\"color: var(--ch-7);\">=</span></span><br></div></div></div></div></code><button type=\"button\" title=\"Copy code\" class=\"ch-code-button\"><svg fill=\"none\" stroke=\"currentColor\" viewBox=\"0 0 24 24\" xmlns=\"http://www.w3.org/2000/svg\"><path stroke-linecap=\"round\" stroke-linejoin=\"round\" stroke-width=\"1.6px\" d=\"M8 16H6a2 2 0 01-2-2V6a2 2 0 012-2h8a2 2 0 012 2v2m-6 12h8a2 2 0 002-2v-8a2 2 0 00-2-2h-8a2 2 0 00-2 2v8a2 2 0 002 2z\"></path></svg></button></div></div></div></div></div><div class=\"relative pb-8 group\"><div class=\" absolute w-px left-[11px] pt-1 h-full \"><div class=\" absolute w-full h-full py-1 bg-border-control group-last:bg-transparent \"></div></div><div class=\" absolute left-0 flex gap-3 items-center not-prose \"><div class=\"flex items-center gap-6\"><div class=\"border bg-surface-100 border-control flex items-center justify-center rounded-full w-6 h-6 text-xs text-foreground font-normal font-mono dropshadow-sm \">3</div></div></div><div class=\"grid grid-cols-1 lg:grid-cols-12 lg:gap-10 lg:ml-12\"><div class=\"col-span-5 ml-12 lg:ml-0\"><h3 class=\"mt-0 text-foreground text-base\">Run script at build time</h3><p>Include the script in your <code>package.json</code> script commands to enable Vercel to automaticall run it at build time.</p></div><div class=\"col-span-7 not-prose\"><div class=\"ch-codeblock not-prose \" data-ch-theme=\"supabase\"><div class=\"ch-code-wrapper ch-code\" data-ch-measured=\"true\"><code class=\"ch-code-scroll-parent\" data-ch-lang=\"json\" style=\"width: 495.5px; height: 154px; position: relative; overflow: auto;\"><div class=\"ch-code-scroll-content\" style=\"position: absolute; top: 0px; left: 0px; transform-origin: left top; width: 493.5px; height: 152px; overflow: hidden;\"><div style=\"position: absolute; top: 0px; left: 0px; transform: translateX(0px) translateY(19px) scale(1); transform-origin: left top; width: 493.5px; height: 114px;\"><span class=\"ch-code-line-number\" style=\"position: absolute; top: 0px; left: 0px; transform: translate(0px, 0px); width: 31.5px; opacity: 0.99;\">1</span><div style=\"position: absolute; top: 0px; left: 0px; transform: translate(31.5px, 0px); width: 336px;\"><div style=\"display: inline-block; width: 100%;\"><span style=\"opacity: 0.99;\"><span style=\"color: var(--ch-8);\">\"scripts\"</span><span style=\"color: var(--ch-4);\">: {</span></span><br></div></div><span class=\"ch-code-line-number\" style=\"position: absolute; top: 0px; left: 0px; transform: translate(0px, 19px); width: 31.5px; opacity: 0.99;\">2</span><div style=\"position: absolute; top: 0px; left: 0px; transform: translate(31.5px, 19px); width: 336px;\"><div style=\"display: inline-block; width: 100%;\"><span style=\"opacity: 0.99;\"><span style=\"color: var(--ch-6);\">  \"dev\"</span><span style=\"color: var(--ch-4);\">: </span><span style=\"color: var(--ch-8);\">\"next dev\"</span><span style=\"color: var(--ch-4);\">,</span></span><br></div></div><span class=\"ch-code-line-number\" style=\"position: absolute; top: 0px; left: 0px; transform: translate(0px, 38px); width: 31.5px; opacity: 0.99;\">3</span><div style=\"position: absolute; top: 0px; left: 0px; transform: translate(31.5px, 38px); width: 336px;\"><div style=\"display: inline-block; width: 100%;\"><span style=\"opacity: 0.99;\"><span style=\"color: var(--ch-6);\">  \"build\"</span><span style=\"color: var(--ch-4);\">: </span><span style=\"color: var(--ch-8);\">\"pnpm run embeddings &amp;&amp; next build\"</span><span style=\"color: var(--ch-4);\">,</span></span><br></div></div><span class=\"ch-code-line-number\" style=\"position: absolute; top: 0px; left: 0px; transform: translate(0px, 57px); width: 31.5px; opacity: 0.99;\">4</span><div style=\"position: absolute; top: 0px; left: 0px; transform: translate(31.5px, 57px); width: 336px;\"><div style=\"display: inline-block; width: 100%;\"><span style=\"opacity: 0.99;\"><span style=\"color: var(--ch-6);\">  \"start\"</span><span style=\"color: var(--ch-4);\">: </span><span style=\"color: var(--ch-8);\">\"next start\"</span><span style=\"color: var(--ch-4);\">,</span></span><br></div></div><span class=\"ch-code-line-number\" style=\"position: absolute; top: 0px; left: 0px; transform: translate(0px, 76px); width: 31.5px; opacity: 0.99;\">5</span><div style=\"position: absolute; top: 0px; left: 0px; transform: translate(31.5px, 76px); width: 336px;\"><div style=\"display: inline-block; width: 100%;\"><span style=\"opacity: 0.99;\"><span style=\"color: var(--ch-6);\">  \"embeddings\"</span><span style=\"color: var(--ch-4);\">: </span><span style=\"color: var(--ch-8);\">\"tsx lib/generate-embeddings.ts\"</span></span><br></div></div><span class=\"ch-code-line-number\" style=\"position: absolute; top: 0px; left: 0px; transform: translate(0px, 95px); width: 31.5px; opacity: 0.99;\">6</span><div style=\"position: absolute; top: 0px; left: 0px; transform: translate(31.5px, 95px); width: 336px;\"><div style=\"display: inline-block; width: 100%;\"><span style=\"opacity: 0.99;\"><span style=\"color: var(--ch-4);\">},</span></span><br></div></div></div></div></code><button type=\"button\" title=\"Copy code\" class=\"ch-code-button\"><svg fill=\"none\" stroke=\"currentColor\" viewBox=\"0 0 24 24\" xmlns=\"http://www.w3.org/2000/svg\"><path stroke-linecap=\"round\" stroke-linejoin=\"round\" stroke-width=\"1.6px\" d=\"M8 16H6a2 2 0 01-2-2V6a2 2 0 012-2h8a2 2 0 012 2v2m-6 12h8a2 2 0 002-2v-8a2 2 0 00-2-2h-8a2 2 0 00-2 2v8a2 2 0 002 2z\"></path></svg></button></div></div></div></div></div></div>\n<h2 id=\"create-text-completion-with-openai-api\" class=\"group scroll-mt-24\">Create text completion with OpenAI API<a href=\"#create-text-completion-with-openai-api\" aria-hidden=\"true\" class=\"ml-2 opacity-0 group-hover:opacity-100 transition\"><span aria-hidden=\"true\">#</span></a></h2>\n<p>Anytime a user asks a question, we need to create an embedding for their question, perform a similarity search, and then send a text completion request to the OpenAI API with the query and then context content merged together into a prompt.</p>\n<p>All of this is glued together in a <a href=\"https://vercel.com/docs/concepts/functions/edge-functions\">Vercel Edge Function</a>, the code for which can be found on <a href=\"https://github.com/supabase-community/nextjs-openai-doc-search/blob/main/pages/api/vector-search.ts\">GitHub</a>.</p>\n<div class=\"py-8\"><div class=\"relative pb-8 group\"><div class=\" absolute w-px left-[11px] pt-1 h-full \"><div class=\" absolute w-full h-full py-1 bg-border-control group-last:bg-transparent \"></div></div><div class=\" absolute left-0 flex gap-3 items-center not-prose \"><div class=\"flex items-center gap-6\"><div class=\"border bg-surface-100 border-control flex items-center justify-center rounded-full w-6 h-6 text-xs text-foreground font-normal font-mono dropshadow-sm \">1</div></div></div><div class=\"grid grid-cols-1 lg:grid-cols-12 lg:gap-10 lg:ml-12\"><div class=\"col-span-5 ml-12 lg:ml-0\"><h3 class=\"mt-0 text-foreground text-base\">Create Embedding for Question</h3><p>In order to perform similarity search we need to turn the question into an embedding.</p></div><div class=\"col-span-7 not-prose\"><div class=\"ch-codeblock not-prose \" data-ch-theme=\"supabase\"><div class=\"ch-code-wrapper ch-code\" data-ch-measured=\"true\"><code class=\"ch-code-scroll-parent\" data-ch-lang=\"ts\" style=\"width: 495.5px; height: 416px; position: relative; overflow: auto;\"><div class=\"ch-code-scroll-content\" style=\"position: absolute; top: 0px; left: 0px; transform-origin: left top; width: 661.5px; height: 399px; overflow: hidden;\"><div style=\"position: absolute; top: 0px; left: 0px; transform: translateX(0px) translateY(19px) scale(1); transform-origin: left top; width: 661.5px; height: 361px;\"><span class=\"ch-code-line-number\" style=\"position: absolute; top: 0px; left: 0px; transform: translate(0px, 0px); width: 31.5px; opacity: 0.99;\">1</span><div style=\"position: absolute; top: 0px; left: 0px; transform: translate(31.5px, 0px); width: 630px;\"><div style=\"display: inline-block; width: 100%;\"><span style=\"opacity: 0.99;\"><span style=\"color: var(--ch-7);\">const </span><span style=\"color: var(--ch-2);\">embeddingResponse </span><span style=\"color: var(--ch-7);\">= await </span><span style=\"color: var(--ch-5);\">fetch</span><span style=\"color: var(--ch-4);\">(</span><span style=\"color: var(--ch-8);\">'https://api.openai.com/v1/embeddings'</span><span style=\"color: var(--ch-4);\">, {</span></span><br></div></div><span class=\"ch-code-line-number\" style=\"position: absolute; top: 0px; left: 0px; transform: translate(0px, 19px); width: 31.5px; opacity: 0.99;\">2</span><div style=\"position: absolute; top: 0px; left: 0px; transform: translate(31.5px, 19px); width: 630px;\"><div style=\"display: inline-block; width: 100%;\"><span style=\"opacity: 0.99;\"><span style=\"color: var(--ch-4);\">  method: </span><span style=\"color: var(--ch-8);\">'POST'</span><span style=\"color: var(--ch-4);\">,</span></span><br></div></div><span class=\"ch-code-line-number\" style=\"position: absolute; top: 0px; left: 0px; transform: translate(0px, 38px); width: 31.5px; opacity: 0.99;\">3</span><div style=\"position: absolute; top: 0px; left: 0px; transform: translate(31.5px, 38px); width: 630px;\"><div style=\"display: inline-block; width: 100%;\"><span style=\"opacity: 0.99;\"><span style=\"color: var(--ch-4);\">  headers: {</span></span><br></div></div><span class=\"ch-code-line-number\" style=\"position: absolute; top: 0px; left: 0px; transform: translate(0px, 57px); width: 31.5px; opacity: 0.99;\">4</span><div style=\"position: absolute; top: 0px; left: 0px; transform: translate(31.5px, 57px); width: 630px;\"><div style=\"display: inline-block; width: 100%;\"><span style=\"opacity: 0.99;\"><span style=\"color: var(--ch-4);\">    Authorization: </span><span style=\"color: var(--ch-8);\">`Bearer ${</span><span style=\"color: var(--ch-4);\">openAiKey</span><span style=\"color: var(--ch-8);\">}`</span><span style=\"color: var(--ch-4);\">,</span></span><br></div></div><span class=\"ch-code-line-number\" style=\"position: absolute; top: 0px; left: 0px; transform: translate(0px, 76px); width: 31.5px; opacity: 0.99;\">5</span><div style=\"position: absolute; top: 0px; left: 0px; transform: translate(31.5px, 76px); width: 630px;\"><div style=\"display: inline-block; width: 100%;\"><span style=\"opacity: 0.99;\"><span style=\"color: var(--ch-8);\">    'Content-Type'</span><span style=\"color: var(--ch-4);\">: </span><span style=\"color: var(--ch-8);\">'application/json'</span><span style=\"color: var(--ch-4);\">,</span></span><br></div></div><span class=\"ch-code-line-number\" style=\"position: absolute; top: 0px; left: 0px; transform: translate(0px, 95px); width: 31.5px; opacity: 0.99;\">6</span><div style=\"position: absolute; top: 0px; left: 0px; transform: translate(31.5px, 95px); width: 630px;\"><div style=\"display: inline-block; width: 100%;\"><span style=\"opacity: 0.99;\"><span style=\"color: var(--ch-4);\">  },</span></span><br></div></div><span class=\"ch-code-line-number\" style=\"position: absolute; top: 0px; left: 0px; transform: translate(0px, 114px); width: 31.5px; opacity: 0.99;\">7</span><div style=\"position: absolute; top: 0px; left: 0px; transform: translate(31.5px, 114px); width: 630px;\"><div style=\"display: inline-block; width: 100%;\"><span style=\"opacity: 0.99;\"><span style=\"color: var(--ch-4);\">  body: </span><span style=\"color: var(--ch-2);\">JSON</span><span style=\"color: var(--ch-4);\">.</span><span style=\"color: var(--ch-5);\">stringify</span><span style=\"color: var(--ch-4);\">({</span></span><br></div></div><span class=\"ch-code-line-number\" style=\"position: absolute; top: 0px; left: 0px; transform: translate(0px, 133px); width: 31.5px; opacity: 0.99;\">8</span><div style=\"position: absolute; top: 0px; left: 0px; transform: translate(31.5px, 133px); width: 630px;\"><div style=\"display: inline-block; width: 100%;\"><span style=\"opacity: 0.99;\"><span style=\"color: var(--ch-4);\">    model: </span><span style=\"color: var(--ch-8);\">'text-embedding-ada-002'</span><span style=\"color: var(--ch-4);\">,</span></span><br></div></div><span class=\"ch-code-line-number\" style=\"position: absolute; top: 0px; left: 0px; transform: translate(0px, 152px); width: 31.5px; opacity: 0.99;\">9</span><div style=\"position: absolute; top: 0px; left: 0px; transform: translate(31.5px, 152px); width: 630px;\"><div style=\"display: inline-block; width: 100%;\"><span style=\"opacity: 0.99;\"><span style=\"color: var(--ch-4);\">    input: sanitizedQuery.</span><span style=\"color: var(--ch-5);\">replaceAll</span><span style=\"color: var(--ch-4);\">(</span><span style=\"color: var(--ch-8);\">'</span><span style=\"color: var(--ch-2);\">\\n</span><span style=\"color: var(--ch-8);\">'</span><span style=\"color: var(--ch-4);\">, </span><span style=\"color: var(--ch-8);\">' '</span><span style=\"color: var(--ch-4);\">),</span></span><br></div></div><span class=\"ch-code-line-number\" style=\"position: absolute; top: 0px; left: 0px; transform: translate(0px, 171px); width: 31.5px; opacity: 0.99;\">10</span><div style=\"position: absolute; top: 0px; left: 0px; transform: translate(31.5px, 171px); width: 630px;\"><div style=\"display: inline-block; width: 100%;\"><span style=\"opacity: 0.99;\"><span style=\"color: var(--ch-4);\">  }),</span></span><br></div></div><span class=\"ch-code-line-number\" style=\"position: absolute; top: 0px; left: 0px; transform: translate(0px, 190px); width: 31.5px; opacity: 0.99;\">11</span><div style=\"position: absolute; top: 0px; left: 0px; transform: translate(31.5px, 190px); width: 630px;\"><div style=\"display: inline-block; width: 100%;\"><span style=\"opacity: 0.99;\"><span style=\"color: var(--ch-4);\">})</span></span><br></div></div><span class=\"ch-code-line-number\" style=\"position: absolute; top: 0px; left: 0px; transform: translate(0px, 209px); width: 31.5px; opacity: 0.99;\">12</span><div style=\"position: absolute; top: 0px; left: 0px; transform: translate(31.5px, 209px); width: 630px;\"><div style=\"display: inline-block; width: 100%;\"><span style=\"opacity: 0.99;\"><span style=\"color: var(--ch-4);\"></span></span><br></div></div><span class=\"ch-code-line-number\" style=\"position: absolute; top: 0px; left: 0px; transform: translate(0px, 228px); width: 31.5px; opacity: 0.99;\">13</span><div style=\"position: absolute; top: 0px; left: 0px; transform: translate(31.5px, 228px); width: 630px;\"><div style=\"display: inline-block; width: 100%;\"><span style=\"opacity: 0.99;\"><span style=\"color: var(--ch-7);\">if</span><span style=\"color: var(--ch-4);\"> (embeddingResponse.status </span><span style=\"color: var(--ch-7);\">!== </span><span style=\"color: var(--ch-2);\">200</span><span style=\"color: var(--ch-4);\">) {</span></span><br></div></div><span class=\"ch-code-line-number\" style=\"position: absolute; top: 0px; left: 0px; transform: translate(0px, 247px); width: 31.5px; opacity: 0.99;\">14</span><div style=\"position: absolute; top: 0px; left: 0px; transform: translate(31.5px, 247px); width: 630px;\"><div style=\"display: inline-block; width: 100%;\"><span style=\"opacity: 0.99;\"><span style=\"color: var(--ch-7);\">  throw new </span><span style=\"color: var(--ch-5);\">ApplicationError</span><span style=\"color: var(--ch-4);\">(</span><span style=\"color: var(--ch-8);\">'Failed to create embedding for question'</span><span style=\"color: var(--ch-4);\">, embeddingResponse)</span></span><br></div></div><span class=\"ch-code-line-number\" style=\"position: absolute; top: 0px; left: 0px; transform: translate(0px, 266px); width: 31.5px; opacity: 0.99;\">15</span><div style=\"position: absolute; top: 0px; left: 0px; transform: translate(31.5px, 266px); width: 630px;\"><div style=\"display: inline-block; width: 100%;\"><span style=\"opacity: 0.99;\"><span style=\"color: var(--ch-4);\">}</span></span><br></div></div><span class=\"ch-code-line-number\" style=\"position: absolute; top: 0px; left: 0px; transform: translate(0px, 285px); width: 31.5px; opacity: 0.99;\">16</span><div style=\"position: absolute; top: 0px; left: 0px; transform: translate(31.5px, 285px); width: 630px;\"><div style=\"display: inline-block; width: 100%;\"><span style=\"opacity: 0.99;\"><span style=\"color: var(--ch-4);\"></span></span><br></div></div><span class=\"ch-code-line-number\" style=\"position: absolute; top: 0px; left: 0px; transform: translate(0px, 304px); width: 31.5px; opacity: 0.99;\">17</span><div style=\"position: absolute; top: 0px; left: 0px; transform: translate(31.5px, 304px); width: 630px;\"><div style=\"display: inline-block; width: 100%;\"><span style=\"opacity: 0.99;\"><span style=\"color: var(--ch-7);\">const</span><span style=\"color: var(--ch-4);\"> {</span></span><br></div></div><span class=\"ch-code-line-number\" style=\"position: absolute; top: 0px; left: 0px; transform: translate(0px, 323px); width: 31.5px; opacity: 0.99;\">18</span><div style=\"position: absolute; top: 0px; left: 0px; transform: translate(31.5px, 323px); width: 630px;\"><div style=\"display: inline-block; width: 100%;\"><span style=\"opacity: 0.99;\"><span style=\"color: var(--ch-3);\">  data</span><span style=\"color: var(--ch-4);\">: [{ </span><span style=\"color: var(--ch-2);\">embedding</span><span style=\"color: var(--ch-4);\"> }],</span></span><br></div></div><span class=\"ch-code-line-number\" style=\"position: absolute; top: 0px; left: 0px; transform: translate(0px, 342px); width: 31.5px; opacity: 0.99;\">19</span><div style=\"position: absolute; top: 0px; left: 0px; transform: translate(31.5px, 342px); width: 630px;\"><div style=\"display: inline-block; width: 100%;\"><span style=\"opacity: 0.99;\"><span style=\"color: var(--ch-4);\">} </span><span style=\"color: var(--ch-7);\">= await</span><span style=\"color: var(--ch-4);\"> embeddingResponse.</span><span style=\"color: var(--ch-5);\">json</span><span style=\"color: var(--ch-4);\">()</span></span><br></div></div></div></div></code><button type=\"button\" title=\"Copy code\" class=\"ch-code-button\"><svg fill=\"none\" stroke=\"currentColor\" viewBox=\"0 0 24 24\" xmlns=\"http://www.w3.org/2000/svg\"><path stroke-linecap=\"round\" stroke-linejoin=\"round\" stroke-width=\"1.6px\" d=\"M8 16H6a2 2 0 01-2-2V6a2 2 0 012-2h8a2 2 0 012 2v2m-6 12h8a2 2 0 002-2v-8a2 2 0 00-2-2h-8a2 2 0 00-2 2v8a2 2 0 002 2z\"></path></svg></button></div></div></div></div></div><div class=\"relative pb-8 group\"><div class=\" absolute w-px left-[11px] pt-1 h-full \"><div class=\" absolute w-full h-full py-1 bg-border-control group-last:bg-transparent \"></div></div><div class=\" absolute left-0 flex gap-3 items-center not-prose \"><div class=\"flex items-center gap-6\"><div class=\"border bg-surface-100 border-control flex items-center justify-center rounded-full w-6 h-6 text-xs text-foreground font-normal font-mono dropshadow-sm \">2</div></div></div><div class=\"grid grid-cols-1 lg:grid-cols-12 lg:gap-10 lg:ml-12\"><div class=\"col-span-5 ml-12 lg:ml-0\"><h3 class=\"mt-0 text-foreground text-base\">Perform similarity search</h3><p>Using the <code>embeddingResponse</code> we can now perform similarity search by performing an remote procedure call (RPC) to the database function we created earlier.</p></div><div class=\"col-span-7 not-prose\"><div class=\"ch-codeblock not-prose \" data-ch-theme=\"supabase\"><div class=\"ch-code-wrapper ch-code\" data-ch-measured=\"true\"><code class=\"ch-code-scroll-parent\" data-ch-lang=\"ts\" style=\"width: 495.5px; height: 226px; position: relative; overflow: auto;\"><div class=\"ch-code-scroll-content\" style=\"position: absolute; top: 0px; left: 0px; transform-origin: left top; width: 556.5px; height: 209px; overflow: hidden;\"><div style=\"position: absolute; top: 0px; left: 0px; transform: translateX(0px) translateY(19px) scale(1); transform-origin: left top; width: 556.5px; height: 171px;\"><span class=\"ch-code-line-number\" style=\"position: absolute; top: 0px; left: 0px; transform: translate(0px, 0px); width: 31.5px; opacity: 0.99;\">1</span><div style=\"position: absolute; top: 0px; left: 0px; transform: translate(31.5px, 0px); width: 525px;\"><div style=\"display: inline-block; width: 100%;\"><span style=\"opacity: 0.99;\"><span style=\"color: var(--ch-7);\">const</span><span style=\"color: var(--ch-4);\"> { </span><span style=\"color: var(--ch-3);\">error</span><span style=\"color: var(--ch-4);\">: </span><span style=\"color: var(--ch-2);\">matchError</span><span style=\"color: var(--ch-4);\">, </span><span style=\"color: var(--ch-3);\">data</span><span style=\"color: var(--ch-4);\">: </span><span style=\"color: var(--ch-2);\">pageSections</span><span style=\"color: var(--ch-4);\"> } </span><span style=\"color: var(--ch-7);\">= await</span><span style=\"color: var(--ch-4);\"> supabaseClient.</span><span style=\"color: var(--ch-5);\">rpc</span><span style=\"color: var(--ch-4);\">(</span></span><br></div></div><span class=\"ch-code-line-number\" style=\"position: absolute; top: 0px; left: 0px; transform: translate(0px, 19px); width: 31.5px; opacity: 0.99;\">2</span><div style=\"position: absolute; top: 0px; left: 0px; transform: translate(31.5px, 19px); width: 525px;\"><div style=\"display: inline-block; width: 100%;\"><span style=\"opacity: 0.99;\"><span style=\"color: var(--ch-8);\">  'match_page_sections'</span><span style=\"color: var(--ch-4);\">,</span></span><br></div></div><span class=\"ch-code-line-number\" style=\"position: absolute; top: 0px; left: 0px; transform: translate(0px, 38px); width: 31.5px; opacity: 0.99;\">3</span><div style=\"position: absolute; top: 0px; left: 0px; transform: translate(31.5px, 38px); width: 525px;\"><div style=\"display: inline-block; width: 100%;\"><span style=\"opacity: 0.99;\"><span style=\"color: var(--ch-4);\">  {</span></span><br></div></div><span class=\"ch-code-line-number\" style=\"position: absolute; top: 0px; left: 0px; transform: translate(0px, 57px); width: 31.5px; opacity: 0.99;\">4</span><div style=\"position: absolute; top: 0px; left: 0px; transform: translate(31.5px, 57px); width: 525px;\"><div style=\"display: inline-block; width: 100%;\"><span style=\"opacity: 0.99;\"><span style=\"color: var(--ch-4);\">    embedding,</span></span><br></div></div><span class=\"ch-code-line-number\" style=\"position: absolute; top: 0px; left: 0px; transform: translate(0px, 76px); width: 31.5px; opacity: 0.99;\">5</span><div style=\"position: absolute; top: 0px; left: 0px; transform: translate(31.5px, 76px); width: 525px;\"><div style=\"display: inline-block; width: 100%;\"><span style=\"opacity: 0.99;\"><span style=\"color: var(--ch-4);\">    match_threshold: </span><span style=\"color: var(--ch-2);\">0.78</span><span style=\"color: var(--ch-4);\">,</span></span><br></div></div><span class=\"ch-code-line-number\" style=\"position: absolute; top: 0px; left: 0px; transform: translate(0px, 95px); width: 31.5px; opacity: 0.99;\">6</span><div style=\"position: absolute; top: 0px; left: 0px; transform: translate(31.5px, 95px); width: 525px;\"><div style=\"display: inline-block; width: 100%;\"><span style=\"opacity: 0.99;\"><span style=\"color: var(--ch-4);\">    match_count: </span><span style=\"color: var(--ch-2);\">10</span><span style=\"color: var(--ch-4);\">,</span></span><br></div></div><span class=\"ch-code-line-number\" style=\"position: absolute; top: 0px; left: 0px; transform: translate(0px, 114px); width: 31.5px; opacity: 0.99;\">7</span><div style=\"position: absolute; top: 0px; left: 0px; transform: translate(31.5px, 114px); width: 525px;\"><div style=\"display: inline-block; width: 100%;\"><span style=\"opacity: 0.99;\"><span style=\"color: var(--ch-4);\">    min_content_length: </span><span style=\"color: var(--ch-2);\">50</span><span style=\"color: var(--ch-4);\">,</span></span><br></div></div><span class=\"ch-code-line-number\" style=\"position: absolute; top: 0px; left: 0px; transform: translate(0px, 133px); width: 31.5px; opacity: 0.99;\">8</span><div style=\"position: absolute; top: 0px; left: 0px; transform: translate(31.5px, 133px); width: 525px;\"><div style=\"display: inline-block; width: 100%;\"><span style=\"opacity: 0.99;\"><span style=\"color: var(--ch-4);\">  }</span></span><br></div></div><span class=\"ch-code-line-number\" style=\"position: absolute; top: 0px; left: 0px; transform: translate(0px, 152px); width: 31.5px; opacity: 0.99;\">9</span><div style=\"position: absolute; top: 0px; left: 0px; transform: translate(31.5px, 152px); width: 525px;\"><div style=\"display: inline-block; width: 100%;\"><span style=\"opacity: 0.99;\"><span style=\"color: var(--ch-4);\">)</span></span><br></div></div></div></div></code><button type=\"button\" title=\"Copy code\" class=\"ch-code-button\"><svg fill=\"none\" stroke=\"currentColor\" viewBox=\"0 0 24 24\" xmlns=\"http://www.w3.org/2000/svg\"><path stroke-linecap=\"round\" stroke-linejoin=\"round\" stroke-width=\"1.6px\" d=\"M8 16H6a2 2 0 01-2-2V6a2 2 0 012-2h8a2 2 0 012 2v2m-6 12h8a2 2 0 002-2v-8a2 2 0 00-2-2h-8a2 2 0 00-2 2v8a2 2 0 002 2z\"></path></svg></button></div></div></div></div></div><div class=\"relative pb-8 group\"><div class=\" absolute w-px left-[11px] pt-1 h-full \"><div class=\" absolute w-full h-full py-1 bg-border-control group-last:bg-transparent \"></div></div><div class=\" absolute left-0 flex gap-3 items-center not-prose \"><div class=\"flex items-center gap-6\"><div class=\"border bg-surface-100 border-control flex items-center justify-center rounded-full w-6 h-6 text-xs text-foreground font-normal font-mono dropshadow-sm \">3</div></div></div><div class=\"grid grid-cols-1 lg:grid-cols-12 lg:gap-10 lg:ml-12\"><div class=\"col-span-5 ml-12 lg:ml-0\"><h3 class=\"mt-0 text-foreground text-base\">Perform text completion request</h3><p>With the relevant content for the user's question identified, we can now build the prompt and make a text completion request via the OpenAI API.</p><p>If successful, the OpenAI API will respond with a <code>text/event-stream</code> response that we can simply forward to the client where we'll process the event stream to smoothly print the answer to the user.</p></div><div class=\"col-span-7 not-prose\"><div class=\"ch-codeblock not-prose \" data-ch-theme=\"supabase\"><div class=\"ch-code-wrapper ch-code\" data-ch-measured=\"true\"><code class=\"ch-code-scroll-parent\" data-ch-lang=\"ts\" style=\"width: 495.5px; height: 967px; position: relative; overflow: auto;\"><div class=\"ch-code-scroll-content\" style=\"position: absolute; top: 0px; left: 0px; transform-origin: left top; width: 528.5px; height: 950px; overflow: hidden;\"><div style=\"position: absolute; top: 0px; left: 0px; transform: translateX(0px) translateY(19px) scale(1); transform-origin: left top; width: 528.5px; height: 912px;\"><span class=\"ch-code-line-number\" style=\"position: absolute; top: 0px; left: 0px; transform: translate(0px, 0px); width: 31.5px; opacity: 0.99;\">1</span><div style=\"position: absolute; top: 0px; left: 0px; transform: translate(31.5px, 0px); width: 497px;\"><div style=\"display: inline-block; width: 100%;\"><span style=\"opacity: 0.99;\"><span style=\"color: var(--ch-7);\">const </span><span style=\"color: var(--ch-2);\">prompt </span><span style=\"color: var(--ch-7);\">= </span><span style=\"color: var(--ch-5);\">codeBlock</span><span style=\"color: var(--ch-8);\">`</span></span><br></div></div><span class=\"ch-code-line-number\" style=\"position: absolute; top: 0px; left: 0px; transform: translate(0px, 19px); width: 31.5px; opacity: 0.99;\">2</span><div style=\"position: absolute; top: 0px; left: 0px; transform: translate(31.5px, 19px); width: 497px;\"><div style=\"display: inline-block; width: 100%;\"><span style=\"opacity: 0.99;\"><span style=\"color: var(--ch-8);\">  ${</span><span style=\"color: var(--ch-5);\">oneLine</span><span style=\"color: var(--ch-8);\">`</span></span><br></div></div><span class=\"ch-code-line-number\" style=\"position: absolute; top: 0px; left: 0px; transform: translate(0px, 38px); width: 31.5px; opacity: 0.99;\">3</span><div style=\"position: absolute; top: 0px; left: 0px; transform: translate(31.5px, 38px); width: 497px;\"><div style=\"display: inline-block; width: 100%;\"><span style=\"opacity: 0.99;\"><span style=\"color: var(--ch-8);\">    You are a very enthusiastic Supabase representative who loves</span></span><br></div></div><span class=\"ch-code-line-number\" style=\"position: absolute; top: 0px; left: 0px; transform: translate(0px, 57px); width: 31.5px; opacity: 0.99;\">4</span><div style=\"position: absolute; top: 0px; left: 0px; transform: translate(31.5px, 57px); width: 497px;\"><div style=\"display: inline-block; width: 100%;\"><span style=\"opacity: 0.99;\"><span style=\"color: var(--ch-8);\">    to help people! Given the following sections from the Supabase</span></span><br></div></div><span class=\"ch-code-line-number\" style=\"position: absolute; top: 0px; left: 0px; transform: translate(0px, 76px); width: 31.5px; opacity: 0.99;\">5</span><div style=\"position: absolute; top: 0px; left: 0px; transform: translate(31.5px, 76px); width: 497px;\"><div style=\"display: inline-block; width: 100%;\"><span style=\"opacity: 0.99;\"><span style=\"color: var(--ch-8);\">    documentation, answer the question using only that information,</span></span><br></div></div><span class=\"ch-code-line-number\" style=\"position: absolute; top: 0px; left: 0px; transform: translate(0px, 95px); width: 31.5px; opacity: 0.99;\">6</span><div style=\"position: absolute; top: 0px; left: 0px; transform: translate(31.5px, 95px); width: 497px;\"><div style=\"display: inline-block; width: 100%;\"><span style=\"opacity: 0.99;\"><span style=\"color: var(--ch-8);\">    outputted in markdown format. If you are unsure and the answer</span></span><br></div></div><span class=\"ch-code-line-number\" style=\"position: absolute; top: 0px; left: 0px; transform: translate(0px, 114px); width: 31.5px; opacity: 0.99;\">7</span><div style=\"position: absolute; top: 0px; left: 0px; transform: translate(31.5px, 114px); width: 497px;\"><div style=\"display: inline-block; width: 100%;\"><span style=\"opacity: 0.99;\"><span style=\"color: var(--ch-8);\">    is not explicitly written in the documentation, say</span></span><br></div></div><span class=\"ch-code-line-number\" style=\"position: absolute; top: 0px; left: 0px; transform: translate(0px, 133px); width: 31.5px; opacity: 0.99;\">8</span><div style=\"position: absolute; top: 0px; left: 0px; transform: translate(31.5px, 133px); width: 497px;\"><div style=\"display: inline-block; width: 100%;\"><span style=\"opacity: 0.99;\"><span style=\"color: var(--ch-8);\">    \"Sorry, I don't know how to help with that.\"</span></span><br></div></div><span class=\"ch-code-line-number\" style=\"position: absolute; top: 0px; left: 0px; transform: translate(0px, 152px); width: 31.5px; opacity: 0.99;\">9</span><div style=\"position: absolute; top: 0px; left: 0px; transform: translate(31.5px, 152px); width: 497px;\"><div style=\"display: inline-block; width: 100%;\"><span style=\"opacity: 0.99;\"><span style=\"color: var(--ch-8);\">  `}</span></span><br></div></div><span class=\"ch-code-line-number\" style=\"position: absolute; top: 0px; left: 0px; transform: translate(0px, 171px); width: 31.5px; opacity: 0.99;\">10</span><div style=\"position: absolute; top: 0px; left: 0px; transform: translate(31.5px, 171px); width: 497px;\"><div style=\"display: inline-block; width: 100%;\"><span style=\"opacity: 0.99;\"><span style=\"color: var(--ch-8);\"></span></span><br></div></div><span class=\"ch-code-line-number\" style=\"position: absolute; top: 0px; left: 0px; transform: translate(0px, 190px); width: 31.5px; opacity: 0.99;\">11</span><div style=\"position: absolute; top: 0px; left: 0px; transform: translate(31.5px, 190px); width: 497px;\"><div style=\"display: inline-block; width: 100%;\"><span style=\"opacity: 0.99;\"><span style=\"color: var(--ch-8);\">  Context sections:</span></span><br></div></div><span class=\"ch-code-line-number\" style=\"position: absolute; top: 0px; left: 0px; transform: translate(0px, 209px); width: 31.5px; opacity: 0.99;\">12</span><div style=\"position: absolute; top: 0px; left: 0px; transform: translate(31.5px, 209px); width: 497px;\"><div style=\"display: inline-block; width: 100%;\"><span style=\"opacity: 0.99;\"><span style=\"color: var(--ch-8);\">  ${</span><span style=\"color: var(--ch-4);\">contextText</span><span style=\"color: var(--ch-8);\">}</span></span><br></div></div><span class=\"ch-code-line-number\" style=\"position: absolute; top: 0px; left: 0px; transform: translate(0px, 228px); width: 31.5px; opacity: 0.99;\">13</span><div style=\"position: absolute; top: 0px; left: 0px; transform: translate(31.5px, 228px); width: 497px;\"><div style=\"display: inline-block; width: 100%;\"><span style=\"opacity: 0.99;\"><span style=\"color: var(--ch-8);\"></span></span><br></div></div><span class=\"ch-code-line-number\" style=\"position: absolute; top: 0px; left: 0px; transform: translate(0px, 247px); width: 31.5px; opacity: 0.99;\">14</span><div style=\"position: absolute; top: 0px; left: 0px; transform: translate(31.5px, 247px); width: 497px;\"><div style=\"display: inline-block; width: 100%;\"><span style=\"opacity: 0.99;\"><span style=\"color: var(--ch-8);\">  Question: \"\"\"</span></span><br></div></div><span class=\"ch-code-line-number\" style=\"position: absolute; top: 0px; left: 0px; transform: translate(0px, 266px); width: 31.5px; opacity: 0.99;\">15</span><div style=\"position: absolute; top: 0px; left: 0px; transform: translate(31.5px, 266px); width: 497px;\"><div style=\"display: inline-block; width: 100%;\"><span style=\"opacity: 0.99;\"><span style=\"color: var(--ch-8);\">  ${</span><span style=\"color: var(--ch-4);\">sanitizedQuery</span><span style=\"color: var(--ch-8);\">}</span></span><br></div></div><span class=\"ch-code-line-number\" style=\"position: absolute; top: 0px; left: 0px; transform: translate(0px, 285px); width: 31.5px; opacity: 0.99;\">16</span><div style=\"position: absolute; top: 0px; left: 0px; transform: translate(31.5px, 285px); width: 497px;\"><div style=\"display: inline-block; width: 100%;\"><span style=\"opacity: 0.99;\"><span style=\"color: var(--ch-8);\">  \"\"\"</span></span><br></div></div><span class=\"ch-code-line-number\" style=\"position: absolute; top: 0px; left: 0px; transform: translate(0px, 304px); width: 31.5px; opacity: 0.99;\">17</span><div style=\"position: absolute; top: 0px; left: 0px; transform: translate(31.5px, 304px); width: 497px;\"><div style=\"display: inline-block; width: 100%;\"><span style=\"opacity: 0.99;\"><span style=\"color: var(--ch-8);\"></span></span><br></div></div><span class=\"ch-code-line-number\" style=\"position: absolute; top: 0px; left: 0px; transform: translate(0px, 323px); width: 31.5px; opacity: 0.99;\">18</span><div style=\"position: absolute; top: 0px; left: 0px; transform: translate(31.5px, 323px); width: 497px;\"><div style=\"display: inline-block; width: 100%;\"><span style=\"opacity: 0.99;\"><span style=\"color: var(--ch-8);\">  Answer as markdown (including related code snippets if available):</span></span><br></div></div><span class=\"ch-code-line-number\" style=\"position: absolute; top: 0px; left: 0px; transform: translate(0px, 342px); width: 31.5px; opacity: 0.99;\">19</span><div style=\"position: absolute; top: 0px; left: 0px; transform: translate(31.5px, 342px); width: 497px;\"><div style=\"display: inline-block; width: 100%;\"><span style=\"opacity: 0.99;\"><span style=\"color: var(--ch-8);\">`</span></span><br></div></div><span class=\"ch-code-line-number\" style=\"position: absolute; top: 0px; left: 0px; transform: translate(0px, 361px); width: 31.5px; opacity: 0.99;\">20</span><div style=\"position: absolute; top: 0px; left: 0px; transform: translate(31.5px, 361px); width: 497px;\"><div style=\"display: inline-block; width: 100%;\"><span style=\"opacity: 0.99;\"><span style=\"color: var(--ch-4);\"></span></span><br></div></div><span class=\"ch-code-line-number\" style=\"position: absolute; top: 0px; left: 0px; transform: translate(0px, 380px); width: 31.5px; opacity: 0.99;\">21</span><div style=\"position: absolute; top: 0px; left: 0px; transform: translate(31.5px, 380px); width: 497px;\"><div style=\"display: inline-block; width: 100%;\"><span style=\"opacity: 0.99;\"><span style=\"color: var(--ch-7);\">const </span><span style=\"color: var(--ch-2);\">completionOptions</span><span style=\"color: var(--ch-7);\">: </span><span style=\"color: var(--ch-3);\">CreateCompletionRequest </span><span style=\"color: var(--ch-7);\">=</span><span style=\"color: var(--ch-4);\"> {</span></span><br></div></div><span class=\"ch-code-line-number\" style=\"position: absolute; top: 0px; left: 0px; transform: translate(0px, 399px); width: 31.5px; opacity: 0.99;\">22</span><div style=\"position: absolute; top: 0px; left: 0px; transform: translate(31.5px, 399px); width: 497px;\"><div style=\"display: inline-block; width: 100%;\"><span style=\"opacity: 0.99;\"><span style=\"color: var(--ch-4);\">  model: </span><span style=\"color: var(--ch-8);\">'gpt-3.5-turbo-instruct'</span><span style=\"color: var(--ch-4);\">,</span></span><br></div></div><span class=\"ch-code-line-number\" style=\"position: absolute; top: 0px; left: 0px; transform: translate(0px, 418px); width: 31.5px; opacity: 0.99;\">23</span><div style=\"position: absolute; top: 0px; left: 0px; transform: translate(31.5px, 418px); width: 497px;\"><div style=\"display: inline-block; width: 100%;\"><span style=\"opacity: 0.99;\"><span style=\"color: var(--ch-4);\">  prompt,</span></span><br></div></div><span class=\"ch-code-line-number\" style=\"position: absolute; top: 0px; left: 0px; transform: translate(0px, 437px); width: 31.5px; opacity: 0.99;\">24</span><div style=\"position: absolute; top: 0px; left: 0px; transform: translate(31.5px, 437px); width: 497px;\"><div style=\"display: inline-block; width: 100%;\"><span style=\"opacity: 0.99;\"><span style=\"color: var(--ch-4);\">  max_tokens: </span><span style=\"color: var(--ch-2);\">512</span><span style=\"color: var(--ch-4);\">,</span></span><br></div></div><span class=\"ch-code-line-number\" style=\"position: absolute; top: 0px; left: 0px; transform: translate(0px, 456px); width: 31.5px; opacity: 0.99;\">25</span><div style=\"position: absolute; top: 0px; left: 0px; transform: translate(31.5px, 456px); width: 497px;\"><div style=\"display: inline-block; width: 100%;\"><span style=\"opacity: 0.99;\"><span style=\"color: var(--ch-4);\">  temperature: </span><span style=\"color: var(--ch-2);\">0</span><span style=\"color: var(--ch-4);\">,</span></span><br></div></div><span class=\"ch-code-line-number\" style=\"position: absolute; top: 0px; left: 0px; transform: translate(0px, 475px); width: 31.5px; opacity: 0.99;\">26</span><div style=\"position: absolute; top: 0px; left: 0px; transform: translate(31.5px, 475px); width: 497px;\"><div style=\"display: inline-block; width: 100%;\"><span style=\"opacity: 0.99;\"><span style=\"color: var(--ch-4);\">  stream: </span><span style=\"color: var(--ch-2);\">true</span><span style=\"color: var(--ch-4);\">,</span></span><br></div></div><span class=\"ch-code-line-number\" style=\"position: absolute; top: 0px; left: 0px; transform: translate(0px, 494px); width: 31.5px; opacity: 0.99;\">27</span><div style=\"position: absolute; top: 0px; left: 0px; transform: translate(31.5px, 494px); width: 497px;\"><div style=\"display: inline-block; width: 100%;\"><span style=\"opacity: 0.99;\"><span style=\"color: var(--ch-4);\">}</span></span><br></div></div><span class=\"ch-code-line-number\" style=\"position: absolute; top: 0px; left: 0px; transform: translate(0px, 513px); width: 31.5px; opacity: 0.99;\">28</span><div style=\"position: absolute; top: 0px; left: 0px; transform: translate(31.5px, 513px); width: 497px;\"><div style=\"display: inline-block; width: 100%;\"><span style=\"opacity: 0.99;\"><span style=\"color: var(--ch-4);\"></span></span><br></div></div><span class=\"ch-code-line-number\" style=\"position: absolute; top: 0px; left: 0px; transform: translate(0px, 532px); width: 31.5px; opacity: 0.99;\">29</span><div style=\"position: absolute; top: 0px; left: 0px; transform: translate(31.5px, 532px); width: 497px;\"><div style=\"display: inline-block; width: 100%;\"><span style=\"opacity: 0.99;\"><span style=\"color: var(--ch-7);\">const </span><span style=\"color: var(--ch-2);\">response </span><span style=\"color: var(--ch-7);\">= await </span><span style=\"color: var(--ch-5);\">fetch</span><span style=\"color: var(--ch-4);\">(</span><span style=\"color: var(--ch-8);\">'https://api.openai.com/v1/completions'</span><span style=\"color: var(--ch-4);\">, {</span></span><br></div></div><span class=\"ch-code-line-number\" style=\"position: absolute; top: 0px; left: 0px; transform: translate(0px, 551px); width: 31.5px; opacity: 0.99;\">30</span><div style=\"position: absolute; top: 0px; left: 0px; transform: translate(31.5px, 551px); width: 497px;\"><div style=\"display: inline-block; width: 100%;\"><span style=\"opacity: 0.99;\"><span style=\"color: var(--ch-4);\">  method: </span><span style=\"color: var(--ch-8);\">'POST'</span><span style=\"color: var(--ch-4);\">,</span></span><br></div></div><span class=\"ch-code-line-number\" style=\"position: absolute; top: 0px; left: 0px; transform: translate(0px, 570px); width: 31.5px; opacity: 0.99;\">31</span><div style=\"position: absolute; top: 0px; left: 0px; transform: translate(31.5px, 570px); width: 497px;\"><div style=\"display: inline-block; width: 100%;\"><span style=\"opacity: 0.99;\"><span style=\"color: var(--ch-4);\">  headers: {</span></span><br></div></div><span class=\"ch-code-line-number\" style=\"position: absolute; top: 0px; left: 0px; transform: translate(0px, 589px); width: 31.5px; opacity: 0.99;\">32</span><div style=\"position: absolute; top: 0px; left: 0px; transform: translate(31.5px, 589px); width: 497px;\"><div style=\"display: inline-block; width: 100%;\"><span style=\"opacity: 0.99;\"><span style=\"color: var(--ch-4);\">    Authorization: </span><span style=\"color: var(--ch-8);\">`Bearer ${</span><span style=\"color: var(--ch-4);\">openAiKey</span><span style=\"color: var(--ch-8);\">}`</span><span style=\"color: var(--ch-4);\">,</span></span><br></div></div><span class=\"ch-code-line-number\" style=\"position: absolute; top: 0px; left: 0px; transform: translate(0px, 608px); width: 31.5px; opacity: 0.99;\">33</span><div style=\"position: absolute; top: 0px; left: 0px; transform: translate(31.5px, 608px); width: 497px;\"><div style=\"display: inline-block; width: 100%;\"><span style=\"opacity: 0.99;\"><span style=\"color: var(--ch-8);\">    'Content-Type'</span><span style=\"color: var(--ch-4);\">: </span><span style=\"color: var(--ch-8);\">'application/json'</span><span style=\"color: var(--ch-4);\">,</span></span><br></div></div><span class=\"ch-code-line-number\" style=\"position: absolute; top: 0px; left: 0px; transform: translate(0px, 627px); width: 31.5px; opacity: 0.99;\">34</span><div style=\"position: absolute; top: 0px; left: 0px; transform: translate(31.5px, 627px); width: 497px;\"><div style=\"display: inline-block; width: 100%;\"><span style=\"opacity: 0.99;\"><span style=\"color: var(--ch-4);\">  },</span></span><br></div></div><span class=\"ch-code-line-number\" style=\"position: absolute; top: 0px; left: 0px; transform: translate(0px, 646px); width: 31.5px; opacity: 0.99;\">35</span><div style=\"position: absolute; top: 0px; left: 0px; transform: translate(31.5px, 646px); width: 497px;\"><div style=\"display: inline-block; width: 100%;\"><span style=\"opacity: 0.99;\"><span style=\"color: var(--ch-4);\">  body: </span><span style=\"color: var(--ch-2);\">JSON</span><span style=\"color: var(--ch-4);\">.</span><span style=\"color: var(--ch-5);\">stringify</span><span style=\"color: var(--ch-4);\">(completionOptions),</span></span><br></div></div><span class=\"ch-code-line-number\" style=\"position: absolute; top: 0px; left: 0px; transform: translate(0px, 665px); width: 31.5px; opacity: 0.99;\">36</span><div style=\"position: absolute; top: 0px; left: 0px; transform: translate(31.5px, 665px); width: 497px;\"><div style=\"display: inline-block; width: 100%;\"><span style=\"opacity: 0.99;\"><span style=\"color: var(--ch-4);\">})</span></span><br></div></div><span class=\"ch-code-line-number\" style=\"position: absolute; top: 0px; left: 0px; transform: translate(0px, 684px); width: 31.5px; opacity: 0.99;\">37</span><div style=\"position: absolute; top: 0px; left: 0px; transform: translate(31.5px, 684px); width: 497px;\"><div style=\"display: inline-block; width: 100%;\"><span style=\"opacity: 0.99;\"><span style=\"color: var(--ch-4);\"></span></span><br></div></div><span class=\"ch-code-line-number\" style=\"position: absolute; top: 0px; left: 0px; transform: translate(0px, 703px); width: 31.5px; opacity: 0.99;\">38</span><div style=\"position: absolute; top: 0px; left: 0px; transform: translate(31.5px, 703px); width: 497px;\"><div style=\"display: inline-block; width: 100%;\"><span style=\"opacity: 0.99;\"><span style=\"color: var(--ch-7);\">if</span><span style=\"color: var(--ch-4);\"> (</span><span style=\"color: var(--ch-7);\">!</span><span style=\"color: var(--ch-4);\">response.ok) {</span></span><br></div></div><span class=\"ch-code-line-number\" style=\"position: absolute; top: 0px; left: 0px; transform: translate(0px, 722px); width: 31.5px; opacity: 0.99;\">39</span><div style=\"position: absolute; top: 0px; left: 0px; transform: translate(31.5px, 722px); width: 497px;\"><div style=\"display: inline-block; width: 100%;\"><span style=\"opacity: 0.99;\"><span style=\"color: var(--ch-7);\">  const </span><span style=\"color: var(--ch-2);\">error </span><span style=\"color: var(--ch-7);\">= await</span><span style=\"color: var(--ch-4);\"> response.</span><span style=\"color: var(--ch-5);\">json</span><span style=\"color: var(--ch-4);\">()</span></span><br></div></div><span class=\"ch-code-line-number\" style=\"position: absolute; top: 0px; left: 0px; transform: translate(0px, 741px); width: 31.5px; opacity: 0.99;\">40</span><div style=\"position: absolute; top: 0px; left: 0px; transform: translate(31.5px, 741px); width: 497px;\"><div style=\"display: inline-block; width: 100%;\"><span style=\"opacity: 0.99;\"><span style=\"color: var(--ch-7);\">  throw new </span><span style=\"color: var(--ch-5);\">ApplicationError</span><span style=\"color: var(--ch-4);\">(</span><span style=\"color: var(--ch-8);\">'Failed to generate completion'</span><span style=\"color: var(--ch-4);\">, error)</span></span><br></div></div><span class=\"ch-code-line-number\" style=\"position: absolute; top: 0px; left: 0px; transform: translate(0px, 760px); width: 31.5px; opacity: 0.99;\">41</span><div style=\"position: absolute; top: 0px; left: 0px; transform: translate(31.5px, 760px); width: 497px;\"><div style=\"display: inline-block; width: 100%;\"><span style=\"opacity: 0.99;\"><span style=\"color: var(--ch-4);\">}</span></span><br></div></div><span class=\"ch-code-line-number\" style=\"position: absolute; top: 0px; left: 0px; transform: translate(0px, 779px); width: 31.5px; opacity: 0.99;\">42</span><div style=\"position: absolute; top: 0px; left: 0px; transform: translate(31.5px, 779px); width: 497px;\"><div style=\"display: inline-block; width: 100%;\"><span style=\"opacity: 0.99;\"><span style=\"color: var(--ch-4);\"></span></span><br></div></div><span class=\"ch-code-line-number\" style=\"position: absolute; top: 0px; left: 0px; transform: translate(0px, 798px); width: 31.5px; opacity: 0.99;\">43</span><div style=\"position: absolute; top: 0px; left: 0px; transform: translate(31.5px, 798px); width: 497px;\"><div style=\"display: inline-block; width: 100%;\"><span style=\"opacity: 0.99;\"><span style=\"color: var(--ch-1);\">// Proxy the streamed SSE response from OpenAI</span></span><br></div></div><span class=\"ch-code-line-number\" style=\"position: absolute; top: 0px; left: 0px; transform: translate(0px, 817px); width: 31.5px; opacity: 0.99;\">44</span><div style=\"position: absolute; top: 0px; left: 0px; transform: translate(31.5px, 817px); width: 497px;\"><div style=\"display: inline-block; width: 100%;\"><span style=\"opacity: 0.99;\"><span style=\"color: var(--ch-7);\">return new </span><span style=\"color: var(--ch-5);\">Response</span><span style=\"color: var(--ch-4);\">(response.body, {</span></span><br></div></div><span class=\"ch-code-line-number\" style=\"position: absolute; top: 0px; left: 0px; transform: translate(0px, 836px); width: 31.5px; opacity: 0.99;\">45</span><div style=\"position: absolute; top: 0px; left: 0px; transform: translate(31.5px, 836px); width: 497px;\"><div style=\"display: inline-block; width: 100%;\"><span style=\"opacity: 0.99;\"><span style=\"color: var(--ch-4);\">  headers: {</span></span><br></div></div><span class=\"ch-code-line-number\" style=\"position: absolute; top: 0px; left: 0px; transform: translate(0px, 855px); width: 31.5px; opacity: 0.99;\">46</span><div style=\"position: absolute; top: 0px; left: 0px; transform: translate(31.5px, 855px); width: 497px;\"><div style=\"display: inline-block; width: 100%;\"><span style=\"opacity: 0.99;\"><span style=\"color: var(--ch-8);\">    'Content-Type'</span><span style=\"color: var(--ch-4);\">: </span><span style=\"color: var(--ch-8);\">'text/event-stream'</span><span style=\"color: var(--ch-4);\">,</span></span><br></div></div><span class=\"ch-code-line-number\" style=\"position: absolute; top: 0px; left: 0px; transform: translate(0px, 874px); width: 31.5px; opacity: 0.99;\">47</span><div style=\"position: absolute; top: 0px; left: 0px; transform: translate(31.5px, 874px); width: 497px;\"><div style=\"display: inline-block; width: 100%;\"><span style=\"opacity: 0.99;\"><span style=\"color: var(--ch-4);\">  },</span></span><br></div></div><span class=\"ch-code-line-number\" style=\"position: absolute; top: 0px; left: 0px; transform: translate(0px, 893px); width: 31.5px; opacity: 0.99;\">48</span><div style=\"position: absolute; top: 0px; left: 0px; transform: translate(31.5px, 893px); width: 497px;\"><div style=\"display: inline-block; width: 100%;\"><span style=\"opacity: 0.99;\"><span style=\"color: var(--ch-4);\">})</span></span><br></div></div></div></div></code><button type=\"button\" title=\"Copy code\" class=\"ch-code-button\"><svg fill=\"none\" stroke=\"currentColor\" viewBox=\"0 0 24 24\" xmlns=\"http://www.w3.org/2000/svg\"><path stroke-linecap=\"round\" stroke-linejoin=\"round\" stroke-width=\"1.6px\" d=\"M8 16H6a2 2 0 01-2-2V6a2 2 0 012-2h8a2 2 0 012 2v2m-6 12h8a2 2 0 002-2v-8a2 2 0 00-2-2h-8a2 2 0 00-2 2v8a2 2 0 002 2z\"></path></svg></button></div></div></div></div></div></div>\n<h2 id=\"display-the-answer-on-the-frontend\" class=\"group scroll-mt-24\">Display the answer on the frontend<a href=\"#display-the-answer-on-the-frontend\" aria-hidden=\"true\" class=\"ml-2 opacity-0 group-hover:opacity-100 transition\"><span aria-hidden=\"true\">#</span></a></h2>\n<p>In a last step, we need to process the event stream from the OpenAI API and print the answer to the user. The full code for this can be found on <a href=\"https://github.com/supabase-community/nextjs-openai-doc-search/blob/main/components/SearchDialog.tsx\">GitHub</a>.</p>\n<div class=\"ch-codeblock not-prose \" data-ch-theme=\"supabase\"><div class=\"ch-code-wrapper ch-code\" data-ch-measured=\"true\"><code class=\"ch-code-scroll-parent\" data-ch-lang=\"ts\" style=\"width: 926px; height: 1218px; position: relative; overflow: auto;\"><div class=\"ch-code-scroll-content\" style=\"position: absolute; top: 0px; left: 0px; transform-origin: left top; width: 924px; height: 1216px; overflow: hidden;\"><div style=\"position: absolute; top: 0px; left: 0px; transform: translateX(0px) translateY(19px) scale(1); transform-origin: left top; width: 924px; height: 1178px;\"><span class=\"ch-code-line-number\" style=\"position: absolute; top: 0px; left: 0px; transform: translate(0px, 0px); width: 31.5px; opacity: 0.99;\">1</span><div style=\"position: absolute; top: 0px; left: 0px; transform: translate(31.5px, 0px); width: 553px;\"><div style=\"display: inline-block; width: 100%;\"><span style=\"opacity: 0.99;\"><span style=\"color: var(--ch-7);\">const </span><span style=\"color: var(--ch-2);\">handleConfirm </span><span style=\"color: var(--ch-7);\">=</span><span style=\"color: var(--ch-4);\"> React.</span><span style=\"color: var(--ch-5);\">useCallback</span><span style=\"color: var(--ch-4);\">(</span></span><br></div></div><span class=\"ch-code-line-number\" style=\"position: absolute; top: 0px; left: 0px; transform: translate(0px, 19px); width: 31.5px; opacity: 0.99;\">2</span><div style=\"position: absolute; top: 0px; left: 0px; transform: translate(31.5px, 19px); width: 553px;\"><div style=\"display: inline-block; width: 100%;\"><span style=\"opacity: 0.99;\"><span style=\"color: var(--ch-7);\">  async</span><span style=\"color: var(--ch-4);\"> (</span><span style=\"color: var(--ch-3);\">query</span><span style=\"color: var(--ch-7);\">: </span><span style=\"color: var(--ch-2);\">string</span><span style=\"color: var(--ch-4);\">) </span><span style=\"color: var(--ch-7);\">=&gt;</span><span style=\"color: var(--ch-4);\"> {</span></span><br></div></div><span class=\"ch-code-line-number\" style=\"position: absolute; top: 0px; left: 0px; transform: translate(0px, 38px); width: 31.5px; opacity: 0.99;\">3</span><div style=\"position: absolute; top: 0px; left: 0px; transform: translate(31.5px, 38px); width: 553px;\"><div style=\"display: inline-block; width: 100%;\"><span style=\"opacity: 0.99;\"><span style=\"color: var(--ch-5);\">    setAnswer</span><span style=\"color: var(--ch-4);\">(</span><span style=\"color: var(--ch-2);\">undefined</span><span style=\"color: var(--ch-4);\">)</span></span><br></div></div><span class=\"ch-code-line-number\" style=\"position: absolute; top: 0px; left: 0px; transform: translate(0px, 57px); width: 31.5px; opacity: 0.99;\">4</span><div style=\"position: absolute; top: 0px; left: 0px; transform: translate(31.5px, 57px); width: 553px;\"><div style=\"display: inline-block; width: 100%;\"><span style=\"opacity: 0.99;\"><span style=\"color: var(--ch-5);\">    setQuestion</span><span style=\"color: var(--ch-4);\">(query)</span></span><br></div></div><span class=\"ch-code-line-number\" style=\"position: absolute; top: 0px; left: 0px; transform: translate(0px, 76px); width: 31.5px; opacity: 0.99;\">5</span><div style=\"position: absolute; top: 0px; left: 0px; transform: translate(31.5px, 76px); width: 553px;\"><div style=\"display: inline-block; width: 100%;\"><span style=\"opacity: 0.99;\"><span style=\"color: var(--ch-5);\">    setSearch</span><span style=\"color: var(--ch-4);\">(</span><span style=\"color: var(--ch-8);\">''</span><span style=\"color: var(--ch-4);\">)</span></span><br></div></div><span class=\"ch-code-line-number\" style=\"position: absolute; top: 0px; left: 0px; transform: translate(0px, 95px); width: 31.5px; opacity: 0.99;\">6</span><div style=\"position: absolute; top: 0px; left: 0px; transform: translate(31.5px, 95px); width: 553px;\"><div style=\"display: inline-block; width: 100%;\"><span style=\"opacity: 0.99;\"><span style=\"color: var(--ch-5);\">    dispatchPromptData</span><span style=\"color: var(--ch-4);\">({ index: promptIndex, answer: </span><span style=\"color: var(--ch-2);\">undefined</span><span style=\"color: var(--ch-4);\">, query })</span></span><br></div></div><span class=\"ch-code-line-number\" style=\"position: absolute; top: 0px; left: 0px; transform: translate(0px, 114px); width: 31.5px; opacity: 0.99;\">7</span><div style=\"position: absolute; top: 0px; left: 0px; transform: translate(31.5px, 114px); width: 553px;\"><div style=\"display: inline-block; width: 100%;\"><span style=\"opacity: 0.99;\"><span style=\"color: var(--ch-5);\">    setHasError</span><span style=\"color: var(--ch-4);\">(</span><span style=\"color: var(--ch-2);\">false</span><span style=\"color: var(--ch-4);\">)</span></span><br></div></div><span class=\"ch-code-line-number\" style=\"position: absolute; top: 0px; left: 0px; transform: translate(0px, 133px); width: 31.5px; opacity: 0.99;\">8</span><div style=\"position: absolute; top: 0px; left: 0px; transform: translate(31.5px, 133px); width: 553px;\"><div style=\"display: inline-block; width: 100%;\"><span style=\"opacity: 0.99;\"><span style=\"color: var(--ch-5);\">    setIsLoading</span><span style=\"color: var(--ch-4);\">(</span><span style=\"color: var(--ch-2);\">true</span><span style=\"color: var(--ch-4);\">)</span></span><br></div></div><span class=\"ch-code-line-number\" style=\"position: absolute; top: 0px; left: 0px; transform: translate(0px, 152px); width: 31.5px; opacity: 0.99;\">9</span><div style=\"position: absolute; top: 0px; left: 0px; transform: translate(31.5px, 152px); width: 553px;\"><div style=\"display: inline-block; width: 100%;\"><span style=\"opacity: 0.99;\"><span style=\"color: var(--ch-4);\"></span></span><br></div></div><span class=\"ch-code-line-number\" style=\"position: absolute; top: 0px; left: 0px; transform: translate(0px, 171px); width: 31.5px; opacity: 0.99;\">10</span><div style=\"position: absolute; top: 0px; left: 0px; transform: translate(31.5px, 171px); width: 553px;\"><div style=\"display: inline-block; width: 100%;\"><span style=\"opacity: 0.99;\"><span style=\"color: var(--ch-7);\">    const </span><span style=\"color: var(--ch-2);\">eventSource </span><span style=\"color: var(--ch-7);\">= new </span><span style=\"color: var(--ch-5);\">SSE</span><span style=\"color: var(--ch-4);\">(</span><span style=\"color: var(--ch-8);\">`api/vector-search`</span><span style=\"color: var(--ch-4);\">, {</span></span><br></div></div><span class=\"ch-code-line-number\" style=\"position: absolute; top: 0px; left: 0px; transform: translate(0px, 190px); width: 31.5px; opacity: 0.99;\">11</span><div style=\"position: absolute; top: 0px; left: 0px; transform: translate(31.5px, 190px); width: 553px;\"><div style=\"display: inline-block; width: 100%;\"><span style=\"opacity: 0.99;\"><span style=\"color: var(--ch-4);\">      headers: {</span></span><br></div></div><span class=\"ch-code-line-number\" style=\"position: absolute; top: 0px; left: 0px; transform: translate(0px, 209px); width: 31.5px; opacity: 0.99;\">12</span><div style=\"position: absolute; top: 0px; left: 0px; transform: translate(31.5px, 209px); width: 553px;\"><div style=\"display: inline-block; width: 100%;\"><span style=\"opacity: 0.99;\"><span style=\"color: var(--ch-4);\">        apikey: process.env.</span><span style=\"color: var(--ch-2);\">NEXT_PUBLIC_SUPABASE_ANON_KEY </span><span style=\"color: var(--ch-7);\">?? </span><span style=\"color: var(--ch-8);\">''</span><span style=\"color: var(--ch-4);\">,</span></span><br></div></div><span class=\"ch-code-line-number\" style=\"position: absolute; top: 0px; left: 0px; transform: translate(0px, 228px); width: 31.5px; opacity: 0.99;\">13</span><div style=\"position: absolute; top: 0px; left: 0px; transform: translate(31.5px, 228px); width: 553px;\"><div style=\"display: inline-block; width: 100%;\"><span style=\"opacity: 0.99;\"><span style=\"color: var(--ch-4);\">        Authorization: </span><span style=\"color: var(--ch-8);\">`Bearer ${</span><span style=\"color: var(--ch-4);\">process</span><span style=\"color: var(--ch-8);\">.</span><span style=\"color: var(--ch-4);\">env</span><span style=\"color: var(--ch-8);\">.</span><span style=\"color: var(--ch-2);\">NEXT_PUBLIC_SUPABASE_ANON_KEY</span><span style=\"color: var(--ch-8);\">}`</span><span style=\"color: var(--ch-4);\">,</span></span><br></div></div><span class=\"ch-code-line-number\" style=\"position: absolute; top: 0px; left: 0px; transform: translate(0px, 247px); width: 31.5px; opacity: 0.99;\">14</span><div style=\"position: absolute; top: 0px; left: 0px; transform: translate(31.5px, 247px); width: 553px;\"><div style=\"display: inline-block; width: 100%;\"><span style=\"opacity: 0.99;\"><span style=\"color: var(--ch-8);\">        'Content-Type'</span><span style=\"color: var(--ch-4);\">: </span><span style=\"color: var(--ch-8);\">'application/json'</span><span style=\"color: var(--ch-4);\">,</span></span><br></div></div><span class=\"ch-code-line-number\" style=\"position: absolute; top: 0px; left: 0px; transform: translate(0px, 266px); width: 31.5px; opacity: 0.99;\">15</span><div style=\"position: absolute; top: 0px; left: 0px; transform: translate(31.5px, 266px); width: 553px;\"><div style=\"display: inline-block; width: 100%;\"><span style=\"opacity: 0.99;\"><span style=\"color: var(--ch-4);\">      },</span></span><br></div></div><span class=\"ch-code-line-number\" style=\"position: absolute; top: 0px; left: 0px; transform: translate(0px, 285px); width: 31.5px; opacity: 0.99;\">16</span><div style=\"position: absolute; top: 0px; left: 0px; transform: translate(31.5px, 285px); width: 553px;\"><div style=\"display: inline-block; width: 100%;\"><span style=\"opacity: 0.99;\"><span style=\"color: var(--ch-4);\">      payload: </span><span style=\"color: var(--ch-2);\">JSON</span><span style=\"color: var(--ch-4);\">.</span><span style=\"color: var(--ch-5);\">stringify</span><span style=\"color: var(--ch-4);\">({ query }),</span></span><br></div></div><span class=\"ch-code-line-number\" style=\"position: absolute; top: 0px; left: 0px; transform: translate(0px, 304px); width: 31.5px; opacity: 0.99;\">17</span><div style=\"position: absolute; top: 0px; left: 0px; transform: translate(31.5px, 304px); width: 553px;\"><div style=\"display: inline-block; width: 100%;\"><span style=\"opacity: 0.99;\"><span style=\"color: var(--ch-4);\">    })</span></span><br></div></div><span class=\"ch-code-line-number\" style=\"position: absolute; top: 0px; left: 0px; transform: translate(0px, 323px); width: 31.5px; opacity: 0.99;\">18</span><div style=\"position: absolute; top: 0px; left: 0px; transform: translate(31.5px, 323px); width: 553px;\"><div style=\"display: inline-block; width: 100%;\"><span style=\"opacity: 0.99;\"><span style=\"color: var(--ch-4);\"></span></span><br></div></div><span class=\"ch-code-line-number\" style=\"position: absolute; top: 0px; left: 0px; transform: translate(0px, 342px); width: 31.5px; opacity: 0.99;\">19</span><div style=\"position: absolute; top: 0px; left: 0px; transform: translate(31.5px, 342px); width: 553px;\"><div style=\"display: inline-block; width: 100%;\"><span style=\"opacity: 0.99;\"><span style=\"color: var(--ch-7);\">    function </span><span style=\"color: var(--ch-5);\">handleError</span><span style=\"color: var(--ch-4);\">&lt;</span><span style=\"color: var(--ch-3);\">T</span><span style=\"color: var(--ch-4);\">&gt;(</span><span style=\"color: var(--ch-3);\">err</span><span style=\"color: var(--ch-7);\">: </span><span style=\"color: var(--ch-3);\">T</span><span style=\"color: var(--ch-4);\">) {</span></span><br></div></div><span class=\"ch-code-line-number\" style=\"position: absolute; top: 0px; left: 0px; transform: translate(0px, 361px); width: 31.5px; opacity: 0.99;\">20</span><div style=\"position: absolute; top: 0px; left: 0px; transform: translate(31.5px, 361px); width: 553px;\"><div style=\"display: inline-block; width: 100%;\"><span style=\"opacity: 0.99;\"><span style=\"color: var(--ch-5);\">      setIsLoading</span><span style=\"color: var(--ch-4);\">(</span><span style=\"color: var(--ch-2);\">false</span><span style=\"color: var(--ch-4);\">)</span></span><br></div></div><span class=\"ch-code-line-number\" style=\"position: absolute; top: 0px; left: 0px; transform: translate(0px, 380px); width: 31.5px; opacity: 0.99;\">21</span><div style=\"position: absolute; top: 0px; left: 0px; transform: translate(31.5px, 380px); width: 553px;\"><div style=\"display: inline-block; width: 100%;\"><span style=\"opacity: 0.99;\"><span style=\"color: var(--ch-5);\">      setHasError</span><span style=\"color: var(--ch-4);\">(</span><span style=\"color: var(--ch-2);\">true</span><span style=\"color: var(--ch-4);\">)</span></span><br></div></div><span class=\"ch-code-line-number\" style=\"position: absolute; top: 0px; left: 0px; transform: translate(0px, 399px); width: 31.5px; opacity: 0.99;\">22</span><div style=\"position: absolute; top: 0px; left: 0px; transform: translate(31.5px, 399px); width: 553px;\"><div style=\"display: inline-block; width: 100%;\"><span style=\"opacity: 0.99;\"><span style=\"color: var(--ch-4);\">      console.</span><span style=\"color: var(--ch-5);\">error</span><span style=\"color: var(--ch-4);\">(err)</span></span><br></div></div><span class=\"ch-code-line-number\" style=\"position: absolute; top: 0px; left: 0px; transform: translate(0px, 418px); width: 31.5px; opacity: 0.99;\">23</span><div style=\"position: absolute; top: 0px; left: 0px; transform: translate(31.5px, 418px); width: 553px;\"><div style=\"display: inline-block; width: 100%;\"><span style=\"opacity: 0.99;\"><span style=\"color: var(--ch-4);\">    }</span></span><br></div></div><span class=\"ch-code-line-number\" style=\"position: absolute; top: 0px; left: 0px; transform: translate(0px, 437px); width: 31.5px; opacity: 0.99;\">24</span><div style=\"position: absolute; top: 0px; left: 0px; transform: translate(31.5px, 437px); width: 553px;\"><div style=\"display: inline-block; width: 100%;\"><span style=\"opacity: 0.99;\"><span style=\"color: var(--ch-4);\"></span></span><br></div></div><span class=\"ch-code-line-number\" style=\"position: absolute; top: 0px; left: 0px; transform: translate(0px, 456px); width: 31.5px; opacity: 0.99;\">25</span><div style=\"position: absolute; top: 0px; left: 0px; transform: translate(31.5px, 456px); width: 553px;\"><div style=\"display: inline-block; width: 100%;\"><span style=\"opacity: 0.99;\"><span style=\"color: var(--ch-4);\">    eventSource.</span><span style=\"color: var(--ch-5);\">addEventListener</span><span style=\"color: var(--ch-4);\">(</span><span style=\"color: var(--ch-8);\">'error'</span><span style=\"color: var(--ch-4);\">, handleError)</span></span><br></div></div><span class=\"ch-code-line-number\" style=\"position: absolute; top: 0px; left: 0px; transform: translate(0px, 475px); width: 31.5px; opacity: 0.99;\">26</span><div style=\"position: absolute; top: 0px; left: 0px; transform: translate(31.5px, 475px); width: 553px;\"><div style=\"display: inline-block; width: 100%;\"><span style=\"opacity: 0.99;\"><span style=\"color: var(--ch-4);\">    eventSource.</span><span style=\"color: var(--ch-5);\">addEventListener</span><span style=\"color: var(--ch-4);\">(</span><span style=\"color: var(--ch-8);\">'message'</span><span style=\"color: var(--ch-4);\">, (</span><span style=\"color: var(--ch-3);\">e</span><span style=\"color: var(--ch-7);\">: </span><span style=\"color: var(--ch-2);\">any</span><span style=\"color: var(--ch-4);\">) </span><span style=\"color: var(--ch-7);\">=&gt;</span><span style=\"color: var(--ch-4);\"> {</span></span><br></div></div><span class=\"ch-code-line-number\" style=\"position: absolute; top: 0px; left: 0px; transform: translate(0px, 494px); width: 31.5px; opacity: 0.99;\">27</span><div style=\"position: absolute; top: 0px; left: 0px; transform: translate(31.5px, 494px); width: 553px;\"><div style=\"display: inline-block; width: 100%;\"><span style=\"opacity: 0.99;\"><span style=\"color: var(--ch-7);\">      try</span><span style=\"color: var(--ch-4);\"> {</span></span><br></div></div><span class=\"ch-code-line-number\" style=\"position: absolute; top: 0px; left: 0px; transform: translate(0px, 513px); width: 31.5px; opacity: 0.99;\">28</span><div style=\"position: absolute; top: 0px; left: 0px; transform: translate(31.5px, 513px); width: 553px;\"><div style=\"display: inline-block; width: 100%;\"><span style=\"opacity: 0.99;\"><span style=\"color: var(--ch-5);\">        setIsLoading</span><span style=\"color: var(--ch-4);\">(</span><span style=\"color: var(--ch-2);\">false</span><span style=\"color: var(--ch-4);\">)</span></span><br></div></div><span class=\"ch-code-line-number\" style=\"position: absolute; top: 0px; left: 0px; transform: translate(0px, 532px); width: 31.5px; opacity: 0.99;\">29</span><div style=\"position: absolute; top: 0px; left: 0px; transform: translate(31.5px, 532px); width: 553px;\"><div style=\"display: inline-block; width: 100%;\"><span style=\"opacity: 0.99;\"><span style=\"color: var(--ch-4);\"></span></span><br></div></div><span class=\"ch-code-line-number\" style=\"position: absolute; top: 0px; left: 0px; transform: translate(0px, 551px); width: 31.5px; opacity: 0.99;\">30</span><div style=\"position: absolute; top: 0px; left: 0px; transform: translate(31.5px, 551px); width: 553px;\"><div style=\"display: inline-block; width: 100%;\"><span style=\"opacity: 0.99;\"><span style=\"color: var(--ch-7);\">        if</span><span style=\"color: var(--ch-4);\"> (e.data </span><span style=\"color: var(--ch-7);\">=== </span><span style=\"color: var(--ch-8);\">'[DONE]'</span><span style=\"color: var(--ch-4);\">) {</span></span><br></div></div><span class=\"ch-code-line-number\" style=\"position: absolute; top: 0px; left: 0px; transform: translate(0px, 570px); width: 31.5px; opacity: 0.99;\">31</span><div style=\"position: absolute; top: 0px; left: 0px; transform: translate(31.5px, 570px); width: 553px;\"><div style=\"display: inline-block; width: 100%;\"><span style=\"opacity: 0.99;\"><span style=\"color: var(--ch-5);\">          setPromptIndex</span><span style=\"color: var(--ch-4);\">((</span><span style=\"color: var(--ch-3);\">x</span><span style=\"color: var(--ch-4);\">) </span><span style=\"color: var(--ch-7);\">=&gt;</span><span style=\"color: var(--ch-4);\"> {</span></span><br></div></div><span class=\"ch-code-line-number\" style=\"position: absolute; top: 0px; left: 0px; transform: translate(0px, 589px); width: 31.5px; opacity: 0.99;\">32</span><div style=\"position: absolute; top: 0px; left: 0px; transform: translate(31.5px, 589px); width: 553px;\"><div style=\"display: inline-block; width: 100%;\"><span style=\"opacity: 0.99;\"><span style=\"color: var(--ch-7);\">            return</span><span style=\"color: var(--ch-4);\"> x </span><span style=\"color: var(--ch-7);\">+ </span><span style=\"color: var(--ch-2);\">1</span></span><br></div></div><span class=\"ch-code-line-number\" style=\"position: absolute; top: 0px; left: 0px; transform: translate(0px, 608px); width: 31.5px; opacity: 0.99;\">33</span><div style=\"position: absolute; top: 0px; left: 0px; transform: translate(31.5px, 608px); width: 553px;\"><div style=\"display: inline-block; width: 100%;\"><span style=\"opacity: 0.99;\"><span style=\"color: var(--ch-4);\">          })</span></span><br></div></div><span class=\"ch-code-line-number\" style=\"position: absolute; top: 0px; left: 0px; transform: translate(0px, 627px); width: 31.5px; opacity: 0.99;\">34</span><div style=\"position: absolute; top: 0px; left: 0px; transform: translate(31.5px, 627px); width: 553px;\"><div style=\"display: inline-block; width: 100%;\"><span style=\"opacity: 0.99;\"><span style=\"color: var(--ch-7);\">          return</span></span><br></div></div><span class=\"ch-code-line-number\" style=\"position: absolute; top: 0px; left: 0px; transform: translate(0px, 646px); width: 31.5px; opacity: 0.99;\">35</span><div style=\"position: absolute; top: 0px; left: 0px; transform: translate(31.5px, 646px); width: 553px;\"><div style=\"display: inline-block; width: 100%;\"><span style=\"opacity: 0.99;\"><span style=\"color: var(--ch-4);\">        }</span></span><br></div></div><span class=\"ch-code-line-number\" style=\"position: absolute; top: 0px; left: 0px; transform: translate(0px, 665px); width: 31.5px; opacity: 0.99;\">36</span><div style=\"position: absolute; top: 0px; left: 0px; transform: translate(31.5px, 665px); width: 553px;\"><div style=\"display: inline-block; width: 100%;\"><span style=\"opacity: 0.99;\"><span style=\"color: var(--ch-4);\"></span></span><br></div></div><span class=\"ch-code-line-number\" style=\"position: absolute; top: 0px; left: 0px; transform: translate(0px, 684px); width: 31.5px; opacity: 0.99;\">37</span><div style=\"position: absolute; top: 0px; left: 0px; transform: translate(31.5px, 684px); width: 553px;\"><div style=\"display: inline-block; width: 100%;\"><span style=\"opacity: 0.99;\"><span style=\"color: var(--ch-7);\">        const </span><span style=\"color: var(--ch-2);\">completionResponse</span><span style=\"color: var(--ch-7);\">: </span><span style=\"color: var(--ch-3);\">CreateCompletionResponse </span><span style=\"color: var(--ch-7);\">= </span><span style=\"color: var(--ch-2);\">JSON</span><span style=\"color: var(--ch-4);\">.</span><span style=\"color: var(--ch-5);\">parse</span><span style=\"color: var(--ch-4);\">(e.data)</span></span><br></div></div><span class=\"ch-code-line-number\" style=\"position: absolute; top: 0px; left: 0px; transform: translate(0px, 703px); width: 31.5px; opacity: 0.99;\">38</span><div style=\"position: absolute; top: 0px; left: 0px; transform: translate(31.5px, 703px); width: 553px;\"><div style=\"display: inline-block; width: 100%;\"><span style=\"opacity: 0.99;\"><span style=\"color: var(--ch-7);\">        const </span><span style=\"color: var(--ch-2);\">text </span><span style=\"color: var(--ch-7);\">=</span><span style=\"color: var(--ch-4);\"> completionResponse.choices[</span><span style=\"color: var(--ch-2);\">0</span><span style=\"color: var(--ch-4);\">].text</span></span><br></div></div><span class=\"ch-code-line-number\" style=\"position: absolute; top: 0px; left: 0px; transform: translate(0px, 722px); width: 31.5px; opacity: 0.99;\">39</span><div style=\"position: absolute; top: 0px; left: 0px; transform: translate(31.5px, 722px); width: 553px;\"><div style=\"display: inline-block; width: 100%;\"><span style=\"opacity: 0.99;\"><span style=\"color: var(--ch-4);\"></span></span><br></div></div><span class=\"ch-code-line-number\" style=\"position: absolute; top: 0px; left: 0px; transform: translate(0px, 741px); width: 31.5px; opacity: 0.99;\">40</span><div style=\"position: absolute; top: 0px; left: 0px; transform: translate(31.5px, 741px); width: 553px;\"><div style=\"display: inline-block; width: 100%;\"><span style=\"opacity: 0.99;\"><span style=\"color: var(--ch-5);\">        setAnswer</span><span style=\"color: var(--ch-4);\">((</span><span style=\"color: var(--ch-3);\">answer</span><span style=\"color: var(--ch-4);\">) </span><span style=\"color: var(--ch-7);\">=&gt;</span><span style=\"color: var(--ch-4);\"> {</span></span><br></div></div><span class=\"ch-code-line-number\" style=\"position: absolute; top: 0px; left: 0px; transform: translate(0px, 760px); width: 31.5px; opacity: 0.99;\">41</span><div style=\"position: absolute; top: 0px; left: 0px; transform: translate(31.5px, 760px); width: 553px;\"><div style=\"display: inline-block; width: 100%;\"><span style=\"opacity: 0.99;\"><span style=\"color: var(--ch-7);\">          const </span><span style=\"color: var(--ch-2);\">currentAnswer </span><span style=\"color: var(--ch-7);\">=</span><span style=\"color: var(--ch-4);\"> answer </span><span style=\"color: var(--ch-7);\">?? </span><span style=\"color: var(--ch-8);\">''</span></span><br></div></div><span class=\"ch-code-line-number\" style=\"position: absolute; top: 0px; left: 0px; transform: translate(0px, 779px); width: 31.5px; opacity: 0.99;\">42</span><div style=\"position: absolute; top: 0px; left: 0px; transform: translate(31.5px, 779px); width: 553px;\"><div style=\"display: inline-block; width: 100%;\"><span style=\"opacity: 0.99;\"><span style=\"color: var(--ch-4);\"></span></span><br></div></div><span class=\"ch-code-line-number\" style=\"position: absolute; top: 0px; left: 0px; transform: translate(0px, 798px); width: 31.5px; opacity: 0.99;\">43</span><div style=\"position: absolute; top: 0px; left: 0px; transform: translate(31.5px, 798px); width: 553px;\"><div style=\"display: inline-block; width: 100%;\"><span style=\"opacity: 0.99;\"><span style=\"color: var(--ch-5);\">          dispatchPromptData</span><span style=\"color: var(--ch-4);\">({</span></span><br></div></div><span class=\"ch-code-line-number\" style=\"position: absolute; top: 0px; left: 0px; transform: translate(0px, 817px); width: 31.5px; opacity: 0.99;\">44</span><div style=\"position: absolute; top: 0px; left: 0px; transform: translate(31.5px, 817px); width: 553px;\"><div style=\"display: inline-block; width: 100%;\"><span style=\"opacity: 0.99;\"><span style=\"color: var(--ch-4);\">            index: promptIndex,</span></span><br></div></div><span class=\"ch-code-line-number\" style=\"position: absolute; top: 0px; left: 0px; transform: translate(0px, 836px); width: 31.5px; opacity: 0.99;\">45</span><div style=\"position: absolute; top: 0px; left: 0px; transform: translate(31.5px, 836px); width: 553px;\"><div style=\"display: inline-block; width: 100%;\"><span style=\"opacity: 0.99;\"><span style=\"color: var(--ch-4);\">            answer: currentAnswer </span><span style=\"color: var(--ch-7);\">+</span><span style=\"color: var(--ch-4);\"> text,</span></span><br></div></div><span class=\"ch-code-line-number\" style=\"position: absolute; top: 0px; left: 0px; transform: translate(0px, 855px); width: 31.5px; opacity: 0.99;\">46</span><div style=\"position: absolute; top: 0px; left: 0px; transform: translate(31.5px, 855px); width: 553px;\"><div style=\"display: inline-block; width: 100%;\"><span style=\"opacity: 0.99;\"><span style=\"color: var(--ch-4);\">          })</span></span><br></div></div><span class=\"ch-code-line-number\" style=\"position: absolute; top: 0px; left: 0px; transform: translate(0px, 874px); width: 31.5px; opacity: 0.99;\">47</span><div style=\"position: absolute; top: 0px; left: 0px; transform: translate(31.5px, 874px); width: 553px;\"><div style=\"display: inline-block; width: 100%;\"><span style=\"opacity: 0.99;\"><span style=\"color: var(--ch-4);\"></span></span><br></div></div><span class=\"ch-code-line-number\" style=\"position: absolute; top: 0px; left: 0px; transform: translate(0px, 893px); width: 31.5px; opacity: 0.99;\">48</span><div style=\"position: absolute; top: 0px; left: 0px; transform: translate(31.5px, 893px); width: 553px;\"><div style=\"display: inline-block; width: 100%;\"><span style=\"opacity: 0.99;\"><span style=\"color: var(--ch-7);\">          return</span><span style=\"color: var(--ch-4);\"> (answer </span><span style=\"color: var(--ch-7);\">?? </span><span style=\"color: var(--ch-8);\">''</span><span style=\"color: var(--ch-4);\">) </span><span style=\"color: var(--ch-7);\">+</span><span style=\"color: var(--ch-4);\"> text</span></span><br></div></div><span class=\"ch-code-line-number\" style=\"position: absolute; top: 0px; left: 0px; transform: translate(0px, 912px); width: 31.5px; opacity: 0.99;\">49</span><div style=\"position: absolute; top: 0px; left: 0px; transform: translate(31.5px, 912px); width: 553px;\"><div style=\"display: inline-block; width: 100%;\"><span style=\"opacity: 0.99;\"><span style=\"color: var(--ch-4);\">        })</span></span><br></div></div><span class=\"ch-code-line-number\" style=\"position: absolute; top: 0px; left: 0px; transform: translate(0px, 931px); width: 31.5px; opacity: 0.99;\">50</span><div style=\"position: absolute; top: 0px; left: 0px; transform: translate(31.5px, 931px); width: 553px;\"><div style=\"display: inline-block; width: 100%;\"><span style=\"opacity: 0.99;\"><span style=\"color: var(--ch-4);\">      } </span><span style=\"color: var(--ch-7);\">catch</span><span style=\"color: var(--ch-4);\"> (err) {</span></span><br></div></div><span class=\"ch-code-line-number\" style=\"position: absolute; top: 0px; left: 0px; transform: translate(0px, 950px); width: 31.5px; opacity: 0.99;\">51</span><div style=\"position: absolute; top: 0px; left: 0px; transform: translate(31.5px, 950px); width: 553px;\"><div style=\"display: inline-block; width: 100%;\"><span style=\"opacity: 0.99;\"><span style=\"color: var(--ch-5);\">        handleError</span><span style=\"color: var(--ch-4);\">(err)</span></span><br></div></div><span class=\"ch-code-line-number\" style=\"position: absolute; top: 0px; left: 0px; transform: translate(0px, 969px); width: 31.5px; opacity: 0.99;\">52</span><div style=\"position: absolute; top: 0px; left: 0px; transform: translate(31.5px, 969px); width: 553px;\"><div style=\"display: inline-block; width: 100%;\"><span style=\"opacity: 0.99;\"><span style=\"color: var(--ch-4);\">      }</span></span><br></div></div><span class=\"ch-code-line-number\" style=\"position: absolute; top: 0px; left: 0px; transform: translate(0px, 988px); width: 31.5px; opacity: 0.99;\">53</span><div style=\"position: absolute; top: 0px; left: 0px; transform: translate(31.5px, 988px); width: 553px;\"><div style=\"display: inline-block; width: 100%;\"><span style=\"opacity: 0.99;\"><span style=\"color: var(--ch-4);\">    })</span></span><br></div></div><span class=\"ch-code-line-number\" style=\"position: absolute; top: 0px; left: 0px; transform: translate(0px, 1007px); width: 31.5px; opacity: 0.99;\">54</span><div style=\"position: absolute; top: 0px; left: 0px; transform: translate(31.5px, 1007px); width: 553px;\"><div style=\"display: inline-block; width: 100%;\"><span style=\"opacity: 0.99;\"><span style=\"color: var(--ch-4);\"></span></span><br></div></div><span class=\"ch-code-line-number\" style=\"position: absolute; top: 0px; left: 0px; transform: translate(0px, 1026px); width: 31.5px; opacity: 0.99;\">55</span><div style=\"position: absolute; top: 0px; left: 0px; transform: translate(31.5px, 1026px); width: 553px;\"><div style=\"display: inline-block; width: 100%;\"><span style=\"opacity: 0.99;\"><span style=\"color: var(--ch-4);\">    eventSource.</span><span style=\"color: var(--ch-5);\">stream</span><span style=\"color: var(--ch-4);\">()</span></span><br></div></div><span class=\"ch-code-line-number\" style=\"position: absolute; top: 0px; left: 0px; transform: translate(0px, 1045px); width: 31.5px; opacity: 0.99;\">56</span><div style=\"position: absolute; top: 0px; left: 0px; transform: translate(31.5px, 1045px); width: 553px;\"><div style=\"display: inline-block; width: 100%;\"><span style=\"opacity: 0.99;\"><span style=\"color: var(--ch-4);\"></span></span><br></div></div><span class=\"ch-code-line-number\" style=\"position: absolute; top: 0px; left: 0px; transform: translate(0px, 1064px); width: 31.5px; opacity: 0.99;\">57</span><div style=\"position: absolute; top: 0px; left: 0px; transform: translate(31.5px, 1064px); width: 553px;\"><div style=\"display: inline-block; width: 100%;\"><span style=\"opacity: 0.99;\"><span style=\"color: var(--ch-4);\">    eventSourceRef.current </span><span style=\"color: var(--ch-7);\">=</span><span style=\"color: var(--ch-4);\"> eventSource</span></span><br></div></div><span class=\"ch-code-line-number\" style=\"position: absolute; top: 0px; left: 0px; transform: translate(0px, 1083px); width: 31.5px; opacity: 0.99;\">58</span><div style=\"position: absolute; top: 0px; left: 0px; transform: translate(31.5px, 1083px); width: 553px;\"><div style=\"display: inline-block; width: 100%;\"><span style=\"opacity: 0.99;\"><span style=\"color: var(--ch-4);\"></span></span><br></div></div><span class=\"ch-code-line-number\" style=\"position: absolute; top: 0px; left: 0px; transform: translate(0px, 1102px); width: 31.5px; opacity: 0.99;\">59</span><div style=\"position: absolute; top: 0px; left: 0px; transform: translate(31.5px, 1102px); width: 553px;\"><div style=\"display: inline-block; width: 100%;\"><span style=\"opacity: 0.99;\"><span style=\"color: var(--ch-5);\">    setIsLoading</span><span style=\"color: var(--ch-4);\">(</span><span style=\"color: var(--ch-2);\">true</span><span style=\"color: var(--ch-4);\">)</span></span><br></div></div><span class=\"ch-code-line-number\" style=\"position: absolute; top: 0px; left: 0px; transform: translate(0px, 1121px); width: 31.5px; opacity: 0.99;\">60</span><div style=\"position: absolute; top: 0px; left: 0px; transform: translate(31.5px, 1121px); width: 553px;\"><div style=\"display: inline-block; width: 100%;\"><span style=\"opacity: 0.99;\"><span style=\"color: var(--ch-4);\">  },</span></span><br></div></div><span class=\"ch-code-line-number\" style=\"position: absolute; top: 0px; left: 0px; transform: translate(0px, 1140px); width: 31.5px; opacity: 0.99;\">61</span><div style=\"position: absolute; top: 0px; left: 0px; transform: translate(31.5px, 1140px); width: 553px;\"><div style=\"display: inline-block; width: 100%;\"><span style=\"opacity: 0.99;\"><span style=\"color: var(--ch-4);\">  [promptIndex, promptData]</span></span><br></div></div><span class=\"ch-code-line-number\" style=\"position: absolute; top: 0px; left: 0px; transform: translate(0px, 1159px); width: 31.5px; opacity: 0.99;\">62</span><div style=\"position: absolute; top: 0px; left: 0px; transform: translate(31.5px, 1159px); width: 553px;\"><div style=\"display: inline-block; width: 100%;\"><span style=\"opacity: 0.99;\"><span style=\"color: var(--ch-4);\">)</span></span><br></div></div></div></div></code><button type=\"button\" title=\"Copy code\" class=\"ch-code-button\"><svg fill=\"none\" stroke=\"currentColor\" viewBox=\"0 0 24 24\" xmlns=\"http://www.w3.org/2000/svg\"><path stroke-linecap=\"round\" stroke-linejoin=\"round\" stroke-width=\"1.6px\" d=\"M8 16H6a2 2 0 01-2-2V6a2 2 0 012-2h8a2 2 0 012 2v2m-6 12h8a2 2 0 002-2v-8a2 2 0 00-2-2h-8a2 2 0 00-2 2v8a2 2 0 002 2z\"></path></svg></button></div></div>\n<h2 id=\"learn-more\" class=\"group scroll-mt-24\">Learn more<a href=\"#learn-more\" aria-hidden=\"true\" class=\"ml-2 opacity-0 group-hover:opacity-100 transition\"><span aria-hidden=\"true\">#</span></a></h2>\n<p>Want to learn more about the awesome tech that is powering this?</p>\n<ul>\n<li>Read about how we built <a href=\"https://supabase.com/blog/chatgpt-supabase-docs\">ChatGPT for the Supabase Docs</a>.</li>\n<li>Read the pgvector Docs for <a href=\"https://supabase.com/docs/guides/database/extensions/pgvector\">Embeddings and vector similarity</a></li>\n<li>Watch Greg's video for a full breakdown:</li>\n</ul>\n<div class=\"video-container\"></div></article></div><div class=\"border-l thin-scrollbar overflow-y-auto px-2 hidden md:block col-span-3 self-start sticky top-[calc(var(--header-height)+1px+2rem)] max-h-[calc(100vh-var(--header-height)-3rem)]\"><div class=\"relative mb-6 pl-5\"><button class=\"w-full\"><div class=\"video-container overflow-hidden rounded hover:cursor-pointer\"><div class=\" absolute inset-0 z-10 text-white flex flex-col gap-3 items-center justify-center before:content[''] before:absolute before:inset-0 before:bg-black before:opacity-30 before:-z-10 hover:before:opacity-50 before:transition-opacity \"><svg xmlns=\"http://www.w3.org/2000/svg\" width=\"24\" height=\"24\" viewBox=\"0 0 24 24\" fill=\"none\" stroke=\"currentColor\" stroke-width=\"2\" stroke-linecap=\"round\" stroke-linejoin=\"round\" class=\"lucide lucide-play w-5 h-5\"><polygon points=\"6 3 20 12 6 21 6 3\"></polygon></svg><p class=\"text-sm\">Watch video guide</p></div><img alt=\"Video guide preview\" loading=\"lazy\" decoding=\"async\" data-nimg=\"fill\" class=\"absolute inset-0 object-cover blur-sm scale-105\" sizes=\"100%\" srcset=\"/docs/_next/image?url=http%3A%2F%2Fimg.youtube.com%2Fvi%2FxmfNUCjszh4%2F0.jpg&amp;w=16&amp;q=75&amp;dpl=dpl_8T75GeYs2RqN59z5hY7ru4dxhiVp 16w, /docs/_next/image?url=http%3A%2F%2Fimg.youtube.com%2Fvi%2FxmfNUCjszh4%2F0.jpg&amp;w=32&amp;q=75&amp;dpl=dpl_8T75GeYs2RqN59z5hY7ru4dxhiVp 32w, /docs/_next/image?url=http%3A%2F%2Fimg.youtube.com%2Fvi%2FxmfNUCjszh4%2F0.jpg&amp;w=48&amp;q=75&amp;dpl=dpl_8T75GeYs2RqN59z5hY7ru4dxhiVp 48w, /docs/_next/image?url=http%3A%2F%2Fimg.youtube.com%2Fvi%2FxmfNUCjszh4%2F0.jpg&amp;w=64&amp;q=75&amp;dpl=dpl_8T75GeYs2RqN59z5hY7ru4dxhiVp 64w, /docs/_next/image?url=http%3A%2F%2Fimg.youtube.com%2Fvi%2FxmfNUCjszh4%2F0.jpg&amp;w=96&amp;q=75&amp;dpl=dpl_8T75GeYs2RqN59z5hY7ru4dxhiVp 96w, /docs/_next/image?url=http%3A%2F%2Fimg.youtube.com%2Fvi%2FxmfNUCjszh4%2F0.jpg&amp;w=128&amp;q=75&amp;dpl=dpl_8T75GeYs2RqN59z5hY7ru4dxhiVp 128w, /docs/_next/image?url=http%3A%2F%2Fimg.youtube.com%2Fvi%2FxmfNUCjszh4%2F0.jpg&amp;w=256&amp;q=75&amp;dpl=dpl_8T75GeYs2RqN59z5hY7ru4dxhiVp 256w, /docs/_next/image?url=http%3A%2F%2Fimg.youtube.com%2Fvi%2FxmfNUCjszh4%2F0.jpg&amp;w=384&amp;q=75&amp;dpl=dpl_8T75GeYs2RqN59z5hY7ru4dxhiVp 384w, /docs/_next/image?url=http%3A%2F%2Fimg.youtube.com%2Fvi%2FxmfNUCjszh4%2F0.jpg&amp;w=640&amp;q=75&amp;dpl=dpl_8T75GeYs2RqN59z5hY7ru4dxhiVp 640w, /docs/_next/image?url=http%3A%2F%2Fimg.youtube.com%2Fvi%2FxmfNUCjszh4%2F0.jpg&amp;w=750&amp;q=75&amp;dpl=dpl_8T75GeYs2RqN59z5hY7ru4dxhiVp 750w, /docs/_next/image?url=http%3A%2F%2Fimg.youtube.com%2Fvi%2FxmfNUCjszh4%2F0.jpg&amp;w=828&amp;q=75&amp;dpl=dpl_8T75GeYs2RqN59z5hY7ru4dxhiVp 828w, /docs/_next/image?url=http%3A%2F%2Fimg.youtube.com%2Fvi%2FxmfNUCjszh4%2F0.jpg&amp;w=1080&amp;q=75&amp;dpl=dpl_8T75GeYs2RqN59z5hY7ru4dxhiVp 1080w, /docs/_next/image?url=http%3A%2F%2Fimg.youtube.com%2Fvi%2FxmfNUCjszh4%2F0.jpg&amp;w=1200&amp;q=75&amp;dpl=dpl_8T75GeYs2RqN59z5hY7ru4dxhiVp 1200w, /docs/_next/image?url=http%3A%2F%2Fimg.youtube.com%2Fvi%2FxmfNUCjszh4%2F0.jpg&amp;w=1920&amp;q=75&amp;dpl=dpl_8T75GeYs2RqN59z5hY7ru4dxhiVp 1920w, /docs/_next/image?url=http%3A%2F%2Fimg.youtube.com%2Fvi%2FxmfNUCjszh4%2F0.jpg&amp;w=2048&amp;q=75&amp;dpl=dpl_8T75GeYs2RqN59z5hY7ru4dxhiVp 2048w, /docs/_next/image?url=http%3A%2F%2Fimg.youtube.com%2Fvi%2FxmfNUCjszh4%2F0.jpg&amp;w=3840&amp;q=75&amp;dpl=dpl_8T75GeYs2RqN59z5hY7ru4dxhiVp 3840w\" src=\"/docs/_next/image?url=http%3A%2F%2Fimg.youtube.com%2Fvi%2FxmfNUCjszh4%2F0.jpg&amp;w=3840&amp;q=75&amp;dpl=dpl_8T75GeYs2RqN59z5hY7ru4dxhiVp\" style=\"position: absolute; height: 100%; width: 100%; inset: 0px; color: transparent;\"></div></button></div><section class=\"@container px-5 mb-6\" aria-labelledby=\"feedback-title\"><h3 id=\"feedback-title\" class=\"block font-mono text-xs uppercase text-foreground mb-4\">Is this helpful?</h3><div class=\"relative flex flex-col gap-y-4 mb-2 @[12rem]:flex-row @[12rem]:items-center\"><div class=\"relative flex gap-[var(--container-flex-gap)] items-center\" style=\"--container-flex-gap: 0.5rem;\"><button data-size=\"tiny\" type=\"button\" class=\"relative justify-center cursor-pointer inline-flex items-center space-x-2 text-center font-regular ease-out duration-200 outline-none transition-all outline-0 focus-visible:outline-4 focus-visible:outline-offset-1 border text-foreground bg-transparent border-strong focus-visible:outline-border-strong data-[state=open]:border-stronger data-[state=open]:outline-border-strong text-xs py-1 h-[26px] rounded-full px-1 hover:text-brand-600 hover:border-brand-500 [transition-property:opacity,transform,color] [transition-duration:150ms,300ms,300ms] motion-reduce:[transition-duration:150ms,1ms,300ms]\"> <span class=\"truncate\"><svg xmlns=\"http://www.w3.org/2000/svg\" width=\"14\" height=\"14\" viewBox=\"0 0 24 24\" fill=\"none\" stroke=\"currentColor\" stroke-width=\"3\" stroke-linecap=\"round\" stroke-linejoin=\"round\" class=\"lucide lucide-check\"><path d=\"M20 6 9 17l-5-5\"></path></svg><span class=\"sr-only\">Yes</span></span> </button><button data-size=\"tiny\" type=\"button\" class=\"relative justify-center cursor-pointer inline-flex items-center space-x-2 text-center font-regular ease-out duration-200 outline-none transition-all outline-0 focus-visible:outline-4 focus-visible:outline-offset-1 border text-foreground bg-transparent border-strong focus-visible:outline-border-strong data-[state=open]:border-stronger data-[state=open]:outline-border-strong text-xs py-1 h-[26px] rounded-full px-1 hover:text-warning-600 hover:border-warning-500 [transition-property:opacity,transform,color] [transition-duration:150ms,300ms,300ms] motion-reduce:[transition-duration:150ms,1ms,300ms]\"> <span class=\"truncate\"><svg xmlns=\"http://www.w3.org/2000/svg\" width=\"14\" height=\"14\" viewBox=\"0 0 24 24\" fill=\"none\" stroke=\"currentColor\" stroke-width=\"3\" stroke-linecap=\"round\" stroke-linejoin=\"round\" class=\"lucide lucide-x\"><path d=\"M18 6 6 18\"></path><path d=\"m6 6 12 12\"></path></svg><span class=\"sr-only\">No</span></span> </button></div><div class=\"flex flex-col gap-1 text-xs opacity-0 invisible text-left -translate-x-[0.25rem] @[12rem]:-translate-x-[1.25rem] [transition-property:opacity,transform] [transition-duration:150ms,300ms] motion-reduce:[transition-duration:150ms,1ms] delay-300\"><span class=\"text-foreground-light\">Thanks for your feedback!</span></div></div></section><span class=\"block font-mono text-xs uppercase text-foreground px-5 mb-6\">On this page</span><ul class=\"toc-menu list-none pl-5 text-[0.8rem] grid gap-2\"><li class=\"\"><a href=\"#create-a-project\" class=\"text-foreground-lighter hover:text-brand-link transition-colors\">Create a project</a></li><li class=\"\"><a href=\"#prepare-the-database\" class=\"text-foreground-lighter hover:text-brand-link transition-colors\">Prepare the database</a></li><li class=\"\"><a href=\"#pre-process-the-knowledge-base-at-build-time\" class=\"text-foreground-lighter hover:text-brand-link transition-colors\">Pre-process the knowledge base at build time</a></li><li class=\"\"><a href=\"#create-text-completion-with-openai-api\" class=\"text-foreground-lighter hover:text-brand-link transition-colors\">Create text completion with OpenAI API</a></li><li class=\"\"><a href=\"#display-the-answer-on-the-frontend\" class=\"text-foreground-lighter hover:text-brand-link transition-colors\">Display the answer on the frontend</a></li><li class=\"\"><a href=\"#learn-more\" class=\"text-foreground-lighter hover:text-brand-link transition-colors\">Learn more</a></li></ul></div></div></div><div class=\"max-w-7xl px-5 mx-auto py-8 pt-0\"></div></div><div class=\"left-0 right-0 z-10 backdrop-blur-sm backdrop-filter bg-alternative/90 hidden h-0 lg:hidden\"></div></div></main></div></div></div></div><next-route-announcer style=\"position: absolute;\"></next-route-announcer><section aria-label=\"Notifications alt+T\" tabindex=\"-1\"><ol dir=\"ltr\" tabindex=\"-1\" class=\"toaster group pointer-events-auto\" data-sonner-toaster=\"true\" data-theme=\"light\" data-y-position=\"top\" data-x-position=\"right\" style=\"--front-toast-height: 112px; --offset: 32px; --width: 356px; --gap: 14px; font-family: inherit;\"></ol><ol dir=\"ltr\" tabindex=\"-1\" class=\"toaster group pointer-events-auto\" data-sonner-toaster=\"true\" data-theme=\"light\" data-y-position=\"bottom\" data-x-position=\"right\" style=\"--front-toast-height: 112px; --offset: 32px; --width: 356px; --gap: 14px; font-family: inherit;\"><li aria-live=\"polite\" aria-atomic=\"true\" role=\"status\" tabindex=\"0\" class=\"group toast w-full rounded-md py-3 px-5 flex gap-2 items-start font-normal text-sm group-[.toaster]:bg-overlay group-[.toaster]:text-foreground group-[.toaster]:border group-[.toaster]:border-overlay group-[.toaster]:shadow-lg\" data-sonner-toast=\"\" data-styled=\"false\" data-mounted=\"true\" data-promise=\"false\" data-removed=\"false\" data-visible=\"true\" data-y-position=\"bottom\" data-x-position=\"right\" data-index=\"0\" data-front=\"true\" data-swiping=\"false\" data-dismissible=\"true\" data-swipe-out=\"false\" data-expanded=\"false\" style=\"--index: 0; --toasts-before: 0; --z-index: 1; --offset: 0px; --initial-height: 112px;\"><button aria-label=\"Close toast\" data-disabled=\"false\" data-close-button=\"true\" class=\"absolute right-2 top-2 rounded-md text-foreground/50 opacity-0 transition-opacity hover:text-foreground focus:opacity-100 focus:outline-none focus:ring-2 group-hover:opacity-100 group-[.destructive]:text-destructive-300 group-[.destructive]:hover:text-destructive-50 group-[.destructive]:focus:ring-destructive-400 group-[.destructive]:focus:ring-offset-destructive-600 left-auto transform-none bg-transparent border-0 border-transparent hover:!bg-transparent hover:border-transparent\"><svg xmlns=\"http://www.w3.org/2000/svg\" width=\"12\" height=\"12\" viewBox=\"0 0 24 24\" fill=\"none\" stroke=\"currentColor\" stroke-width=\"1.5\" stroke-linecap=\"round\" stroke-linejoin=\"round\"><line x1=\"18\" y1=\"6\" x2=\"6\" y2=\"18\"></line><line x1=\"6\" y1=\"6\" x2=\"18\" y2=\"18\"></line></svg></button><div class=\"space-y-3 py-1 flex flex-col w-full\"><div><p class=\"text-foreground\">We only collect analytics essential to ensuring smooth operation of our services. <a class=\"inline sm:hidden underline text-light\" target=\"_blank\" rel=\"noreferrer\" href=\"https://supabase.com/privacy\">Learn more</a></p></div><div class=\"flex items-center space-x-2\"><button data-size=\"tiny\" type=\"button\" class=\"relative justify-center cursor-pointer inline-flex items-center space-x-2 text-center font-regular ease-out duration-200 rounded-md outline-none transition-all outline-0 focus-visible:outline-4 focus-visible:outline-offset-1 border text-foreground bg-alternative dark:bg-muted hover:bg-selection border-strong hover:border-stronger focus-visible:outline-brand-600 data-[state=open]:bg-selection data-[state=open]:outline-brand-600 data-[state=open]:border-button-hover text-xs px-2.5 py-1 h-[26px]\"> <span class=\"truncate\">Accept</span> </button><button data-size=\"tiny\" type=\"button\" class=\"relative justify-center cursor-pointer inline-flex items-center space-x-2 text-center font-regular ease-out duration-200 rounded-md outline-none transition-all outline-0 focus-visible:outline-4 focus-visible:outline-offset-1 border text-foreground hover:bg-surface-300 shadow-none focus-visible:outline-border-strong data-[state=open]:bg-surface-300 data-[state=open]:outline-border-strong border-transparent text-xs px-2.5 py-1 h-[26px]\"> <span class=\"truncate\">Opt out</span> </button><a target=\"_blank\" rel=\"noreferrer\" data-size=\"tiny\" type=\"button\" class=\"relative justify-center cursor-pointer items-center space-x-2 text-center font-regular ease-out duration-200 rounded-md outline-none transition-all outline-0 focus-visible:outline-4 focus-visible:outline-offset-1 border hover:bg-surface-300 shadow-none focus-visible:outline-border-strong data-[state=open]:bg-surface-300 data-[state=open]:outline-border-strong border-transparent text-xs px-2.5 py-1 h-[26px] hidden sm:block text-light hover:text-foreground\" href=\"https://supabase.com/privacy\"><span class=\"truncate\">Learn more</span></a></div></div></li></ol></section></body></html>",
      "metadata": {
        "ogUrl": "https://supabase.com/docs/guides/ai/examples/nextjs-vector-search",
        "title": "Vector search with Next.js and OpenAI | Supabase Docs",
        "robots": "index, follow",
        "ogImage": "https://obuldanrptloktxcffvn.supabase.co/functions/v1/og-images?site=docs&type=ai&title=Vector%20search%20with%20Next.js%20and%20OpenAI&description=undefined",
        "ogTitle": "Vector search with Next.js and OpenAI | Supabase Docs",
        "language": "en",
        "sourceURL": "https://supabase.com/docs/guides/ai/examples/nextjs-vector-search",
        "description": "Learn how to build a ChatGPT-style doc search powered by Next.js, OpenAI, and Supabase.",
        "modifiedTime": "2024-09-10T20:36:25.434Z",
        "ogDescription": "Learn how to build a ChatGPT-style doc search powered by Next.js, OpenAI, and Supabase.",
        "publishedTime": "2024-09-10T20:36:25.434Z",
        "ogLocaleAlternate": [],
        "statusCode": 200
      }
    },
    {
      "markdown": "AI & Vectors\n\n# API\n\n* * *\n\n# API\n\n`vecs` is a python client for managing and querying vector stores in PostgreSQL with the [pgvector extension](https://github.com/pgvector/pgvector). This guide will help you get started with using vecs.\n\nIf you don't have a Postgres database with the pgvector ready, see [hosting](https://supabase.github.io/vecs/hosting) for easy options.\n\n## Installation [\\#](\\#installation)\n\nRequires:\n\n- Python 3.7+\n\nYou can install vecs using pip:\n\n`\n_10\npip install vecs\n`\n\n## Usage [\\#](\\#usage)\n\n## Connecting [\\#](\\#connecting)\n\nBefore you can interact with vecs, create the client to communicate with Postgres. If you haven't started a Postgres instance yet, see [hosting](https://supabase.github.io/vecs/hosting).\n\n`\n_10\nimport vecs\n_10\n_10\nDB_CONNECTION = \"postgresql://<user>:<password>@<host>:<port>/<db_name>\"\n_10\n_10\n# create vector store client\n_10\nvx = vecs.create_client(DB_CONNECTION)\n`\n\n## Get or Create a Collection [\\#](\\#get-or-create-a-collection)\n\nYou can get a collection (or create if it doesn't exist), specifying the collection's name and the number of dimensions for the vectors you intend to store.\n\n`\n_10\ndocs = vx.get_or_create_collection(name=\"docs\", dimension=3)\n`\n\n## Upserting vectors [\\#](\\#upserting-vectors)\n\n`vecs` combines the concepts of \"insert\" and \"update\" into \"upsert\". Upserting records adds them to the collection if the `id` is not present, or updates the existing record if the `id` does exist.\n\n`\n_15\n# add records to the collection\n_15\ndocs.upsert(\n_15\n    records=[\\\n_15\\\n        (\\\n_15\\\n         \"vec0\",           # the vector's identifier\\\n_15\\\n         [0.1, 0.2, 0.3],  # the vector. list or np.array\\\n_15\\\n         {\"year\": 1973}    # associated  metadata\\\n_15\\\n        ),\\\n_15\\\n        (\\\n_15\\\n         \"vec1\",\\\n_15\\\n         [0.7, 0.8, 0.9],\\\n_15\\\n         {\"year\": 2012}\\\n_15\\\n        )\\\n_15\\\n    ]\n_15\n)\n`\n\n## Deleting vectors [\\#](\\#deleting-vectors)\n\nDeleting records removes them from the collection. To delete records, specify a list of `ids` or metadata filters to the `delete` method. The ids of the sucessfully deleted records are returned from the method. Note that attempting to delete non-existent records does not raise an error.\n\n`\n_10\ndocs.delete(ids=[\"vec0\", \"vec1\"])\n_10\n# or delete by a metadata filter\n_10\ndocs.delete(filters={\"year\": {\"$eq\": 2012}})\n`\n\n## Create an index [\\#](\\#create-an-index)\n\nCollections can be queried immediately after being created.\nHowever, for good throughput, the collection should be indexed after records have been upserted.\n\nOnly one index may exist per-collection. By default, creating an index will replace any existing index.\n\nTo create an index:\n\n`\n_10\ndocs.create_index()\n`\n\nYou may optionally provide a distance measure and index method.\n\nAvailable options for distance `measure` are:\n\n- `vecs.IndexMeasure.cosine_distance`\n- `vecs.IndexMeasure.l2_distance`\n- `vecs.IndexMeasure.max_inner_product`\n\nwhich correspond to different methods for comparing query vectors to the vectors in the database.\n\nIf you aren't sure which to use, the default of cosine\\_distance is the most widely compatible with off-the-shelf embedding methods.\n\nAvailable options for index `method` are:\n\n- `vecs.IndexMethod.auto`\n- `vecs.IndexMethod.hnsw`\n- `vecs.IndexMethod.ivfflat`\n\nWhere `auto` selects the best available index method, `hnsw` uses the [HNSW](https://github.com/pgvector/pgvector#hnsw) method and `ivfflat` uses [IVFFlat](https://github.com/pgvector/pgvector#ivfflat).\n\nHNSW and IVFFlat indexes both allow for parameterization to control the speed/accuracy tradeoff. vecs provides sane defaults for these parameters. For a greater level of control you can optionally pass an instance of `vecs.IndexArgsIVFFlat` or `vecs.IndexArgsHNSW` to `create_index`'s `index_arguments` argument. Descriptions of the impact for each parameter are available in the [pgvector docs](https://github.com/pgvector/pgvector).\n\nWhen using IVFFlat indexes, the index must be created **after** the collection has been populated with records. Building an IVFFlat index on an empty collection will result in significantly reduced recall. You can continue upserting new documents after the index has been created, but should rebuild the index if the size of the collection more than doubles since the last index operation.\n\nHNSW indexes can be created immediately after the collection without populating records.\n\nTo manually specify `method`, `measure`, and `index_arguments` add them as arguments to `create_index` for example:\n\n`\n_10\ndocs.create_index(\n_10\n    method=IndexMethod.hnsw,\n_10\n    measure=IndexMeasure.cosine_distance,\n_10\n    index_arguments=IndexArgsHNSW(m=8),\n_10\n)\n`\n\nThe time required to create an index grows with the number of records and size of vectors.\nFor a few thousand records expect sub-minute a response in under a minute. It may take a few\nminutes for larger collections.\n\n## Query [\\#](\\#query)\n\nGiven a collection `docs` with several records:\n\n### Basic [\\#](\\#basic)\n\nThe simplest form of search is to provide a query vector.\n\nIndexes are essential for good performance. See [creating an index](#create-an-index) for more info.\n\nIf you do not create an index, every query will return a warning\n\n`\n_10\nquery does not have a covering index for cosine_similarity. See Collection.create_index\n`\n\nthat incldues the `IndexMeasure` you should index.\n\n`\n_10\ndocs.query(\n_10\n    data=[0.4,0.5,0.6],          # required\n_10\n    limit=5,                     # number of records to return\n_10\n    filters={},                  # metadata filters\n_10\n    measure=\"cosine_distance\",   # distance measure to use\n_10\n    include_value=False,         # should distance measure values be returned?\n_10\n    include_metadata=False,      # should record metadata be returned?\n_10\n)\n`\n\nWhich returns a list of vector record `ids`.\n\n### Metadata Filtering [\\#](\\#metadata-filtering)\n\nThe metadata that is associated with each record can also be filtered during a query.\n\nAs an example, `{\"year\": {\"$eq\": 2005}}` filters a `year` metadata key to be equal to 2005\n\nIn context:\n\n`\n_10\ndocs.query(\n_10\n    data=[0.4,0.5,0.6],\n_10\n    filters={\"year\": {\"$eq\": 2012}}, # metadata filters\n_10\n)\n`\n\nFor a complete reference, see the [metadata guide](metadata).\n\n### Disconnect [\\#](\\#disconnect)\n\nWhen you're done with a collection, be sure to disconnect the client from the database.\n\n`\n_10\nvx.disconnect()\n`\n\nalternatively, use the client as a context manager and it will automatically close the connection on exit.\n\n`\n_10\nimport vecs\n_10\n_10\nDB_CONNECTION = \"postgresql://<user>:<password>@<host>:<port>/<db_name>\"\n_10\n_10\n# create vector store client\n_10\nwith vecs.create_client(DB_CONNECTION) as vx:\n_10\n    # do some work here\n_10\n    pass\n_10\n_10\n# connections are now closed\n`\n\n## Adapters [\\#](\\#adapters)\n\nAdapters are an optional feature to transform data before adding to or querying from a collection. Adapters make it possible to interact with a collection using only your project's native data type (eg. just raw text), rather than manually handling vectors.\n\nFor a complete list of available adapters, see [built-in adapters](https://supabase.github.io/vecs/concepts_adapters#built-in-adapters).\n\nAs an example, we'll create a collection with an adapter that chunks text into paragraphs and converts each chunk into an embedding vector using the `all-MiniLM-L6-v2` model.\n\nFirst, install `vecs` with optional dependencies for text embeddings:\n\n`\n_10\npip install \"vecs[text_embedding]\"\n`\n\nThen create a collection with an adapter to chunk text into paragraphs and embed each paragraph using the `all-MiniLM-L6-v2` 384 dimensional text embedding model.\n\n`\n_16\nimport vecs\n_16\nfrom vecs.adapter import Adapter, ParagraphChunker, TextEmbedding\n_16\n_16\n# create vector store client\n_16\nvx = vecs.Client(\"postgresql://<user>:<password>@<host>:<port>/<db_name>\")\n_16\n_16\n# create a collection with an adapter\n_16\ndocs = vx.get_or_create_collection(\n_16\n    name=\"docs\",\n_16\n    adapter=Adapter(\n_16\n        [\\\n_16\\\n            ParagraphChunker(skip_during_query=True),\\\n_16\\\n            TextEmbedding(model='all-MiniLM-L6-v2'),\\\n_16\\\n        ]\n_16\n    )\n_16\n)\n`\n\nWith the adapter registered against the collection, we can upsert records into the collection passing in text rather than vectors.\n\n`\n_15\n# add records to the collection using text as the media type\n_15\ndocs.upsert(\n_15\n    records=[\\\n_15\\\n        (\\\n_15\\\n         \"vec0\",\\\n_15\\\n         \"four score and ....\", # <- note that we can now pass text here\\\n_15\\\n         {\"year\": 1973}\\\n_15\\\n        ),\\\n_15\\\n        (\\\n_15\\\n         \"vec1\",\\\n_15\\\n         \"hello, world!\",\\\n_15\\\n         {\"year\": \"2012\"}\\\n_15\\\n        )\\\n_15\\\n    ]\n_15\n)\n`\n\nSimilarly, we can query the collection using text.\n\n`\n_10\n_10\n# search by text\n_10\ndocs.query(data=\"foo bar\")\n`\n\n* * *\n\n## Deprecated [\\#](\\#deprecated)\n\n### Create collection [\\#](\\#create-collection)\n\nDeprecated: use [get\\_or\\_create\\_collection](#get-or-create-a-collection)\n\nYou can create a collection to store vectors specifying the collections name and the number of dimensions in the vectors you intend to store.\n\n`\n_10\ndocs = vx.create_collection(name=\"docs\", dimension=3)\n`\n\n### Get an existing collection [\\#](\\#get-an-existing-collection)\n\nDeprecated: use [get\\_or\\_create\\_collection](#get-or-create-a-collection)\n\nTo access a previously created collection, use `get_collection` to retrieve it by name\n\n`\n_10\ndocs = vx.get_collection(name=\"docs\")\n`",
      "html": "<!DOCTYPE html><html lang=\"en\" data-theme=\"light\" style=\"color-scheme: light;\"><body><div class=\"flex flex-col\"><div class=\"grow\"><div class=\"flex flex-col h-full w-full\"><div class=\"hidden lg:sticky w-full lg:flex top-0 left-0 right-0 z-50\"><!--$--><!--/$--></div><div class=\"flex flex-row h-full relative\"><main id=\"docs-content-container\" class=\"w-full transition-all ease-out relative lg:ml-0\"><div class=\"flex flex-col sticky top-0\"><div class=\"flex lg:hidden w-full top-0 left-0 right-0 z-50\"><!--$--><!--/$--></div><div class=\"sticky transition-all top-0 z-10 backdrop-blur backdrop-filter bg-background\"><div class=\"lg:hidden px-3.5 border-b z-10 transition-all ease-out top-0 flex items-center gap-1\"><button class=\"h-8 w-8 flex group items-center justify-center mr-1\"><div class=\"space-y-1 cursor-pointer relative w-4 h-[8px]\"><span class=\"transition-all ease-out block h-px bg-foreground-muted group-hover:bg-foreground w-4\"></span><span class=\"transition-all ease-out block h-px bg-foreground-muted group-hover:bg-foreground w-3 group-hover:w-4\"></span></div></button><span class=\"transition-all duration-200 text-foreground text-sm\">AI &amp; Vectors</span></div></div><div class=\"grow\"><div class=\"max-w-7xl px-5 mx-auto py-8 pb-0\"><div class=\"grid grid-cols-12 relative gap-4\"><div class=\"relative transition-all ease-out duration-100 col-span-12 md:col-span-9\"><article id=\"sb-docs-guide-main-article\" class=\"prose max-w-none\"><h1 class=\"mb-0\">API</h1><hr class=\"not-prose border-t-0 border-b my-8\">\n<h1 id=\"api\">API</h1>\n<p><code>vecs</code> is a python client for managing and querying vector stores in PostgreSQL with the <a href=\"https://github.com/pgvector/pgvector\">pgvector extension</a>. This guide will help you get started with using vecs.</p>\n<p>If you don't have a Postgres database with the pgvector ready, see <a href=\"https://supabase.github.io/vecs/hosting\">hosting</a> for easy options.</p>\n<h2 id=\"installation\" class=\"group scroll-mt-24\">Installation<a href=\"#installation\" aria-hidden=\"true\" class=\"ml-2 opacity-0 group-hover:opacity-100 transition\"><span aria-hidden=\"true\">#</span></a></h2>\n<p>Requires:</p>\n<ul>\n<li>Python 3.7+</li>\n</ul>\n<p>You can install vecs using pip:</p>\n<div class=\"ch-codeblock not-prose \" data-ch-theme=\"supabase\"><div class=\"ch-code-wrapper ch-code\" data-ch-measured=\"false\"><code class=\"ch-code-scroll-parent\"><br><div><span class=\"ch-code-line-number\">_<!-- -->10</span><div style=\"display:inline-block;margin-left:16px\"><span>pip install vecs</span></div></div><br></code></div></div>\n<h2 id=\"usage\" class=\"group scroll-mt-24\">Usage<a href=\"#usage\" aria-hidden=\"true\" class=\"ml-2 opacity-0 group-hover:opacity-100 transition\"><span aria-hidden=\"true\">#</span></a></h2>\n<h2 id=\"connecting\" class=\"group scroll-mt-24\">Connecting<a href=\"#connecting\" aria-hidden=\"true\" class=\"ml-2 opacity-0 group-hover:opacity-100 transition\"><span aria-hidden=\"true\">#</span></a></h2>\n<p>Before you can interact with vecs, create the client to communicate with Postgres. If you haven't started a Postgres instance yet, see <a href=\"https://supabase.github.io/vecs/hosting\">hosting</a>.</p>\n<div class=\"ch-codeblock not-prose \" data-ch-theme=\"supabase\"><div class=\"ch-code-wrapper ch-code\" data-ch-measured=\"false\"><code class=\"ch-code-scroll-parent\"><br><div><span class=\"ch-code-line-number\">_<!-- -->10</span><div style=\"display:inline-block;margin-left:16px\"><span>import vecs</span></div></div><div><span class=\"ch-code-line-number\">_<!-- -->10</span><div style=\"display:inline-block;margin-left:16px\"><span></span></div></div><div><span class=\"ch-code-line-number\">_<!-- -->10</span><div style=\"display:inline-block;margin-left:16px\"><span>DB_CONNECTION = \"postgresql://&lt;user&gt;:&lt;password&gt;@&lt;host&gt;:&lt;port&gt;/&lt;db_name&gt;\"</span></div></div><div><span class=\"ch-code-line-number\">_<!-- -->10</span><div style=\"display:inline-block;margin-left:16px\"><span></span></div></div><div><span class=\"ch-code-line-number\">_<!-- -->10</span><div style=\"display:inline-block;margin-left:16px\"><span># create vector store client</span></div></div><div><span class=\"ch-code-line-number\">_<!-- -->10</span><div style=\"display:inline-block;margin-left:16px\"><span>vx = vecs.create_client(DB_CONNECTION)</span></div></div><br></code></div></div>\n<h2 id=\"get-or-create-a-collection\" class=\"group scroll-mt-24\">Get or Create a Collection<a href=\"#get-or-create-a-collection\" aria-hidden=\"true\" class=\"ml-2 opacity-0 group-hover:opacity-100 transition\"><span aria-hidden=\"true\">#</span></a></h2>\n<p>You can get a collection (or create if it doesn't exist), specifying the collection's name and the number of dimensions for the vectors you intend to store.</p>\n<div class=\"ch-codeblock not-prose \" data-ch-theme=\"supabase\"><div class=\"ch-code-wrapper ch-code\" data-ch-measured=\"false\"><code class=\"ch-code-scroll-parent\"><br><div><span class=\"ch-code-line-number\">_<!-- -->10</span><div style=\"display:inline-block;margin-left:16px\"><span>docs = vx.get_or_create_collection(name=\"docs\", dimension=3)</span></div></div><br></code></div></div>\n<h2 id=\"upserting-vectors\" class=\"group scroll-mt-24\">Upserting vectors<a href=\"#upserting-vectors\" aria-hidden=\"true\" class=\"ml-2 opacity-0 group-hover:opacity-100 transition\"><span aria-hidden=\"true\">#</span></a></h2>\n<p><code>vecs</code> combines the concepts of \"insert\" and \"update\" into \"upsert\". Upserting records adds them to the collection if the <code>id</code> is not present, or updates the existing record if the <code>id</code> does exist.</p>\n<div class=\"ch-codeblock not-prose \" data-ch-theme=\"supabase\"><div class=\"ch-code-wrapper ch-code\" data-ch-measured=\"false\"><code class=\"ch-code-scroll-parent\"><br><div><span class=\"ch-code-line-number\">_<!-- -->15</span><div style=\"display:inline-block;margin-left:16px\"><span># add records to the collection</span></div></div><div><span class=\"ch-code-line-number\">_<!-- -->15</span><div style=\"display:inline-block;margin-left:16px\"><span>docs.upsert(</span></div></div><div><span class=\"ch-code-line-number\">_<!-- -->15</span><div style=\"display:inline-block;margin-left:16px\"><span>    records=[</span></div></div><div><span class=\"ch-code-line-number\">_<!-- -->15</span><div style=\"display:inline-block;margin-left:16px\"><span>        (</span></div></div><div><span class=\"ch-code-line-number\">_<!-- -->15</span><div style=\"display:inline-block;margin-left:16px\"><span>         \"vec0\",           # the vector's identifier</span></div></div><div><span class=\"ch-code-line-number\">_<!-- -->15</span><div style=\"display:inline-block;margin-left:16px\"><span>         [0.1, 0.2, 0.3],  # the vector. list or np.array</span></div></div><div><span class=\"ch-code-line-number\">_<!-- -->15</span><div style=\"display:inline-block;margin-left:16px\"><span>         {\"year\": 1973}    # associated  metadata</span></div></div><div><span class=\"ch-code-line-number\">_<!-- -->15</span><div style=\"display:inline-block;margin-left:16px\"><span>        ),</span></div></div><div><span class=\"ch-code-line-number\">_<!-- -->15</span><div style=\"display:inline-block;margin-left:16px\"><span>        (</span></div></div><div><span class=\"ch-code-line-number\">_<!-- -->15</span><div style=\"display:inline-block;margin-left:16px\"><span>         \"vec1\",</span></div></div><div><span class=\"ch-code-line-number\">_<!-- -->15</span><div style=\"display:inline-block;margin-left:16px\"><span>         [0.7, 0.8, 0.9],</span></div></div><div><span class=\"ch-code-line-number\">_<!-- -->15</span><div style=\"display:inline-block;margin-left:16px\"><span>         {\"year\": 2012}</span></div></div><div><span class=\"ch-code-line-number\">_<!-- -->15</span><div style=\"display:inline-block;margin-left:16px\"><span>        )</span></div></div><div><span class=\"ch-code-line-number\">_<!-- -->15</span><div style=\"display:inline-block;margin-left:16px\"><span>    ]</span></div></div><div><span class=\"ch-code-line-number\">_<!-- -->15</span><div style=\"display:inline-block;margin-left:16px\"><span>)</span></div></div><br></code></div></div>\n<h2 id=\"deleting-vectors\" class=\"group scroll-mt-24\">Deleting vectors<a href=\"#deleting-vectors\" aria-hidden=\"true\" class=\"ml-2 opacity-0 group-hover:opacity-100 transition\"><span aria-hidden=\"true\">#</span></a></h2>\n<p>Deleting records removes them from the collection. To delete records, specify a list of <code>ids</code> or metadata filters to the <code>delete</code> method. The ids of the sucessfully deleted records are returned from the method. Note that attempting to delete non-existent records does not raise an error.</p>\n<div class=\"ch-codeblock not-prose \" data-ch-theme=\"supabase\"><div class=\"ch-code-wrapper ch-code\" data-ch-measured=\"false\"><code class=\"ch-code-scroll-parent\"><br><div><span class=\"ch-code-line-number\">_<!-- -->10</span><div style=\"display:inline-block;margin-left:16px\"><span>docs.delete(ids=[\"vec0\", \"vec1\"])</span></div></div><div><span class=\"ch-code-line-number\">_<!-- -->10</span><div style=\"display:inline-block;margin-left:16px\"><span># or delete by a metadata filter</span></div></div><div><span class=\"ch-code-line-number\">_<!-- -->10</span><div style=\"display:inline-block;margin-left:16px\"><span>docs.delete(filters={\"year\": {\"$eq\": 2012}})</span></div></div><br></code></div></div>\n<h2 id=\"create-an-index\" class=\"group scroll-mt-24\">Create an index<a href=\"#create-an-index\" aria-hidden=\"true\" class=\"ml-2 opacity-0 group-hover:opacity-100 transition\"><span aria-hidden=\"true\">#</span></a></h2>\n<p>Collections can be queried immediately after being created.\nHowever, for good throughput, the collection should be indexed after records have been upserted.</p>\n<p>Only one index may exist per-collection. By default, creating an index will replace any existing index.</p>\n<p>To create an index:</p>\n<div class=\"ch-codeblock not-prose \" data-ch-theme=\"supabase\"><div class=\"ch-code-wrapper ch-code\" data-ch-measured=\"false\"><code class=\"ch-code-scroll-parent\"><br><div><span class=\"ch-code-line-number\">_<!-- -->10</span><div style=\"display:inline-block;margin-left:16px\"><span>docs.create_index()</span></div></div><br></code></div></div>\n<p>You may optionally provide a distance measure and index method.</p>\n<p>Available options for distance <code>measure</code> are:</p>\n<ul>\n<li><code>vecs.IndexMeasure.cosine_distance</code></li>\n<li><code>vecs.IndexMeasure.l2_distance</code></li>\n<li><code>vecs.IndexMeasure.max_inner_product</code></li>\n</ul>\n<p>which correspond to different methods for comparing query vectors to the vectors in the database.</p>\n<p>If you aren't sure which to use, the default of cosine_distance is the most widely compatible with off-the-shelf embedding methods.</p>\n<p>Available options for index <code>method</code> are:</p>\n<ul>\n<li><code>vecs.IndexMethod.auto</code></li>\n<li><code>vecs.IndexMethod.hnsw</code></li>\n<li><code>vecs.IndexMethod.ivfflat</code></li>\n</ul>\n<p>Where <code>auto</code> selects the best available index method, <code>hnsw</code> uses the <a href=\"https://github.com/pgvector/pgvector#hnsw\">HNSW</a> method and <code>ivfflat</code> uses <a href=\"https://github.com/pgvector/pgvector#ivfflat\">IVFFlat</a>.</p>\n<p>HNSW and IVFFlat indexes both allow for parameterization to control the speed/accuracy tradeoff. vecs provides sane defaults for these parameters. For a greater level of control you can optionally pass an instance of <code>vecs.IndexArgsIVFFlat</code> or <code>vecs.IndexArgsHNSW</code> to <code>create_index</code>'s <code>index_arguments</code> argument. Descriptions of the impact for each parameter are available in the <a href=\"https://github.com/pgvector/pgvector\">pgvector docs</a>.</p>\n<p>When using IVFFlat indexes, the index must be created <strong>after</strong> the collection has been populated with records. Building an IVFFlat index on an empty collection will result in significantly reduced recall. You can continue upserting new documents after the index has been created, but should rebuild the index if the size of the collection more than doubles since the last index operation.</p>\n<p>HNSW indexes can be created immediately after the collection without populating records.</p>\n<p>To manually specify <code>method</code>, <code>measure</code>, and <code>index_arguments</code> add them as arguments to <code>create_index</code> for example:</p>\n<div class=\"ch-codeblock not-prose \" data-ch-theme=\"supabase\"><div class=\"ch-code-wrapper ch-code\" data-ch-measured=\"false\"><code class=\"ch-code-scroll-parent\"><br><div><span class=\"ch-code-line-number\">_<!-- -->10</span><div style=\"display:inline-block;margin-left:16px\"><span>docs.create_index(</span></div></div><div><span class=\"ch-code-line-number\">_<!-- -->10</span><div style=\"display:inline-block;margin-left:16px\"><span>    method=IndexMethod.hnsw,</span></div></div><div><span class=\"ch-code-line-number\">_<!-- -->10</span><div style=\"display:inline-block;margin-left:16px\"><span>    measure=IndexMeasure.cosine_distance,</span></div></div><div><span class=\"ch-code-line-number\">_<!-- -->10</span><div style=\"display:inline-block;margin-left:16px\"><span>    index_arguments=IndexArgsHNSW(m=8),</span></div></div><div><span class=\"ch-code-line-number\">_<!-- -->10</span><div style=\"display:inline-block;margin-left:16px\"><span>)</span></div></div><br></code></div></div>\n<div role=\"alert\" class=\"relative w-full text-sm rounded-lg p-4 [&amp;>svg~*]:pl-10 [&amp;>svg+div]:translate-y-[-3px] [&amp;>svg]:absolute [&amp;>svg]:left-4 [&amp;>svg]:top-4 [&amp;>svg]:w-[23px] [&amp;>svg]:h-[23px] [&amp;>svg]:p-1 [&amp;>svg]:flex [&amp;>svg]:rounded text-foreground [&amp;>svg]:text-background [&amp;>svg]:bg-foreground mb-2 [&amp;_svg]:bg-foreground-muted [&amp;_svg]:text-background-muted bg-surface-200/25 border border-default\"><svg xmlns=\"http://www.w3.org/2000/svg\" viewBox=\"0 0 21 20\" class=\"w-6 h-6\" fill=\"currentColor\"><path fill-rule=\"evenodd\" clip-rule=\"evenodd\" d=\"M0.625 9.8252C0.625 4.44043 4.99023 0.0751953 10.375 0.0751953C15.7598 0.0751953 20.125 4.44043 20.125 9.8252C20.125 15.21 15.7598 19.5752 10.375 19.5752C4.99023 19.5752 0.625 15.21 0.625 9.8252ZM9.3584 4.38135C9.45117 4.28857 9.55518 4.20996 9.66699 4.14648C9.88086 4.02539 10.1245 3.96045 10.375 3.96045C10.5845 3.96045 10.7896 4.00586 10.9766 4.09229C11.1294 4.1626 11.2705 4.26025 11.3916 4.38135C11.6611 4.65088 11.8125 5.0166 11.8125 5.39795C11.8125 5.5249 11.7959 5.6499 11.7637 5.77002C11.6987 6.01172 11.5718 6.23438 11.3916 6.41455C11.1221 6.68408 10.7563 6.83545 10.375 6.83545C9.99365 6.83545 9.62793 6.68408 9.3584 6.41455C9.08887 6.14502 8.9375 5.7793 8.9375 5.39795C8.9375 5.29492 8.94873 5.19287 8.97021 5.09375C9.02783 4.82568 9.16162 4.57812 9.3584 4.38135ZM10.375 15.6899C10.0933 15.6899 9.82275 15.5781 9.62354 15.3789C9.42432 15.1797 9.3125 14.9092 9.3125 14.6274V9.31494C9.3125 9.0332 9.42432 8.7627 9.62354 8.56348C9.82275 8.36426 10.0933 8.25244 10.375 8.25244C10.6567 8.25244 10.9272 8.36426 11.1265 8.56348C11.3257 8.7627 11.4375 9.0332 11.4375 9.31494V14.6274C11.4375 14.7944 11.3979 14.9575 11.3242 15.104C11.2739 15.2046 11.2075 15.2979 11.1265 15.3789C10.9272 15.5781 10.6567 15.6899 10.375 15.6899Z\"></path></svg><div class=\"text mt [&amp;_p]:mb-1.5 [&amp;_p]:mt-0 mt-0.5 [&amp;_p:last-child]:mb-0\">The time required to create an index grows with the number of records and size of vectors.\nFor a few thousand records expect sub-minute a response in under a minute. It may take a few\nminutes for larger collections.</div></div>\n<h2 id=\"query\" class=\"group scroll-mt-24\">Query<a href=\"#query\" aria-hidden=\"true\" class=\"ml-2 opacity-0 group-hover:opacity-100 transition\"><span aria-hidden=\"true\">#</span></a></h2>\n<p>Given a collection <code>docs</code> with several records:</p>\n<h3 id=\"basic\" class=\"group scroll-mt-24\">Basic<a href=\"#basic\" aria-hidden=\"true\" class=\"ml-2 opacity-0 group-hover:opacity-100 transition\"><span aria-hidden=\"true\">#</span></a></h3>\n<p>The simplest form of search is to provide a query vector.</p>\n<div role=\"alert\" class=\"relative w-full text-sm rounded-lg p-4 [&amp;>svg~*]:pl-10 [&amp;>svg+div]:translate-y-[-3px] [&amp;>svg]:absolute [&amp;>svg]:left-4 [&amp;>svg]:top-4 [&amp;>svg]:w-[23px] [&amp;>svg]:h-[23px] [&amp;>svg]:p-1 [&amp;>svg]:flex [&amp;>svg]:rounded text-foreground [&amp;>svg]:text-background [&amp;>svg]:bg-foreground mb-2 [&amp;_svg]:bg-foreground-muted [&amp;_svg]:text-background-muted bg-surface-200/25 border border-default\"><svg xmlns=\"http://www.w3.org/2000/svg\" viewBox=\"0 0 21 20\" class=\"w-6 h-6\" fill=\"currentColor\"><path fill-rule=\"evenodd\" clip-rule=\"evenodd\" d=\"M0.625 9.8252C0.625 4.44043 4.99023 0.0751953 10.375 0.0751953C15.7598 0.0751953 20.125 4.44043 20.125 9.8252C20.125 15.21 15.7598 19.5752 10.375 19.5752C4.99023 19.5752 0.625 15.21 0.625 9.8252ZM9.3584 4.38135C9.45117 4.28857 9.55518 4.20996 9.66699 4.14648C9.88086 4.02539 10.1245 3.96045 10.375 3.96045C10.5845 3.96045 10.7896 4.00586 10.9766 4.09229C11.1294 4.1626 11.2705 4.26025 11.3916 4.38135C11.6611 4.65088 11.8125 5.0166 11.8125 5.39795C11.8125 5.5249 11.7959 5.6499 11.7637 5.77002C11.6987 6.01172 11.5718 6.23438 11.3916 6.41455C11.1221 6.68408 10.7563 6.83545 10.375 6.83545C9.99365 6.83545 9.62793 6.68408 9.3584 6.41455C9.08887 6.14502 8.9375 5.7793 8.9375 5.39795C8.9375 5.29492 8.94873 5.19287 8.97021 5.09375C9.02783 4.82568 9.16162 4.57812 9.3584 4.38135ZM10.375 15.6899C10.0933 15.6899 9.82275 15.5781 9.62354 15.3789C9.42432 15.1797 9.3125 14.9092 9.3125 14.6274V9.31494C9.3125 9.0332 9.42432 8.7627 9.62354 8.56348C9.82275 8.36426 10.0933 8.25244 10.375 8.25244C10.6567 8.25244 10.9272 8.36426 11.1265 8.56348C11.3257 8.7627 11.4375 9.0332 11.4375 9.31494V14.6274C11.4375 14.7944 11.3979 14.9575 11.3242 15.104C11.2739 15.2046 11.2075 15.2979 11.1265 15.3789C10.9272 15.5781 10.6567 15.6899 10.375 15.6899Z\"></path></svg><div class=\"text mt [&amp;_p]:mb-1.5 [&amp;_p]:mt-0 mt-0.5 [&amp;_p:last-child]:mb-0\">Indexes are essential for good performance. See <a href=\"#create-an-index\">creating an index</a> for more info.<p>If you do not create an index, every query will return a warning</p><div class=\"ch-codeblock not-prose \" data-ch-theme=\"supabase\"><div class=\"ch-code-wrapper ch-code\" data-ch-measured=\"false\"><code class=\"ch-code-scroll-parent\"><br><div><span class=\"ch-code-line-number\">_<!-- -->10</span><div style=\"display:inline-block;margin-left:16px\"><span>query does not have a covering index for cosine_similarity. See Collection.create_index</span></div></div><br></code></div></div><p>that incldues the <code>IndexMeasure</code> you should index.</p></div></div>\n<div class=\"ch-codeblock not-prose \" data-ch-theme=\"supabase\"><div class=\"ch-code-wrapper ch-code\" data-ch-measured=\"false\"><code class=\"ch-code-scroll-parent\"><br><div><span class=\"ch-code-line-number\">_<!-- -->10</span><div style=\"display:inline-block;margin-left:16px\"><span>docs.query(</span></div></div><div><span class=\"ch-code-line-number\">_<!-- -->10</span><div style=\"display:inline-block;margin-left:16px\"><span>    data=[0.4,0.5,0.6],          # required</span></div></div><div><span class=\"ch-code-line-number\">_<!-- -->10</span><div style=\"display:inline-block;margin-left:16px\"><span>    limit=5,                     # number of records to return</span></div></div><div><span class=\"ch-code-line-number\">_<!-- -->10</span><div style=\"display:inline-block;margin-left:16px\"><span>    filters={},                  # metadata filters</span></div></div><div><span class=\"ch-code-line-number\">_<!-- -->10</span><div style=\"display:inline-block;margin-left:16px\"><span>    measure=\"cosine_distance\",   # distance measure to use</span></div></div><div><span class=\"ch-code-line-number\">_<!-- -->10</span><div style=\"display:inline-block;margin-left:16px\"><span>    include_value=False,         # should distance measure values be returned?</span></div></div><div><span class=\"ch-code-line-number\">_<!-- -->10</span><div style=\"display:inline-block;margin-left:16px\"><span>    include_metadata=False,      # should record metadata be returned?</span></div></div><div><span class=\"ch-code-line-number\">_<!-- -->10</span><div style=\"display:inline-block;margin-left:16px\"><span>)</span></div></div><br></code></div></div>\n<p>Which returns a list of vector record <code>ids</code>.</p>\n<h3 id=\"metadata-filtering\" class=\"group scroll-mt-24\">Metadata Filtering<a href=\"#metadata-filtering\" aria-hidden=\"true\" class=\"ml-2 opacity-0 group-hover:opacity-100 transition\"><span aria-hidden=\"true\">#</span></a></h3>\n<p>The metadata that is associated with each record can also be filtered during a query.</p>\n<p>As an example, <code>{\"year\": {\"$eq\": 2005}}</code> filters a <code>year</code> metadata key to be equal to 2005</p>\n<p>In context:</p>\n<div class=\"ch-codeblock not-prose \" data-ch-theme=\"supabase\"><div class=\"ch-code-wrapper ch-code\" data-ch-measured=\"false\"><code class=\"ch-code-scroll-parent\"><br><div><span class=\"ch-code-line-number\">_<!-- -->10</span><div style=\"display:inline-block;margin-left:16px\"><span>docs.query(</span></div></div><div><span class=\"ch-code-line-number\">_<!-- -->10</span><div style=\"display:inline-block;margin-left:16px\"><span>    data=[0.4,0.5,0.6],</span></div></div><div><span class=\"ch-code-line-number\">_<!-- -->10</span><div style=\"display:inline-block;margin-left:16px\"><span>    filters={\"year\": {\"$eq\": 2012}}, # metadata filters</span></div></div><div><span class=\"ch-code-line-number\">_<!-- -->10</span><div style=\"display:inline-block;margin-left:16px\"><span>)</span></div></div><br></code></div></div>\n<p>For a complete reference, see the <a href=\"metadata\">metadata guide</a>.</p>\n<h3 id=\"disconnect\" class=\"group scroll-mt-24\">Disconnect<a href=\"#disconnect\" aria-hidden=\"true\" class=\"ml-2 opacity-0 group-hover:opacity-100 transition\"><span aria-hidden=\"true\">#</span></a></h3>\n<p>When you're done with a collection, be sure to disconnect the client from the database.</p>\n<div class=\"ch-codeblock not-prose \" data-ch-theme=\"supabase\"><div class=\"ch-code-wrapper ch-code\" data-ch-measured=\"false\"><code class=\"ch-code-scroll-parent\"><br><div><span class=\"ch-code-line-number\">_<!-- -->10</span><div style=\"display:inline-block;margin-left:16px\"><span>vx.disconnect()</span></div></div><br></code></div></div>\n<p>alternatively, use the client as a context manager and it will automatically close the connection on exit.</p>\n<div class=\"ch-codeblock not-prose \" data-ch-theme=\"supabase\"><div class=\"ch-code-wrapper ch-code\" data-ch-measured=\"false\"><code class=\"ch-code-scroll-parent\"><br><div><span class=\"ch-code-line-number\">_<!-- -->10</span><div style=\"display:inline-block;margin-left:16px\"><span>import vecs</span></div></div><div><span class=\"ch-code-line-number\">_<!-- -->10</span><div style=\"display:inline-block;margin-left:16px\"><span></span></div></div><div><span class=\"ch-code-line-number\">_<!-- -->10</span><div style=\"display:inline-block;margin-left:16px\"><span>DB_CONNECTION = \"postgresql://&lt;user&gt;:&lt;password&gt;@&lt;host&gt;:&lt;port&gt;/&lt;db_name&gt;\"</span></div></div><div><span class=\"ch-code-line-number\">_<!-- -->10</span><div style=\"display:inline-block;margin-left:16px\"><span></span></div></div><div><span class=\"ch-code-line-number\">_<!-- -->10</span><div style=\"display:inline-block;margin-left:16px\"><span># create vector store client</span></div></div><div><span class=\"ch-code-line-number\">_<!-- -->10</span><div style=\"display:inline-block;margin-left:16px\"><span>with vecs.create_client(DB_CONNECTION) as vx:</span></div></div><div><span class=\"ch-code-line-number\">_<!-- -->10</span><div style=\"display:inline-block;margin-left:16px\"><span>    # do some work here</span></div></div><div><span class=\"ch-code-line-number\">_<!-- -->10</span><div style=\"display:inline-block;margin-left:16px\"><span>    pass</span></div></div><div><span class=\"ch-code-line-number\">_<!-- -->10</span><div style=\"display:inline-block;margin-left:16px\"><span></span></div></div><div><span class=\"ch-code-line-number\">_<!-- -->10</span><div style=\"display:inline-block;margin-left:16px\"><span># connections are now closed</span></div></div><br></code></div></div>\n<h2 id=\"adapters\" class=\"group scroll-mt-24\">Adapters<a href=\"#adapters\" aria-hidden=\"true\" class=\"ml-2 opacity-0 group-hover:opacity-100 transition\"><span aria-hidden=\"true\">#</span></a></h2>\n<p>Adapters are an optional feature to transform data before adding to or querying from a collection. Adapters make it possible to interact with a collection using only your project's native data type (eg. just raw text), rather than manually handling vectors.</p>\n<p>For a complete list of available adapters, see <a href=\"https://supabase.github.io/vecs/concepts_adapters#built-in-adapters\">built-in adapters</a>.</p>\n<p>As an example, we'll create a collection with an adapter that chunks text into paragraphs and converts each chunk into an embedding vector using the <code>all-MiniLM-L6-v2</code> model.</p>\n<p>First, install <code>vecs</code> with optional dependencies for text embeddings:</p>\n<div class=\"ch-codeblock not-prose \" data-ch-theme=\"supabase\"><div class=\"ch-code-wrapper ch-code\" data-ch-measured=\"false\"><code class=\"ch-code-scroll-parent\"><br><div><span class=\"ch-code-line-number\">_<!-- -->10</span><div style=\"display:inline-block;margin-left:16px\"><span>pip install \"vecs[text_embedding]\"</span></div></div><br></code></div></div>\n<p>Then create a collection with an adapter to chunk text into paragraphs and embed each paragraph using the <code>all-MiniLM-L6-v2</code> 384 dimensional text embedding model.</p>\n<div class=\"ch-codeblock not-prose \" data-ch-theme=\"supabase\"><div class=\"ch-code-wrapper ch-code\" data-ch-measured=\"false\"><code class=\"ch-code-scroll-parent\"><br><div><span class=\"ch-code-line-number\">_<!-- -->16</span><div style=\"display:inline-block;margin-left:16px\"><span>import vecs</span></div></div><div><span class=\"ch-code-line-number\">_<!-- -->16</span><div style=\"display:inline-block;margin-left:16px\"><span>from vecs.adapter import Adapter, ParagraphChunker, TextEmbedding</span></div></div><div><span class=\"ch-code-line-number\">_<!-- -->16</span><div style=\"display:inline-block;margin-left:16px\"><span></span></div></div><div><span class=\"ch-code-line-number\">_<!-- -->16</span><div style=\"display:inline-block;margin-left:16px\"><span># create vector store client</span></div></div><div><span class=\"ch-code-line-number\">_<!-- -->16</span><div style=\"display:inline-block;margin-left:16px\"><span>vx = vecs.Client(\"postgresql://&lt;user&gt;:&lt;password&gt;@&lt;host&gt;:&lt;port&gt;/&lt;db_name&gt;\")</span></div></div><div><span class=\"ch-code-line-number\">_<!-- -->16</span><div style=\"display:inline-block;margin-left:16px\"><span></span></div></div><div><span class=\"ch-code-line-number\">_<!-- -->16</span><div style=\"display:inline-block;margin-left:16px\"><span># create a collection with an adapter</span></div></div><div><span class=\"ch-code-line-number\">_<!-- -->16</span><div style=\"display:inline-block;margin-left:16px\"><span>docs = vx.get_or_create_collection(</span></div></div><div><span class=\"ch-code-line-number\">_<!-- -->16</span><div style=\"display:inline-block;margin-left:16px\"><span>    name=\"docs\",</span></div></div><div><span class=\"ch-code-line-number\">_<!-- -->16</span><div style=\"display:inline-block;margin-left:16px\"><span>    adapter=Adapter(</span></div></div><div><span class=\"ch-code-line-number\">_<!-- -->16</span><div style=\"display:inline-block;margin-left:16px\"><span>        [</span></div></div><div><span class=\"ch-code-line-number\">_<!-- -->16</span><div style=\"display:inline-block;margin-left:16px\"><span>            ParagraphChunker(skip_during_query=True),</span></div></div><div><span class=\"ch-code-line-number\">_<!-- -->16</span><div style=\"display:inline-block;margin-left:16px\"><span>            TextEmbedding(model='all-MiniLM-L6-v2'),</span></div></div><div><span class=\"ch-code-line-number\">_<!-- -->16</span><div style=\"display:inline-block;margin-left:16px\"><span>        ]</span></div></div><div><span class=\"ch-code-line-number\">_<!-- -->16</span><div style=\"display:inline-block;margin-left:16px\"><span>    )</span></div></div><div><span class=\"ch-code-line-number\">_<!-- -->16</span><div style=\"display:inline-block;margin-left:16px\"><span>)</span></div></div><br></code></div></div>\n<p>With the adapter registered against the collection, we can upsert records into the collection passing in text rather than vectors.</p>\n<div class=\"ch-codeblock not-prose \" data-ch-theme=\"supabase\"><div class=\"ch-code-wrapper ch-code\" data-ch-measured=\"false\"><code class=\"ch-code-scroll-parent\"><br><div><span class=\"ch-code-line-number\">_<!-- -->15</span><div style=\"display:inline-block;margin-left:16px\"><span># add records to the collection using text as the media type</span></div></div><div><span class=\"ch-code-line-number\">_<!-- -->15</span><div style=\"display:inline-block;margin-left:16px\"><span>docs.upsert(</span></div></div><div><span class=\"ch-code-line-number\">_<!-- -->15</span><div style=\"display:inline-block;margin-left:16px\"><span>    records=[</span></div></div><div><span class=\"ch-code-line-number\">_<!-- -->15</span><div style=\"display:inline-block;margin-left:16px\"><span>        (</span></div></div><div><span class=\"ch-code-line-number\">_<!-- -->15</span><div style=\"display:inline-block;margin-left:16px\"><span>         \"vec0\",</span></div></div><div><span class=\"ch-code-line-number\">_<!-- -->15</span><div style=\"display:inline-block;margin-left:16px\"><span>         \"four score and ....\", # &lt;- note that we can now pass text here</span></div></div><div><span class=\"ch-code-line-number\">_<!-- -->15</span><div style=\"display:inline-block;margin-left:16px\"><span>         {\"year\": 1973}</span></div></div><div><span class=\"ch-code-line-number\">_<!-- -->15</span><div style=\"display:inline-block;margin-left:16px\"><span>        ),</span></div></div><div><span class=\"ch-code-line-number\">_<!-- -->15</span><div style=\"display:inline-block;margin-left:16px\"><span>        (</span></div></div><div><span class=\"ch-code-line-number\">_<!-- -->15</span><div style=\"display:inline-block;margin-left:16px\"><span>         \"vec1\",</span></div></div><div><span class=\"ch-code-line-number\">_<!-- -->15</span><div style=\"display:inline-block;margin-left:16px\"><span>         \"hello, world!\",</span></div></div><div><span class=\"ch-code-line-number\">_<!-- -->15</span><div style=\"display:inline-block;margin-left:16px\"><span>         {\"year\": \"2012\"}</span></div></div><div><span class=\"ch-code-line-number\">_<!-- -->15</span><div style=\"display:inline-block;margin-left:16px\"><span>        )</span></div></div><div><span class=\"ch-code-line-number\">_<!-- -->15</span><div style=\"display:inline-block;margin-left:16px\"><span>    ]</span></div></div><div><span class=\"ch-code-line-number\">_<!-- -->15</span><div style=\"display:inline-block;margin-left:16px\"><span>)</span></div></div><br></code></div></div>\n<p>Similarly, we can query the collection using text.</p>\n<div class=\"ch-codeblock not-prose \" data-ch-theme=\"supabase\"><div class=\"ch-code-wrapper ch-code\" data-ch-measured=\"false\"><code class=\"ch-code-scroll-parent\"><br><div><span class=\"ch-code-line-number\">_<!-- -->10</span><div style=\"display:inline-block;margin-left:16px\"><span></span></div></div><div><span class=\"ch-code-line-number\">_<!-- -->10</span><div style=\"display:inline-block;margin-left:16px\"><span># search by text</span></div></div><div><span class=\"ch-code-line-number\">_<!-- -->10</span><div style=\"display:inline-block;margin-left:16px\"><span>docs.query(data=\"foo bar\")</span></div></div><br></code></div></div>\n<hr>\n<h2 id=\"deprecated\" class=\"group scroll-mt-24\">Deprecated<a href=\"#deprecated\" aria-hidden=\"true\" class=\"ml-2 opacity-0 group-hover:opacity-100 transition\"><span aria-hidden=\"true\">#</span></a></h2>\n<h3 id=\"create-collection\" class=\"group scroll-mt-24\">Create collection<a href=\"#create-collection\" aria-hidden=\"true\" class=\"ml-2 opacity-0 group-hover:opacity-100 transition\"><span aria-hidden=\"true\">#</span></a></h3>\n<div role=\"alert\" class=\"relative w-full text-sm rounded-lg p-4 [&amp;>svg~*]:pl-10 [&amp;>svg+div]:translate-y-[-3px] [&amp;>svg]:absolute [&amp;>svg]:left-4 [&amp;>svg]:top-4 [&amp;>svg]:w-[23px] [&amp;>svg]:h-[23px] [&amp;>svg]:p-1 [&amp;>svg]:flex [&amp;>svg]:rounded text-foreground [&amp;>svg]:text-background [&amp;>svg]:bg-foreground mb-2 [&amp;_svg]:bg-foreground-muted [&amp;_svg]:text-background-muted bg-surface-200/25 border border-default\"><svg xmlns=\"http://www.w3.org/2000/svg\" viewBox=\"0 0 21 20\" class=\"w-6 h-6\" fill=\"currentColor\"><path fill-rule=\"evenodd\" clip-rule=\"evenodd\" d=\"M0.625 9.8252C0.625 4.44043 4.99023 0.0751953 10.375 0.0751953C15.7598 0.0751953 20.125 4.44043 20.125 9.8252C20.125 15.21 15.7598 19.5752 10.375 19.5752C4.99023 19.5752 0.625 15.21 0.625 9.8252ZM9.3584 4.38135C9.45117 4.28857 9.55518 4.20996 9.66699 4.14648C9.88086 4.02539 10.1245 3.96045 10.375 3.96045C10.5845 3.96045 10.7896 4.00586 10.9766 4.09229C11.1294 4.1626 11.2705 4.26025 11.3916 4.38135C11.6611 4.65088 11.8125 5.0166 11.8125 5.39795C11.8125 5.5249 11.7959 5.6499 11.7637 5.77002C11.6987 6.01172 11.5718 6.23438 11.3916 6.41455C11.1221 6.68408 10.7563 6.83545 10.375 6.83545C9.99365 6.83545 9.62793 6.68408 9.3584 6.41455C9.08887 6.14502 8.9375 5.7793 8.9375 5.39795C8.9375 5.29492 8.94873 5.19287 8.97021 5.09375C9.02783 4.82568 9.16162 4.57812 9.3584 4.38135ZM10.375 15.6899C10.0933 15.6899 9.82275 15.5781 9.62354 15.3789C9.42432 15.1797 9.3125 14.9092 9.3125 14.6274V9.31494C9.3125 9.0332 9.42432 8.7627 9.62354 8.56348C9.82275 8.36426 10.0933 8.25244 10.375 8.25244C10.6567 8.25244 10.9272 8.36426 11.1265 8.56348C11.3257 8.7627 11.4375 9.0332 11.4375 9.31494V14.6274C11.4375 14.7944 11.3979 14.9575 11.3242 15.104C11.2739 15.2046 11.2075 15.2979 11.1265 15.3789C10.9272 15.5781 10.6567 15.6899 10.375 15.6899Z\"></path></svg><div class=\"text mt [&amp;_p]:mb-1.5 [&amp;_p]:mt-0 mt-0.5 [&amp;_p:last-child]:mb-0\">Deprecated: use <a href=\"#get-or-create-a-collection\">get_or_create_collection</a></div></div>\n<p>You can create a collection to store vectors specifying the collections name and the number of dimensions in the vectors you intend to store.</p>\n<div class=\"ch-codeblock not-prose \" data-ch-theme=\"supabase\"><div class=\"ch-code-wrapper ch-code\" data-ch-measured=\"false\"><code class=\"ch-code-scroll-parent\"><br><div><span class=\"ch-code-line-number\">_<!-- -->10</span><div style=\"display:inline-block;margin-left:16px\"><span>docs = vx.create_collection(name=\"docs\", dimension=3)</span></div></div><br></code></div></div>\n<h3 id=\"get-an-existing-collection\" class=\"group scroll-mt-24\">Get an existing collection<a href=\"#get-an-existing-collection\" aria-hidden=\"true\" class=\"ml-2 opacity-0 group-hover:opacity-100 transition\"><span aria-hidden=\"true\">#</span></a></h3>\n<div role=\"alert\" class=\"relative w-full text-sm rounded-lg p-4 [&amp;>svg~*]:pl-10 [&amp;>svg+div]:translate-y-[-3px] [&amp;>svg]:absolute [&amp;>svg]:left-4 [&amp;>svg]:top-4 [&amp;>svg]:w-[23px] [&amp;>svg]:h-[23px] [&amp;>svg]:p-1 [&amp;>svg]:flex [&amp;>svg]:rounded text-foreground [&amp;>svg]:text-background [&amp;>svg]:bg-foreground mb-2 [&amp;_svg]:bg-foreground-muted [&amp;_svg]:text-background-muted bg-surface-200/25 border border-default\"><svg xmlns=\"http://www.w3.org/2000/svg\" viewBox=\"0 0 21 20\" class=\"w-6 h-6\" fill=\"currentColor\"><path fill-rule=\"evenodd\" clip-rule=\"evenodd\" d=\"M0.625 9.8252C0.625 4.44043 4.99023 0.0751953 10.375 0.0751953C15.7598 0.0751953 20.125 4.44043 20.125 9.8252C20.125 15.21 15.7598 19.5752 10.375 19.5752C4.99023 19.5752 0.625 15.21 0.625 9.8252ZM9.3584 4.38135C9.45117 4.28857 9.55518 4.20996 9.66699 4.14648C9.88086 4.02539 10.1245 3.96045 10.375 3.96045C10.5845 3.96045 10.7896 4.00586 10.9766 4.09229C11.1294 4.1626 11.2705 4.26025 11.3916 4.38135C11.6611 4.65088 11.8125 5.0166 11.8125 5.39795C11.8125 5.5249 11.7959 5.6499 11.7637 5.77002C11.6987 6.01172 11.5718 6.23438 11.3916 6.41455C11.1221 6.68408 10.7563 6.83545 10.375 6.83545C9.99365 6.83545 9.62793 6.68408 9.3584 6.41455C9.08887 6.14502 8.9375 5.7793 8.9375 5.39795C8.9375 5.29492 8.94873 5.19287 8.97021 5.09375C9.02783 4.82568 9.16162 4.57812 9.3584 4.38135ZM10.375 15.6899C10.0933 15.6899 9.82275 15.5781 9.62354 15.3789C9.42432 15.1797 9.3125 14.9092 9.3125 14.6274V9.31494C9.3125 9.0332 9.42432 8.7627 9.62354 8.56348C9.82275 8.36426 10.0933 8.25244 10.375 8.25244C10.6567 8.25244 10.9272 8.36426 11.1265 8.56348C11.3257 8.7627 11.4375 9.0332 11.4375 9.31494V14.6274C11.4375 14.7944 11.3979 14.9575 11.3242 15.104C11.2739 15.2046 11.2075 15.2979 11.1265 15.3789C10.9272 15.5781 10.6567 15.6899 10.375 15.6899Z\"></path></svg><div class=\"text mt [&amp;_p]:mb-1.5 [&amp;_p]:mt-0 mt-0.5 [&amp;_p:last-child]:mb-0\">Deprecated: use <a href=\"#get-or-create-a-collection\">get_or_create_collection</a></div></div>\n<p>To access a previously created collection, use <code>get_collection</code> to retrieve it by name</p>\n<div class=\"ch-codeblock not-prose \" data-ch-theme=\"supabase\"><div class=\"ch-code-wrapper ch-code\" data-ch-measured=\"false\"><code class=\"ch-code-scroll-parent\"><br><div><span class=\"ch-code-line-number\">_<!-- -->10</span><div style=\"display:inline-block;margin-left:16px\"><span>docs = vx.get_collection(name=\"docs\")</span></div></div><br></code></div></div></article></div></div></div><!--$--><div class=\"max-w-7xl px-5 mx-auto py-8 pt-0\"></div><!--/$--></div><div class=\"left-0 right-0 z-10 backdrop-blur-sm backdrop-filter bg-alternative/90 hidden h-0 lg:hidden\"></div></div></main></div></div></div></div></body></html>",
      "metadata": {
        "ogUrl": "https://supabase.com/docs/guides/ai/python/api",
        "title": "API | Supabase Docs",
        "robots": "index, follow",
        "ogImage": "https://obuldanrptloktxcffvn.supabase.co/functions/v1/og-images?site=docs&type=ai&title=API&description=undefined",
        "ogTitle": "API | Supabase Docs",
        "language": "en",
        "sourceURL": "https://supabase.com/docs/guides/ai/python/api",
        "modifiedTime": "2024-09-10T20:36:24.980Z",
        "publishedTime": "2024-09-10T20:36:24.980Z",
        "ogLocaleAlternate": [],
        "statusCode": 200
      }
    },
    {
      "markdown": "AI & Vectors\n\n# LangChain\n\n* * *\n\n[LangChain](https://langchain.com/) is a popular framework for working with AI, Vectors, and embeddings. LangChain supports using Supabase as a [vector store](https://js.langchain.com/docs/modules/indexes/vector_stores/integrations/supabase), using the `pgvector` extension.\n\n## Initializing your database [\\#](\\#initializing-your-database)\n\nPrepare you database with the relevant tables:\n\nDashboardSQL\n\n1. Go to the [SQL Editor](https://supabase.com/dashboard/project/_/sql) page in the Dashboard.\n2. Click **LangChain** in the Quick start section.\n3. Click **Run**.\n\n## Usage [\\#](\\#usage)\n\nYou can now search your documents using any Node.js application. This is intended to be run on a secure server route.\n\n``\n_28\nimport { SupabaseVectorStore } from 'langchain/vectorstores/supabase'\n_28\nimport { OpenAIEmbeddings } from 'langchain/embeddings/openai'\n_28\nimport { createClient } from '@supabase/supabase-js'\n_28\n_28\nconst supabaseKey = process.env.SUPABASE_SERVICE_ROLE_KEY\n_28\nif (!supabaseKey) throw new Error(`Expected SUPABASE_SERVICE_ROLE_KEY`)\n_28\n_28\nconst url = process.env.SUPABASE_URL\n_28\nif (!url) throw new Error(`Expected env var SUPABASE_URL`)\n_28\n_28\nexport const run = async () => {\n_28\nconst client = createClient(url, supabaseKey)\n_28\n_28\nconst vectorStore = await SupabaseVectorStore.fromTexts(\n_28\n    ['Hello world', 'Bye bye', \"What's this?\"],\n_28\n    [{ id: 2 }, { id: 1 }, { id: 3 }],\n_28\n    new OpenAIEmbeddings(),\n_28\n    {\n_28\n      client,\n_28\n      tableName: 'documents',\n_28\n      queryName: 'match_documents',\n_28\n    }\n_28\n)\n_28\n_28\nconst resultOne = await vectorStore.similaritySearch('Hello world', 1)\n_28\n_28\nconsole.log(resultOne)\n_28\n}\n``\n\n### Simple metadata filtering [\\#](\\#simple-metadata-filtering)\n\nGiven the above `match_documents` Postgres function, you can also pass a filter parameter to only return documents with a specific metadata field value. This filter parameter is a JSON object, and the `match_documents` function will use the Postgres JSONB Containment operator `@>` to filter documents by the metadata field values you specify. See details on the [Postgres JSONB Containment operator](https://www.postgresql.org/docs/current/datatype-json.html#JSON-CONTAINMENT) for more information.\n\n``\n_32\nimport { SupabaseVectorStore } from 'langchain/vectorstores/supabase'\n_32\nimport { OpenAIEmbeddings } from 'langchain/embeddings/openai'\n_32\nimport { createClient } from '@supabase/supabase-js'\n_32\n_32\n// First, follow set-up instructions above\n_32\n_32\nconst privateKey = process.env.SUPABASE_SERVICE_ROLE_KEY\n_32\nif (!privateKey) throw new Error(`Expected env var SUPABASE_SERVICE_ROLE_KEY`)\n_32\n_32\nconst url = process.env.SUPABASE_URL\n_32\nif (!url) throw new Error(`Expected env var SUPABASE_URL`)\n_32\n_32\nexport const run = async () => {\n_32\nconst client = createClient(url, privateKey)\n_32\n_32\nconst vectorStore = await SupabaseVectorStore.fromTexts(\n_32\n    ['Hello world', 'Hello world', 'Hello world'],\n_32\n    [{ user_id: 2 }, { user_id: 1 }, { user_id: 3 }],\n_32\n    new OpenAIEmbeddings(),\n_32\n    {\n_32\n      client,\n_32\n      tableName: 'documents',\n_32\n      queryName: 'match_documents',\n_32\n    }\n_32\n)\n_32\n_32\nconst result = await vectorStore.similaritySearch('Hello world', 1, {\n_32\n    user_id: 3,\n_32\n})\n_32\n_32\nconsole.log(result)\n_32\n}\n``\n\n### Advanced metadata filtering [\\#](\\#advanced-metadata-filtering)\n\nYou can also use query builder-style filtering ( [similar to how the Supabase JavaScript library works](https://supabase.com/docs/reference/javascript/using-filters)) instead of passing an object. Note that since the filter properties will be in the metadata column, you need to use arrow operators ( `->` for integer or `->>` for text) as defined in [Postgrest API documentation](https://postgrest.org/en/stable/references/api/tables_views.html?highlight=operators#json-columns) and specify the data type of the property (e.g. the column should look something like `metadata->some_int_value::int`).\n\n``\n_62\nimport { SupabaseFilterRPCCall, SupabaseVectorStore } from 'langchain/vectorstores/supabase'\n_62\nimport { OpenAIEmbeddings } from 'langchain/embeddings/openai'\n_62\nimport { createClient } from '@supabase/supabase-js'\n_62\n_62\n// First, follow set-up instructions above\n_62\n_62\nconst privateKey = process.env.SUPABASE_SERVICE_ROLE_KEY\n_62\nif (!privateKey) throw new Error(`Expected env var SUPABASE_SERVICE_ROLE_KEY`)\n_62\n_62\nconst url = process.env.SUPABASE_URL\n_62\nif (!url) throw new Error(`Expected env var SUPABASE_URL`)\n_62\n_62\nexport const run = async () => {\n_62\nconst client = createClient(url, privateKey)\n_62\n_62\nconst embeddings = new OpenAIEmbeddings()\n_62\n_62\nconst store = new SupabaseVectorStore(embeddings, {\n_62\n    client,\n_62\n    tableName: 'documents',\n_62\n})\n_62\n_62\nconst docs = [\\\n_62\\\n    {\\\n_62\\\n      pageContent:\\\n_62\\\n        'This is a long text, but it actually means something because vector database does not understand Lorem Ipsum. So I would need to expand upon the notion of quantum fluff, a theoretical concept where subatomic particles coalesce to form transient multidimensional spaces. Yet, this abstraction holds no real-world application or comprehensible meaning, reflecting a cosmic puzzle.',\\\n_62\\\n      metadata: { b: 1, c: 10, stuff: 'right' },\\\n_62\\\n    },\\\n_62\\\n    {\\\n_62\\\n      pageContent:\\\n_62\\\n        'This is a long text, but it actually means something because vector database does not understand Lorem Ipsum. So I would need to proceed by discussing the echo of virtual tweets in the binary corridors of the digital universe. Each tweet, like a pixelated canary, hums in an unseen frequency, a fascinatingly perplexing phenomenon that, while conjuring vivid imagery, lacks any concrete implication or real-world relevance, portraying a paradox of multidimensional spaces in the age of cyber folklore.',\\\n_62\\\n      metadata: { b: 2, c: 9, stuff: 'right' },\\\n_62\\\n    },\\\n_62\\\n    { pageContent: 'hello', metadata: { b: 1, c: 9, stuff: 'right' } },\\\n_62\\\n    { pageContent: 'hello', metadata: { b: 1, c: 9, stuff: 'wrong' } },\\\n_62\\\n    { pageContent: 'hi', metadata: { b: 2, c: 8, stuff: 'right' } },\\\n_62\\\n    { pageContent: 'bye', metadata: { b: 3, c: 7, stuff: 'right' } },\\\n_62\\\n    { pageContent: \"what's this\", metadata: { b: 4, c: 6, stuff: 'right' } },\\\n_62\\\n]\n_62\n_62\nawait store.addDocuments(docs)\n_62\n_62\nconst funcFilterA: SupabaseFilterRPCCall = (rpc) =>\n_62\n    rpc\n_62\n      .filter('metadata->b::int', 'lt', 3)\n_62\n      .filter('metadata->c::int', 'gt', 7)\n_62\n      .textSearch('content', `'multidimensional' & 'spaces'`, {\n_62\n        config: 'english',\n_62\n      })\n_62\n_62\nconst resultA = await store.similaritySearch('quantum', 4, funcFilterA)\n_62\n_62\nconst funcFilterB: SupabaseFilterRPCCall = (rpc) =>\n_62\n    rpc\n_62\n      .filter('metadata->b::int', 'lt', 3)\n_62\n      .filter('metadata->c::int', 'gt', 7)\n_62\n      .filter('metadata->>stuff', 'eq', 'right')\n_62\n_62\nconst resultB = await store.similaritySearch('hello', 2, funcFilterB)\n_62\n_62\nconsole.log(resultA, resultB)\n_62\n}\n``\n\n## Hybrid search [\\#](\\#hybrid-search)\n\nLangChain supports the concept of a hybrid search, which combines Similarity Search with Full Text Search. Read the official docs to get started: [Supabase Hybrid Search](https://js.langchain.com/docs/modules/indexes/retrievers/supabase-hybrid).\n\nYou can install the LangChain Hybrid Search function though our [database.dev package manager](https://database.dev/langchain/hybrid_search).\n\n## Resources [\\#](\\#resources)\n\n- Official [LangChain site](https://langchain.com/).\n- Official [LangChain docs](https://js.langchain.com/docs/modules/indexes/vector_stores/integrations/supabase).\n- Supabase [Hybrid Search](https://js.langchain.com/docs/modules/indexes/retrievers/supabase-hybrid).",
      "html": "<!DOCTYPE html><html lang=\"en\" data-theme=\"light\" style=\"color-scheme: light;\"><body><div class=\"flex flex-col\"><div class=\"grow\"><div class=\"flex flex-col h-full w-full\"><div class=\"hidden lg:sticky w-full lg:flex top-0 left-0 right-0 z-50\"><!--$--><!--/$--></div><div class=\"flex flex-row h-full relative\"><main id=\"docs-content-container\" class=\"w-full transition-all ease-out relative lg:ml-0\"><div class=\"flex flex-col sticky top-0\"><div class=\"flex lg:hidden w-full top-0 left-0 right-0 z-50\"><!--$--><!--/$--></div><div class=\"sticky transition-all top-0 z-10 backdrop-blur backdrop-filter bg-background\"><div class=\"lg:hidden px-3.5 border-b z-10 transition-all ease-out top-0 flex items-center gap-1\"><button class=\"h-8 w-8 flex group items-center justify-center mr-1\"><div class=\"space-y-1 cursor-pointer relative w-4 h-[8px]\"><span class=\"transition-all ease-out block h-px bg-foreground-muted group-hover:bg-foreground w-4\"></span><span class=\"transition-all ease-out block h-px bg-foreground-muted group-hover:bg-foreground w-3 group-hover:w-4\"></span></div></button><span class=\"transition-all duration-200 text-foreground text-sm\">AI &amp; Vectors</span></div></div><div class=\"grow\"><div class=\"max-w-7xl px-5 mx-auto py-8 pb-0\"><div class=\"grid grid-cols-12 relative gap-4\"><div class=\"relative transition-all ease-out duration-100 col-span-12 md:col-span-9\"><article id=\"sb-docs-guide-main-article\" class=\"prose max-w-none\"><h1 class=\"mb-0\">LangChain</h1><hr class=\"not-prose border-t-0 border-b my-8\">\n<p><a href=\"https://langchain.com/\">LangChain</a> is a popular framework for working with AI, Vectors, and embeddings. LangChain supports using Supabase as a <a href=\"https://js.langchain.com/docs/modules/indexes/vector_stores/integrations/supabase\">vector store</a>, using the <code>pgvector</code> extension.</p>\n<h2 id=\"initializing-your-database\" class=\"group scroll-mt-24\">Initializing your database<a href=\"#initializing-your-database\" aria-hidden=\"true\" class=\"ml-2 opacity-0 group-hover:opacity-100 transition\"><span aria-hidden=\"true\">#</span></a></h2>\n<p>Prepare you database with the relevant tables:</p>\n<div dir=\"ltr\" data-orientation=\"horizontal\" class=\"w-full justify-between space-y-4 \"><div role=\"tablist\" aria-orientation=\"horizontal\" class=\" flex items-center border-b border-secondary  overflow-auto whitespace-nowrap no-scrollbar mask-fadeout-right flex-wrap\" tabindex=\"-1\" data-orientation=\"horizontal\" style=\"outline:none\"><button type=\"button\" role=\"tab\" aria-selected=\"true\" aria-controls=\"radix-:R969jtsn7qb6ra:-content-dashboard\" data-state=\"active\" id=\"radix-:R969jtsn7qb6ra:-trigger-dashboard\" class=\" relative cursor-pointer text-foreground-lighter flex items-center space-x-2 text-center transition focus:outline-none focus-visible:ring focus-visible:ring-foreground-muted focus-visible:border-foreground-muted  text-sm leading-4 px-3 py-2  !text-foreground border-b-2 border-foreground \" tabindex=\"-1\" data-orientation=\"horizontal\" data-radix-collection-item=\"\"><span>Dashboard</span></button><button type=\"button\" role=\"tab\" aria-selected=\"false\" aria-controls=\"radix-:R969jtsn7qb6ra:-content-sql\" data-state=\"inactive\" id=\"radix-:R969jtsn7qb6ra:-trigger-sql\" class=\" relative cursor-pointer text-foreground-lighter flex items-center space-x-2 text-center transition focus:outline-none focus-visible:ring focus-visible:ring-foreground-muted focus-visible:border-foreground-muted  text-sm leading-4 px-3 py-2  hover:text-foreground \" tabindex=\"-1\" data-orientation=\"horizontal\" data-radix-collection-item=\"\"><span>SQL</span></button></div><div data-state=\"active\" data-orientation=\"horizontal\" role=\"tabpanel\" aria-labelledby=\"radix-:R969jtsn7qb6ra:-trigger-dashboard\" id=\"radix-:R969jtsn7qb6ra:-content-dashboard\" tabindex=\"0\" class=\"focus:outline-none transition-height \" style=\"animation-duration:0s\"><ol>\n<li>Go to the <a href=\"https://supabase.com/dashboard/project/_/sql\">SQL Editor</a> page in the Dashboard.</li>\n<li>Click <strong>LangChain</strong> in the Quick start section.</li>\n<li>Click <strong>Run</strong>.</li>\n</ol></div><div data-state=\"inactive\" data-orientation=\"horizontal\" role=\"tabpanel\" aria-labelledby=\"radix-:R969jtsn7qb6ra:-trigger-sql\" hidden=\"\" id=\"radix-:R969jtsn7qb6ra:-content-sql\" tabindex=\"0\" class=\"focus:outline-none transition-height \"></div></div>\n<h2 id=\"usage\" class=\"group scroll-mt-24\">Usage<a href=\"#usage\" aria-hidden=\"true\" class=\"ml-2 opacity-0 group-hover:opacity-100 transition\"><span aria-hidden=\"true\">#</span></a></h2>\n<p>You can now search your documents using any Node.js application. This is intended to be run on a secure server route.</p>\n<div class=\"ch-codeblock not-prose \" data-ch-theme=\"supabase\"><div class=\"ch-code-wrapper ch-code\" data-ch-measured=\"false\"><code class=\"ch-code-scroll-parent\"><br><div><span class=\"ch-code-line-number\">_<!-- -->28</span><div style=\"display:inline-block;margin-left:16px\"><span>import { SupabaseVectorStore } from 'langchain/vectorstores/supabase'</span></div></div><div><span class=\"ch-code-line-number\">_<!-- -->28</span><div style=\"display:inline-block;margin-left:16px\"><span>import { OpenAIEmbeddings } from 'langchain/embeddings/openai'</span></div></div><div><span class=\"ch-code-line-number\">_<!-- -->28</span><div style=\"display:inline-block;margin-left:16px\"><span>import { createClient } from '@supabase/supabase-js'</span></div></div><div><span class=\"ch-code-line-number\">_<!-- -->28</span><div style=\"display:inline-block;margin-left:16px\"><span></span></div></div><div><span class=\"ch-code-line-number\">_<!-- -->28</span><div style=\"display:inline-block;margin-left:16px\"><span>const supabaseKey = process.env.SUPABASE_SERVICE_ROLE_KEY</span></div></div><div><span class=\"ch-code-line-number\">_<!-- -->28</span><div style=\"display:inline-block;margin-left:16px\"><span>if (!supabaseKey) throw new Error(`Expected SUPABASE_SERVICE_ROLE_KEY`)</span></div></div><div><span class=\"ch-code-line-number\">_<!-- -->28</span><div style=\"display:inline-block;margin-left:16px\"><span></span></div></div><div><span class=\"ch-code-line-number\">_<!-- -->28</span><div style=\"display:inline-block;margin-left:16px\"><span>const url = process.env.SUPABASE_URL</span></div></div><div><span class=\"ch-code-line-number\">_<!-- -->28</span><div style=\"display:inline-block;margin-left:16px\"><span>if (!url) throw new Error(`Expected env var SUPABASE_URL`)</span></div></div><div><span class=\"ch-code-line-number\">_<!-- -->28</span><div style=\"display:inline-block;margin-left:16px\"><span></span></div></div><div><span class=\"ch-code-line-number\">_<!-- -->28</span><div style=\"display:inline-block;margin-left:16px\"><span>export const run = async () =&gt; {</span></div></div><div><span class=\"ch-code-line-number\">_<!-- -->28</span><div style=\"display:inline-block;margin-left:16px\"><span>  const client = createClient(url, supabaseKey)</span></div></div><div><span class=\"ch-code-line-number\">_<!-- -->28</span><div style=\"display:inline-block;margin-left:16px\"><span></span></div></div><div><span class=\"ch-code-line-number\">_<!-- -->28</span><div style=\"display:inline-block;margin-left:16px\"><span>  const vectorStore = await SupabaseVectorStore.fromTexts(</span></div></div><div><span class=\"ch-code-line-number\">_<!-- -->28</span><div style=\"display:inline-block;margin-left:16px\"><span>    ['Hello world', 'Bye bye', \"What's this?\"],</span></div></div><div><span class=\"ch-code-line-number\">_<!-- -->28</span><div style=\"display:inline-block;margin-left:16px\"><span>    [{ id: 2 }, { id: 1 }, { id: 3 }],</span></div></div><div><span class=\"ch-code-line-number\">_<!-- -->28</span><div style=\"display:inline-block;margin-left:16px\"><span>    new OpenAIEmbeddings(),</span></div></div><div><span class=\"ch-code-line-number\">_<!-- -->28</span><div style=\"display:inline-block;margin-left:16px\"><span>    {</span></div></div><div><span class=\"ch-code-line-number\">_<!-- -->28</span><div style=\"display:inline-block;margin-left:16px\"><span>      client,</span></div></div><div><span class=\"ch-code-line-number\">_<!-- -->28</span><div style=\"display:inline-block;margin-left:16px\"><span>      tableName: 'documents',</span></div></div><div><span class=\"ch-code-line-number\">_<!-- -->28</span><div style=\"display:inline-block;margin-left:16px\"><span>      queryName: 'match_documents',</span></div></div><div><span class=\"ch-code-line-number\">_<!-- -->28</span><div style=\"display:inline-block;margin-left:16px\"><span>    }</span></div></div><div><span class=\"ch-code-line-number\">_<!-- -->28</span><div style=\"display:inline-block;margin-left:16px\"><span>  )</span></div></div><div><span class=\"ch-code-line-number\">_<!-- -->28</span><div style=\"display:inline-block;margin-left:16px\"><span></span></div></div><div><span class=\"ch-code-line-number\">_<!-- -->28</span><div style=\"display:inline-block;margin-left:16px\"><span>  const resultOne = await vectorStore.similaritySearch('Hello world', 1)</span></div></div><div><span class=\"ch-code-line-number\">_<!-- -->28</span><div style=\"display:inline-block;margin-left:16px\"><span></span></div></div><div><span class=\"ch-code-line-number\">_<!-- -->28</span><div style=\"display:inline-block;margin-left:16px\"><span>  console.log(resultOne)</span></div></div><div><span class=\"ch-code-line-number\">_<!-- -->28</span><div style=\"display:inline-block;margin-left:16px\"><span>}</span></div></div><br></code></div></div>\n<h3 id=\"simple-metadata-filtering\" class=\"group scroll-mt-24\">Simple metadata filtering<a href=\"#simple-metadata-filtering\" aria-hidden=\"true\" class=\"ml-2 opacity-0 group-hover:opacity-100 transition\"><span aria-hidden=\"true\">#</span></a></h3>\n<p>Given the above <code>match_documents</code> Postgres function, you can also pass a filter parameter to only return documents with a specific metadata field value. This filter parameter is a JSON object, and the <code>match_documents</code> function will use the Postgres JSONB Containment operator <code>@&gt;</code> to filter documents by the metadata field values you specify. See details on the <a href=\"https://www.postgresql.org/docs/current/datatype-json.html#JSON-CONTAINMENT\">Postgres JSONB Containment operator</a> for more information.</p>\n<div class=\"ch-codeblock not-prose \" data-ch-theme=\"supabase\"><div class=\"ch-code-wrapper ch-code\" data-ch-measured=\"false\"><code class=\"ch-code-scroll-parent\"><br><div><span class=\"ch-code-line-number\">_<!-- -->32</span><div style=\"display:inline-block;margin-left:16px\"><span>import { SupabaseVectorStore } from 'langchain/vectorstores/supabase'</span></div></div><div><span class=\"ch-code-line-number\">_<!-- -->32</span><div style=\"display:inline-block;margin-left:16px\"><span>import { OpenAIEmbeddings } from 'langchain/embeddings/openai'</span></div></div><div><span class=\"ch-code-line-number\">_<!-- -->32</span><div style=\"display:inline-block;margin-left:16px\"><span>import { createClient } from '@supabase/supabase-js'</span></div></div><div><span class=\"ch-code-line-number\">_<!-- -->32</span><div style=\"display:inline-block;margin-left:16px\"><span></span></div></div><div><span class=\"ch-code-line-number\">_<!-- -->32</span><div style=\"display:inline-block;margin-left:16px\"><span>// First, follow set-up instructions above</span></div></div><div><span class=\"ch-code-line-number\">_<!-- -->32</span><div style=\"display:inline-block;margin-left:16px\"><span></span></div></div><div><span class=\"ch-code-line-number\">_<!-- -->32</span><div style=\"display:inline-block;margin-left:16px\"><span>const privateKey = process.env.SUPABASE_SERVICE_ROLE_KEY</span></div></div><div><span class=\"ch-code-line-number\">_<!-- -->32</span><div style=\"display:inline-block;margin-left:16px\"><span>if (!privateKey) throw new Error(`Expected env var SUPABASE_SERVICE_ROLE_KEY`)</span></div></div><div><span class=\"ch-code-line-number\">_<!-- -->32</span><div style=\"display:inline-block;margin-left:16px\"><span></span></div></div><div><span class=\"ch-code-line-number\">_<!-- -->32</span><div style=\"display:inline-block;margin-left:16px\"><span>const url = process.env.SUPABASE_URL</span></div></div><div><span class=\"ch-code-line-number\">_<!-- -->32</span><div style=\"display:inline-block;margin-left:16px\"><span>if (!url) throw new Error(`Expected env var SUPABASE_URL`)</span></div></div><div><span class=\"ch-code-line-number\">_<!-- -->32</span><div style=\"display:inline-block;margin-left:16px\"><span></span></div></div><div><span class=\"ch-code-line-number\">_<!-- -->32</span><div style=\"display:inline-block;margin-left:16px\"><span>export const run = async () =&gt; {</span></div></div><div><span class=\"ch-code-line-number\">_<!-- -->32</span><div style=\"display:inline-block;margin-left:16px\"><span>  const client = createClient(url, privateKey)</span></div></div><div><span class=\"ch-code-line-number\">_<!-- -->32</span><div style=\"display:inline-block;margin-left:16px\"><span></span></div></div><div><span class=\"ch-code-line-number\">_<!-- -->32</span><div style=\"display:inline-block;margin-left:16px\"><span>  const vectorStore = await SupabaseVectorStore.fromTexts(</span></div></div><div><span class=\"ch-code-line-number\">_<!-- -->32</span><div style=\"display:inline-block;margin-left:16px\"><span>    ['Hello world', 'Hello world', 'Hello world'],</span></div></div><div><span class=\"ch-code-line-number\">_<!-- -->32</span><div style=\"display:inline-block;margin-left:16px\"><span>    [{ user_id: 2 }, { user_id: 1 }, { user_id: 3 }],</span></div></div><div><span class=\"ch-code-line-number\">_<!-- -->32</span><div style=\"display:inline-block;margin-left:16px\"><span>    new OpenAIEmbeddings(),</span></div></div><div><span class=\"ch-code-line-number\">_<!-- -->32</span><div style=\"display:inline-block;margin-left:16px\"><span>    {</span></div></div><div><span class=\"ch-code-line-number\">_<!-- -->32</span><div style=\"display:inline-block;margin-left:16px\"><span>      client,</span></div></div><div><span class=\"ch-code-line-number\">_<!-- -->32</span><div style=\"display:inline-block;margin-left:16px\"><span>      tableName: 'documents',</span></div></div><div><span class=\"ch-code-line-number\">_<!-- -->32</span><div style=\"display:inline-block;margin-left:16px\"><span>      queryName: 'match_documents',</span></div></div><div><span class=\"ch-code-line-number\">_<!-- -->32</span><div style=\"display:inline-block;margin-left:16px\"><span>    }</span></div></div><div><span class=\"ch-code-line-number\">_<!-- -->32</span><div style=\"display:inline-block;margin-left:16px\"><span>  )</span></div></div><div><span class=\"ch-code-line-number\">_<!-- -->32</span><div style=\"display:inline-block;margin-left:16px\"><span></span></div></div><div><span class=\"ch-code-line-number\">_<!-- -->32</span><div style=\"display:inline-block;margin-left:16px\"><span>  const result = await vectorStore.similaritySearch('Hello world', 1, {</span></div></div><div><span class=\"ch-code-line-number\">_<!-- -->32</span><div style=\"display:inline-block;margin-left:16px\"><span>    user_id: 3,</span></div></div><div><span class=\"ch-code-line-number\">_<!-- -->32</span><div style=\"display:inline-block;margin-left:16px\"><span>  })</span></div></div><div><span class=\"ch-code-line-number\">_<!-- -->32</span><div style=\"display:inline-block;margin-left:16px\"><span></span></div></div><div><span class=\"ch-code-line-number\">_<!-- -->32</span><div style=\"display:inline-block;margin-left:16px\"><span>  console.log(result)</span></div></div><div><span class=\"ch-code-line-number\">_<!-- -->32</span><div style=\"display:inline-block;margin-left:16px\"><span>}</span></div></div><br></code></div></div>\n<h3 id=\"advanced-metadata-filtering\" class=\"group scroll-mt-24\">Advanced metadata filtering<a href=\"#advanced-metadata-filtering\" aria-hidden=\"true\" class=\"ml-2 opacity-0 group-hover:opacity-100 transition\"><span aria-hidden=\"true\">#</span></a></h3>\n<p>You can also use query builder-style filtering (<a href=\"https://supabase.com/docs/reference/javascript/using-filters\">similar to how the Supabase JavaScript library works</a>) instead of passing an object. Note that since the filter properties will be in the metadata column, you need to use arrow operators (<code>-&gt;</code> for integer or <code>-&gt;&gt;</code> for text) as defined in <a href=\"https://postgrest.org/en/stable/references/api/tables_views.html?highlight=operators#json-columns\">Postgrest API documentation</a> and specify the data type of the property (e.g. the column should look something like <code>metadata-&gt;some_int_value::int</code>).</p>\n<div class=\"ch-codeblock not-prose \" data-ch-theme=\"supabase\"><div class=\"ch-code-wrapper ch-code\" data-ch-measured=\"false\"><code class=\"ch-code-scroll-parent\"><br><div><span class=\"ch-code-line-number\">_<!-- -->62</span><div style=\"display:inline-block;margin-left:16px\"><span>import { SupabaseFilterRPCCall, SupabaseVectorStore } from 'langchain/vectorstores/supabase'</span></div></div><div><span class=\"ch-code-line-number\">_<!-- -->62</span><div style=\"display:inline-block;margin-left:16px\"><span>import { OpenAIEmbeddings } from 'langchain/embeddings/openai'</span></div></div><div><span class=\"ch-code-line-number\">_<!-- -->62</span><div style=\"display:inline-block;margin-left:16px\"><span>import { createClient } from '@supabase/supabase-js'</span></div></div><div><span class=\"ch-code-line-number\">_<!-- -->62</span><div style=\"display:inline-block;margin-left:16px\"><span></span></div></div><div><span class=\"ch-code-line-number\">_<!-- -->62</span><div style=\"display:inline-block;margin-left:16px\"><span>// First, follow set-up instructions above</span></div></div><div><span class=\"ch-code-line-number\">_<!-- -->62</span><div style=\"display:inline-block;margin-left:16px\"><span></span></div></div><div><span class=\"ch-code-line-number\">_<!-- -->62</span><div style=\"display:inline-block;margin-left:16px\"><span>const privateKey = process.env.SUPABASE_SERVICE_ROLE_KEY</span></div></div><div><span class=\"ch-code-line-number\">_<!-- -->62</span><div style=\"display:inline-block;margin-left:16px\"><span>if (!privateKey) throw new Error(`Expected env var SUPABASE_SERVICE_ROLE_KEY`)</span></div></div><div><span class=\"ch-code-line-number\">_<!-- -->62</span><div style=\"display:inline-block;margin-left:16px\"><span></span></div></div><div><span class=\"ch-code-line-number\">_<!-- -->62</span><div style=\"display:inline-block;margin-left:16px\"><span>const url = process.env.SUPABASE_URL</span></div></div><div><span class=\"ch-code-line-number\">_<!-- -->62</span><div style=\"display:inline-block;margin-left:16px\"><span>if (!url) throw new Error(`Expected env var SUPABASE_URL`)</span></div></div><div><span class=\"ch-code-line-number\">_<!-- -->62</span><div style=\"display:inline-block;margin-left:16px\"><span></span></div></div><div><span class=\"ch-code-line-number\">_<!-- -->62</span><div style=\"display:inline-block;margin-left:16px\"><span>export const run = async () =&gt; {</span></div></div><div><span class=\"ch-code-line-number\">_<!-- -->62</span><div style=\"display:inline-block;margin-left:16px\"><span>  const client = createClient(url, privateKey)</span></div></div><div><span class=\"ch-code-line-number\">_<!-- -->62</span><div style=\"display:inline-block;margin-left:16px\"><span></span></div></div><div><span class=\"ch-code-line-number\">_<!-- -->62</span><div style=\"display:inline-block;margin-left:16px\"><span>  const embeddings = new OpenAIEmbeddings()</span></div></div><div><span class=\"ch-code-line-number\">_<!-- -->62</span><div style=\"display:inline-block;margin-left:16px\"><span></span></div></div><div><span class=\"ch-code-line-number\">_<!-- -->62</span><div style=\"display:inline-block;margin-left:16px\"><span>  const store = new SupabaseVectorStore(embeddings, {</span></div></div><div><span class=\"ch-code-line-number\">_<!-- -->62</span><div style=\"display:inline-block;margin-left:16px\"><span>    client,</span></div></div><div><span class=\"ch-code-line-number\">_<!-- -->62</span><div style=\"display:inline-block;margin-left:16px\"><span>    tableName: 'documents',</span></div></div><div><span class=\"ch-code-line-number\">_<!-- -->62</span><div style=\"display:inline-block;margin-left:16px\"><span>  })</span></div></div><div><span class=\"ch-code-line-number\">_<!-- -->62</span><div style=\"display:inline-block;margin-left:16px\"><span></span></div></div><div><span class=\"ch-code-line-number\">_<!-- -->62</span><div style=\"display:inline-block;margin-left:16px\"><span>  const docs = [</span></div></div><div><span class=\"ch-code-line-number\">_<!-- -->62</span><div style=\"display:inline-block;margin-left:16px\"><span>    {</span></div></div><div><span class=\"ch-code-line-number\">_<!-- -->62</span><div style=\"display:inline-block;margin-left:16px\"><span>      pageContent:</span></div></div><div><span class=\"ch-code-line-number\">_<!-- -->62</span><div style=\"display:inline-block;margin-left:16px\"><span>        'This is a long text, but it actually means something because vector database does not understand Lorem Ipsum. So I would need to expand upon the notion of quantum fluff, a theoretical concept where subatomic particles coalesce to form transient multidimensional spaces. Yet, this abstraction holds no real-world application or comprehensible meaning, reflecting a cosmic puzzle.',</span></div></div><div><span class=\"ch-code-line-number\">_<!-- -->62</span><div style=\"display:inline-block;margin-left:16px\"><span>      metadata: { b: 1, c: 10, stuff: 'right' },</span></div></div><div><span class=\"ch-code-line-number\">_<!-- -->62</span><div style=\"display:inline-block;margin-left:16px\"><span>    },</span></div></div><div><span class=\"ch-code-line-number\">_<!-- -->62</span><div style=\"display:inline-block;margin-left:16px\"><span>    {</span></div></div><div><span class=\"ch-code-line-number\">_<!-- -->62</span><div style=\"display:inline-block;margin-left:16px\"><span>      pageContent:</span></div></div><div><span class=\"ch-code-line-number\">_<!-- -->62</span><div style=\"display:inline-block;margin-left:16px\"><span>        'This is a long text, but it actually means something because vector database does not understand Lorem Ipsum. So I would need to proceed by discussing the echo of virtual tweets in the binary corridors of the digital universe. Each tweet, like a pixelated canary, hums in an unseen frequency, a fascinatingly perplexing phenomenon that, while conjuring vivid imagery, lacks any concrete implication or real-world relevance, portraying a paradox of multidimensional spaces in the age of cyber folklore.',</span></div></div><div><span class=\"ch-code-line-number\">_<!-- -->62</span><div style=\"display:inline-block;margin-left:16px\"><span>      metadata: { b: 2, c: 9, stuff: 'right' },</span></div></div><div><span class=\"ch-code-line-number\">_<!-- -->62</span><div style=\"display:inline-block;margin-left:16px\"><span>    },</span></div></div><div><span class=\"ch-code-line-number\">_<!-- -->62</span><div style=\"display:inline-block;margin-left:16px\"><span>    { pageContent: 'hello', metadata: { b: 1, c: 9, stuff: 'right' } },</span></div></div><div><span class=\"ch-code-line-number\">_<!-- -->62</span><div style=\"display:inline-block;margin-left:16px\"><span>    { pageContent: 'hello', metadata: { b: 1, c: 9, stuff: 'wrong' } },</span></div></div><div><span class=\"ch-code-line-number\">_<!-- -->62</span><div style=\"display:inline-block;margin-left:16px\"><span>    { pageContent: 'hi', metadata: { b: 2, c: 8, stuff: 'right' } },</span></div></div><div><span class=\"ch-code-line-number\">_<!-- -->62</span><div style=\"display:inline-block;margin-left:16px\"><span>    { pageContent: 'bye', metadata: { b: 3, c: 7, stuff: 'right' } },</span></div></div><div><span class=\"ch-code-line-number\">_<!-- -->62</span><div style=\"display:inline-block;margin-left:16px\"><span>    { pageContent: \"what's this\", metadata: { b: 4, c: 6, stuff: 'right' } },</span></div></div><div><span class=\"ch-code-line-number\">_<!-- -->62</span><div style=\"display:inline-block;margin-left:16px\"><span>  ]</span></div></div><div><span class=\"ch-code-line-number\">_<!-- -->62</span><div style=\"display:inline-block;margin-left:16px\"><span></span></div></div><div><span class=\"ch-code-line-number\">_<!-- -->62</span><div style=\"display:inline-block;margin-left:16px\"><span>  await store.addDocuments(docs)</span></div></div><div><span class=\"ch-code-line-number\">_<!-- -->62</span><div style=\"display:inline-block;margin-left:16px\"><span></span></div></div><div><span class=\"ch-code-line-number\">_<!-- -->62</span><div style=\"display:inline-block;margin-left:16px\"><span>  const funcFilterA: SupabaseFilterRPCCall = (rpc) =&gt;</span></div></div><div><span class=\"ch-code-line-number\">_<!-- -->62</span><div style=\"display:inline-block;margin-left:16px\"><span>    rpc</span></div></div><div><span class=\"ch-code-line-number\">_<!-- -->62</span><div style=\"display:inline-block;margin-left:16px\"><span>      .filter('metadata-&gt;b::int', 'lt', 3)</span></div></div><div><span class=\"ch-code-line-number\">_<!-- -->62</span><div style=\"display:inline-block;margin-left:16px\"><span>      .filter('metadata-&gt;c::int', 'gt', 7)</span></div></div><div><span class=\"ch-code-line-number\">_<!-- -->62</span><div style=\"display:inline-block;margin-left:16px\"><span>      .textSearch('content', `'multidimensional' &amp; 'spaces'`, {</span></div></div><div><span class=\"ch-code-line-number\">_<!-- -->62</span><div style=\"display:inline-block;margin-left:16px\"><span>        config: 'english',</span></div></div><div><span class=\"ch-code-line-number\">_<!-- -->62</span><div style=\"display:inline-block;margin-left:16px\"><span>      })</span></div></div><div><span class=\"ch-code-line-number\">_<!-- -->62</span><div style=\"display:inline-block;margin-left:16px\"><span></span></div></div><div><span class=\"ch-code-line-number\">_<!-- -->62</span><div style=\"display:inline-block;margin-left:16px\"><span>  const resultA = await store.similaritySearch('quantum', 4, funcFilterA)</span></div></div><div><span class=\"ch-code-line-number\">_<!-- -->62</span><div style=\"display:inline-block;margin-left:16px\"><span></span></div></div><div><span class=\"ch-code-line-number\">_<!-- -->62</span><div style=\"display:inline-block;margin-left:16px\"><span>  const funcFilterB: SupabaseFilterRPCCall = (rpc) =&gt;</span></div></div><div><span class=\"ch-code-line-number\">_<!-- -->62</span><div style=\"display:inline-block;margin-left:16px\"><span>    rpc</span></div></div><div><span class=\"ch-code-line-number\">_<!-- -->62</span><div style=\"display:inline-block;margin-left:16px\"><span>      .filter('metadata-&gt;b::int', 'lt', 3)</span></div></div><div><span class=\"ch-code-line-number\">_<!-- -->62</span><div style=\"display:inline-block;margin-left:16px\"><span>      .filter('metadata-&gt;c::int', 'gt', 7)</span></div></div><div><span class=\"ch-code-line-number\">_<!-- -->62</span><div style=\"display:inline-block;margin-left:16px\"><span>      .filter('metadata-&gt;&gt;stuff', 'eq', 'right')</span></div></div><div><span class=\"ch-code-line-number\">_<!-- -->62</span><div style=\"display:inline-block;margin-left:16px\"><span></span></div></div><div><span class=\"ch-code-line-number\">_<!-- -->62</span><div style=\"display:inline-block;margin-left:16px\"><span>  const resultB = await store.similaritySearch('hello', 2, funcFilterB)</span></div></div><div><span class=\"ch-code-line-number\">_<!-- -->62</span><div style=\"display:inline-block;margin-left:16px\"><span></span></div></div><div><span class=\"ch-code-line-number\">_<!-- -->62</span><div style=\"display:inline-block;margin-left:16px\"><span>  console.log(resultA, resultB)</span></div></div><div><span class=\"ch-code-line-number\">_<!-- -->62</span><div style=\"display:inline-block;margin-left:16px\"><span>}</span></div></div><br></code></div></div>\n<h2 id=\"hybrid-search\" class=\"group scroll-mt-24\">Hybrid search<a href=\"#hybrid-search\" aria-hidden=\"true\" class=\"ml-2 opacity-0 group-hover:opacity-100 transition\"><span aria-hidden=\"true\">#</span></a></h2>\n<p>LangChain supports the concept of a hybrid search, which combines Similarity Search with Full Text Search. Read the official docs to get started: <a href=\"https://js.langchain.com/docs/modules/indexes/retrievers/supabase-hybrid\">Supabase Hybrid Search</a>.</p>\n<p>You can install the LangChain Hybrid Search function though our <a href=\"https://database.dev/langchain/hybrid_search\">database.dev package manager</a>.</p>\n<h2 id=\"resources\" class=\"group scroll-mt-24\">Resources<a href=\"#resources\" aria-hidden=\"true\" class=\"ml-2 opacity-0 group-hover:opacity-100 transition\"><span aria-hidden=\"true\">#</span></a></h2>\n<ul>\n<li>Official <a href=\"https://langchain.com/\">LangChain site</a>.</li>\n<li>Official <a href=\"https://js.langchain.com/docs/modules/indexes/vector_stores/integrations/supabase\">LangChain docs</a>.</li>\n<li>Supabase <a href=\"https://js.langchain.com/docs/modules/indexes/retrievers/supabase-hybrid\">Hybrid Search</a>.</li>\n</ul></article></div></div></div><!--$--><div class=\"max-w-7xl px-5 mx-auto py-8 pt-0\"></div><!--/$--></div><div class=\"left-0 right-0 z-10 backdrop-blur-sm backdrop-filter bg-alternative/90 hidden h-0 lg:hidden\"></div></div></main></div></div></div></div></body></html>",
      "metadata": {
        "ogUrl": "https://supabase.com/docs/guides/ai/langchain",
        "title": "LangChain | Supabase Docs",
        "robots": "index, follow",
        "ogImage": "https://obuldanrptloktxcffvn.supabase.co/functions/v1/og-images?site=docs&type=ai&title=LangChain&description=Learn%20how%20to%20integrate%20Supabase%20with%20LangChain%2C%20a%20popular%20framework%20for%20composing%20AI%2C%20Vectors%2C%20and%20embeddings",
        "ogTitle": "LangChain | Supabase Docs",
        "language": "en",
        "sourceURL": "https://supabase.com/docs/guides/ai/langchain",
        "description": "Learn how to integrate Supabase with LangChain, a popular framework for composing AI, Vectors, and embeddings",
        "modifiedTime": "2024-09-10T20:36:25.434Z",
        "ogDescription": "Learn how to integrate Supabase with LangChain, a popular framework for composing AI, Vectors, and embeddings",
        "publishedTime": "2024-09-10T20:36:25.434Z",
        "ogLocaleAlternate": [],
        "statusCode": 200
      }
    },
    {
      "markdown": "AI & Vectors\n\n# Hybrid search\n\n## Combine keyword search with semantic search.\n\n* * *\n\nHybrid search combines [full text search](/docs/guides/ai/keyword-search) (searching by keyword) with [semantic search](/docs/guides/ai/semantic-search) (searching by meaning) to identify results that are both directly and contextually relevant to the user's query.\n\n## Why would I want to use hybrid search? [\\#](\\#why-would-i-want-to-use-hybrid-search)\n\nSometimes a single search method doesn't quite capture what a user is really looking for. For example, if a user searches for \"Italian recipes with tomato sauce\" on a cooking app, a keyword search would pull up recipes that specifically mention \"Italian,\" \"recipes,\" and \"tomato sauce\" in the text. However, it might miss out on dishes that are quintessentially Italian and use tomato sauce but don't explicitly label themselves with these words, or use variations like \"pasta sauce\" or \"marinara.\" On the other hand, a semantic search might understand the culinary context and find recipes that match the intent, such as a traditional \"Spaghetti Marinara,\" even if they don't match the exact keyword phrase. However, it could also suggest recipes that are contextually related but not what the user is looking for, like a \"Mexican salsa\" recipe, because it understands the context to be broadly about tomato-based sauces.\n\nHybrid search combines the strengths of both these methods. It would ensure that recipes explicitly mentioning the keywords are prioritized, thus capturing direct hits that satisfy the keyword criteria. At the same time, it would include recipes identified through semantic understanding as being related in meaning or context, like different Italian dishes that traditionally use tomato sauce but might not have been tagged explicitly with the user's search terms. It identifies results that are both directly and contextually relevant to the user's query while ideally minimizing misses and irrelevant suggestions.\n\n## When would I want to use hybrid search? [\\#](\\#when-would-i-want-to-use-hybrid-search)\n\nThe decision to use hybrid search depends on what your users are looking for in your app. For a code repository where developers need to find exact lines of code or error messages, keyword search is likely ideal because it matches specific terms. In a mental health forum where users search for advice or experiences related to their feelings, semantic search may be better because it finds results based on the meaning of a query, not just specific words. For a shopping app where customers might search for specific product names yet also be open to related suggestions, hybrid search combines the best of both worlds - finding exact matches while also uncovering similar products based on the shopping context.\n\n## How to combine search methods [\\#](\\#how-to-combine-search-methods)\n\nHybrid search merges keyword search and semantic search, but how does this process work?\n\nFirst, each search method is executed separately. Keyword search, which involves searching by specific words or phrases present in the content, will yield its own set of results. Similarly, semantic search, which involves understanding the context or meaning behind the search query rather than the specific words used, will generate its own unique results.\n\nNow with these separate result lists available, the next step is to combine them into a single, unified list. This is achieved through a process known as \u201cfusion\u201d. Fusion takes the results from both search methods and merges them together based on a certain ranking or scoring system. This system may prioritize certain results based on factors like their relevance to the search query, their ranking in the individual lists, or other criteria. The result is a final list that integrates the strengths of both keyword and semantic search methods.\n\n## Reciprocal Ranked Fusion (RRF) [\\#](\\#reciprocal-ranked-fusion-rrf)\n\nOne of the most common fusion methods is Reciprocal Ranked Fusion (RRF). The key idea behind RRF is to give more weight to the top-ranked items in each individual result list when building the final combined list.\n\nIn RRF, we iterate over each record and assign a score (noting that each record could exist in one or both lists). The score is calculated as 1 divided by that record's rank in each list, summed together between both lists. For example, if a record with an ID of `123` was ranked third in the keyword search and ninth in semantic search, it would receive a score of 13+19=0.444\\\\dfrac{1}{3} + \\\\dfrac{1}{9} = 0.44431\u200b+91\u200b=0.444. If the record was found in only one list and not the other, it would receive a score of 0 for the other list. The records are then sorted by this score to create the final list. The items with the highest scores are ranked first, and lowest scores ranked last.\n\nThis method ensures that items that are ranked high in multiple lists are given a high rank in the final list. It also ensures that items that are ranked high in only a few lists but low in others are not given a high rank in the final list. Placing the rank in the denominator when calculating score helps penalize the low ranking records.\n\n### Smoothing constant `k` [\\#](\\#smoothing-constant-k)\n\nTo prevent extremely high scores for items that are ranked first (since we're dividing by the rank), a `k` constant is often added to the denominator to smooth the score:\n\n1k+rank\\\\dfrac{1}{k+rank}k+rank1\u200b\n\nThis constant can be any positive number, but is typically small. A constant of 1 would mean that a record ranked first would have a score of 11+1=0.5\\\\dfrac{1}{1+1} = 0.51+11\u200b=0.5 instead of 111. This adjustment can help balance the influence of items that are ranked very high in individual lists when creating the final combined list.\n\n## Hybrid search in Postgres [\\#](\\#hybrid-search-in-postgres)\n\nLet's implement hybrid search in Postgres using `tsvector` (keyword search) and `pgvector` (semantic search).\n\nFirst we'll create a `documents` table to store the documents that we will search over. This is just an example - adjust this to match the structure of your application.\n\n`\n1\ncreate table documents (\n2\nid bigint primary key generated always as identity,\n3\ncontent text,\n4\nfts tsvector generated always as (to_tsvector('english', content)) stored,\n5\nembedding vector(512)\n6\n);\n`\n\nThe table contains 4 columns:\n\n- `id` is an auto-generated unique ID for the record. We'll use this later to match records when performing RRF.\n- `content` contains the actual text we will be searching over.\n- `fts` is an auto-generated `tsvector` column that is generated using the text in `content`. We will use this for [full text search](/docs/guides/database/full-text-search) (search by keyword).\n- `embedding` is a [vector column](/docs/guides/ai/vector-columns) that stores the vector generated from our embedding model. We will use this for [semantic search](/docs/guides/ai/semantic-search) (search by meaning). We chose 512 dimensions for this example, but adjust this to match the size of the embedding vectors generated from your preferred model.\n\nNext we'll create indexes on the `fts` and `embedding` columns so that their individual queries will remain fast at scale:\n\n`\n1\n-- Create an index for the full-text search\n2\ncreate index on documents using gin(fts);\n3\n4\n-- Create an index for the semantic vector search\n5\ncreate index on documents using hnsw (embedding vector_ip_ops);\n`\n\nFor full text search we use a [generalized inverted (GIN) index](https://www.postgresql.org/docs/current/gin-intro.html) which is designed for handling composite values like those stored in a `tsvector`.\n\nFor semantic vector search we use an [HNSW index](/docs/guides/ai/vector-indexes/hnsw-indexes), which is a high performing approximate nearest neighbor (ANN) search algorithm. Note that we are using the `vector_ip_ops` (inner product) operator with this index because we plan on using the inner product ( `<#>`) operator later in our query. If you plan to use a different operator like cosine distance ( `<=>`), be sure to update the index accordingly. For more information, see [distance operators](/docs/guides/ai/vector-indexes#distance-operators).\n\nFinally we'll create our `hybrid_search` function:\n\n`\n1\ncreate or replace function hybrid_search(\n2\nquery_text text,\n3\nquery_embedding vector(512),\n4\nmatch_count int,\n5\nfull_text_weight float = 1,\n6\nsemantic_weight float = 1,\n7\nrrf_k int = 50\n8\n)\n9\nreturns setof documents\n10\nlanguage sql\n11\nas $$\n12\nwith full_text as (\n13\nselect\n14\n    id,\n15\n    -- Note: ts_rank_cd is not indexable but will only rank matches of the where clause\n16\n    -- which shouldn't be too big\n17\n    row_number() over(order by ts_rank_cd(fts, websearch_to_tsquery(query_text)) desc) as rank_ix\n18\nfrom\n19\n    documents\n20\nwhere\n21\n    fts @@ websearch_to_tsquery(query_text)\n22\norder by rank_ix\n23\nlimit least(match_count, 30) * 2\n24\n),\n25\nsemantic as (\n26\nselect\n27\n    id,\n28\n    row_number() over (order by embedding <#> query_embedding) as rank_ix\n29\nfrom\n30\n    documents\n31\norder by rank_ix\n32\nlimit least(match_count, 30) * 2\n33\n)\n34\nselect\n35\ndocuments.*\n36\nfrom\n37\nfull_text\n38\nfull outer join semantic\n39\n    on full_text.id = semantic.id\n40\njoin documents\n41\n    on coalesce(full_text.id, semantic.id) = documents.id\n42\norder by\n43\ncoalesce(1.0 / (rrf_k + full_text.rank_ix), 0.0) * full_text_weight +\n44\ncoalesce(1.0 / (rrf_k + semantic.rank_ix), 0.0) * semantic_weight\n45\ndesc\n46\nlimit\n47\nleast(match_count, 30)\n48\n$$;\n`\n\nLet's break this down:\n\n- **Parameters:** The function accepts quite a few parameters, but the main (required) ones are `query_text`, `query_embedding`, and `match_count`.\n\n\n  - `query_text` is the user's query text (more on this shortly)\n  - `query_embedding` is the vector representation of the user's query produced by the embedding model. We chose 512 dimensions for this example, but adjust this to match the size of the embedding vectors generated from your preferred model. This must match the size of the `embedding` vector on the `documents` table (and use the same model).\n  - `match_count` is the number of records returned in the `limit` clause.\n\nThe other parameters are optional, but give more control over the fusion process.\n  - `full_text_weight` and `semantic_weight` decide how much weight each search method gets in the final score. These are both 1 by default which means they both equally contribute towards the final rank. A `full_text_weight` of 2 and `semantic_weight` of 1 would give full-text search twice as much weight as semantic search.\n  - `rrf_k` is the `k` [smoothing constant](#smoothing-constant-k) added to the reciprocal rank. The default is 50.\n- **Return type:** The function returns a set of records from our `documents` table.\n\n- **CTE:** We create two [common table expressions (CTE)](https://www.postgresql.org/docs/current/queries-with.html), one for full-text search and one for semantic search. These perform each query individually prior to joining them.\n\n- **RRF:** The final query combines the results from the two CTEs using [reciprocal rank fusion (RRF)](#reciprocal-ranked-fusion-rrf).\n\n\n## Running hybrid search [\\#](\\#running-hybrid-search)\n\nTo use this function in SQL, we can run:\n\n`\n1\nselect\n2\n*\n3\nfrom\n4\nhybrid_search(\n5\n    'Italian recipes with tomato sauce', -- user query\n6\n    '[...]'::vector(512), -- embedding generated from user query\n7\n    10\n8\n);\n`\n\nIn practice, you will likely be calling this from the [Supabase client](/docs/reference/javascript/introduction) or through a custom backend layer. Here is a quick example of how you might call this from an [Edge Function](/docs/guides/functions) using JavaScript:\n\n`\n1\nimport { createClient } from 'jsr:@supabase/supabase-js@2'\n2\nimport OpenAI from 'npm:openai'\n3\n4\nconst supabaseUrl = Deno.env.get('SUPABASE_URL')!\n5\nconst supabaseServiceRoleKey = Deno.env.get('SUPABASE_SERVICE_ROLE_KEY')!\n6\nconst openaiApiKey = Deno.env.get('OPENAI_API_KEY')!\n7\n8\nDeno.serve(async (req) => {\n9\n// Grab the user's query from the JSON payload\n10\nconst { query } = await req.json()\n11\n12\n// Instantiate OpenAI client\n13\nconst openai = new OpenAI({ apiKey: openaiApiKey })\n14\n15\n// Generate a one-time embedding for the user's query\n16\nconst embeddingResponse = await openai.embeddings.create({\n17\n    model: 'text-embedding-3-large',\n18\n    input: query,\n19\n    dimensions: 512,\n20\n})\n21\n22\nconst [{ embedding }] = embeddingResponse.data\n23\n24\n// Instantiate the Supabase client\n25\n// (replace service role key with user's JWT if using Supabase auth and RLS)\n26\nconst supabase = createClient(supabaseUrl, supabaseServiceRoleKey)\n27\n28\n// Call hybrid_search Postgres function via RPC\n29\nconst { data: documents } = await supabase.rpc('hybrid_search', {\n30\n    query_text: query,\n31\n    query_embedding: embedding,\n32\n    match_count: 10,\n33\n})\n34\n35\nreturn new Response(JSON.stringify(documents), {\n36\n    headers: { 'Content-Type': 'application/json' },\n37\n})\n38\n})\n`\n\nThis uses OpenAI's `text-embedding-3-large` model to generate embeddings (shortened to 512 dimensions for faster retrieval). Swap in your preferred embedding model (and dimension size) accordingly.\n\nTo test this, make a `POST` request to the function's endpoint while passing in a JSON payload containing the user's query. Here is an example `POST` request using cURL:\n\n`\n1\ncurl -i --location --request POST \\\n2\n'http://127.0.0.1:54321/functions/v1/hybrid-search' \\\n3\n  --header 'Authorization: Bearer <anonymous key>' \\\n4\n  --header 'Content-Type: application/json' \\\n5\n  --data '{\"query\":\"Italian recipes with tomato sauce\"}'\n`\n\nFor more information on how to create, test, and deploy edge functions, see [Getting started](/docs/guides/functions/quickstart).\n\n## See also [\\#](\\#see-also)\n\n- [Embedding concepts](/docs/guides/ai/concepts)\n- [Vector columns](/docs/guides/ai/vector-columns)\n- [Vector indexes](/docs/guides/ai/vector-indexes)\n- [Semantic search](/docs/guides/ai/semantic-search)\n- [Full text (keyword) search](/docs/guides/database/full-text-search)\n\n### Is this helpful?\n\nYesNo\n\nThanks for your feedback!\n\nOn this page\n\n- [Why would I want to use hybrid search?](#why-would-i-want-to-use-hybrid-search)\n- [When would I want to use hybrid search?](#when-would-i-want-to-use-hybrid-search)\n- [How to combine search methods](#how-to-combine-search-methods)\n- [Reciprocal Ranked Fusion (RRF)](#reciprocal-ranked-fusion-rrf)\n- [Smoothing constant k](#smoothing-constant-k)\n- [Hybrid search in Postgres](#hybrid-search-in-postgres)\n- [Running hybrid search](#running-hybrid-search)\n- [See also](#see-also)\n\n1. We only collect analytics essential to ensuring smooth operation of our services. [Learn more](https://supabase.com/privacy)\n\n\n\n\n\n   AcceptOpt out[Learn more](https://supabase.com/privacy)",
      "html": "<!DOCTYPE html><html lang=\"en\" data-theme=\"light\" style=\"color-scheme: light;\"><body><div class=\"flex flex-col\"><div class=\"grow\"><div class=\"flex flex-col h-full w-full\"><div class=\"hidden lg:sticky w-full lg:flex top-0 left-0 right-0 z-50\"></div><div class=\"flex flex-row h-full relative\"><main id=\"docs-content-container\" class=\"w-full transition-all ease-out relative lg:ml-0\"><div class=\"flex flex-col sticky top-0\"><div class=\"flex lg:hidden w-full top-0 left-0 right-0 z-50\"></div><div class=\"sticky transition-all top-0 z-10 backdrop-blur backdrop-filter bg-background\"><div class=\"lg:hidden px-3.5 border-b z-10 transition-all ease-out top-0 flex items-center gap-1\"><button class=\"h-8 w-8 flex group items-center justify-center mr-1\"><div class=\"space-y-1 cursor-pointer relative w-4 h-[8px]\"><span class=\"transition-all ease-out block h-px bg-foreground-muted group-hover:bg-foreground w-4\"></span><span class=\"transition-all ease-out block h-px bg-foreground-muted group-hover:bg-foreground w-3 group-hover:w-4\"></span></div></button><span class=\"transition-all duration-200 text-foreground text-sm\">AI &amp; Vectors</span></div></div><div class=\"grow\"><div class=\"max-w-7xl px-5 mx-auto py-8 pb-0\"><div class=\"grid grid-cols-12 relative gap-4\"><div class=\"relative transition-all ease-out duration-100 col-span-12 md:col-span-9\"><article id=\"sb-docs-guide-main-article\" class=\"prose max-w-none\"><h1 class=\"mb-0\">Hybrid search</h1><h2 class=\"mt-3 text-xl text-foreground-light\">Combine keyword search with semantic search.</h2><hr class=\"not-prose border-t-0 border-b my-8\">\n<p>Hybrid search combines <a href=\"/docs/guides/ai/keyword-search\">full text search</a> (searching by keyword) with <a href=\"/docs/guides/ai/semantic-search\">semantic search</a> (searching by meaning) to identify results that are both directly and contextually relevant to the user's query.</p>\n<h2 id=\"why-would-i-want-to-use-hybrid-search\" class=\"group scroll-mt-24\">Why would I want to use hybrid search?<a href=\"#why-would-i-want-to-use-hybrid-search\" aria-hidden=\"true\" class=\"ml-2 opacity-0 group-hover:opacity-100 transition\"><span aria-hidden=\"true\">#</span></a></h2>\n<p>Sometimes a single search method doesn't quite capture what a user is really looking for. For example, if a user searches for \"Italian recipes with tomato sauce\" on a cooking app, a keyword search would pull up recipes that specifically mention \"Italian,\" \"recipes,\" and \"tomato sauce\" in the text. However, it might miss out on dishes that are quintessentially Italian and use tomato sauce but don't explicitly label themselves with these words, or use variations like \"pasta sauce\" or \"marinara.\" On the other hand, a semantic search might understand the culinary context and find recipes that match the intent, such as a traditional \"Spaghetti Marinara,\" even if they don't match the exact keyword phrase. However, it could also suggest recipes that are contextually related but not what the user is looking for, like a \"Mexican salsa\" recipe, because it understands the context to be broadly about tomato-based sauces.</p>\n<p>Hybrid search combines the strengths of both these methods. It would ensure that recipes explicitly mentioning the keywords are prioritized, thus capturing direct hits that satisfy the keyword criteria. At the same time, it would include recipes identified through semantic understanding as being related in meaning or context, like different Italian dishes that traditionally use tomato sauce but might not have been tagged explicitly with the user's search terms. It identifies results that are both directly and contextually relevant to the user's query while ideally minimizing misses and irrelevant suggestions.</p>\n<h2 id=\"when-would-i-want-to-use-hybrid-search\" class=\"group scroll-mt-24\">When would I want to use hybrid search?<a href=\"#when-would-i-want-to-use-hybrid-search\" aria-hidden=\"true\" class=\"ml-2 opacity-0 group-hover:opacity-100 transition\"><span aria-hidden=\"true\">#</span></a></h2>\n<p>The decision to use hybrid search depends on what your users are looking for in your app. For a code repository where developers need to find exact lines of code or error messages, keyword search is likely ideal because it matches specific terms. In a mental health forum where users search for advice or experiences related to their feelings, semantic search may be better because it finds results based on the meaning of a query, not just specific words. For a shopping app where customers might search for specific product names yet also be open to related suggestions, hybrid search combines the best of both worlds - finding exact matches while also uncovering similar products based on the shopping context.</p>\n<h2 id=\"how-to-combine-search-methods\" class=\"group scroll-mt-24\">How to combine search methods<a href=\"#how-to-combine-search-methods\" aria-hidden=\"true\" class=\"ml-2 opacity-0 group-hover:opacity-100 transition\"><span aria-hidden=\"true\">#</span></a></h2>\n<p>Hybrid search merges keyword search and semantic search, but how does this process work?</p>\n<p>First, each search method is executed separately. Keyword search, which involves searching by specific words or phrases present in the content, will yield its own set of results. Similarly, semantic search, which involves understanding the context or meaning behind the search query rather than the specific words used, will generate its own unique results.</p>\n<p>Now with these separate result lists available, the next step is to combine them into a single, unified list. This is achieved through a process known as \u201cfusion\u201d. Fusion takes the results from both search methods and merges them together based on a certain ranking or scoring system. This system may prioritize certain results based on factors like their relevance to the search query, their ranking in the individual lists, or other criteria. The result is a final list that integrates the strengths of both keyword and semantic search methods.</p>\n<h2 id=\"reciprocal-ranked-fusion-rrf\" class=\"group scroll-mt-24\">Reciprocal Ranked Fusion (RRF)<a href=\"#reciprocal-ranked-fusion-rrf\" aria-hidden=\"true\" class=\"ml-2 opacity-0 group-hover:opacity-100 transition\"><span aria-hidden=\"true\">#</span></a></h2>\n<p>One of the most common fusion methods is Reciprocal Ranked Fusion (RRF). The key idea behind RRF is to give more weight to the top-ranked items in each individual result list when building the final combined list.</p>\n<p>In RRF, we iterate over each record and assign a score (noting that each record could exist in one or both lists). The score is calculated as 1 divided by that record's rank in each list, summed together between both lists. For example, if a record with an ID of <code>123</code> was ranked third in the keyword search and ninth in semantic search, it would receive a score of <span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mstyle displaystyle=\"true\" scriptlevel=\"0\"><mfrac><mn>1</mn><mn>3</mn></mfrac></mstyle><mo>+</mo><mstyle displaystyle=\"true\" scriptlevel=\"0\"><mfrac><mn>1</mn><mn>9</mn></mfrac></mstyle><mo>=</mo><mn>0.444</mn></mrow><annotation encoding=\"application/x-tex\">\\dfrac{1}{3} + \\dfrac{1}{9} = 0.444</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:2.0074em;vertical-align:-0.686em\"></span><span class=\"mord\"><span class=\"mopen nulldelimiter\"></span><span class=\"mfrac\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:1.3214em\"><span style=\"top:-2.314em\"><span class=\"pstrut\" style=\"height:3em\"></span><span class=\"mord\"><span class=\"mord\">3</span></span></span><span style=\"top:-3.23em\"><span class=\"pstrut\" style=\"height:3em\"></span><span class=\"frac-line\" style=\"border-bottom-width:0.04em\"></span></span><span style=\"top:-3.677em\"><span class=\"pstrut\" style=\"height:3em\"></span><span class=\"mord\"><span class=\"mord\">1</span></span></span></span><span class=\"vlist-s\">\u200b</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.686em\"><span></span></span></span></span></span><span class=\"mclose nulldelimiter\"></span></span><span class=\"mspace\" style=\"margin-right:0.2222em\"></span><span class=\"mbin\">+</span><span class=\"mspace\" style=\"margin-right:0.2222em\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:2.0074em;vertical-align:-0.686em\"></span><span class=\"mord\"><span class=\"mopen nulldelimiter\"></span><span class=\"mfrac\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:1.3214em\"><span style=\"top:-2.314em\"><span class=\"pstrut\" style=\"height:3em\"></span><span class=\"mord\"><span class=\"mord\">9</span></span></span><span style=\"top:-3.23em\"><span class=\"pstrut\" style=\"height:3em\"></span><span class=\"frac-line\" style=\"border-bottom-width:0.04em\"></span></span><span style=\"top:-3.677em\"><span class=\"pstrut\" style=\"height:3em\"></span><span class=\"mord\"><span class=\"mord\">1</span></span></span></span><span class=\"vlist-s\">\u200b</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.686em\"><span></span></span></span></span></span><span class=\"mclose nulldelimiter\"></span></span><span class=\"mspace\" style=\"margin-right:0.2778em\"></span><span class=\"mrel\">=</span><span class=\"mspace\" style=\"margin-right:0.2778em\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:0.6444em\"></span><span class=\"mord\">0.444</span></span></span></span>. If the record was found in only one list and not the other, it would receive a score of 0 for the other list. The records are then sorted by this score to create the final list. The items with the highest scores are ranked first, and lowest scores ranked last.</p>\n<p>This method ensures that items that are ranked high in multiple lists are given a high rank in the final list. It also ensures that items that are ranked high in only a few lists but low in others are not given a high rank in the final list. Placing the rank in the denominator when calculating score helps penalize the low ranking records.</p>\n<h3 id=\"smoothing-constant-k\" class=\"group scroll-mt-24\">Smoothing constant <code>k</code><a href=\"#smoothing-constant-k\" aria-hidden=\"true\" class=\"ml-2 opacity-0 group-hover:opacity-100 transition\"><span aria-hidden=\"true\">#</span></a></h3>\n<p>To prevent extremely high scores for items that are ranked first (since we're dividing by the rank), a <code>k</code> constant is often added to the denominator to smooth the score:</p>\n<p><span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mstyle displaystyle=\"true\" scriptlevel=\"0\"><mfrac><mn>1</mn><mrow><mi>k</mi><mo>+</mo><mi>r</mi><mi>a</mi><mi>n</mi><mi>k</mi></mrow></mfrac></mstyle></mrow><annotation encoding=\"application/x-tex\">\\dfrac{1}{k+rank}</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:2.0908em;vertical-align:-0.7693em\"></span><span class=\"mord\"><span class=\"mopen nulldelimiter\"></span><span class=\"mfrac\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:1.3214em\"><span style=\"top:-2.314em\"><span class=\"pstrut\" style=\"height:3em\"></span><span class=\"mord\"><span class=\"mord mathnormal\" style=\"margin-right:0.03148em\">k</span><span class=\"mspace\" style=\"margin-right:0.2222em\"></span><span class=\"mbin\">+</span><span class=\"mspace\" style=\"margin-right:0.2222em\"></span><span class=\"mord mathnormal\" style=\"margin-right:0.02778em\">r</span><span class=\"mord mathnormal\" style=\"margin-right:0.03148em\">ank</span></span></span><span style=\"top:-3.23em\"><span class=\"pstrut\" style=\"height:3em\"></span><span class=\"frac-line\" style=\"border-bottom-width:0.04em\"></span></span><span style=\"top:-3.677em\"><span class=\"pstrut\" style=\"height:3em\"></span><span class=\"mord\"><span class=\"mord\">1</span></span></span></span><span class=\"vlist-s\">\u200b</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.7693em\"><span></span></span></span></span></span><span class=\"mclose nulldelimiter\"></span></span></span></span></span></p>\n<p>This constant can be any positive number, but is typically small. A constant of 1 would mean that a record ranked first would have a score of <span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mstyle displaystyle=\"true\" scriptlevel=\"0\"><mfrac><mn>1</mn><mrow><mn>1</mn><mo>+</mo><mn>1</mn></mrow></mfrac></mstyle><mo>=</mo><mn>0.5</mn></mrow><annotation encoding=\"application/x-tex\">\\dfrac{1}{1+1} = 0.5</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:2.0908em;vertical-align:-0.7693em\"></span><span class=\"mord\"><span class=\"mopen nulldelimiter\"></span><span class=\"mfrac\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:1.3214em\"><span style=\"top:-2.314em\"><span class=\"pstrut\" style=\"height:3em\"></span><span class=\"mord\"><span class=\"mord\">1</span><span class=\"mspace\" style=\"margin-right:0.2222em\"></span><span class=\"mbin\">+</span><span class=\"mspace\" style=\"margin-right:0.2222em\"></span><span class=\"mord\">1</span></span></span><span style=\"top:-3.23em\"><span class=\"pstrut\" style=\"height:3em\"></span><span class=\"frac-line\" style=\"border-bottom-width:0.04em\"></span></span><span style=\"top:-3.677em\"><span class=\"pstrut\" style=\"height:3em\"></span><span class=\"mord\"><span class=\"mord\">1</span></span></span></span><span class=\"vlist-s\">\u200b</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.7693em\"><span></span></span></span></span></span><span class=\"mclose nulldelimiter\"></span></span><span class=\"mspace\" style=\"margin-right:0.2778em\"></span><span class=\"mrel\">=</span><span class=\"mspace\" style=\"margin-right:0.2778em\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:0.6444em\"></span><span class=\"mord\">0.5</span></span></span></span> instead of <span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mn>1</mn></mrow><annotation encoding=\"application/x-tex\">1</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.6444em\"></span><span class=\"mord\">1</span></span></span></span>. This adjustment can help balance the influence of items that are ranked very high in individual lists when creating the final combined list.</p>\n<h2 id=\"hybrid-search-in-postgres\" class=\"group scroll-mt-24\">Hybrid search in Postgres<a href=\"#hybrid-search-in-postgres\" aria-hidden=\"true\" class=\"ml-2 opacity-0 group-hover:opacity-100 transition\"><span aria-hidden=\"true\">#</span></a></h2>\n<p>Let's implement hybrid search in Postgres using <code>tsvector</code> (keyword search) and <code>pgvector</code> (semantic search).</p>\n<p>First we'll create a <code>documents</code> table to store the documents that we will search over. This is just an example - adjust this to match the structure of your application.</p>\n<div class=\"ch-codeblock not-prose \" data-ch-theme=\"supabase\"><div class=\"ch-code-wrapper ch-code\" data-ch-measured=\"true\"><code class=\"ch-code-scroll-parent\" data-ch-lang=\"sql\" style=\"width: 926px; height: 154px; position: relative; overflow: auto;\"><div class=\"ch-code-scroll-content\" style=\"position: absolute; top: 0px; left: 0px; transform-origin: left top; width: 924px; height: 152px; overflow: hidden;\"><div style=\"position: absolute; top: 0px; left: 0px; transform: translateX(0px) translateY(19px) scale(1); transform-origin: left top; width: 924px; height: 114px;\"><span class=\"ch-code-line-number\" style=\"position: absolute; top: 0px; left: 0px; transform: translate(0px, 0px); width: 31.5px; opacity: 0.99;\">1</span><div style=\"position: absolute; top: 0px; left: 0px; transform: translate(31.5px, 0px); width: 532px;\"><div style=\"display: inline-block; width: 100%;\"><span style=\"opacity: 0.99;\"><span style=\"color: var(--ch-7);\">create table </span><span style=\"color: var(--ch-5);\">documents</span><span style=\"color: var(--ch-4);\"> (</span></span><br></div></div><span class=\"ch-code-line-number\" style=\"position: absolute; top: 0px; left: 0px; transform: translate(0px, 19px); width: 31.5px; opacity: 0.99;\">2</span><div style=\"position: absolute; top: 0px; left: 0px; transform: translate(31.5px, 19px); width: 532px;\"><div style=\"display: inline-block; width: 100%;\"><span style=\"opacity: 0.99;\"><span style=\"color: var(--ch-4);\">  id </span><span style=\"color: var(--ch-7);\">bigint primary key generated always as identity</span><span style=\"color: var(--ch-4);\">,</span></span><br></div></div><span class=\"ch-code-line-number\" style=\"position: absolute; top: 0px; left: 0px; transform: translate(0px, 38px); width: 31.5px; opacity: 0.99;\">3</span><div style=\"position: absolute; top: 0px; left: 0px; transform: translate(31.5px, 38px); width: 532px;\"><div style=\"display: inline-block; width: 100%;\"><span style=\"opacity: 0.99;\"><span style=\"color: var(--ch-4);\">  content </span><span style=\"color: var(--ch-7);\">text</span><span style=\"color: var(--ch-4);\">,</span></span><br></div></div><span class=\"ch-code-line-number\" style=\"position: absolute; top: 0px; left: 0px; transform: translate(0px, 57px); width: 31.5px; opacity: 0.99;\">4</span><div style=\"position: absolute; top: 0px; left: 0px; transform: translate(31.5px, 57px); width: 532px;\"><div style=\"display: inline-block; width: 100%;\"><span style=\"opacity: 0.99;\"><span style=\"color: var(--ch-4);\">  fts tsvector </span><span style=\"color: var(--ch-7);\">generated always as</span><span style=\"color: var(--ch-4);\"> (to_tsvector(</span><span style=\"color: var(--ch-8);\">'english'</span><span style=\"color: var(--ch-4);\">, content)) stored,</span></span><br></div></div><span class=\"ch-code-line-number\" style=\"position: absolute; top: 0px; left: 0px; transform: translate(0px, 76px); width: 31.5px; opacity: 0.99;\">5</span><div style=\"position: absolute; top: 0px; left: 0px; transform: translate(31.5px, 76px); width: 532px;\"><div style=\"display: inline-block; width: 100%;\"><span style=\"opacity: 0.99;\"><span style=\"color: var(--ch-4);\">  embedding vector(</span><span style=\"color: var(--ch-2);\">512</span><span style=\"color: var(--ch-4);\">)</span></span><br></div></div><span class=\"ch-code-line-number\" style=\"position: absolute; top: 0px; left: 0px; transform: translate(0px, 95px); width: 31.5px; opacity: 0.99;\">6</span><div style=\"position: absolute; top: 0px; left: 0px; transform: translate(31.5px, 95px); width: 532px;\"><div style=\"display: inline-block; width: 100%;\"><span style=\"opacity: 0.99;\"><span style=\"color: var(--ch-4);\">);</span></span><br></div></div></div></div></code><button type=\"button\" title=\"Copy code\" class=\"ch-code-button\"><svg fill=\"none\" stroke=\"currentColor\" viewBox=\"0 0 24 24\" xmlns=\"http://www.w3.org/2000/svg\"><path stroke-linecap=\"round\" stroke-linejoin=\"round\" stroke-width=\"1.6px\" d=\"M8 16H6a2 2 0 01-2-2V6a2 2 0 012-2h8a2 2 0 012 2v2m-6 12h8a2 2 0 002-2v-8a2 2 0 00-2-2h-8a2 2 0 00-2 2v8a2 2 0 002 2z\"></path></svg></button></div></div>\n<p>The table contains 4 columns:</p>\n<ul>\n<li><code>id</code> is an auto-generated unique ID for the record. We'll use this later to match records when performing RRF.</li>\n<li><code>content</code> contains the actual text we will be searching over.</li>\n<li><code>fts</code> is an auto-generated <code>tsvector</code> column that is generated using the text in <code>content</code>. We will use this for <a href=\"/docs/guides/database/full-text-search\">full text search</a> (search by keyword).</li>\n<li><code>embedding</code> is a <a href=\"/docs/guides/ai/vector-columns\">vector column</a> that stores the vector generated from our embedding model. We will use this for <a href=\"/docs/guides/ai/semantic-search\">semantic search</a> (search by meaning). We chose 512 dimensions for this example, but adjust this to match the size of the embedding vectors generated from your preferred model.</li>\n</ul>\n<p>Next we'll create indexes on the <code>fts</code> and <code>embedding</code> columns so that their individual queries will remain fast at scale:</p>\n<div class=\"ch-codeblock not-prose \" data-ch-theme=\"supabase\"><div class=\"ch-code-wrapper ch-code\" data-ch-measured=\"true\"><code class=\"ch-code-scroll-parent\" data-ch-lang=\"sql\" style=\"width: 926px; height: 135px; position: relative; overflow: auto;\"><div class=\"ch-code-scroll-content\" style=\"position: absolute; top: 0px; left: 0px; transform-origin: left top; width: 924px; height: 133px; overflow: hidden;\"><div style=\"position: absolute; top: 0px; left: 0px; transform: translateX(0px) translateY(19px) scale(1); transform-origin: left top; width: 924px; height: 95px;\"><span class=\"ch-code-line-number\" style=\"position: absolute; top: 0px; left: 0px; transform: translate(0px, 0px); width: 31.5px; opacity: 0.99;\">1</span><div style=\"position: absolute; top: 0px; left: 0px; transform: translate(31.5px, 0px); width: 441px;\"><div style=\"display: inline-block; width: 100%;\"><span style=\"opacity: 0.99;\"><span style=\"color: var(--ch-1);\">-- Create an index for the full-text search</span></span><br></div></div><span class=\"ch-code-line-number\" style=\"position: absolute; top: 0px; left: 0px; transform: translate(0px, 19px); width: 31.5px; opacity: 0.99;\">2</span><div style=\"position: absolute; top: 0px; left: 0px; transform: translate(31.5px, 19px); width: 441px;\"><div style=\"display: inline-block; width: 100%;\"><span style=\"opacity: 0.99;\"><span style=\"color: var(--ch-7);\">create index </span><span style=\"color: var(--ch-5);\">on</span><span style=\"color: var(--ch-4);\"> documents </span><span style=\"color: var(--ch-7);\">using</span><span style=\"color: var(--ch-4);\"> gin(fts);</span></span><br></div></div><span class=\"ch-code-line-number\" style=\"position: absolute; top: 0px; left: 0px; transform: translate(0px, 38px); width: 31.5px; opacity: 0.99;\">3</span><div style=\"position: absolute; top: 0px; left: 0px; transform: translate(31.5px, 38px); width: 441px;\"><div style=\"display: inline-block; width: 100%;\"><span style=\"opacity: 0.99;\"><span style=\"color: var(--ch-4);\"></span></span><br></div></div><span class=\"ch-code-line-number\" style=\"position: absolute; top: 0px; left: 0px; transform: translate(0px, 57px); width: 31.5px; opacity: 0.99;\">4</span><div style=\"position: absolute; top: 0px; left: 0px; transform: translate(31.5px, 57px); width: 441px;\"><div style=\"display: inline-block; width: 100%;\"><span style=\"opacity: 0.99;\"><span style=\"color: var(--ch-1);\">-- Create an index for the semantic vector search</span></span><br></div></div><span class=\"ch-code-line-number\" style=\"position: absolute; top: 0px; left: 0px; transform: translate(0px, 76px); width: 31.5px; opacity: 0.99;\">5</span><div style=\"position: absolute; top: 0px; left: 0px; transform: translate(31.5px, 76px); width: 441px;\"><div style=\"display: inline-block; width: 100%;\"><span style=\"opacity: 0.99;\"><span style=\"color: var(--ch-7);\">create index </span><span style=\"color: var(--ch-5);\">on</span><span style=\"color: var(--ch-4);\"> documents </span><span style=\"color: var(--ch-7);\">using</span><span style=\"color: var(--ch-4);\"> hnsw (embedding vector_ip_ops);</span></span><br></div></div></div></div></code><button type=\"button\" title=\"Copy code\" class=\"ch-code-button\"><svg fill=\"none\" stroke=\"currentColor\" viewBox=\"0 0 24 24\" xmlns=\"http://www.w3.org/2000/svg\"><path stroke-linecap=\"round\" stroke-linejoin=\"round\" stroke-width=\"1.6px\" d=\"M8 16H6a2 2 0 01-2-2V6a2 2 0 012-2h8a2 2 0 012 2v2m-6 12h8a2 2 0 002-2v-8a2 2 0 00-2-2h-8a2 2 0 00-2 2v8a2 2 0 002 2z\"></path></svg></button></div></div>\n<p>For full text search we use a <a href=\"https://www.postgresql.org/docs/current/gin-intro.html\">generalized inverted (GIN) index</a> which is designed for handling composite values like those stored in a <code>tsvector</code>.</p>\n<p>For semantic vector search we use an <a href=\"/docs/guides/ai/vector-indexes/hnsw-indexes\">HNSW index</a>, which is a high performing approximate nearest neighbor (ANN) search algorithm. Note that we are using the <code>vector_ip_ops</code> (inner product) operator with this index because we plan on using the inner product (<code>&lt;#&gt;</code>) operator later in our query. If you plan to use a different operator like cosine distance (<code>&lt;=&gt;</code>), be sure to update the index accordingly. For more information, see <a href=\"/docs/guides/ai/vector-indexes#distance-operators\">distance operators</a>.</p>\n<p>Finally we'll create our <code>hybrid_search</code> function:</p>\n<div class=\"ch-codeblock not-prose \" data-ch-theme=\"supabase\"><div class=\"ch-code-wrapper ch-code\" data-ch-measured=\"true\"><code class=\"ch-code-scroll-parent\" data-ch-lang=\"sql\" style=\"width: 926px; height: 952px; position: relative; overflow: auto;\"><div class=\"ch-code-scroll-content\" style=\"position: absolute; top: 0px; left: 0px; transform-origin: left top; width: 924px; height: 950px; overflow: hidden;\"><div style=\"position: absolute; top: 0px; left: 0px; transform: translateX(0px) translateY(19px) scale(1); transform-origin: left top; width: 924px; height: 912px;\"><span class=\"ch-code-line-number\" style=\"position: absolute; top: 0px; left: 0px; transform: translate(0px, 0px); width: 31.5px; opacity: 0.99;\">1</span><div style=\"position: absolute; top: 0px; left: 0px; transform: translate(31.5px, 0px); width: 679px;\"><div style=\"display: inline-block; width: 100%;\"><span style=\"opacity: 0.99;\"><span style=\"color: var(--ch-7);\">create or replace function </span><span style=\"color: var(--ch-5);\">hybrid_search</span><span style=\"color: var(--ch-4);\">(</span></span><br></div></div><span class=\"ch-code-line-number\" style=\"position: absolute; top: 0px; left: 0px; transform: translate(0px, 19px); width: 31.5px; opacity: 0.99;\">2</span><div style=\"position: absolute; top: 0px; left: 0px; transform: translate(31.5px, 19px); width: 679px;\"><div style=\"display: inline-block; width: 100%;\"><span style=\"opacity: 0.99;\"><span style=\"color: var(--ch-4);\">  query_text </span><span style=\"color: var(--ch-7);\">text</span><span style=\"color: var(--ch-4);\">,</span></span><br></div></div><span class=\"ch-code-line-number\" style=\"position: absolute; top: 0px; left: 0px; transform: translate(0px, 38px); width: 31.5px; opacity: 0.99;\">3</span><div style=\"position: absolute; top: 0px; left: 0px; transform: translate(31.5px, 38px); width: 679px;\"><div style=\"display: inline-block; width: 100%;\"><span style=\"opacity: 0.99;\"><span style=\"color: var(--ch-4);\">  query_embedding vector(</span><span style=\"color: var(--ch-2);\">512</span><span style=\"color: var(--ch-4);\">),</span></span><br></div></div><span class=\"ch-code-line-number\" style=\"position: absolute; top: 0px; left: 0px; transform: translate(0px, 57px); width: 31.5px; opacity: 0.99;\">4</span><div style=\"position: absolute; top: 0px; left: 0px; transform: translate(31.5px, 57px); width: 679px;\"><div style=\"display: inline-block; width: 100%;\"><span style=\"opacity: 0.99;\"><span style=\"color: var(--ch-4);\">  match_count </span><span style=\"color: var(--ch-7);\">int</span><span style=\"color: var(--ch-4);\">,</span></span><br></div></div><span class=\"ch-code-line-number\" style=\"position: absolute; top: 0px; left: 0px; transform: translate(0px, 76px); width: 31.5px; opacity: 0.99;\">5</span><div style=\"position: absolute; top: 0px; left: 0px; transform: translate(31.5px, 76px); width: 679px;\"><div style=\"display: inline-block; width: 100%;\"><span style=\"opacity: 0.99;\"><span style=\"color: var(--ch-4);\">  full_text_weight </span><span style=\"color: var(--ch-7);\">float = </span><span style=\"color: var(--ch-2);\">1</span><span style=\"color: var(--ch-4);\">,</span></span><br></div></div><span class=\"ch-code-line-number\" style=\"position: absolute; top: 0px; left: 0px; transform: translate(0px, 95px); width: 31.5px; opacity: 0.99;\">6</span><div style=\"position: absolute; top: 0px; left: 0px; transform: translate(31.5px, 95px); width: 679px;\"><div style=\"display: inline-block; width: 100%;\"><span style=\"opacity: 0.99;\"><span style=\"color: var(--ch-4);\">  semantic_weight </span><span style=\"color: var(--ch-7);\">float = </span><span style=\"color: var(--ch-2);\">1</span><span style=\"color: var(--ch-4);\">,</span></span><br></div></div><span class=\"ch-code-line-number\" style=\"position: absolute; top: 0px; left: 0px; transform: translate(0px, 114px); width: 31.5px; opacity: 0.99;\">7</span><div style=\"position: absolute; top: 0px; left: 0px; transform: translate(31.5px, 114px); width: 679px;\"><div style=\"display: inline-block; width: 100%;\"><span style=\"opacity: 0.99;\"><span style=\"color: var(--ch-4);\">  rrf_k </span><span style=\"color: var(--ch-7);\">int = </span><span style=\"color: var(--ch-2);\">50</span></span><br></div></div><span class=\"ch-code-line-number\" style=\"position: absolute; top: 0px; left: 0px; transform: translate(0px, 133px); width: 31.5px; opacity: 0.99;\">8</span><div style=\"position: absolute; top: 0px; left: 0px; transform: translate(31.5px, 133px); width: 679px;\"><div style=\"display: inline-block; width: 100%;\"><span style=\"opacity: 0.99;\"><span style=\"color: var(--ch-4);\">)</span></span><br></div></div><span class=\"ch-code-line-number\" style=\"position: absolute; top: 0px; left: 0px; transform: translate(0px, 152px); width: 31.5px; opacity: 0.99;\">9</span><div style=\"position: absolute; top: 0px; left: 0px; transform: translate(31.5px, 152px); width: 679px;\"><div style=\"display: inline-block; width: 100%;\"><span style=\"opacity: 0.99;\"><span style=\"color: var(--ch-7);\">returns</span><span style=\"color: var(--ch-4);\"> setof documents</span></span><br></div></div><span class=\"ch-code-line-number\" style=\"position: absolute; top: 0px; left: 0px; transform: translate(0px, 171px); width: 31.5px; opacity: 0.99;\">10</span><div style=\"position: absolute; top: 0px; left: 0px; transform: translate(31.5px, 171px); width: 679px;\"><div style=\"display: inline-block; width: 100%;\"><span style=\"opacity: 0.99;\"><span style=\"color: var(--ch-7);\">language sql</span></span><br></div></div><span class=\"ch-code-line-number\" style=\"position: absolute; top: 0px; left: 0px; transform: translate(0px, 190px); width: 31.5px; opacity: 0.99;\">11</span><div style=\"position: absolute; top: 0px; left: 0px; transform: translate(31.5px, 190px); width: 679px;\"><div style=\"display: inline-block; width: 100%;\"><span style=\"opacity: 0.99;\"><span style=\"color: var(--ch-7);\">as</span><span style=\"color: var(--ch-4);\"> $$</span></span><br></div></div><span class=\"ch-code-line-number\" style=\"position: absolute; top: 0px; left: 0px; transform: translate(0px, 209px); width: 31.5px; opacity: 0.99;\">12</span><div style=\"position: absolute; top: 0px; left: 0px; transform: translate(31.5px, 209px); width: 679px;\"><div style=\"display: inline-block; width: 100%;\"><span style=\"opacity: 0.99;\"><span style=\"color: var(--ch-7);\">with</span><span style=\"color: var(--ch-4);\"> full_text </span><span style=\"color: var(--ch-7);\">as</span><span style=\"color: var(--ch-4);\"> (</span></span><br></div></div><span class=\"ch-code-line-number\" style=\"position: absolute; top: 0px; left: 0px; transform: translate(0px, 228px); width: 31.5px; opacity: 0.99;\">13</span><div style=\"position: absolute; top: 0px; left: 0px; transform: translate(31.5px, 228px); width: 679px;\"><div style=\"display: inline-block; width: 100%;\"><span style=\"opacity: 0.99;\"><span style=\"color: var(--ch-7);\">  select</span></span><br></div></div><span class=\"ch-code-line-number\" style=\"position: absolute; top: 0px; left: 0px; transform: translate(0px, 247px); width: 31.5px; opacity: 0.99;\">14</span><div style=\"position: absolute; top: 0px; left: 0px; transform: translate(31.5px, 247px); width: 679px;\"><div style=\"display: inline-block; width: 100%;\"><span style=\"opacity: 0.99;\"><span style=\"color: var(--ch-4);\">    id,</span></span><br></div></div><span class=\"ch-code-line-number\" style=\"position: absolute; top: 0px; left: 0px; transform: translate(0px, 266px); width: 31.5px; opacity: 0.99;\">15</span><div style=\"position: absolute; top: 0px; left: 0px; transform: translate(31.5px, 266px); width: 679px;\"><div style=\"display: inline-block; width: 100%;\"><span style=\"opacity: 0.99;\"><span style=\"color: var(--ch-1);\">    -- Note: ts_rank_cd is not indexable but will only rank matches of the where clause</span></span><br></div></div><span class=\"ch-code-line-number\" style=\"position: absolute; top: 0px; left: 0px; transform: translate(0px, 285px); width: 31.5px; opacity: 0.99;\">16</span><div style=\"position: absolute; top: 0px; left: 0px; transform: translate(31.5px, 285px); width: 679px;\"><div style=\"display: inline-block; width: 100%;\"><span style=\"opacity: 0.99;\"><span style=\"color: var(--ch-1);\">    -- which shouldn't be too big</span></span><br></div></div><span class=\"ch-code-line-number\" style=\"position: absolute; top: 0px; left: 0px; transform: translate(0px, 304px); width: 31.5px; opacity: 0.99;\">17</span><div style=\"position: absolute; top: 0px; left: 0px; transform: translate(31.5px, 304px); width: 679px;\"><div style=\"display: inline-block; width: 100%;\"><span style=\"opacity: 0.99;\"><span style=\"color: var(--ch-2);\">    row_number</span><span style=\"color: var(--ch-4);\">() </span><span style=\"color: var(--ch-7);\">over</span><span style=\"color: var(--ch-4);\">(</span><span style=\"color: var(--ch-7);\">order by</span><span style=\"color: var(--ch-4);\"> ts_rank_cd(fts, websearch_to_tsquery(query_text)) </span><span style=\"color: var(--ch-7);\">desc</span><span style=\"color: var(--ch-4);\">) </span><span style=\"color: var(--ch-7);\">as</span><span style=\"color: var(--ch-4);\"> rank_ix</span></span><br></div></div><span class=\"ch-code-line-number\" style=\"position: absolute; top: 0px; left: 0px; transform: translate(0px, 323px); width: 31.5px; opacity: 0.99;\">18</span><div style=\"position: absolute; top: 0px; left: 0px; transform: translate(31.5px, 323px); width: 679px;\"><div style=\"display: inline-block; width: 100%;\"><span style=\"opacity: 0.99;\"><span style=\"color: var(--ch-7);\">  from</span></span><br></div></div><span class=\"ch-code-line-number\" style=\"position: absolute; top: 0px; left: 0px; transform: translate(0px, 342px); width: 31.5px; opacity: 0.99;\">19</span><div style=\"position: absolute; top: 0px; left: 0px; transform: translate(31.5px, 342px); width: 679px;\"><div style=\"display: inline-block; width: 100%;\"><span style=\"opacity: 0.99;\"><span style=\"color: var(--ch-4);\">    documents</span></span><br></div></div><span class=\"ch-code-line-number\" style=\"position: absolute; top: 0px; left: 0px; transform: translate(0px, 361px); width: 31.5px; opacity: 0.99;\">20</span><div style=\"position: absolute; top: 0px; left: 0px; transform: translate(31.5px, 361px); width: 679px;\"><div style=\"display: inline-block; width: 100%;\"><span style=\"opacity: 0.99;\"><span style=\"color: var(--ch-7);\">  where</span></span><br></div></div><span class=\"ch-code-line-number\" style=\"position: absolute; top: 0px; left: 0px; transform: translate(0px, 380px); width: 31.5px; opacity: 0.99;\">21</span><div style=\"position: absolute; top: 0px; left: 0px; transform: translate(31.5px, 380px); width: 679px;\"><div style=\"display: inline-block; width: 100%;\"><span style=\"opacity: 0.99;\"><span style=\"color: var(--ch-4);\">    fts @@ websearch_to_tsquery(query_text)</span></span><br></div></div><span class=\"ch-code-line-number\" style=\"position: absolute; top: 0px; left: 0px; transform: translate(0px, 399px); width: 31.5px; opacity: 0.99;\">22</span><div style=\"position: absolute; top: 0px; left: 0px; transform: translate(31.5px, 399px); width: 679px;\"><div style=\"display: inline-block; width: 100%;\"><span style=\"opacity: 0.99;\"><span style=\"color: var(--ch-7);\">  order by</span><span style=\"color: var(--ch-4);\"> rank_ix</span></span><br></div></div><span class=\"ch-code-line-number\" style=\"position: absolute; top: 0px; left: 0px; transform: translate(0px, 418px); width: 31.5px; opacity: 0.99;\">23</span><div style=\"position: absolute; top: 0px; left: 0px; transform: translate(31.5px, 418px); width: 679px;\"><div style=\"display: inline-block; width: 100%;\"><span style=\"opacity: 0.99;\"><span style=\"color: var(--ch-7);\">  limit </span><span style=\"color: var(--ch-2);\">least</span><span style=\"color: var(--ch-4);\">(match_count, </span><span style=\"color: var(--ch-2);\">30</span><span style=\"color: var(--ch-4);\">) </span><span style=\"color: var(--ch-7);\">* </span><span style=\"color: var(--ch-2);\">2</span></span><br></div></div><span class=\"ch-code-line-number\" style=\"position: absolute; top: 0px; left: 0px; transform: translate(0px, 437px); width: 31.5px; opacity: 0.99;\">24</span><div style=\"position: absolute; top: 0px; left: 0px; transform: translate(31.5px, 437px); width: 679px;\"><div style=\"display: inline-block; width: 100%;\"><span style=\"opacity: 0.99;\"><span style=\"color: var(--ch-4);\">),</span></span><br></div></div><span class=\"ch-code-line-number\" style=\"position: absolute; top: 0px; left: 0px; transform: translate(0px, 456px); width: 31.5px; opacity: 0.99;\">25</span><div style=\"position: absolute; top: 0px; left: 0px; transform: translate(31.5px, 456px); width: 679px;\"><div style=\"display: inline-block; width: 100%;\"><span style=\"opacity: 0.99;\"><span style=\"color: var(--ch-4);\">semantic </span><span style=\"color: var(--ch-7);\">as</span><span style=\"color: var(--ch-4);\"> (</span></span><br></div></div><span class=\"ch-code-line-number\" style=\"position: absolute; top: 0px; left: 0px; transform: translate(0px, 475px); width: 31.5px; opacity: 0.99;\">26</span><div style=\"position: absolute; top: 0px; left: 0px; transform: translate(31.5px, 475px); width: 679px;\"><div style=\"display: inline-block; width: 100%;\"><span style=\"opacity: 0.99;\"><span style=\"color: var(--ch-7);\">  select</span></span><br></div></div><span class=\"ch-code-line-number\" style=\"position: absolute; top: 0px; left: 0px; transform: translate(0px, 494px); width: 31.5px; opacity: 0.99;\">27</span><div style=\"position: absolute; top: 0px; left: 0px; transform: translate(31.5px, 494px); width: 679px;\"><div style=\"display: inline-block; width: 100%;\"><span style=\"opacity: 0.99;\"><span style=\"color: var(--ch-4);\">    id,</span></span><br></div></div><span class=\"ch-code-line-number\" style=\"position: absolute; top: 0px; left: 0px; transform: translate(0px, 513px); width: 31.5px; opacity: 0.99;\">28</span><div style=\"position: absolute; top: 0px; left: 0px; transform: translate(31.5px, 513px); width: 679px;\"><div style=\"display: inline-block; width: 100%;\"><span style=\"opacity: 0.99;\"><span style=\"color: var(--ch-2);\">    row_number</span><span style=\"color: var(--ch-4);\">() </span><span style=\"color: var(--ch-7);\">over</span><span style=\"color: var(--ch-4);\"> (</span><span style=\"color: var(--ch-7);\">order by</span><span style=\"color: var(--ch-4);\"> embedding </span><span style=\"color: var(--ch-7);\">&lt;</span><span style=\"color: var(--ch-4);\">#</span><span style=\"color: var(--ch-7);\">&gt;</span><span style=\"color: var(--ch-4);\"> query_embedding) </span><span style=\"color: var(--ch-7);\">as</span><span style=\"color: var(--ch-4);\"> rank_ix</span></span><br></div></div><span class=\"ch-code-line-number\" style=\"position: absolute; top: 0px; left: 0px; transform: translate(0px, 532px); width: 31.5px; opacity: 0.99;\">29</span><div style=\"position: absolute; top: 0px; left: 0px; transform: translate(31.5px, 532px); width: 679px;\"><div style=\"display: inline-block; width: 100%;\"><span style=\"opacity: 0.99;\"><span style=\"color: var(--ch-7);\">  from</span></span><br></div></div><span class=\"ch-code-line-number\" style=\"position: absolute; top: 0px; left: 0px; transform: translate(0px, 551px); width: 31.5px; opacity: 0.99;\">30</span><div style=\"position: absolute; top: 0px; left: 0px; transform: translate(31.5px, 551px); width: 679px;\"><div style=\"display: inline-block; width: 100%;\"><span style=\"opacity: 0.99;\"><span style=\"color: var(--ch-4);\">    documents</span></span><br></div></div><span class=\"ch-code-line-number\" style=\"position: absolute; top: 0px; left: 0px; transform: translate(0px, 570px); width: 31.5px; opacity: 0.99;\">31</span><div style=\"position: absolute; top: 0px; left: 0px; transform: translate(31.5px, 570px); width: 679px;\"><div style=\"display: inline-block; width: 100%;\"><span style=\"opacity: 0.99;\"><span style=\"color: var(--ch-7);\">  order by</span><span style=\"color: var(--ch-4);\"> rank_ix</span></span><br></div></div><span class=\"ch-code-line-number\" style=\"position: absolute; top: 0px; left: 0px; transform: translate(0px, 589px); width: 31.5px; opacity: 0.99;\">32</span><div style=\"position: absolute; top: 0px; left: 0px; transform: translate(31.5px, 589px); width: 679px;\"><div style=\"display: inline-block; width: 100%;\"><span style=\"opacity: 0.99;\"><span style=\"color: var(--ch-7);\">  limit </span><span style=\"color: var(--ch-2);\">least</span><span style=\"color: var(--ch-4);\">(match_count, </span><span style=\"color: var(--ch-2);\">30</span><span style=\"color: var(--ch-4);\">) </span><span style=\"color: var(--ch-7);\">* </span><span style=\"color: var(--ch-2);\">2</span></span><br></div></div><span class=\"ch-code-line-number\" style=\"position: absolute; top: 0px; left: 0px; transform: translate(0px, 608px); width: 31.5px; opacity: 0.99;\">33</span><div style=\"position: absolute; top: 0px; left: 0px; transform: translate(31.5px, 608px); width: 679px;\"><div style=\"display: inline-block; width: 100%;\"><span style=\"opacity: 0.99;\"><span style=\"color: var(--ch-4);\">)</span></span><br></div></div><span class=\"ch-code-line-number\" style=\"position: absolute; top: 0px; left: 0px; transform: translate(0px, 627px); width: 31.5px; opacity: 0.99;\">34</span><div style=\"position: absolute; top: 0px; left: 0px; transform: translate(31.5px, 627px); width: 679px;\"><div style=\"display: inline-block; width: 100%;\"><span style=\"opacity: 0.99;\"><span style=\"color: var(--ch-7);\">select</span></span><br></div></div><span class=\"ch-code-line-number\" style=\"position: absolute; top: 0px; left: 0px; transform: translate(0px, 646px); width: 31.5px; opacity: 0.99;\">35</span><div style=\"position: absolute; top: 0px; left: 0px; transform: translate(31.5px, 646px); width: 679px;\"><div style=\"display: inline-block; width: 100%;\"><span style=\"opacity: 0.99;\"><span style=\"color: var(--ch-4);\">  documents.</span><span style=\"color: var(--ch-7);\">*</span></span><br></div></div><span class=\"ch-code-line-number\" style=\"position: absolute; top: 0px; left: 0px; transform: translate(0px, 665px); width: 31.5px; opacity: 0.99;\">36</span><div style=\"position: absolute; top: 0px; left: 0px; transform: translate(31.5px, 665px); width: 679px;\"><div style=\"display: inline-block; width: 100%;\"><span style=\"opacity: 0.99;\"><span style=\"color: var(--ch-7);\">from</span></span><br></div></div><span class=\"ch-code-line-number\" style=\"position: absolute; top: 0px; left: 0px; transform: translate(0px, 684px); width: 31.5px; opacity: 0.99;\">37</span><div style=\"position: absolute; top: 0px; left: 0px; transform: translate(31.5px, 684px); width: 679px;\"><div style=\"display: inline-block; width: 100%;\"><span style=\"opacity: 0.99;\"><span style=\"color: var(--ch-4);\">  full_text</span></span><br></div></div><span class=\"ch-code-line-number\" style=\"position: absolute; top: 0px; left: 0px; transform: translate(0px, 703px); width: 31.5px; opacity: 0.99;\">38</span><div style=\"position: absolute; top: 0px; left: 0px; transform: translate(31.5px, 703px); width: 679px;\"><div style=\"display: inline-block; width: 100%;\"><span style=\"opacity: 0.99;\"><span style=\"color: var(--ch-7);\">  full outer join</span><span style=\"color: var(--ch-4);\"> semantic</span></span><br></div></div><span class=\"ch-code-line-number\" style=\"position: absolute; top: 0px; left: 0px; transform: translate(0px, 722px); width: 31.5px; opacity: 0.99;\">39</span><div style=\"position: absolute; top: 0px; left: 0px; transform: translate(31.5px, 722px); width: 679px;\"><div style=\"display: inline-block; width: 100%;\"><span style=\"opacity: 0.99;\"><span style=\"color: var(--ch-7);\">    on </span><span style=\"color: var(--ch-2);\">full_text</span><span style=\"color: var(--ch-4);\">.</span><span style=\"color: var(--ch-2);\">id </span><span style=\"color: var(--ch-7);\">= </span><span style=\"color: var(--ch-2);\">semantic</span><span style=\"color: var(--ch-4);\">.</span><span style=\"color: var(--ch-2);\">id</span></span><br></div></div><span class=\"ch-code-line-number\" style=\"position: absolute; top: 0px; left: 0px; transform: translate(0px, 741px); width: 31.5px; opacity: 0.99;\">40</span><div style=\"position: absolute; top: 0px; left: 0px; transform: translate(31.5px, 741px); width: 679px;\"><div style=\"display: inline-block; width: 100%;\"><span style=\"opacity: 0.99;\"><span style=\"color: var(--ch-7);\">  join</span><span style=\"color: var(--ch-4);\"> documents</span></span><br></div></div><span class=\"ch-code-line-number\" style=\"position: absolute; top: 0px; left: 0px; transform: translate(0px, 760px); width: 31.5px; opacity: 0.99;\">41</span><div style=\"position: absolute; top: 0px; left: 0px; transform: translate(31.5px, 760px); width: 679px;\"><div style=\"display: inline-block; width: 100%;\"><span style=\"opacity: 0.99;\"><span style=\"color: var(--ch-7);\">    on </span><span style=\"color: var(--ch-2);\">coalesce</span><span style=\"color: var(--ch-4);\">(</span><span style=\"color: var(--ch-2);\">full_text</span><span style=\"color: var(--ch-4);\">.</span><span style=\"color: var(--ch-2);\">id</span><span style=\"color: var(--ch-4);\">, </span><span style=\"color: var(--ch-2);\">semantic</span><span style=\"color: var(--ch-4);\">.</span><span style=\"color: var(--ch-2);\">id</span><span style=\"color: var(--ch-4);\">) </span><span style=\"color: var(--ch-7);\">= </span><span style=\"color: var(--ch-2);\">documents</span><span style=\"color: var(--ch-4);\">.</span><span style=\"color: var(--ch-2);\">id</span></span><br></div></div><span class=\"ch-code-line-number\" style=\"position: absolute; top: 0px; left: 0px; transform: translate(0px, 779px); width: 31.5px; opacity: 0.99;\">42</span><div style=\"position: absolute; top: 0px; left: 0px; transform: translate(31.5px, 779px); width: 679px;\"><div style=\"display: inline-block; width: 100%;\"><span style=\"opacity: 0.99;\"><span style=\"color: var(--ch-7);\">order by</span></span><br></div></div><span class=\"ch-code-line-number\" style=\"position: absolute; top: 0px; left: 0px; transform: translate(0px, 798px); width: 31.5px; opacity: 0.99;\">43</span><div style=\"position: absolute; top: 0px; left: 0px; transform: translate(31.5px, 798px); width: 679px;\"><div style=\"display: inline-block; width: 100%;\"><span style=\"opacity: 0.99;\"><span style=\"color: var(--ch-2);\">  coalesce</span><span style=\"color: var(--ch-4);\">(</span><span style=\"color: var(--ch-2);\">1</span><span style=\"color: var(--ch-4);\">.</span><span style=\"color: var(--ch-2);\">0 </span><span style=\"color: var(--ch-7);\">/</span><span style=\"color: var(--ch-4);\"> (rrf_k </span><span style=\"color: var(--ch-7);\">+ </span><span style=\"color: var(--ch-2);\">full_text</span><span style=\"color: var(--ch-4);\">.</span><span style=\"color: var(--ch-2);\">rank_ix</span><span style=\"color: var(--ch-4);\">), </span><span style=\"color: var(--ch-2);\">0</span><span style=\"color: var(--ch-4);\">.</span><span style=\"color: var(--ch-2);\">0</span><span style=\"color: var(--ch-4);\">) </span><span style=\"color: var(--ch-7);\">*</span><span style=\"color: var(--ch-4);\"> full_text_weight </span><span style=\"color: var(--ch-7);\">+</span></span><br></div></div><span class=\"ch-code-line-number\" style=\"position: absolute; top: 0px; left: 0px; transform: translate(0px, 817px); width: 31.5px; opacity: 0.99;\">44</span><div style=\"position: absolute; top: 0px; left: 0px; transform: translate(31.5px, 817px); width: 679px;\"><div style=\"display: inline-block; width: 100%;\"><span style=\"opacity: 0.99;\"><span style=\"color: var(--ch-2);\">  coalesce</span><span style=\"color: var(--ch-4);\">(</span><span style=\"color: var(--ch-2);\">1</span><span style=\"color: var(--ch-4);\">.</span><span style=\"color: var(--ch-2);\">0 </span><span style=\"color: var(--ch-7);\">/</span><span style=\"color: var(--ch-4);\"> (rrf_k </span><span style=\"color: var(--ch-7);\">+ </span><span style=\"color: var(--ch-2);\">semantic</span><span style=\"color: var(--ch-4);\">.</span><span style=\"color: var(--ch-2);\">rank_ix</span><span style=\"color: var(--ch-4);\">), </span><span style=\"color: var(--ch-2);\">0</span><span style=\"color: var(--ch-4);\">.</span><span style=\"color: var(--ch-2);\">0</span><span style=\"color: var(--ch-4);\">) </span><span style=\"color: var(--ch-7);\">*</span><span style=\"color: var(--ch-4);\"> semantic_weight</span></span><br></div></div><span class=\"ch-code-line-number\" style=\"position: absolute; top: 0px; left: 0px; transform: translate(0px, 836px); width: 31.5px; opacity: 0.99;\">45</span><div style=\"position: absolute; top: 0px; left: 0px; transform: translate(31.5px, 836px); width: 679px;\"><div style=\"display: inline-block; width: 100%;\"><span style=\"opacity: 0.99;\"><span style=\"color: var(--ch-7);\">  desc</span></span><br></div></div><span class=\"ch-code-line-number\" style=\"position: absolute; top: 0px; left: 0px; transform: translate(0px, 855px); width: 31.5px; opacity: 0.99;\">46</span><div style=\"position: absolute; top: 0px; left: 0px; transform: translate(31.5px, 855px); width: 679px;\"><div style=\"display: inline-block; width: 100%;\"><span style=\"opacity: 0.99;\"><span style=\"color: var(--ch-7);\">limit</span></span><br></div></div><span class=\"ch-code-line-number\" style=\"position: absolute; top: 0px; left: 0px; transform: translate(0px, 874px); width: 31.5px; opacity: 0.99;\">47</span><div style=\"position: absolute; top: 0px; left: 0px; transform: translate(31.5px, 874px); width: 679px;\"><div style=\"display: inline-block; width: 100%;\"><span style=\"opacity: 0.99;\"><span style=\"color: var(--ch-2);\">  least</span><span style=\"color: var(--ch-4);\">(match_count, </span><span style=\"color: var(--ch-2);\">30</span><span style=\"color: var(--ch-4);\">)</span></span><br></div></div><span class=\"ch-code-line-number\" style=\"position: absolute; top: 0px; left: 0px; transform: translate(0px, 893px); width: 31.5px; opacity: 0.99;\">48</span><div style=\"position: absolute; top: 0px; left: 0px; transform: translate(31.5px, 893px); width: 679px;\"><div style=\"display: inline-block; width: 100%;\"><span style=\"opacity: 0.99;\"><span style=\"color: var(--ch-4);\">$$;</span></span><br></div></div></div></div></code><button type=\"button\" title=\"Copy code\" class=\"ch-code-button\"><svg fill=\"none\" stroke=\"currentColor\" viewBox=\"0 0 24 24\" xmlns=\"http://www.w3.org/2000/svg\"><path stroke-linecap=\"round\" stroke-linejoin=\"round\" stroke-width=\"1.6px\" d=\"M8 16H6a2 2 0 01-2-2V6a2 2 0 012-2h8a2 2 0 012 2v2m-6 12h8a2 2 0 002-2v-8a2 2 0 00-2-2h-8a2 2 0 00-2 2v8a2 2 0 002 2z\"></path></svg></button></div></div>\n<p>Let's break this down:</p>\n<ul>\n<li>\n<p><strong>Parameters:</strong> The function accepts quite a few parameters, but the main (required) ones are <code>query_text</code>, <code>query_embedding</code>, and <code>match_count</code>.</p>\n<ul>\n<li><code>query_text</code> is the user's query text (more on this shortly)</li>\n<li><code>query_embedding</code> is the vector representation of the user's query produced by the embedding model. We chose 512 dimensions for this example, but adjust this to match the size of the embedding vectors generated from your preferred model. This must match the size of the <code>embedding</code> vector on the <code>documents</code> table (and use the same model).</li>\n<li><code>match_count</code> is the number of records returned in the <code>limit</code> clause.</li>\n</ul>\n<p>The other parameters are optional, but give more control over the fusion process.</p>\n<ul>\n<li><code>full_text_weight</code> and <code>semantic_weight</code> decide how much weight each search method gets in the final score. These are both 1 by default which means they both equally contribute towards the final rank. A <code>full_text_weight</code> of 2 and <code>semantic_weight</code> of 1 would give full-text search twice as much weight as semantic search.</li>\n<li><code>rrf_k</code> is the <code>k</code> <a href=\"#smoothing-constant-k\">smoothing constant</a> added to the reciprocal rank. The default is 50.</li>\n</ul>\n</li>\n<li>\n<p><strong>Return type:</strong> The function returns a set of records from our <code>documents</code> table.</p>\n</li>\n<li>\n<p><strong>CTE:</strong> We create two <a href=\"https://www.postgresql.org/docs/current/queries-with.html\">common table expressions (CTE)</a>, one for full-text search and one for semantic search. These perform each query individually prior to joining them.</p>\n</li>\n<li>\n<p><strong>RRF:</strong> The final query combines the results from the two CTEs using <a href=\"#reciprocal-ranked-fusion-rrf\">reciprocal rank fusion (RRF)</a>.</p>\n</li>\n</ul>\n<h2 id=\"running-hybrid-search\" class=\"group scroll-mt-24\">Running hybrid search<a href=\"#running-hybrid-search\" aria-hidden=\"true\" class=\"ml-2 opacity-0 group-hover:opacity-100 transition\"><span aria-hidden=\"true\">#</span></a></h2>\n<p>To use this function in SQL, we can run:</p>\n<div class=\"ch-codeblock not-prose \" data-ch-theme=\"supabase\"><div class=\"ch-code-wrapper ch-code\" data-ch-measured=\"true\"><code class=\"ch-code-scroll-parent\" data-ch-lang=\"sql\" style=\"width: 926px; height: 192px; position: relative; overflow: auto;\"><div class=\"ch-code-scroll-content\" style=\"position: absolute; top: 0px; left: 0px; transform-origin: left top; width: 924px; height: 190px; overflow: hidden;\"><div style=\"position: absolute; top: 0px; left: 0px; transform: translateX(0px) translateY(19px) scale(1); transform-origin: left top; width: 924px; height: 152px;\"><span class=\"ch-code-line-number\" style=\"position: absolute; top: 0px; left: 0px; transform: translate(0px, 0px); width: 31.5px; opacity: 0.99;\">1</span><div style=\"position: absolute; top: 0px; left: 0px; transform: translate(31.5px, 0px); width: 448px;\"><div style=\"display: inline-block; width: 100%;\"><span style=\"opacity: 0.99;\"><span style=\"color: var(--ch-7);\">select</span></span><br></div></div><span class=\"ch-code-line-number\" style=\"position: absolute; top: 0px; left: 0px; transform: translate(0px, 19px); width: 31.5px; opacity: 0.99;\">2</span><div style=\"position: absolute; top: 0px; left: 0px; transform: translate(31.5px, 19px); width: 448px;\"><div style=\"display: inline-block; width: 100%;\"><span style=\"opacity: 0.99;\"><span style=\"color: var(--ch-7);\">  *</span></span><br></div></div><span class=\"ch-code-line-number\" style=\"position: absolute; top: 0px; left: 0px; transform: translate(0px, 38px); width: 31.5px; opacity: 0.99;\">3</span><div style=\"position: absolute; top: 0px; left: 0px; transform: translate(31.5px, 38px); width: 448px;\"><div style=\"display: inline-block; width: 100%;\"><span style=\"opacity: 0.99;\"><span style=\"color: var(--ch-7);\">from</span></span><br></div></div><span class=\"ch-code-line-number\" style=\"position: absolute; top: 0px; left: 0px; transform: translate(0px, 57px); width: 31.5px; opacity: 0.99;\">4</span><div style=\"position: absolute; top: 0px; left: 0px; transform: translate(31.5px, 57px); width: 448px;\"><div style=\"display: inline-block; width: 100%;\"><span style=\"opacity: 0.99;\"><span style=\"color: var(--ch-4);\">  hybrid_search(</span></span><br></div></div><span class=\"ch-code-line-number\" style=\"position: absolute; top: 0px; left: 0px; transform: translate(0px, 76px); width: 31.5px; opacity: 0.99;\">5</span><div style=\"position: absolute; top: 0px; left: 0px; transform: translate(31.5px, 76px); width: 448px;\"><div style=\"display: inline-block; width: 100%;\"><span style=\"opacity: 0.99;\"><span style=\"color: var(--ch-8);\">    'Italian recipes with tomato sauce'</span><span style=\"color: var(--ch-4);\">, </span><span style=\"color: var(--ch-1);\">-- user query</span></span><br></div></div><span class=\"ch-code-line-number\" style=\"position: absolute; top: 0px; left: 0px; transform: translate(0px, 95px); width: 31.5px; opacity: 0.99;\">6</span><div style=\"position: absolute; top: 0px; left: 0px; transform: translate(31.5px, 95px); width: 448px;\"><div style=\"display: inline-block; width: 100%;\"><span style=\"opacity: 0.99;\"><span style=\"color: var(--ch-8);\">    '[...]'</span><span style=\"color: var(--ch-4);\">::vector(</span><span style=\"color: var(--ch-2);\">512</span><span style=\"color: var(--ch-4);\">), </span><span style=\"color: var(--ch-1);\">-- embedding generated from user query</span></span><br></div></div><span class=\"ch-code-line-number\" style=\"position: absolute; top: 0px; left: 0px; transform: translate(0px, 114px); width: 31.5px; opacity: 0.99;\">7</span><div style=\"position: absolute; top: 0px; left: 0px; transform: translate(31.5px, 114px); width: 448px;\"><div style=\"display: inline-block; width: 100%;\"><span style=\"opacity: 0.99;\"><span style=\"color: var(--ch-2);\">    10</span></span><br></div></div><span class=\"ch-code-line-number\" style=\"position: absolute; top: 0px; left: 0px; transform: translate(0px, 133px); width: 31.5px; opacity: 0.99;\">8</span><div style=\"position: absolute; top: 0px; left: 0px; transform: translate(31.5px, 133px); width: 448px;\"><div style=\"display: inline-block; width: 100%;\"><span style=\"opacity: 0.99;\"><span style=\"color: var(--ch-4);\">  );</span></span><br></div></div></div></div></code><button type=\"button\" title=\"Copy code\" class=\"ch-code-button\"><svg fill=\"none\" stroke=\"currentColor\" viewBox=\"0 0 24 24\" xmlns=\"http://www.w3.org/2000/svg\"><path stroke-linecap=\"round\" stroke-linejoin=\"round\" stroke-width=\"1.6px\" d=\"M8 16H6a2 2 0 01-2-2V6a2 2 0 012-2h8a2 2 0 012 2v2m-6 12h8a2 2 0 002-2v-8a2 2 0 00-2-2h-8a2 2 0 00-2 2v8a2 2 0 002 2z\"></path></svg></button></div></div>\n<p>In practice, you will likely be calling this from the <a href=\"/docs/reference/javascript/introduction\">Supabase client</a> or through a custom backend layer. Here is a quick example of how you might call this from an <a href=\"/docs/guides/functions\">Edge Function</a> using JavaScript:</p>\n<div class=\"ch-codeblock not-prose \" data-ch-theme=\"supabase\"><div class=\"ch-code-wrapper ch-code\" data-ch-measured=\"true\"><code class=\"ch-code-scroll-parent\" data-ch-lang=\"tsx\" style=\"width: 926px; height: 762px; position: relative; overflow: auto;\"><div class=\"ch-code-scroll-content\" style=\"position: absolute; top: 0px; left: 0px; transform-origin: left top; width: 924px; height: 760px; overflow: hidden;\"><div style=\"position: absolute; top: 0px; left: 0px; transform: translateX(0px) translateY(19px) scale(1); transform-origin: left top; width: 924px; height: 722px;\"><span class=\"ch-code-line-number\" style=\"position: absolute; top: 0px; left: 0px; transform: translate(0px, 0px); width: 31.5px; opacity: 0.99;\">1</span><div style=\"position: absolute; top: 0px; left: 0px; transform: translate(31.5px, 0px); width: 546px;\"><div style=\"display: inline-block; width: 100%;\"><span style=\"opacity: 0.99;\"><span style=\"color: var(--ch-7);\">import</span><span style=\"color: var(--ch-4);\"> { createClient } </span><span style=\"color: var(--ch-7);\">from </span><span style=\"color: var(--ch-8);\">'jsr:@supabase/supabase-js@2'</span></span><br></div></div><span class=\"ch-code-line-number\" style=\"position: absolute; top: 0px; left: 0px; transform: translate(0px, 19px); width: 31.5px; opacity: 0.99;\">2</span><div style=\"position: absolute; top: 0px; left: 0px; transform: translate(31.5px, 19px); width: 546px;\"><div style=\"display: inline-block; width: 100%;\"><span style=\"opacity: 0.99;\"><span style=\"color: var(--ch-7);\">import</span><span style=\"color: var(--ch-4);\"> OpenAI </span><span style=\"color: var(--ch-7);\">from </span><span style=\"color: var(--ch-8);\">'npm:openai'</span></span><br></div></div><span class=\"ch-code-line-number\" style=\"position: absolute; top: 0px; left: 0px; transform: translate(0px, 38px); width: 31.5px; opacity: 0.99;\">3</span><div style=\"position: absolute; top: 0px; left: 0px; transform: translate(31.5px, 38px); width: 546px;\"><div style=\"display: inline-block; width: 100%;\"><span style=\"opacity: 0.99;\"><span style=\"color: var(--ch-4);\"></span></span><br></div></div><span class=\"ch-code-line-number\" style=\"position: absolute; top: 0px; left: 0px; transform: translate(0px, 57px); width: 31.5px; opacity: 0.99;\">4</span><div style=\"position: absolute; top: 0px; left: 0px; transform: translate(31.5px, 57px); width: 546px;\"><div style=\"display: inline-block; width: 100%;\"><span style=\"opacity: 0.99;\"><span style=\"color: var(--ch-7);\">const </span><span style=\"color: var(--ch-2);\">supabaseUrl </span><span style=\"color: var(--ch-7);\">=</span><span style=\"color: var(--ch-4);\"> Deno.env.</span><span style=\"color: var(--ch-5);\">get</span><span style=\"color: var(--ch-4);\">(</span><span style=\"color: var(--ch-8);\">'SUPABASE_URL'</span><span style=\"color: var(--ch-4);\">)</span><span style=\"color: var(--ch-7);\">!</span></span><br></div></div><span class=\"ch-code-line-number\" style=\"position: absolute; top: 0px; left: 0px; transform: translate(0px, 76px); width: 31.5px; opacity: 0.99;\">5</span><div style=\"position: absolute; top: 0px; left: 0px; transform: translate(31.5px, 76px); width: 546px;\"><div style=\"display: inline-block; width: 100%;\"><span style=\"opacity: 0.99;\"><span style=\"color: var(--ch-7);\">const </span><span style=\"color: var(--ch-2);\">supabaseServiceRoleKey </span><span style=\"color: var(--ch-7);\">=</span><span style=\"color: var(--ch-4);\"> Deno.env.</span><span style=\"color: var(--ch-5);\">get</span><span style=\"color: var(--ch-4);\">(</span><span style=\"color: var(--ch-8);\">'SUPABASE_SERVICE_ROLE_KEY'</span><span style=\"color: var(--ch-4);\">)</span><span style=\"color: var(--ch-7);\">!</span></span><br></div></div><span class=\"ch-code-line-number\" style=\"position: absolute; top: 0px; left: 0px; transform: translate(0px, 95px); width: 31.5px; opacity: 0.99;\">6</span><div style=\"position: absolute; top: 0px; left: 0px; transform: translate(31.5px, 95px); width: 546px;\"><div style=\"display: inline-block; width: 100%;\"><span style=\"opacity: 0.99;\"><span style=\"color: var(--ch-7);\">const </span><span style=\"color: var(--ch-2);\">openaiApiKey </span><span style=\"color: var(--ch-7);\">=</span><span style=\"color: var(--ch-4);\"> Deno.env.</span><span style=\"color: var(--ch-5);\">get</span><span style=\"color: var(--ch-4);\">(</span><span style=\"color: var(--ch-8);\">'OPENAI_API_KEY'</span><span style=\"color: var(--ch-4);\">)</span><span style=\"color: var(--ch-7);\">!</span></span><br></div></div><span class=\"ch-code-line-number\" style=\"position: absolute; top: 0px; left: 0px; transform: translate(0px, 114px); width: 31.5px; opacity: 0.99;\">7</span><div style=\"position: absolute; top: 0px; left: 0px; transform: translate(31.5px, 114px); width: 546px;\"><div style=\"display: inline-block; width: 100%;\"><span style=\"opacity: 0.99;\"><span style=\"color: var(--ch-4);\"></span></span><br></div></div><span class=\"ch-code-line-number\" style=\"position: absolute; top: 0px; left: 0px; transform: translate(0px, 133px); width: 31.5px; opacity: 0.99;\">8</span><div style=\"position: absolute; top: 0px; left: 0px; transform: translate(31.5px, 133px); width: 546px;\"><div style=\"display: inline-block; width: 100%;\"><span style=\"opacity: 0.99;\"><span style=\"color: var(--ch-4);\">Deno.</span><span style=\"color: var(--ch-5);\">serve</span><span style=\"color: var(--ch-4);\">(</span><span style=\"color: var(--ch-7);\">async</span><span style=\"color: var(--ch-4);\"> (</span><span style=\"color: var(--ch-3);\">req</span><span style=\"color: var(--ch-4);\">) </span><span style=\"color: var(--ch-7);\">=&gt;</span><span style=\"color: var(--ch-4);\"> {</span></span><br></div></div><span class=\"ch-code-line-number\" style=\"position: absolute; top: 0px; left: 0px; transform: translate(0px, 152px); width: 31.5px; opacity: 0.99;\">9</span><div style=\"position: absolute; top: 0px; left: 0px; transform: translate(31.5px, 152px); width: 546px;\"><div style=\"display: inline-block; width: 100%;\"><span style=\"opacity: 0.99;\"><span style=\"color: var(--ch-1);\">  // Grab the user's query from the JSON payload</span></span><br></div></div><span class=\"ch-code-line-number\" style=\"position: absolute; top: 0px; left: 0px; transform: translate(0px, 171px); width: 31.5px; opacity: 0.99;\">10</span><div style=\"position: absolute; top: 0px; left: 0px; transform: translate(31.5px, 171px); width: 546px;\"><div style=\"display: inline-block; width: 100%;\"><span style=\"opacity: 0.99;\"><span style=\"color: var(--ch-7);\">  const</span><span style=\"color: var(--ch-4);\"> { </span><span style=\"color: var(--ch-2);\">query</span><span style=\"color: var(--ch-4);\"> } </span><span style=\"color: var(--ch-7);\">= await</span><span style=\"color: var(--ch-4);\"> req.</span><span style=\"color: var(--ch-5);\">json</span><span style=\"color: var(--ch-4);\">()</span></span><br></div></div><span class=\"ch-code-line-number\" style=\"position: absolute; top: 0px; left: 0px; transform: translate(0px, 190px); width: 31.5px; opacity: 0.99;\">11</span><div style=\"position: absolute; top: 0px; left: 0px; transform: translate(31.5px, 190px); width: 546px;\"><div style=\"display: inline-block; width: 100%;\"><span style=\"opacity: 0.99;\"><span style=\"color: var(--ch-4);\"></span></span><br></div></div><span class=\"ch-code-line-number\" style=\"position: absolute; top: 0px; left: 0px; transform: translate(0px, 209px); width: 31.5px; opacity: 0.99;\">12</span><div style=\"position: absolute; top: 0px; left: 0px; transform: translate(31.5px, 209px); width: 546px;\"><div style=\"display: inline-block; width: 100%;\"><span style=\"opacity: 0.99;\"><span style=\"color: var(--ch-1);\">  // Instantiate OpenAI client</span></span><br></div></div><span class=\"ch-code-line-number\" style=\"position: absolute; top: 0px; left: 0px; transform: translate(0px, 228px); width: 31.5px; opacity: 0.99;\">13</span><div style=\"position: absolute; top: 0px; left: 0px; transform: translate(31.5px, 228px); width: 546px;\"><div style=\"display: inline-block; width: 100%;\"><span style=\"opacity: 0.99;\"><span style=\"color: var(--ch-7);\">  const </span><span style=\"color: var(--ch-2);\">openai </span><span style=\"color: var(--ch-7);\">= new </span><span style=\"color: var(--ch-5);\">OpenAI</span><span style=\"color: var(--ch-4);\">({ apiKey: openaiApiKey })</span></span><br></div></div><span class=\"ch-code-line-number\" style=\"position: absolute; top: 0px; left: 0px; transform: translate(0px, 247px); width: 31.5px; opacity: 0.99;\">14</span><div style=\"position: absolute; top: 0px; left: 0px; transform: translate(31.5px, 247px); width: 546px;\"><div style=\"display: inline-block; width: 100%;\"><span style=\"opacity: 0.99;\"><span style=\"color: var(--ch-4);\"></span></span><br></div></div><span class=\"ch-code-line-number\" style=\"position: absolute; top: 0px; left: 0px; transform: translate(0px, 266px); width: 31.5px; opacity: 0.99;\">15</span><div style=\"position: absolute; top: 0px; left: 0px; transform: translate(31.5px, 266px); width: 546px;\"><div style=\"display: inline-block; width: 100%;\"><span style=\"opacity: 0.99;\"><span style=\"color: var(--ch-1);\">  // Generate a one-time embedding for the user's query</span></span><br></div></div><span class=\"ch-code-line-number\" style=\"position: absolute; top: 0px; left: 0px; transform: translate(0px, 285px); width: 31.5px; opacity: 0.99;\">16</span><div style=\"position: absolute; top: 0px; left: 0px; transform: translate(31.5px, 285px); width: 546px;\"><div style=\"display: inline-block; width: 100%;\"><span style=\"opacity: 0.99;\"><span style=\"color: var(--ch-7);\">  const </span><span style=\"color: var(--ch-2);\">embeddingResponse </span><span style=\"color: var(--ch-7);\">= await</span><span style=\"color: var(--ch-4);\"> openai.embeddings.</span><span style=\"color: var(--ch-5);\">create</span><span style=\"color: var(--ch-4);\">({</span></span><br></div></div><span class=\"ch-code-line-number\" style=\"position: absolute; top: 0px; left: 0px; transform: translate(0px, 304px); width: 31.5px; opacity: 0.99;\">17</span><div style=\"position: absolute; top: 0px; left: 0px; transform: translate(31.5px, 304px); width: 546px;\"><div style=\"display: inline-block; width: 100%;\"><span style=\"opacity: 0.99;\"><span style=\"color: var(--ch-4);\">    model: </span><span style=\"color: var(--ch-8);\">'text-embedding-3-large'</span><span style=\"color: var(--ch-4);\">,</span></span><br></div></div><span class=\"ch-code-line-number\" style=\"position: absolute; top: 0px; left: 0px; transform: translate(0px, 323px); width: 31.5px; opacity: 0.99;\">18</span><div style=\"position: absolute; top: 0px; left: 0px; transform: translate(31.5px, 323px); width: 546px;\"><div style=\"display: inline-block; width: 100%;\"><span style=\"opacity: 0.99;\"><span style=\"color: var(--ch-4);\">    input: query,</span></span><br></div></div><span class=\"ch-code-line-number\" style=\"position: absolute; top: 0px; left: 0px; transform: translate(0px, 342px); width: 31.5px; opacity: 0.99;\">19</span><div style=\"position: absolute; top: 0px; left: 0px; transform: translate(31.5px, 342px); width: 546px;\"><div style=\"display: inline-block; width: 100%;\"><span style=\"opacity: 0.99;\"><span style=\"color: var(--ch-4);\">    dimensions: </span><span style=\"color: var(--ch-2);\">512</span><span style=\"color: var(--ch-4);\">,</span></span><br></div></div><span class=\"ch-code-line-number\" style=\"position: absolute; top: 0px; left: 0px; transform: translate(0px, 361px); width: 31.5px; opacity: 0.99;\">20</span><div style=\"position: absolute; top: 0px; left: 0px; transform: translate(31.5px, 361px); width: 546px;\"><div style=\"display: inline-block; width: 100%;\"><span style=\"opacity: 0.99;\"><span style=\"color: var(--ch-4);\">  })</span></span><br></div></div><span class=\"ch-code-line-number\" style=\"position: absolute; top: 0px; left: 0px; transform: translate(0px, 380px); width: 31.5px; opacity: 0.99;\">21</span><div style=\"position: absolute; top: 0px; left: 0px; transform: translate(31.5px, 380px); width: 546px;\"><div style=\"display: inline-block; width: 100%;\"><span style=\"opacity: 0.99;\"><span style=\"color: var(--ch-4);\"></span></span><br></div></div><span class=\"ch-code-line-number\" style=\"position: absolute; top: 0px; left: 0px; transform: translate(0px, 399px); width: 31.5px; opacity: 0.99;\">22</span><div style=\"position: absolute; top: 0px; left: 0px; transform: translate(31.5px, 399px); width: 546px;\"><div style=\"display: inline-block; width: 100%;\"><span style=\"opacity: 0.99;\"><span style=\"color: var(--ch-7);\">  const</span><span style=\"color: var(--ch-4);\"> [{ </span><span style=\"color: var(--ch-2);\">embedding</span><span style=\"color: var(--ch-4);\"> }] </span><span style=\"color: var(--ch-7);\">=</span><span style=\"color: var(--ch-4);\"> embeddingResponse.data</span></span><br></div></div><span class=\"ch-code-line-number\" style=\"position: absolute; top: 0px; left: 0px; transform: translate(0px, 418px); width: 31.5px; opacity: 0.99;\">23</span><div style=\"position: absolute; top: 0px; left: 0px; transform: translate(31.5px, 418px); width: 546px;\"><div style=\"display: inline-block; width: 100%;\"><span style=\"opacity: 0.99;\"><span style=\"color: var(--ch-4);\"></span></span><br></div></div><span class=\"ch-code-line-number\" style=\"position: absolute; top: 0px; left: 0px; transform: translate(0px, 437px); width: 31.5px; opacity: 0.99;\">24</span><div style=\"position: absolute; top: 0px; left: 0px; transform: translate(31.5px, 437px); width: 546px;\"><div style=\"display: inline-block; width: 100%;\"><span style=\"opacity: 0.99;\"><span style=\"color: var(--ch-1);\">  // Instantiate the Supabase client</span></span><br></div></div><span class=\"ch-code-line-number\" style=\"position: absolute; top: 0px; left: 0px; transform: translate(0px, 456px); width: 31.5px; opacity: 0.99;\">25</span><div style=\"position: absolute; top: 0px; left: 0px; transform: translate(31.5px, 456px); width: 546px;\"><div style=\"display: inline-block; width: 100%;\"><span style=\"opacity: 0.99;\"><span style=\"color: var(--ch-1);\">  // (replace service role key with user's JWT if using Supabase auth and RLS)</span></span><br></div></div><span class=\"ch-code-line-number\" style=\"position: absolute; top: 0px; left: 0px; transform: translate(0px, 475px); width: 31.5px; opacity: 0.99;\">26</span><div style=\"position: absolute; top: 0px; left: 0px; transform: translate(31.5px, 475px); width: 546px;\"><div style=\"display: inline-block; width: 100%;\"><span style=\"opacity: 0.99;\"><span style=\"color: var(--ch-7);\">  const </span><span style=\"color: var(--ch-2);\">supabase </span><span style=\"color: var(--ch-7);\">= </span><span style=\"color: var(--ch-5);\">createClient</span><span style=\"color: var(--ch-4);\">(supabaseUrl, supabaseServiceRoleKey)</span></span><br></div></div><span class=\"ch-code-line-number\" style=\"position: absolute; top: 0px; left: 0px; transform: translate(0px, 494px); width: 31.5px; opacity: 0.99;\">27</span><div style=\"position: absolute; top: 0px; left: 0px; transform: translate(31.5px, 494px); width: 546px;\"><div style=\"display: inline-block; width: 100%;\"><span style=\"opacity: 0.99;\"><span style=\"color: var(--ch-4);\"></span></span><br></div></div><span class=\"ch-code-line-number\" style=\"position: absolute; top: 0px; left: 0px; transform: translate(0px, 513px); width: 31.5px; opacity: 0.99;\">28</span><div style=\"position: absolute; top: 0px; left: 0px; transform: translate(31.5px, 513px); width: 546px;\"><div style=\"display: inline-block; width: 100%;\"><span style=\"opacity: 0.99;\"><span style=\"color: var(--ch-1);\">  // Call hybrid_search Postgres function via RPC</span></span><br></div></div><span class=\"ch-code-line-number\" style=\"position: absolute; top: 0px; left: 0px; transform: translate(0px, 532px); width: 31.5px; opacity: 0.99;\">29</span><div style=\"position: absolute; top: 0px; left: 0px; transform: translate(31.5px, 532px); width: 546px;\"><div style=\"display: inline-block; width: 100%;\"><span style=\"opacity: 0.99;\"><span style=\"color: var(--ch-7);\">  const</span><span style=\"color: var(--ch-4);\"> { </span><span style=\"color: var(--ch-3);\">data</span><span style=\"color: var(--ch-4);\">: </span><span style=\"color: var(--ch-2);\">documents</span><span style=\"color: var(--ch-4);\"> } </span><span style=\"color: var(--ch-7);\">= await</span><span style=\"color: var(--ch-4);\"> supabase.</span><span style=\"color: var(--ch-5);\">rpc</span><span style=\"color: var(--ch-4);\">(</span><span style=\"color: var(--ch-8);\">'hybrid_search'</span><span style=\"color: var(--ch-4);\">, {</span></span><br></div></div><span class=\"ch-code-line-number\" style=\"position: absolute; top: 0px; left: 0px; transform: translate(0px, 551px); width: 31.5px; opacity: 0.99;\">30</span><div style=\"position: absolute; top: 0px; left: 0px; transform: translate(31.5px, 551px); width: 546px;\"><div style=\"display: inline-block; width: 100%;\"><span style=\"opacity: 0.99;\"><span style=\"color: var(--ch-4);\">    query_text: query,</span></span><br></div></div><span class=\"ch-code-line-number\" style=\"position: absolute; top: 0px; left: 0px; transform: translate(0px, 570px); width: 31.5px; opacity: 0.99;\">31</span><div style=\"position: absolute; top: 0px; left: 0px; transform: translate(31.5px, 570px); width: 546px;\"><div style=\"display: inline-block; width: 100%;\"><span style=\"opacity: 0.99;\"><span style=\"color: var(--ch-4);\">    query_embedding: embedding,</span></span><br></div></div><span class=\"ch-code-line-number\" style=\"position: absolute; top: 0px; left: 0px; transform: translate(0px, 589px); width: 31.5px; opacity: 0.99;\">32</span><div style=\"position: absolute; top: 0px; left: 0px; transform: translate(31.5px, 589px); width: 546px;\"><div style=\"display: inline-block; width: 100%;\"><span style=\"opacity: 0.99;\"><span style=\"color: var(--ch-4);\">    match_count: </span><span style=\"color: var(--ch-2);\">10</span><span style=\"color: var(--ch-4);\">,</span></span><br></div></div><span class=\"ch-code-line-number\" style=\"position: absolute; top: 0px; left: 0px; transform: translate(0px, 608px); width: 31.5px; opacity: 0.99;\">33</span><div style=\"position: absolute; top: 0px; left: 0px; transform: translate(31.5px, 608px); width: 546px;\"><div style=\"display: inline-block; width: 100%;\"><span style=\"opacity: 0.99;\"><span style=\"color: var(--ch-4);\">  })</span></span><br></div></div><span class=\"ch-code-line-number\" style=\"position: absolute; top: 0px; left: 0px; transform: translate(0px, 627px); width: 31.5px; opacity: 0.99;\">34</span><div style=\"position: absolute; top: 0px; left: 0px; transform: translate(31.5px, 627px); width: 546px;\"><div style=\"display: inline-block; width: 100%;\"><span style=\"opacity: 0.99;\"><span style=\"color: var(--ch-4);\"></span></span><br></div></div><span class=\"ch-code-line-number\" style=\"position: absolute; top: 0px; left: 0px; transform: translate(0px, 646px); width: 31.5px; opacity: 0.99;\">35</span><div style=\"position: absolute; top: 0px; left: 0px; transform: translate(31.5px, 646px); width: 546px;\"><div style=\"display: inline-block; width: 100%;\"><span style=\"opacity: 0.99;\"><span style=\"color: var(--ch-7);\">  return new </span><span style=\"color: var(--ch-5);\">Response</span><span style=\"color: var(--ch-4);\">(</span><span style=\"color: var(--ch-2);\">JSON</span><span style=\"color: var(--ch-4);\">.</span><span style=\"color: var(--ch-5);\">stringify</span><span style=\"color: var(--ch-4);\">(documents), {</span></span><br></div></div><span class=\"ch-code-line-number\" style=\"position: absolute; top: 0px; left: 0px; transform: translate(0px, 665px); width: 31.5px; opacity: 0.99;\">36</span><div style=\"position: absolute; top: 0px; left: 0px; transform: translate(31.5px, 665px); width: 546px;\"><div style=\"display: inline-block; width: 100%;\"><span style=\"opacity: 0.99;\"><span style=\"color: var(--ch-4);\">    headers: { </span><span style=\"color: var(--ch-8);\">'Content-Type'</span><span style=\"color: var(--ch-4);\">: </span><span style=\"color: var(--ch-8);\">'application/json'</span><span style=\"color: var(--ch-4);\"> },</span></span><br></div></div><span class=\"ch-code-line-number\" style=\"position: absolute; top: 0px; left: 0px; transform: translate(0px, 684px); width: 31.5px; opacity: 0.99;\">37</span><div style=\"position: absolute; top: 0px; left: 0px; transform: translate(31.5px, 684px); width: 546px;\"><div style=\"display: inline-block; width: 100%;\"><span style=\"opacity: 0.99;\"><span style=\"color: var(--ch-4);\">  })</span></span><br></div></div><span class=\"ch-code-line-number\" style=\"position: absolute; top: 0px; left: 0px; transform: translate(0px, 703px); width: 31.5px; opacity: 0.99;\">38</span><div style=\"position: absolute; top: 0px; left: 0px; transform: translate(31.5px, 703px); width: 546px;\"><div style=\"display: inline-block; width: 100%;\"><span style=\"opacity: 0.99;\"><span style=\"color: var(--ch-4);\">})</span></span><br></div></div></div></div></code><button type=\"button\" title=\"Copy code\" class=\"ch-code-button\"><svg fill=\"none\" stroke=\"currentColor\" viewBox=\"0 0 24 24\" xmlns=\"http://www.w3.org/2000/svg\"><path stroke-linecap=\"round\" stroke-linejoin=\"round\" stroke-width=\"1.6px\" d=\"M8 16H6a2 2 0 01-2-2V6a2 2 0 012-2h8a2 2 0 012 2v2m-6 12h8a2 2 0 002-2v-8a2 2 0 00-2-2h-8a2 2 0 00-2 2v8a2 2 0 002 2z\"></path></svg></button></div></div>\n<p>This uses OpenAI's <code>text-embedding-3-large</code> model to generate embeddings (shortened to 512 dimensions for faster retrieval). Swap in your preferred embedding model (and dimension size) accordingly.</p>\n<p>To test this, make a <code>POST</code> request to the function's endpoint while passing in a JSON payload containing the user's query. Here is an example <code>POST</code> request using cURL:</p>\n<div class=\"ch-codeblock not-prose \" data-ch-theme=\"supabase\"><div class=\"ch-code-wrapper ch-code\" data-ch-measured=\"true\"><code class=\"ch-code-scroll-parent\" data-ch-lang=\"tsx\" style=\"width: 926px; height: 135px; position: relative; overflow: auto;\"><div class=\"ch-code-scroll-content\" style=\"position: absolute; top: 0px; left: 0px; transform-origin: left top; width: 924px; height: 133px; overflow: hidden;\"><div style=\"position: absolute; top: 0px; left: 0px; transform: translateX(0px) translateY(19px) scale(1); transform-origin: left top; width: 924px; height: 95px;\"><span class=\"ch-code-line-number\" style=\"position: absolute; top: 0px; left: 0px; transform: translate(0px, 0px); width: 31.5px; opacity: 0.99;\">1</span><div style=\"position: absolute; top: 0px; left: 0px; transform: translate(31.5px, 0px); width: 392px;\"><div style=\"display: inline-block; width: 100%;\"><span style=\"opacity: 0.99;\"><span style=\"color: var(--ch-4);\">curl </span><span style=\"color: var(--ch-7);\">-</span><span style=\"color: var(--ch-4);\">i </span><span style=\"color: var(--ch-7);\">--</span><span style=\"color: var(--ch-4);\">location </span><span style=\"color: var(--ch-7);\">--</span><span style=\"color: var(--ch-4);\">request </span><span style=\"color: var(--ch-2);\">POST</span><span style=\"color: var(--ch-4);\"> \\</span></span><br></div></div><span class=\"ch-code-line-number\" style=\"position: absolute; top: 0px; left: 0px; transform: translate(0px, 19px); width: 31.5px; opacity: 0.99;\">2</span><div style=\"position: absolute; top: 0px; left: 0px; transform: translate(31.5px, 19px); width: 392px;\"><div style=\"display: inline-block; width: 100%;\"><span style=\"opacity: 0.99;\"><span style=\"color: var(--ch-8);\">  'http://127.0.0.1:54321/functions/v1/hybrid-search'</span><span style=\"color: var(--ch-4);\"> \\</span></span><br></div></div><span class=\"ch-code-line-number\" style=\"position: absolute; top: 0px; left: 0px; transform: translate(0px, 38px); width: 31.5px; opacity: 0.99;\">3</span><div style=\"position: absolute; top: 0px; left: 0px; transform: translate(31.5px, 38px); width: 392px;\"><div style=\"display: inline-block; width: 100%;\"><span style=\"opacity: 0.99;\"><span style=\"color: var(--ch-7);\">  --</span><span style=\"color: var(--ch-4);\">header </span><span style=\"color: var(--ch-8);\">'Authorization: Bearer &lt;anonymous key&gt;'</span><span style=\"color: var(--ch-4);\"> \\</span></span><br></div></div><span class=\"ch-code-line-number\" style=\"position: absolute; top: 0px; left: 0px; transform: translate(0px, 57px); width: 31.5px; opacity: 0.99;\">4</span><div style=\"position: absolute; top: 0px; left: 0px; transform: translate(31.5px, 57px); width: 392px;\"><div style=\"display: inline-block; width: 100%;\"><span style=\"opacity: 0.99;\"><span style=\"color: var(--ch-7);\">  --</span><span style=\"color: var(--ch-4);\">header </span><span style=\"color: var(--ch-8);\">'Content-Type: application/json'</span><span style=\"color: var(--ch-4);\"> \\</span></span><br></div></div><span class=\"ch-code-line-number\" style=\"position: absolute; top: 0px; left: 0px; transform: translate(0px, 76px); width: 31.5px; opacity: 0.99;\">5</span><div style=\"position: absolute; top: 0px; left: 0px; transform: translate(31.5px, 76px); width: 392px;\"><div style=\"display: inline-block; width: 100%;\"><span style=\"opacity: 0.99;\"><span style=\"color: var(--ch-7);\">  --</span><span style=\"color: var(--ch-4);\">data </span><span style=\"color: var(--ch-8);\">'{\"query\":\"Italian recipes with tomato sauce\"}'</span></span><br></div></div></div></div></code><button type=\"button\" title=\"Copy code\" class=\"ch-code-button\"><svg fill=\"none\" stroke=\"currentColor\" viewBox=\"0 0 24 24\" xmlns=\"http://www.w3.org/2000/svg\"><path stroke-linecap=\"round\" stroke-linejoin=\"round\" stroke-width=\"1.6px\" d=\"M8 16H6a2 2 0 01-2-2V6a2 2 0 012-2h8a2 2 0 012 2v2m-6 12h8a2 2 0 002-2v-8a2 2 0 00-2-2h-8a2 2 0 00-2 2v8a2 2 0 002 2z\"></path></svg></button></div></div>\n<p>For more information on how to create, test, and deploy edge functions, see <a href=\"/docs/guides/functions/quickstart\">Getting started</a>.</p>\n<h2 id=\"see-also\" class=\"group scroll-mt-24\">See also<a href=\"#see-also\" aria-hidden=\"true\" class=\"ml-2 opacity-0 group-hover:opacity-100 transition\"><span aria-hidden=\"true\">#</span></a></h2>\n<ul>\n<li><a href=\"/docs/guides/ai/concepts\">Embedding concepts</a></li>\n<li><a href=\"/docs/guides/ai/vector-columns\">Vector columns</a></li>\n<li><a href=\"/docs/guides/ai/vector-indexes\">Vector indexes</a></li>\n<li><a href=\"/docs/guides/ai/semantic-search\">Semantic search</a></li>\n<li><a href=\"/docs/guides/database/full-text-search\">Full text (keyword) search</a></li>\n</ul></article></div><div class=\"border-l thin-scrollbar overflow-y-auto px-2 hidden md:block col-span-3 self-start sticky top-[calc(var(--header-height)+1px+2rem)] max-h-[calc(100vh-var(--header-height)-3rem)]\"><section class=\"@container px-5 mb-6\" aria-labelledby=\"feedback-title\"><h3 id=\"feedback-title\" class=\"block font-mono text-xs uppercase text-foreground mb-4\">Is this helpful?</h3><div class=\"relative flex flex-col gap-y-4 mb-2 @[12rem]:flex-row @[12rem]:items-center\"><div class=\"relative flex gap-[var(--container-flex-gap)] items-center\" style=\"--container-flex-gap: 0.5rem;\"><button data-size=\"tiny\" type=\"button\" class=\"relative justify-center cursor-pointer inline-flex items-center space-x-2 text-center font-regular ease-out duration-200 outline-none transition-all outline-0 focus-visible:outline-4 focus-visible:outline-offset-1 border text-foreground bg-transparent border-strong focus-visible:outline-border-strong data-[state=open]:border-stronger data-[state=open]:outline-border-strong text-xs py-1 h-[26px] rounded-full px-1 hover:text-brand-600 hover:border-brand-500 [transition-property:opacity,transform,color] [transition-duration:150ms,300ms,300ms] motion-reduce:[transition-duration:150ms,1ms,300ms]\"> <span class=\"truncate\"><svg xmlns=\"http://www.w3.org/2000/svg\" width=\"14\" height=\"14\" viewBox=\"0 0 24 24\" fill=\"none\" stroke=\"currentColor\" stroke-width=\"3\" stroke-linecap=\"round\" stroke-linejoin=\"round\" class=\"lucide lucide-check\"><path d=\"M20 6 9 17l-5-5\"></path></svg><span class=\"sr-only\">Yes</span></span> </button><button data-size=\"tiny\" type=\"button\" class=\"relative justify-center cursor-pointer inline-flex items-center space-x-2 text-center font-regular ease-out duration-200 outline-none transition-all outline-0 focus-visible:outline-4 focus-visible:outline-offset-1 border text-foreground bg-transparent border-strong focus-visible:outline-border-strong data-[state=open]:border-stronger data-[state=open]:outline-border-strong text-xs py-1 h-[26px] rounded-full px-1 hover:text-warning-600 hover:border-warning-500 [transition-property:opacity,transform,color] [transition-duration:150ms,300ms,300ms] motion-reduce:[transition-duration:150ms,1ms,300ms]\"> <span class=\"truncate\"><svg xmlns=\"http://www.w3.org/2000/svg\" width=\"14\" height=\"14\" viewBox=\"0 0 24 24\" fill=\"none\" stroke=\"currentColor\" stroke-width=\"3\" stroke-linecap=\"round\" stroke-linejoin=\"round\" class=\"lucide lucide-x\"><path d=\"M18 6 6 18\"></path><path d=\"m6 6 12 12\"></path></svg><span class=\"sr-only\">No</span></span> </button></div><div class=\"flex flex-col gap-1 text-xs opacity-0 invisible text-left -translate-x-[0.25rem] @[12rem]:-translate-x-[1.25rem] [transition-property:opacity,transform] [transition-duration:150ms,300ms] motion-reduce:[transition-duration:150ms,1ms] delay-300\"><span class=\"text-foreground-light\">Thanks for your feedback!</span></div></div></section><span class=\"block font-mono text-xs uppercase text-foreground px-5 mb-6\">On this page</span><ul class=\"toc-menu list-none pl-5 text-[0.8rem] grid gap-2\"><li class=\"\"><a href=\"#why-would-i-want-to-use-hybrid-search\" class=\"text-foreground-lighter hover:text-brand-link transition-colors\">Why would I want to use hybrid search?</a></li><li class=\"\"><a href=\"#when-would-i-want-to-use-hybrid-search\" class=\"text-foreground-lighter hover:text-brand-link transition-colors\">When would I want to use hybrid search?</a></li><li class=\"\"><a href=\"#how-to-combine-search-methods\" class=\"text-foreground-lighter hover:text-brand-link transition-colors\">How to combine search methods</a></li><li class=\"\"><a href=\"#reciprocal-ranked-fusion-rrf\" class=\"text-foreground-lighter hover:text-brand-link transition-colors\">Reciprocal Ranked Fusion (RRF)</a></li><li class=\"ml-4\"><a href=\"#smoothing-constant-k\" class=\"text-foreground-lighter hover:text-brand-link transition-colors\">Smoothing constant k</a></li><li class=\"\"><a href=\"#hybrid-search-in-postgres\" class=\"text-foreground-lighter hover:text-brand-link transition-colors\">Hybrid search in Postgres</a></li><li class=\"\"><a href=\"#running-hybrid-search\" class=\"text-foreground-lighter hover:text-brand-link transition-colors\">Running hybrid search</a></li><li class=\"\"><a href=\"#see-also\" class=\"text-foreground-lighter hover:text-brand-link transition-colors\">See also</a></li></ul></div></div></div><div class=\"max-w-7xl px-5 mx-auto py-8 pt-0\"></div></div><div class=\"left-0 right-0 z-10 backdrop-blur-sm backdrop-filter bg-alternative/90 hidden h-0 lg:hidden\"></div></div></main></div></div></div></div><next-route-announcer style=\"position: absolute;\"></next-route-announcer><section aria-label=\"Notifications alt+T\" tabindex=\"-1\"><ol dir=\"ltr\" tabindex=\"-1\" class=\"toaster group pointer-events-auto\" data-sonner-toaster=\"true\" data-theme=\"light\" data-y-position=\"top\" data-x-position=\"right\" style=\"--front-toast-height: 112px; --offset: 32px; --width: 356px; --gap: 14px; font-family: inherit;\"></ol><ol dir=\"ltr\" tabindex=\"-1\" class=\"toaster group pointer-events-auto\" data-sonner-toaster=\"true\" data-theme=\"light\" data-y-position=\"bottom\" data-x-position=\"right\" style=\"--front-toast-height: 112px; --offset: 32px; --width: 356px; --gap: 14px; font-family: inherit;\"><li aria-live=\"polite\" aria-atomic=\"true\" role=\"status\" tabindex=\"0\" class=\"group toast w-full rounded-md py-3 px-5 flex gap-2 items-start font-normal text-sm group-[.toaster]:bg-overlay group-[.toaster]:text-foreground group-[.toaster]:border group-[.toaster]:border-overlay group-[.toaster]:shadow-lg\" data-sonner-toast=\"\" data-styled=\"false\" data-mounted=\"true\" data-promise=\"false\" data-removed=\"false\" data-visible=\"true\" data-y-position=\"bottom\" data-x-position=\"right\" data-index=\"0\" data-front=\"true\" data-swiping=\"false\" data-dismissible=\"true\" data-swipe-out=\"false\" data-expanded=\"false\" style=\"--index: 0; --toasts-before: 0; --z-index: 1; --offset: 0px; --initial-height: 112px;\"><button aria-label=\"Close toast\" data-disabled=\"false\" data-close-button=\"true\" class=\"absolute right-2 top-2 rounded-md text-foreground/50 opacity-0 transition-opacity hover:text-foreground focus:opacity-100 focus:outline-none focus:ring-2 group-hover:opacity-100 group-[.destructive]:text-destructive-300 group-[.destructive]:hover:text-destructive-50 group-[.destructive]:focus:ring-destructive-400 group-[.destructive]:focus:ring-offset-destructive-600 left-auto transform-none bg-transparent border-0 border-transparent hover:!bg-transparent hover:border-transparent\"><svg xmlns=\"http://www.w3.org/2000/svg\" width=\"12\" height=\"12\" viewBox=\"0 0 24 24\" fill=\"none\" stroke=\"currentColor\" stroke-width=\"1.5\" stroke-linecap=\"round\" stroke-linejoin=\"round\"><line x1=\"18\" y1=\"6\" x2=\"6\" y2=\"18\"></line><line x1=\"6\" y1=\"6\" x2=\"18\" y2=\"18\"></line></svg></button><div class=\"space-y-3 py-1 flex flex-col w-full\"><div><p class=\"text-foreground\">We only collect analytics essential to ensuring smooth operation of our services. <a class=\"inline sm:hidden underline text-light\" target=\"_blank\" rel=\"noreferrer\" href=\"https://supabase.com/privacy\">Learn more</a></p></div><div class=\"flex items-center space-x-2\"><button data-size=\"tiny\" type=\"button\" class=\"relative justify-center cursor-pointer inline-flex items-center space-x-2 text-center font-regular ease-out duration-200 rounded-md outline-none transition-all outline-0 focus-visible:outline-4 focus-visible:outline-offset-1 border text-foreground bg-alternative dark:bg-muted hover:bg-selection border-strong hover:border-stronger focus-visible:outline-brand-600 data-[state=open]:bg-selection data-[state=open]:outline-brand-600 data-[state=open]:border-button-hover text-xs px-2.5 py-1 h-[26px]\"> <span class=\"truncate\">Accept</span> </button><button data-size=\"tiny\" type=\"button\" class=\"relative justify-center cursor-pointer inline-flex items-center space-x-2 text-center font-regular ease-out duration-200 rounded-md outline-none transition-all outline-0 focus-visible:outline-4 focus-visible:outline-offset-1 border text-foreground hover:bg-surface-300 shadow-none focus-visible:outline-border-strong data-[state=open]:bg-surface-300 data-[state=open]:outline-border-strong border-transparent text-xs px-2.5 py-1 h-[26px]\"> <span class=\"truncate\">Opt out</span> </button><a target=\"_blank\" rel=\"noreferrer\" data-size=\"tiny\" type=\"button\" class=\"relative justify-center cursor-pointer items-center space-x-2 text-center font-regular ease-out duration-200 rounded-md outline-none transition-all outline-0 focus-visible:outline-4 focus-visible:outline-offset-1 border hover:bg-surface-300 shadow-none focus-visible:outline-border-strong data-[state=open]:bg-surface-300 data-[state=open]:outline-border-strong border-transparent text-xs px-2.5 py-1 h-[26px] hidden sm:block text-light hover:text-foreground\" href=\"https://supabase.com/privacy\"><span class=\"truncate\">Learn more</span></a></div></div></li></ol></section></body></html>",
      "metadata": {
        "ogUrl": "https://supabase.com/docs/guides/ai/hybrid-search",
        "title": "Hybrid search | Supabase Docs",
        "robots": "index, follow",
        "ogImage": "https://obuldanrptloktxcffvn.supabase.co/functions/v1/og-images?site=docs&type=ai&title=Hybrid%20search&description=Combine%20keyword%20search%20with%20semantic%20search%20to%20get%20both%20direct%20and%20contextual%20results.",
        "ogTitle": "Hybrid search | Supabase Docs",
        "language": "en",
        "sourceURL": "https://supabase.com/docs/guides/ai/hybrid-search",
        "description": "Combine keyword search with semantic search to get both direct and contextual results.",
        "modifiedTime": "2024-09-10T20:36:24.564Z",
        "ogDescription": "Combine keyword search with semantic search to get both direct and contextual results.",
        "publishedTime": "2024-09-10T20:36:24.564Z",
        "ogLocaleAlternate": [],
        "statusCode": 200
      }
    },
    {
      "markdown": "AI & Vectors\n\n# Generating OpenAI GPT3 completions\n\n## Generate GPT text completions using OpenAI and Supabase Edge Functions.\n\n* * *\n\nOpenAI provides a [completions API](https://platform.openai.com/docs/api-reference/completions) that allows you to use their generative GPT models in your own applications.\n\nOpenAI's API is intended to be used from the server-side. Supabase offers Edge Functions to make it easy to interact with third party APIs like OpenAI.\n\n## Setup Supabase project [\\#](\\#setup-supabase-project)\n\nIf you haven't already, [install the Supabase CLI](/docs/guides/cli) and initialize your project:\n\n`\n1\nsupabase init\n`\n\n## Create edge function [\\#](\\#create-edge-function)\n\nScaffold a new edge function called `openai` by running:\n\n`\n1\nsupabase functions new openai\n`\n\nA new edge function will now exist under `./supabase/functions/openai/index.ts`.\n\nWe'll design the function to take your user's query (via POST request) and forward it to OpenAI's API.\n\nindex.ts\n\n`\n1\nimport OpenAI from 'https://deno.land/x/openai@v4.24.0/mod.ts'\n2\n3\nDeno.serve(async (req) => {\n4\nconst { query } = await req.json()\n5\nconst apiKey = Deno.env.get('OPENAI_API_KEY')\n6\nconst openai = new OpenAI({\n7\n    apiKey: apiKey,\n8\n})\n9\n10\n// Documentation here: https://github.com/openai/openai-node\n11\nconst chatCompletion = await openai.chat.completions.create({\n12\n    messages: [{ role: 'user', content: query }],\n13\n    // Choose model from here: https://platform.openai.com/docs/models\n14\n    model: 'gpt-3.5-turbo',\n15\n    stream: false,\n16\n})\n17\n18\nconst reply = chatCompletion.choices[0].message.content\n19\n20\nreturn new Response(reply, {\n21\n    headers: { 'Content-Type': 'text/plain' },\n22\n})\n23\n})\n`\n\nNote that we are setting `stream` to `false` which will wait until the entire response is complete before returning. If you wish to stream GPT's response word-by-word back to your client, set `stream` to `true`.\n\n## Create OpenAI key [\\#](\\#create-openai-key)\n\nYou may have noticed we were passing `OPENAI_API_KEY` in the Authorization header to OpenAI. To generate this key, go to [https://platform.openai.com/account/api-keys](https://platform.openai.com/account/api-keys) and create a new secret key.\n\nAfter getting the key, copy it into a new file called `.env.local` in your `./supabase` folder:\n\n`\n1\nOPENAI_API_KEY=your-key-here\n`\n\n## Run locally [\\#](\\#run-locally)\n\nServe the edge function locally by running:\n\n`\n1\nsupabase functions serve --env-file ./supabase/.env.local --no-verify-jwt\n`\n\nNotice how we are passing in the `.env.local` file.\n\nUse cURL or Postman to make a POST request to [http://localhost:54321/functions/v1/openai](http://localhost:54321/functions/v1/openai).\n\n`\n1\ncurl -i --location --request POST http://localhost:54321/functions/v1/openai \\\n2\n  --header 'Content-Type: application/json' \\\n3\n  --data '{\"query\":\"What is Supabase?\"}'\n`\n\nYou should see a GPT response come back from OpenAI!\n\n## Deploy [\\#](\\#deploy)\n\nDeploy your function to the cloud by runnning:\n\n`\n1\nsupabase functions deploy --no-verify-jwt openai\n2\nsupabase secrets set --env-file ./supabase/.env.local\n`\n\n## Go deeper [\\#](\\#go-deeper)\n\nIf you're interesting in learning how to use this to build your own ChatGPT, read [the blog post](/blog/chatgpt-supabase-docs) and check out the video:\n\nWatch video guide\n\n![Video guide preview](https://supabase.com/docs/_next/image?url=http%3A%2F%2Fimg.youtube.com%2Fvi%2F29p8kIqyU_Y%2F0.jpg&w=3840&q=75&dpl=dpl_8T75GeYs2RqN59z5hY7ru4dxhiVp)\n\n### Is this helpful?\n\nYesNo\n\nThanks for your feedback!\n\nOn this page\n\n- [Setup Supabase project](#setup-supabase-project)\n- [Create edge function](#create-edge-function)\n- [Create OpenAI key](#create-openai-key)\n- [Run locally](#run-locally)\n- [Deploy](#deploy)\n- [Go deeper](#go-deeper)\n\n1. We only collect analytics essential to ensuring smooth operation of our services. [Learn more](https://supabase.com/privacy)\n\n\n\n\n\n   AcceptOpt out[Learn more](https://supabase.com/privacy)",
      "html": "<!DOCTYPE html><html lang=\"en\" data-theme=\"light\" style=\"color-scheme: light;\"><body><div class=\"flex flex-col\"><div class=\"grow\"><div class=\"flex flex-col h-full w-full\"><div class=\"hidden lg:sticky w-full lg:flex top-0 left-0 right-0 z-50\"></div><div class=\"flex flex-row h-full relative\"><main id=\"docs-content-container\" class=\"w-full transition-all ease-out relative lg:ml-0\"><div class=\"flex flex-col sticky top-0\"><div class=\"flex lg:hidden w-full top-0 left-0 right-0 z-50\"></div><div class=\"sticky transition-all top-0 z-10 backdrop-blur backdrop-filter bg-background\"><div class=\"lg:hidden px-3.5 border-b z-10 transition-all ease-out top-0 flex items-center gap-1\"><button class=\"h-8 w-8 flex group items-center justify-center mr-1\"><div class=\"space-y-1 cursor-pointer relative w-4 h-[8px]\"><span class=\"transition-all ease-out block h-px bg-foreground-muted group-hover:bg-foreground w-4\"></span><span class=\"transition-all ease-out block h-px bg-foreground-muted group-hover:bg-foreground w-3 group-hover:w-4\"></span></div></button><span class=\"transition-all duration-200 text-foreground text-sm\">AI &amp; Vectors</span></div></div><div class=\"grow\"><div class=\"max-w-7xl px-5 mx-auto py-8 pb-0\"><div class=\"grid grid-cols-12 relative gap-4\"><div class=\"relative transition-all ease-out duration-100 col-span-12 md:col-span-9\"><article id=\"sb-docs-guide-main-article\" class=\"prose max-w-none\"><h1 class=\"mb-0\">Generating OpenAI GPT3 completions</h1><h2 class=\"mt-3 text-xl text-foreground-light\">Generate GPT text completions using OpenAI and Supabase Edge Functions.</h2><hr class=\"not-prose border-t-0 border-b my-8\">\n<p>OpenAI provides a <a href=\"https://platform.openai.com/docs/api-reference/completions\">completions API</a> that allows you to use their generative GPT models in your own applications.</p>\n<p>OpenAI's API is intended to be used from the server-side. Supabase offers Edge Functions to make it easy to interact with third party APIs like OpenAI.</p>\n<h2 id=\"setup-supabase-project\" class=\"group scroll-mt-24\">Setup Supabase project<a href=\"#setup-supabase-project\" aria-hidden=\"true\" class=\"ml-2 opacity-0 group-hover:opacity-100 transition\"><span aria-hidden=\"true\">#</span></a></h2>\n<p>If you haven't already, <a href=\"/docs/guides/cli\">install the Supabase CLI</a> and initialize your project:</p>\n<div class=\"ch-codeblock not-prose \" data-ch-theme=\"supabase\"><div class=\"ch-code-wrapper ch-code\" data-ch-measured=\"true\"><code class=\"ch-code-scroll-parent\" data-ch-lang=\"shell\" style=\"width: 926px; height: 59px; position: relative; overflow: auto;\"><div class=\"ch-code-scroll-content\" style=\"position: absolute; top: 0px; left: 0px; transform-origin: left top; width: 924px; height: 57px; overflow: hidden;\"><div style=\"position: absolute; top: 0px; left: 0px; transform: translateX(0px) translateY(19px) scale(1); transform-origin: left top; width: 924px; height: 19px;\"><span class=\"ch-code-line-number\" style=\"position: absolute; top: 0px; left: 0px; transform: translate(0px, 0px); width: 31.5px; opacity: 0.99;\">1</span><div style=\"position: absolute; top: 0px; left: 0px; transform: translate(31.5px, 0px); width: 91px;\"><div style=\"display: inline-block; width: 100%;\"><span style=\"opacity: 0.99;\"><span style=\"color: var(--ch-3);\">supabase </span><span style=\"color: var(--ch-8);\">init</span></span><br></div></div></div></div></code><button type=\"button\" title=\"Copy code\" class=\"ch-code-button\"><svg fill=\"none\" stroke=\"currentColor\" viewBox=\"0 0 24 24\" xmlns=\"http://www.w3.org/2000/svg\"><path stroke-linecap=\"round\" stroke-linejoin=\"round\" stroke-width=\"1.6px\" d=\"M8 16H6a2 2 0 01-2-2V6a2 2 0 012-2h8a2 2 0 012 2v2m-6 12h8a2 2 0 002-2v-8a2 2 0 00-2-2h-8a2 2 0 00-2 2v8a2 2 0 002 2z\"></path></svg></button></div></div>\n<h2 id=\"create-edge-function\" class=\"group scroll-mt-24\">Create edge function<a href=\"#create-edge-function\" aria-hidden=\"true\" class=\"ml-2 opacity-0 group-hover:opacity-100 transition\"><span aria-hidden=\"true\">#</span></a></h2>\n<p>Scaffold a new edge function called <code>openai</code> by running:</p>\n<div class=\"ch-codeblock not-prose \" data-ch-theme=\"supabase\"><div class=\"ch-code-wrapper ch-code\" data-ch-measured=\"true\"><code class=\"ch-code-scroll-parent\" data-ch-lang=\"shell\" style=\"width: 926px; height: 59px; position: relative; overflow: auto;\"><div class=\"ch-code-scroll-content\" style=\"position: absolute; top: 0px; left: 0px; transform-origin: left top; width: 924px; height: 57px; overflow: hidden;\"><div style=\"position: absolute; top: 0px; left: 0px; transform: translateX(0px) translateY(19px) scale(1); transform-origin: left top; width: 924px; height: 19px;\"><span class=\"ch-code-line-number\" style=\"position: absolute; top: 0px; left: 0px; transform: translate(0px, 0px); width: 31.5px; opacity: 0.99;\">1</span><div style=\"position: absolute; top: 0px; left: 0px; transform: translate(31.5px, 0px); width: 203px;\"><div style=\"display: inline-block; width: 100%;\"><span style=\"opacity: 0.99;\"><span style=\"color: var(--ch-3);\">supabase </span><span style=\"color: var(--ch-8);\">functions new openai</span></span><br></div></div></div></div></code><button type=\"button\" title=\"Copy code\" class=\"ch-code-button\"><svg fill=\"none\" stroke=\"currentColor\" viewBox=\"0 0 24 24\" xmlns=\"http://www.w3.org/2000/svg\"><path stroke-linecap=\"round\" stroke-linejoin=\"round\" stroke-width=\"1.6px\" d=\"M8 16H6a2 2 0 01-2-2V6a2 2 0 012-2h8a2 2 0 012 2v2m-6 12h8a2 2 0 002-2v-8a2 2 0 00-2-2h-8a2 2 0 00-2 2v8a2 2 0 002 2z\"></path></svg></button></div></div>\n<p>A new edge function will now exist under <code>./supabase/functions/openai/index.ts</code>.</p>\n<p>We'll design the function to take your user's query (via POST request) and forward it to OpenAI's API.</p>\n<div class=\"ch-codegroup not-prose \" data-ch-theme=\"supabase\"><div class=\"ch-editor-frame\" style=\"height: 507px; max-height: 507px;\"><div class=\"ch-frame-title-bar\"><div class=\"ch-frame-buttons\"><div class=\"ch-frame-button ch-frame-button-left\"></div><div class=\"ch-frame-button-space\"></div><div class=\"ch-frame-button ch-frame-button-middle\"></div><div class=\"ch-frame-button-space\"></div><div class=\"ch-frame-button ch-frame-button-right\"></div></div><div title=\"index.ts\" data-ch-tab=\"north\" data-active=\"true\" class=\"ch-editor-tab\"><div><span style=\"opacity:0.5\"></span>index.ts</div></div><div style=\"flex:1;min-width:0.8em\"></div><button type=\"button\" title=\"Copy code\" class=\"ch-editor-button\"><svg fill=\"none\" stroke=\"currentColor\" viewBox=\"0 0 24 24\" xmlns=\"http://www.w3.org/2000/svg\"><path stroke-linecap=\"round\" stroke-linejoin=\"round\" stroke-width=\"1.6px\" d=\"M8 16H6a2 2 0 01-2-2V6a2 2 0 012-2h8a2 2 0 012 2v2m-6 12h8a2 2 0 002-2v-8a2 2 0 00-2-2h-8a2 2 0 00-2 2v8a2 2 0 002 2z\"></path></svg></button></div><div data-ch-panel=\"north\" style=\"flex-grow:1;overflow:hidden\"><div class=\"ch-code-wrapper \" data-ch-measured=\"true\" style=\"height: 100%;\"><code class=\"ch-code-scroll-parent\" data-ch-lang=\"ts\" style=\"width: 924px; height: 475px; position: relative; overflow: auto;\"><div class=\"ch-code-scroll-content\" style=\"position: absolute; top: 0px; left: 0px; transform-origin: left top; width: 924px; height: 475px; overflow: hidden;\"><div style=\"position: absolute; top: 0px; left: 0px; transform: translateX(0px) translateY(19px) scale(1); transform-origin: left top; width: 924px; height: 437px;\"><span class=\"ch-code-line-number\" style=\"position: absolute; top: 0px; left: 0px; transform: translate(0px, 0px); width: 31.5px; opacity: 0.99;\">1</span><div style=\"position: absolute; top: 0px; left: 0px; transform: translate(31.5px, 0px); width: 490px;\"><div style=\"display: inline-block; width: 100%;\"><span style=\"opacity: 0.99;\"><span style=\"color: var(--ch-7);\">import</span><span style=\"color: var(--ch-4);\"> OpenAI </span><span style=\"color: var(--ch-7);\">from </span><span style=\"color: var(--ch-8);\">'https://deno.land/x/openai@v4.24.0/mod.ts'</span></span><br></div></div><span class=\"ch-code-line-number\" style=\"position: absolute; top: 0px; left: 0px; transform: translate(0px, 19px); width: 31.5px; opacity: 0.99;\">2</span><div style=\"position: absolute; top: 0px; left: 0px; transform: translate(31.5px, 19px); width: 490px;\"><div style=\"display: inline-block; width: 100%;\"><span style=\"opacity: 0.99;\"><span style=\"color: var(--ch-4);\"></span></span><br></div></div><span class=\"ch-code-line-number\" style=\"position: absolute; top: 0px; left: 0px; transform: translate(0px, 38px); width: 31.5px; opacity: 0.99;\">3</span><div style=\"position: absolute; top: 0px; left: 0px; transform: translate(31.5px, 38px); width: 490px;\"><div style=\"display: inline-block; width: 100%;\"><span style=\"opacity: 0.99;\"><span style=\"color: var(--ch-4);\">Deno.</span><span style=\"color: var(--ch-5);\">serve</span><span style=\"color: var(--ch-4);\">(</span><span style=\"color: var(--ch-7);\">async</span><span style=\"color: var(--ch-4);\"> (</span><span style=\"color: var(--ch-3);\">req</span><span style=\"color: var(--ch-4);\">) </span><span style=\"color: var(--ch-7);\">=&gt;</span><span style=\"color: var(--ch-4);\"> {</span></span><br></div></div><span class=\"ch-code-line-number\" style=\"position: absolute; top: 0px; left: 0px; transform: translate(0px, 57px); width: 31.5px; opacity: 0.99;\">4</span><div style=\"position: absolute; top: 0px; left: 0px; transform: translate(31.5px, 57px); width: 490px;\"><div style=\"display: inline-block; width: 100%;\"><span style=\"opacity: 0.99;\"><span style=\"color: var(--ch-7);\">  const</span><span style=\"color: var(--ch-4);\"> { </span><span style=\"color: var(--ch-2);\">query</span><span style=\"color: var(--ch-4);\"> } </span><span style=\"color: var(--ch-7);\">= await</span><span style=\"color: var(--ch-4);\"> req.</span><span style=\"color: var(--ch-5);\">json</span><span style=\"color: var(--ch-4);\">()</span></span><br></div></div><span class=\"ch-code-line-number\" style=\"position: absolute; top: 0px; left: 0px; transform: translate(0px, 76px); width: 31.5px; opacity: 0.99;\">5</span><div style=\"position: absolute; top: 0px; left: 0px; transform: translate(31.5px, 76px); width: 490px;\"><div style=\"display: inline-block; width: 100%;\"><span style=\"opacity: 0.99;\"><span style=\"color: var(--ch-7);\">  const </span><span style=\"color: var(--ch-2);\">apiKey </span><span style=\"color: var(--ch-7);\">=</span><span style=\"color: var(--ch-4);\"> Deno.env.</span><span style=\"color: var(--ch-5);\">get</span><span style=\"color: var(--ch-4);\">(</span><span style=\"color: var(--ch-8);\">'OPENAI_API_KEY'</span><span style=\"color: var(--ch-4);\">)</span></span><br></div></div><span class=\"ch-code-line-number\" style=\"position: absolute; top: 0px; left: 0px; transform: translate(0px, 95px); width: 31.5px; opacity: 0.99;\">6</span><div style=\"position: absolute; top: 0px; left: 0px; transform: translate(31.5px, 95px); width: 490px;\"><div style=\"display: inline-block; width: 100%;\"><span style=\"opacity: 0.99;\"><span style=\"color: var(--ch-7);\">  const </span><span style=\"color: var(--ch-2);\">openai </span><span style=\"color: var(--ch-7);\">= new </span><span style=\"color: var(--ch-5);\">OpenAI</span><span style=\"color: var(--ch-4);\">({</span></span><br></div></div><span class=\"ch-code-line-number\" style=\"position: absolute; top: 0px; left: 0px; transform: translate(0px, 114px); width: 31.5px; opacity: 0.99;\">7</span><div style=\"position: absolute; top: 0px; left: 0px; transform: translate(31.5px, 114px); width: 490px;\"><div style=\"display: inline-block; width: 100%;\"><span style=\"opacity: 0.99;\"><span style=\"color: var(--ch-4);\">    apiKey: apiKey,</span></span><br></div></div><span class=\"ch-code-line-number\" style=\"position: absolute; top: 0px; left: 0px; transform: translate(0px, 133px); width: 31.5px; opacity: 0.99;\">8</span><div style=\"position: absolute; top: 0px; left: 0px; transform: translate(31.5px, 133px); width: 490px;\"><div style=\"display: inline-block; width: 100%;\"><span style=\"opacity: 0.99;\"><span style=\"color: var(--ch-4);\">  })</span></span><br></div></div><span class=\"ch-code-line-number\" style=\"position: absolute; top: 0px; left: 0px; transform: translate(0px, 152px); width: 31.5px; opacity: 0.99;\">9</span><div style=\"position: absolute; top: 0px; left: 0px; transform: translate(31.5px, 152px); width: 490px;\"><div style=\"display: inline-block; width: 100%;\"><span style=\"opacity: 0.99;\"><span style=\"color: var(--ch-4);\"></span></span><br></div></div><span class=\"ch-code-line-number\" style=\"position: absolute; top: 0px; left: 0px; transform: translate(0px, 171px); width: 31.5px; opacity: 0.99;\">10</span><div style=\"position: absolute; top: 0px; left: 0px; transform: translate(31.5px, 171px); width: 490px;\"><div style=\"display: inline-block; width: 100%;\"><span style=\"opacity: 0.99;\"><span style=\"color: var(--ch-1);\">  // Documentation here: https://github.com/openai/openai-node</span></span><br></div></div><span class=\"ch-code-line-number\" style=\"position: absolute; top: 0px; left: 0px; transform: translate(0px, 190px); width: 31.5px; opacity: 0.99;\">11</span><div style=\"position: absolute; top: 0px; left: 0px; transform: translate(31.5px, 190px); width: 490px;\"><div style=\"display: inline-block; width: 100%;\"><span style=\"opacity: 0.99;\"><span style=\"color: var(--ch-7);\">  const </span><span style=\"color: var(--ch-2);\">chatCompletion </span><span style=\"color: var(--ch-7);\">= await</span><span style=\"color: var(--ch-4);\"> openai.chat.completions.</span><span style=\"color: var(--ch-5);\">create</span><span style=\"color: var(--ch-4);\">({</span></span><br></div></div><span class=\"ch-code-line-number\" style=\"position: absolute; top: 0px; left: 0px; transform: translate(0px, 209px); width: 31.5px; opacity: 0.99;\">12</span><div style=\"position: absolute; top: 0px; left: 0px; transform: translate(31.5px, 209px); width: 490px;\"><div style=\"display: inline-block; width: 100%;\"><span style=\"opacity: 0.99;\"><span style=\"color: var(--ch-4);\">    messages: [{ role: </span><span style=\"color: var(--ch-8);\">'user'</span><span style=\"color: var(--ch-4);\">, content: query }],</span></span><br></div></div><span class=\"ch-code-line-number\" style=\"position: absolute; top: 0px; left: 0px; transform: translate(0px, 228px); width: 31.5px; opacity: 0.99;\">13</span><div style=\"position: absolute; top: 0px; left: 0px; transform: translate(31.5px, 228px); width: 490px;\"><div style=\"display: inline-block; width: 100%;\"><span style=\"opacity: 0.99;\"><span style=\"color: var(--ch-1);\">    // Choose model from here: https://platform.openai.com/docs/models</span></span><br></div></div><span class=\"ch-code-line-number\" style=\"position: absolute; top: 0px; left: 0px; transform: translate(0px, 247px); width: 31.5px; opacity: 0.99;\">14</span><div style=\"position: absolute; top: 0px; left: 0px; transform: translate(31.5px, 247px); width: 490px;\"><div style=\"display: inline-block; width: 100%;\"><span style=\"opacity: 0.99;\"><span style=\"color: var(--ch-4);\">    model: </span><span style=\"color: var(--ch-8);\">'gpt-3.5-turbo'</span><span style=\"color: var(--ch-4);\">,</span></span><br></div></div><span class=\"ch-code-line-number\" style=\"position: absolute; top: 0px; left: 0px; transform: translate(0px, 266px); width: 31.5px; opacity: 0.99;\">15</span><div style=\"position: absolute; top: 0px; left: 0px; transform: translate(31.5px, 266px); width: 490px;\"><div style=\"display: inline-block; width: 100%;\"><span style=\"opacity: 0.99;\"><span style=\"color: var(--ch-4);\">    stream: </span><span style=\"color: var(--ch-2);\">false</span><span style=\"color: var(--ch-4);\">,</span></span><br></div></div><span class=\"ch-code-line-number\" style=\"position: absolute; top: 0px; left: 0px; transform: translate(0px, 285px); width: 31.5px; opacity: 0.99;\">16</span><div style=\"position: absolute; top: 0px; left: 0px; transform: translate(31.5px, 285px); width: 490px;\"><div style=\"display: inline-block; width: 100%;\"><span style=\"opacity: 0.99;\"><span style=\"color: var(--ch-4);\">  })</span></span><br></div></div><span class=\"ch-code-line-number\" style=\"position: absolute; top: 0px; left: 0px; transform: translate(0px, 304px); width: 31.5px; opacity: 0.99;\">17</span><div style=\"position: absolute; top: 0px; left: 0px; transform: translate(31.5px, 304px); width: 490px;\"><div style=\"display: inline-block; width: 100%;\"><span style=\"opacity: 0.99;\"><span style=\"color: var(--ch-4);\"></span></span><br></div></div><span class=\"ch-code-line-number\" style=\"position: absolute; top: 0px; left: 0px; transform: translate(0px, 323px); width: 31.5px; opacity: 0.99;\">18</span><div style=\"position: absolute; top: 0px; left: 0px; transform: translate(31.5px, 323px); width: 490px;\"><div style=\"display: inline-block; width: 100%;\"><span style=\"opacity: 0.99;\"><span style=\"color: var(--ch-7);\">  const </span><span style=\"color: var(--ch-2);\">reply </span><span style=\"color: var(--ch-7);\">=</span><span style=\"color: var(--ch-4);\"> chatCompletion.choices[</span><span style=\"color: var(--ch-2);\">0</span><span style=\"color: var(--ch-4);\">].message.content</span></span><br></div></div><span class=\"ch-code-line-number\" style=\"position: absolute; top: 0px; left: 0px; transform: translate(0px, 342px); width: 31.5px; opacity: 0.99;\">19</span><div style=\"position: absolute; top: 0px; left: 0px; transform: translate(31.5px, 342px); width: 490px;\"><div style=\"display: inline-block; width: 100%;\"><span style=\"opacity: 0.99;\"><span style=\"color: var(--ch-4);\"></span></span><br></div></div><span class=\"ch-code-line-number\" style=\"position: absolute; top: 0px; left: 0px; transform: translate(0px, 361px); width: 31.5px; opacity: 0.99;\">20</span><div style=\"position: absolute; top: 0px; left: 0px; transform: translate(31.5px, 361px); width: 490px;\"><div style=\"display: inline-block; width: 100%;\"><span style=\"opacity: 0.99;\"><span style=\"color: var(--ch-7);\">  return new </span><span style=\"color: var(--ch-5);\">Response</span><span style=\"color: var(--ch-4);\">(reply, {</span></span><br></div></div><span class=\"ch-code-line-number\" style=\"position: absolute; top: 0px; left: 0px; transform: translate(0px, 380px); width: 31.5px; opacity: 0.99;\">21</span><div style=\"position: absolute; top: 0px; left: 0px; transform: translate(31.5px, 380px); width: 490px;\"><div style=\"display: inline-block; width: 100%;\"><span style=\"opacity: 0.99;\"><span style=\"color: var(--ch-4);\">    headers: { </span><span style=\"color: var(--ch-8);\">'Content-Type'</span><span style=\"color: var(--ch-4);\">: </span><span style=\"color: var(--ch-8);\">'text/plain'</span><span style=\"color: var(--ch-4);\"> },</span></span><br></div></div><span class=\"ch-code-line-number\" style=\"position: absolute; top: 0px; left: 0px; transform: translate(0px, 399px); width: 31.5px; opacity: 0.99;\">22</span><div style=\"position: absolute; top: 0px; left: 0px; transform: translate(31.5px, 399px); width: 490px;\"><div style=\"display: inline-block; width: 100%;\"><span style=\"opacity: 0.99;\"><span style=\"color: var(--ch-4);\">  })</span></span><br></div></div><span class=\"ch-code-line-number\" style=\"position: absolute; top: 0px; left: 0px; transform: translate(0px, 418px); width: 31.5px; opacity: 0.99;\">23</span><div style=\"position: absolute; top: 0px; left: 0px; transform: translate(31.5px, 418px); width: 490px;\"><div style=\"display: inline-block; width: 100%;\"><span style=\"opacity: 0.99;\"><span style=\"color: var(--ch-4);\">})</span></span><br></div></div></div></div></code></div></div></div></div>\n<p>Note that we are setting <code>stream</code> to <code>false</code> which will wait until the entire response is complete before returning. If you wish to stream GPT's response word-by-word back to your client, set <code>stream</code> to <code>true</code>.</p>\n<h2 id=\"create-openai-key\" class=\"group scroll-mt-24\">Create OpenAI key<a href=\"#create-openai-key\" aria-hidden=\"true\" class=\"ml-2 opacity-0 group-hover:opacity-100 transition\"><span aria-hidden=\"true\">#</span></a></h2>\n<p>You may have noticed we were passing <code>OPENAI_API_KEY</code> in the Authorization header to OpenAI. To generate this key, go to <a href=\"https://platform.openai.com/account/api-keys\">https://platform.openai.com/account/api-keys</a> and create a new secret key.</p>\n<p>After getting the key, copy it into a new file called <code>.env.local</code> in your <code>./supabase</code> folder:</p>\n<div class=\"ch-codeblock not-prose \" data-ch-theme=\"supabase\"><div class=\"ch-code-wrapper ch-code\" data-ch-measured=\"true\"><code class=\"ch-code-scroll-parent\" data-ch-lang=\"text\" style=\"width: 926px; height: 59px; position: relative; overflow: auto;\"><div class=\"ch-code-scroll-content\" style=\"position: absolute; top: 0px; left: 0px; transform-origin: left top; width: 924px; height: 57px; overflow: hidden;\"><div style=\"position: absolute; top: 0px; left: 0px; transform: translateX(0px) translateY(19px) scale(1); transform-origin: left top; width: 924px; height: 19px;\"><span class=\"ch-code-line-number\" style=\"position: absolute; top: 0px; left: 0px; transform: translate(0px, 0px); width: 31.5px; opacity: 0.99;\">1</span><div style=\"position: absolute; top: 0px; left: 0px; transform: translate(31.5px, 0px); width: 196px;\"><div style=\"display: inline-block; width: 100%;\"><span style=\"opacity: 0.99;\"><span>OPENAI_API_KEY=your-key-here</span></span><br></div></div></div></div></code><button type=\"button\" title=\"Copy code\" class=\"ch-code-button\"><svg fill=\"none\" stroke=\"currentColor\" viewBox=\"0 0 24 24\" xmlns=\"http://www.w3.org/2000/svg\"><path stroke-linecap=\"round\" stroke-linejoin=\"round\" stroke-width=\"1.6px\" d=\"M8 16H6a2 2 0 01-2-2V6a2 2 0 012-2h8a2 2 0 012 2v2m-6 12h8a2 2 0 002-2v-8a2 2 0 00-2-2h-8a2 2 0 00-2 2v8a2 2 0 002 2z\"></path></svg></button></div></div>\n<h2 id=\"run-locally\" class=\"group scroll-mt-24\">Run locally<a href=\"#run-locally\" aria-hidden=\"true\" class=\"ml-2 opacity-0 group-hover:opacity-100 transition\"><span aria-hidden=\"true\">#</span></a></h2>\n<p>Serve the edge function locally by running:</p>\n<div class=\"ch-codeblock not-prose \" data-ch-theme=\"supabase\"><div class=\"ch-code-wrapper ch-code\" data-ch-measured=\"true\"><code class=\"ch-code-scroll-parent\" data-ch-lang=\"bash\" style=\"width: 926px; height: 59px; position: relative; overflow: auto;\"><div class=\"ch-code-scroll-content\" style=\"position: absolute; top: 0px; left: 0px; transform-origin: left top; width: 924px; height: 57px; overflow: hidden;\"><div style=\"position: absolute; top: 0px; left: 0px; transform: translateX(0px) translateY(19px) scale(1); transform-origin: left top; width: 924px; height: 19px;\"><span class=\"ch-code-line-number\" style=\"position: absolute; top: 0px; left: 0px; transform: translate(0px, 0px); width: 31.5px; opacity: 0.99;\">1</span><div style=\"position: absolute; top: 0px; left: 0px; transform: translate(31.5px, 0px); width: 511px;\"><div style=\"display: inline-block; width: 100%;\"><span style=\"opacity: 0.99;\"><span style=\"color: var(--ch-3);\">supabase </span><span style=\"color: var(--ch-8);\">functions serve </span><span style=\"color: var(--ch-2);\">--env-file </span><span style=\"color: var(--ch-8);\">./supabase/.env.local </span><span style=\"color: var(--ch-2);\">--no-verify-jwt</span></span><br></div></div></div></div></code><button type=\"button\" title=\"Copy code\" class=\"ch-code-button\"><svg fill=\"none\" stroke=\"currentColor\" viewBox=\"0 0 24 24\" xmlns=\"http://www.w3.org/2000/svg\"><path stroke-linecap=\"round\" stroke-linejoin=\"round\" stroke-width=\"1.6px\" d=\"M8 16H6a2 2 0 01-2-2V6a2 2 0 012-2h8a2 2 0 012 2v2m-6 12h8a2 2 0 002-2v-8a2 2 0 00-2-2h-8a2 2 0 00-2 2v8a2 2 0 002 2z\"></path></svg></button></div></div>\n<p>Notice how we are passing in the <code>.env.local</code> file.</p>\n<p>Use cURL or Postman to make a POST request to <a href=\"http://localhost:54321/functions/v1/openai\">http://localhost:54321/functions/v1/openai</a>.</p>\n<div class=\"ch-codeblock not-prose \" data-ch-theme=\"supabase\"><div class=\"ch-code-wrapper ch-code\" data-ch-measured=\"true\"><code class=\"ch-code-scroll-parent\" data-ch-lang=\"bash\" style=\"width: 926px; height: 97px; position: relative; overflow: auto;\"><div class=\"ch-code-scroll-content\" style=\"position: absolute; top: 0px; left: 0px; transform-origin: left top; width: 924px; height: 95px; overflow: hidden;\"><div style=\"position: absolute; top: 0px; left: 0px; transform: translateX(0px) translateY(19px) scale(1); transform-origin: left top; width: 924px; height: 57px;\"><span class=\"ch-code-line-number\" style=\"position: absolute; top: 0px; left: 0px; transform: translate(0px, 0px); width: 31.5px; opacity: 0.99;\">1</span><div style=\"position: absolute; top: 0px; left: 0px; transform: translate(31.5px, 0px); width: 546px;\"><div style=\"display: inline-block; width: 100%;\"><span style=\"opacity: 0.99;\"><span style=\"color: var(--ch-3);\">curl </span><span style=\"color: var(--ch-2);\">-i --location --request </span><span style=\"color: var(--ch-8);\">POST http://localhost:54321/functions/v1/openai </span><span style=\"color: var(--ch-2);\">\\</span></span><br></div></div><span class=\"ch-code-line-number\" style=\"position: absolute; top: 0px; left: 0px; transform: translate(0px, 19px); width: 31.5px; opacity: 0.99;\">2</span><div style=\"position: absolute; top: 0px; left: 0px; transform: translate(31.5px, 19px); width: 546px;\"><div style=\"display: inline-block; width: 100%;\"><span style=\"opacity: 0.99;\"><span style=\"color: var(--ch-2);\">  --header </span><span style=\"color: var(--ch-8);\">'Content-Type: application/json' </span><span style=\"color: var(--ch-2);\">\\</span></span><br></div></div><span class=\"ch-code-line-number\" style=\"position: absolute; top: 0px; left: 0px; transform: translate(0px, 38px); width: 31.5px; opacity: 0.99;\">3</span><div style=\"position: absolute; top: 0px; left: 0px; transform: translate(31.5px, 38px); width: 546px;\"><div style=\"display: inline-block; width: 100%;\"><span style=\"opacity: 0.99;\"><span style=\"color: var(--ch-2);\">  --data </span><span style=\"color: var(--ch-8);\">'{\"query\":\"What is Supabase?\"}'</span></span><br></div></div></div></div></code><button type=\"button\" title=\"Copy code\" class=\"ch-code-button\"><svg fill=\"none\" stroke=\"currentColor\" viewBox=\"0 0 24 24\" xmlns=\"http://www.w3.org/2000/svg\"><path stroke-linecap=\"round\" stroke-linejoin=\"round\" stroke-width=\"1.6px\" d=\"M8 16H6a2 2 0 01-2-2V6a2 2 0 012-2h8a2 2 0 012 2v2m-6 12h8a2 2 0 002-2v-8a2 2 0 00-2-2h-8a2 2 0 00-2 2v8a2 2 0 002 2z\"></path></svg></button></div></div>\n<p>You should see a GPT response come back from OpenAI!</p>\n<h2 id=\"deploy\" class=\"group scroll-mt-24\">Deploy<a href=\"#deploy\" aria-hidden=\"true\" class=\"ml-2 opacity-0 group-hover:opacity-100 transition\"><span aria-hidden=\"true\">#</span></a></h2>\n<p>Deploy your function to the cloud by runnning:</p>\n<div class=\"ch-codeblock not-prose \" data-ch-theme=\"supabase\"><div class=\"ch-code-wrapper ch-code\" data-ch-measured=\"true\"><code class=\"ch-code-scroll-parent\" data-ch-lang=\"bash\" style=\"width: 926px; height: 78px; position: relative; overflow: auto;\"><div class=\"ch-code-scroll-content\" style=\"position: absolute; top: 0px; left: 0px; transform-origin: left top; width: 924px; height: 76px; overflow: hidden;\"><div style=\"position: absolute; top: 0px; left: 0px; transform: translateX(0px) translateY(19px) scale(1); transform-origin: left top; width: 924px; height: 38px;\"><span class=\"ch-code-line-number\" style=\"position: absolute; top: 0px; left: 0px; transform: translate(0px, 0px); width: 31.5px; opacity: 0.99;\">1</span><div style=\"position: absolute; top: 0px; left: 0px; transform: translate(31.5px, 0px); width: 371px;\"><div style=\"display: inline-block; width: 100%;\"><span style=\"opacity: 0.99;\"><span style=\"color: var(--ch-3);\">supabase </span><span style=\"color: var(--ch-8);\">functions deploy </span><span style=\"color: var(--ch-2);\">--no-verify-jwt </span><span style=\"color: var(--ch-8);\">openai</span></span><br></div></div><span class=\"ch-code-line-number\" style=\"position: absolute; top: 0px; left: 0px; transform: translate(0px, 19px); width: 31.5px; opacity: 0.99;\">2</span><div style=\"position: absolute; top: 0px; left: 0px; transform: translate(31.5px, 19px); width: 371px;\"><div style=\"display: inline-block; width: 100%;\"><span style=\"opacity: 0.99;\"><span style=\"color: var(--ch-3);\">supabase </span><span style=\"color: var(--ch-8);\">secrets set </span><span style=\"color: var(--ch-2);\">--env-file </span><span style=\"color: var(--ch-8);\">./supabase/.env.local</span></span><br></div></div></div></div></code><button type=\"button\" title=\"Copy code\" class=\"ch-code-button\"><svg fill=\"none\" stroke=\"currentColor\" viewBox=\"0 0 24 24\" xmlns=\"http://www.w3.org/2000/svg\"><path stroke-linecap=\"round\" stroke-linejoin=\"round\" stroke-width=\"1.6px\" d=\"M8 16H6a2 2 0 01-2-2V6a2 2 0 012-2h8a2 2 0 012 2v2m-6 12h8a2 2 0 002-2v-8a2 2 0 00-2-2h-8a2 2 0 00-2 2v8a2 2 0 002 2z\"></path></svg></button></div></div>\n<h2 id=\"go-deeper\" class=\"group scroll-mt-24\">Go deeper<a href=\"#go-deeper\" aria-hidden=\"true\" class=\"ml-2 opacity-0 group-hover:opacity-100 transition\"><span aria-hidden=\"true\">#</span></a></h2>\n<p>If you're interesting in learning how to use this to build your own ChatGPT, read <a href=\"/blog/chatgpt-supabase-docs\">the blog post</a> and check out the video:</p>\n<div class=\"video-container\"></div></article></div><div class=\"border-l thin-scrollbar overflow-y-auto px-2 hidden md:block col-span-3 self-start sticky top-[calc(var(--header-height)+1px+2rem)] max-h-[calc(100vh-var(--header-height)-3rem)]\"><div class=\"relative mb-6 pl-5\"><button class=\"w-full\"><div class=\"video-container overflow-hidden rounded hover:cursor-pointer\"><div class=\" absolute inset-0 z-10 text-white flex flex-col gap-3 items-center justify-center before:content[''] before:absolute before:inset-0 before:bg-black before:opacity-30 before:-z-10 hover:before:opacity-50 before:transition-opacity \"><svg xmlns=\"http://www.w3.org/2000/svg\" width=\"24\" height=\"24\" viewBox=\"0 0 24 24\" fill=\"none\" stroke=\"currentColor\" stroke-width=\"2\" stroke-linecap=\"round\" stroke-linejoin=\"round\" class=\"lucide lucide-play w-5 h-5\"><polygon points=\"6 3 20 12 6 21 6 3\"></polygon></svg><p class=\"text-sm\">Watch video guide</p></div><img alt=\"Video guide preview\" loading=\"lazy\" decoding=\"async\" data-nimg=\"fill\" class=\"absolute inset-0 object-cover blur-sm scale-105\" sizes=\"100%\" srcset=\"/docs/_next/image?url=http%3A%2F%2Fimg.youtube.com%2Fvi%2F29p8kIqyU_Y%2F0.jpg&amp;w=16&amp;q=75&amp;dpl=dpl_8T75GeYs2RqN59z5hY7ru4dxhiVp 16w, /docs/_next/image?url=http%3A%2F%2Fimg.youtube.com%2Fvi%2F29p8kIqyU_Y%2F0.jpg&amp;w=32&amp;q=75&amp;dpl=dpl_8T75GeYs2RqN59z5hY7ru4dxhiVp 32w, /docs/_next/image?url=http%3A%2F%2Fimg.youtube.com%2Fvi%2F29p8kIqyU_Y%2F0.jpg&amp;w=48&amp;q=75&amp;dpl=dpl_8T75GeYs2RqN59z5hY7ru4dxhiVp 48w, /docs/_next/image?url=http%3A%2F%2Fimg.youtube.com%2Fvi%2F29p8kIqyU_Y%2F0.jpg&amp;w=64&amp;q=75&amp;dpl=dpl_8T75GeYs2RqN59z5hY7ru4dxhiVp 64w, /docs/_next/image?url=http%3A%2F%2Fimg.youtube.com%2Fvi%2F29p8kIqyU_Y%2F0.jpg&amp;w=96&amp;q=75&amp;dpl=dpl_8T75GeYs2RqN59z5hY7ru4dxhiVp 96w, /docs/_next/image?url=http%3A%2F%2Fimg.youtube.com%2Fvi%2F29p8kIqyU_Y%2F0.jpg&amp;w=128&amp;q=75&amp;dpl=dpl_8T75GeYs2RqN59z5hY7ru4dxhiVp 128w, /docs/_next/image?url=http%3A%2F%2Fimg.youtube.com%2Fvi%2F29p8kIqyU_Y%2F0.jpg&amp;w=256&amp;q=75&amp;dpl=dpl_8T75GeYs2RqN59z5hY7ru4dxhiVp 256w, /docs/_next/image?url=http%3A%2F%2Fimg.youtube.com%2Fvi%2F29p8kIqyU_Y%2F0.jpg&amp;w=384&amp;q=75&amp;dpl=dpl_8T75GeYs2RqN59z5hY7ru4dxhiVp 384w, /docs/_next/image?url=http%3A%2F%2Fimg.youtube.com%2Fvi%2F29p8kIqyU_Y%2F0.jpg&amp;w=640&amp;q=75&amp;dpl=dpl_8T75GeYs2RqN59z5hY7ru4dxhiVp 640w, /docs/_next/image?url=http%3A%2F%2Fimg.youtube.com%2Fvi%2F29p8kIqyU_Y%2F0.jpg&amp;w=750&amp;q=75&amp;dpl=dpl_8T75GeYs2RqN59z5hY7ru4dxhiVp 750w, /docs/_next/image?url=http%3A%2F%2Fimg.youtube.com%2Fvi%2F29p8kIqyU_Y%2F0.jpg&amp;w=828&amp;q=75&amp;dpl=dpl_8T75GeYs2RqN59z5hY7ru4dxhiVp 828w, /docs/_next/image?url=http%3A%2F%2Fimg.youtube.com%2Fvi%2F29p8kIqyU_Y%2F0.jpg&amp;w=1080&amp;q=75&amp;dpl=dpl_8T75GeYs2RqN59z5hY7ru4dxhiVp 1080w, /docs/_next/image?url=http%3A%2F%2Fimg.youtube.com%2Fvi%2F29p8kIqyU_Y%2F0.jpg&amp;w=1200&amp;q=75&amp;dpl=dpl_8T75GeYs2RqN59z5hY7ru4dxhiVp 1200w, /docs/_next/image?url=http%3A%2F%2Fimg.youtube.com%2Fvi%2F29p8kIqyU_Y%2F0.jpg&amp;w=1920&amp;q=75&amp;dpl=dpl_8T75GeYs2RqN59z5hY7ru4dxhiVp 1920w, /docs/_next/image?url=http%3A%2F%2Fimg.youtube.com%2Fvi%2F29p8kIqyU_Y%2F0.jpg&amp;w=2048&amp;q=75&amp;dpl=dpl_8T75GeYs2RqN59z5hY7ru4dxhiVp 2048w, /docs/_next/image?url=http%3A%2F%2Fimg.youtube.com%2Fvi%2F29p8kIqyU_Y%2F0.jpg&amp;w=3840&amp;q=75&amp;dpl=dpl_8T75GeYs2RqN59z5hY7ru4dxhiVp 3840w\" src=\"/docs/_next/image?url=http%3A%2F%2Fimg.youtube.com%2Fvi%2F29p8kIqyU_Y%2F0.jpg&amp;w=3840&amp;q=75&amp;dpl=dpl_8T75GeYs2RqN59z5hY7ru4dxhiVp\" style=\"position: absolute; height: 100%; width: 100%; inset: 0px; color: transparent;\"></div></button></div><section class=\"@container px-5 mb-6\" aria-labelledby=\"feedback-title\"><h3 id=\"feedback-title\" class=\"block font-mono text-xs uppercase text-foreground mb-4\">Is this helpful?</h3><div class=\"relative flex flex-col gap-y-4 mb-2 @[12rem]:flex-row @[12rem]:items-center\"><div class=\"relative flex gap-[var(--container-flex-gap)] items-center\" style=\"--container-flex-gap: 0.5rem;\"><button data-size=\"tiny\" type=\"button\" class=\"relative justify-center cursor-pointer inline-flex items-center space-x-2 text-center font-regular ease-out duration-200 outline-none transition-all outline-0 focus-visible:outline-4 focus-visible:outline-offset-1 border text-foreground bg-transparent border-strong focus-visible:outline-border-strong data-[state=open]:border-stronger data-[state=open]:outline-border-strong text-xs py-1 h-[26px] rounded-full px-1 hover:text-brand-600 hover:border-brand-500 [transition-property:opacity,transform,color] [transition-duration:150ms,300ms,300ms] motion-reduce:[transition-duration:150ms,1ms,300ms]\"> <span class=\"truncate\"><svg xmlns=\"http://www.w3.org/2000/svg\" width=\"14\" height=\"14\" viewBox=\"0 0 24 24\" fill=\"none\" stroke=\"currentColor\" stroke-width=\"3\" stroke-linecap=\"round\" stroke-linejoin=\"round\" class=\"lucide lucide-check\"><path d=\"M20 6 9 17l-5-5\"></path></svg><span class=\"sr-only\">Yes</span></span> </button><button data-size=\"tiny\" type=\"button\" class=\"relative justify-center cursor-pointer inline-flex items-center space-x-2 text-center font-regular ease-out duration-200 outline-none transition-all outline-0 focus-visible:outline-4 focus-visible:outline-offset-1 border text-foreground bg-transparent border-strong focus-visible:outline-border-strong data-[state=open]:border-stronger data-[state=open]:outline-border-strong text-xs py-1 h-[26px] rounded-full px-1 hover:text-warning-600 hover:border-warning-500 [transition-property:opacity,transform,color] [transition-duration:150ms,300ms,300ms] motion-reduce:[transition-duration:150ms,1ms,300ms]\"> <span class=\"truncate\"><svg xmlns=\"http://www.w3.org/2000/svg\" width=\"14\" height=\"14\" viewBox=\"0 0 24 24\" fill=\"none\" stroke=\"currentColor\" stroke-width=\"3\" stroke-linecap=\"round\" stroke-linejoin=\"round\" class=\"lucide lucide-x\"><path d=\"M18 6 6 18\"></path><path d=\"m6 6 12 12\"></path></svg><span class=\"sr-only\">No</span></span> </button></div><div class=\"flex flex-col gap-1 text-xs opacity-0 invisible text-left -translate-x-[0.25rem] @[12rem]:-translate-x-[1.25rem] [transition-property:opacity,transform] [transition-duration:150ms,300ms] motion-reduce:[transition-duration:150ms,1ms] delay-300\"><span class=\"text-foreground-light\">Thanks for your feedback!</span></div></div></section><span class=\"block font-mono text-xs uppercase text-foreground px-5 mb-6\">On this page</span><ul class=\"toc-menu list-none pl-5 text-[0.8rem] grid gap-2\"><li class=\"\"><a href=\"#setup-supabase-project\" class=\"text-foreground-lighter hover:text-brand-link transition-colors\">Setup Supabase project</a></li><li class=\"\"><a href=\"#create-edge-function\" class=\"text-foreground-lighter hover:text-brand-link transition-colors\">Create edge function</a></li><li class=\"\"><a href=\"#create-openai-key\" class=\"text-foreground-lighter hover:text-brand-link transition-colors\">Create OpenAI key</a></li><li class=\"\"><a href=\"#run-locally\" class=\"text-foreground-lighter hover:text-brand-link transition-colors\">Run locally</a></li><li class=\"\"><a href=\"#deploy\" class=\"text-foreground-lighter hover:text-brand-link transition-colors\">Deploy</a></li><li class=\"\"><a href=\"#go-deeper\" class=\"text-foreground-lighter hover:text-brand-link transition-colors\">Go deeper</a></li></ul></div></div></div><div class=\"max-w-7xl px-5 mx-auto py-8 pt-0\"></div></div><div class=\"left-0 right-0 z-10 backdrop-blur-sm backdrop-filter bg-alternative/90 hidden h-0 lg:hidden\"></div></div></main></div></div></div></div><next-route-announcer style=\"position: absolute;\"></next-route-announcer><section aria-label=\"Notifications alt+T\" tabindex=\"-1\"><ol dir=\"ltr\" tabindex=\"-1\" class=\"toaster group pointer-events-auto\" data-sonner-toaster=\"true\" data-theme=\"light\" data-y-position=\"top\" data-x-position=\"right\" style=\"--front-toast-height: 112px; --offset: 32px; --width: 356px; --gap: 14px; font-family: inherit;\"></ol><ol dir=\"ltr\" tabindex=\"-1\" class=\"toaster group pointer-events-auto\" data-sonner-toaster=\"true\" data-theme=\"light\" data-y-position=\"bottom\" data-x-position=\"right\" style=\"--front-toast-height: 112px; --offset: 32px; --width: 356px; --gap: 14px; font-family: inherit;\"><li aria-live=\"polite\" aria-atomic=\"true\" role=\"status\" tabindex=\"0\" class=\"group toast w-full rounded-md py-3 px-5 flex gap-2 items-start font-normal text-sm group-[.toaster]:bg-overlay group-[.toaster]:text-foreground group-[.toaster]:border group-[.toaster]:border-overlay group-[.toaster]:shadow-lg\" data-sonner-toast=\"\" data-styled=\"false\" data-mounted=\"true\" data-promise=\"false\" data-removed=\"false\" data-visible=\"true\" data-y-position=\"bottom\" data-x-position=\"right\" data-index=\"0\" data-front=\"true\" data-swiping=\"false\" data-dismissible=\"true\" data-swipe-out=\"false\" data-expanded=\"false\" style=\"--index: 0; --toasts-before: 0; --z-index: 1; --offset: 0px; --initial-height: 112px;\"><button aria-label=\"Close toast\" data-disabled=\"false\" data-close-button=\"true\" class=\"absolute right-2 top-2 rounded-md text-foreground/50 opacity-0 transition-opacity hover:text-foreground focus:opacity-100 focus:outline-none focus:ring-2 group-hover:opacity-100 group-[.destructive]:text-destructive-300 group-[.destructive]:hover:text-destructive-50 group-[.destructive]:focus:ring-destructive-400 group-[.destructive]:focus:ring-offset-destructive-600 left-auto transform-none bg-transparent border-0 border-transparent hover:!bg-transparent hover:border-transparent\"><svg xmlns=\"http://www.w3.org/2000/svg\" width=\"12\" height=\"12\" viewBox=\"0 0 24 24\" fill=\"none\" stroke=\"currentColor\" stroke-width=\"1.5\" stroke-linecap=\"round\" stroke-linejoin=\"round\"><line x1=\"18\" y1=\"6\" x2=\"6\" y2=\"18\"></line><line x1=\"6\" y1=\"6\" x2=\"18\" y2=\"18\"></line></svg></button><div class=\"space-y-3 py-1 flex flex-col w-full\"><div><p class=\"text-foreground\">We only collect analytics essential to ensuring smooth operation of our services. <a class=\"inline sm:hidden underline text-light\" target=\"_blank\" rel=\"noreferrer\" href=\"https://supabase.com/privacy\">Learn more</a></p></div><div class=\"flex items-center space-x-2\"><button data-size=\"tiny\" type=\"button\" class=\"relative justify-center cursor-pointer inline-flex items-center space-x-2 text-center font-regular ease-out duration-200 rounded-md outline-none transition-all outline-0 focus-visible:outline-4 focus-visible:outline-offset-1 border text-foreground bg-alternative dark:bg-muted hover:bg-selection border-strong hover:border-stronger focus-visible:outline-brand-600 data-[state=open]:bg-selection data-[state=open]:outline-brand-600 data-[state=open]:border-button-hover text-xs px-2.5 py-1 h-[26px]\"> <span class=\"truncate\">Accept</span> </button><button data-size=\"tiny\" type=\"button\" class=\"relative justify-center cursor-pointer inline-flex items-center space-x-2 text-center font-regular ease-out duration-200 rounded-md outline-none transition-all outline-0 focus-visible:outline-4 focus-visible:outline-offset-1 border text-foreground hover:bg-surface-300 shadow-none focus-visible:outline-border-strong data-[state=open]:bg-surface-300 data-[state=open]:outline-border-strong border-transparent text-xs px-2.5 py-1 h-[26px]\"> <span class=\"truncate\">Opt out</span> </button><a target=\"_blank\" rel=\"noreferrer\" data-size=\"tiny\" type=\"button\" class=\"relative justify-center cursor-pointer items-center space-x-2 text-center font-regular ease-out duration-200 rounded-md outline-none transition-all outline-0 focus-visible:outline-4 focus-visible:outline-offset-1 border hover:bg-surface-300 shadow-none focus-visible:outline-border-strong data-[state=open]:bg-surface-300 data-[state=open]:outline-border-strong border-transparent text-xs px-2.5 py-1 h-[26px] hidden sm:block text-light hover:text-foreground\" href=\"https://supabase.com/privacy\"><span class=\"truncate\">Learn more</span></a></div></div></li></ol></section></body></html>",
      "metadata": {
        "ogUrl": "https://supabase.com/docs/guides/ai/examples/openai",
        "title": "Generating OpenAI GPT3 completions | Supabase Docs",
        "robots": "index, follow",
        "ogImage": "https://obuldanrptloktxcffvn.supabase.co/functions/v1/og-images?site=docs&type=ai&title=Generating%20OpenAI%20GPT3%20completions&description=Generate%20GPT%20text%20completions%20using%20OpenAI%20and%20Supabase%20Edge%20Functions.",
        "ogTitle": "Generating OpenAI GPT3 completions | Supabase Docs",
        "language": "en",
        "sourceURL": "https://supabase.com/docs/guides/ai/examples/openai",
        "description": "Generate GPT text completions using OpenAI and Supabase Edge Functions.",
        "modifiedTime": "2024-09-10T20:36:24.980Z",
        "ogDescription": "Generate GPT text completions using OpenAI and Supabase Edge Functions.",
        "publishedTime": "2024-09-10T20:36:24.980Z",
        "ogLocaleAlternate": [],
        "statusCode": 200
      }
    },
    {
      "markdown": "AI & Vectors\n\n# IVFFlat indexes\n\n* * *\n\nIVFFlat is a type of vector index for approximate nearest neighbor search. It is a frequently used index type that can improve performance when querying highly-dimensional vectors, like those representing embeddings.\n\n## Choosing an index [\\#](\\#choosing-an-index)\n\nToday `pgvector` supports two types of indexes:\n\n- [HNSW](/docs/guides/ai/vector-indexes/hnsw-indexes)\n- [IVFFlat](/docs/guides/ai/vector-indexes/ivf-indexes)\n\nIn general we recommend using [HNSW](/docs/guides/ai/vector-indexes/hnsw-indexes) because of its [performance](https://supabase.com/blog/increase-performance-pgvector-hnsw#hnsw-performance-1536-dimensions) and [robustness against changing data](/docs/guides/ai/vector-indexes/hnsw-indexes#when-should-you-create-hnsw-indexes). If you have a special use case that requires IVFFlat instead, keep reading.\n\n## Usage [\\#](\\#usage)\n\nThe way you create an IVFFlat index depends on the distance operator you are using. `pgvector` includes 3 distance operators:\n\n| Operator | Description | [**Operator class**](https://www.postgresql.org/docs/current/sql-createopclass.html) |\n| --- | --- | --- |\n| `<->` | Euclidean distance | `vector_l2_ops` |\n| `<#>` | negative inner product | `vector_ip_ops` |\n| `<=>` | cosine distance | `vector_cosine_ops` |\n\nUse the following SQL commands to create an IVFFlat index for the operator(s) used in your queries.\n\n### Euclidean L2 distance ( `vector_l2_ops`) [\\#](\\#euclidean-l2-distance--vectorl2ops-)\n\n`\n_10\ncreate index on items using ivfflat (column_name vector_l2_ops) with (lists = 100);\n`\n\n### Inner product ( `vector_ip_ops`) [\\#](\\#inner-product--vectoripops-)\n\n`\n_10\ncreate index on items using ivfflat (column_name vector_ip_ops) with (lists = 100);\n`\n\n### Cosine distance ( `vector_cosine_ops`) [\\#](\\#cosine-distance--vectorcosineops-)\n\n`\n_10\ncreate index on items using ivfflat (column_name vector_cosine_ops) with (lists = 100);\n`\n\nCurrently vectors with up to 2,000 dimensions can be indexed.\n\n## How does IVFFlat work? [\\#](\\#how-does-ivfflat-work)\n\nIVF stands for 'inverted file indexes'. It works by clustering your vectors in order to reduce the similarity search scope. Rather than comparing a vector to every other vector, the vector is only compared against vectors within the same cell cluster (or nearby clusters, depending on your configuration).\n\n### Inverted lists (cell clusters) [\\#](\\#inverted-lists-cell-clusters)\n\nWhen you create the index, you choose the number of inverted lists (cell clusters). Increase this number to speed up queries, but at the expense of recall.\n\nFor example, to create an index with 100 lists on a column that uses the cosine operator:\n\n`\n_10\ncreate index on items using ivfflat (column_name vector_cosine_ops) with (lists = 100);\n`\n\nFor more info on the different operators, see [Distance operations](#distance-operators).\n\nFor every query, you can set the number of probes (1 by default). The number of probes corresponds to the number of nearby cells to probe for a match. Increase this for better recall at the expense of speed.\n\nTo set the number of probes for the duration of the session run:\n\n`\n_10\nset ivfflat.probes = 10;\n`\n\nTo set the number of probes only for the current transaction run:\n\n`\n_10\nbegin;\n_10\nset local ivfflat.probes = 10;\n_10\nselect ...\n_10\ncommit;\n`\n\nIf the number of probes is the same as the number of lists, exact nearest neighbor search will be performed and the planner won't use the index.\n\n### Approximate nearest neighbor [\\#](\\#approximate-nearest-neighbor)\n\nOne important note with IVF indexes is that nearest neighbor search is approximate, since exact search on high dimensional data can't be indexed efficiently. This means that similarity results will change (slightly) after you add an index (trading recall for speed).\n\n## When should you create IVFFlat indexes? [\\#](\\#when-should-you-create-ivfflat-indexes)\n\n`pgvector` recommends building IVFFlat indexes only after the table has sufficient data, so that the internal IVFFlat cell clusters are based on your data's distribution. Anytime the distribution changes significantly, consider rebuilding indexes.\n\n## Resources [\\#](\\#resources)\n\nRead more about indexing on `pgvector`'s [GitHub page](https://github.com/pgvector/pgvector#indexing).",
      "html": "<!DOCTYPE html><html lang=\"en\" data-theme=\"light\" style=\"color-scheme: light;\"><body><div class=\"flex flex-col\"><div class=\"grow\"><div class=\"flex flex-col h-full w-full\"><div class=\"hidden lg:sticky w-full lg:flex top-0 left-0 right-0 z-50\"><!--$--><!--/$--></div><div class=\"flex flex-row h-full relative\"><main id=\"docs-content-container\" class=\"w-full transition-all ease-out relative lg:ml-0\"><div class=\"flex flex-col sticky top-0\"><div class=\"flex lg:hidden w-full top-0 left-0 right-0 z-50\"><!--$--><!--/$--></div><div class=\"sticky transition-all top-0 z-10 backdrop-blur backdrop-filter bg-background\"><div class=\"lg:hidden px-3.5 border-b z-10 transition-all ease-out top-0 flex items-center gap-1\"><button class=\"h-8 w-8 flex group items-center justify-center mr-1\"><div class=\"space-y-1 cursor-pointer relative w-4 h-[8px]\"><span class=\"transition-all ease-out block h-px bg-foreground-muted group-hover:bg-foreground w-4\"></span><span class=\"transition-all ease-out block h-px bg-foreground-muted group-hover:bg-foreground w-3 group-hover:w-4\"></span></div></button><span class=\"transition-all duration-200 text-foreground text-sm\">AI &amp; Vectors</span></div></div><div class=\"grow\"><div class=\"max-w-7xl px-5 mx-auto py-8 pb-0\"><div class=\"grid grid-cols-12 relative gap-4\"><div class=\"relative transition-all ease-out duration-100 col-span-12 md:col-span-9\"><article id=\"sb-docs-guide-main-article\" class=\"prose max-w-none\"><h1 class=\"mb-0\">IVFFlat indexes</h1><hr class=\"not-prose border-t-0 border-b my-8\">\n<p>IVFFlat is a type of vector index for approximate nearest neighbor search. It is a frequently used index type that can improve performance when querying highly-dimensional vectors, like those representing embeddings.</p>\n<h2 id=\"choosing-an-index\" class=\"group scroll-mt-24\">Choosing an index<a href=\"#choosing-an-index\" aria-hidden=\"true\" class=\"ml-2 opacity-0 group-hover:opacity-100 transition\"><span aria-hidden=\"true\">#</span></a></h2>\n<p>Today <code>pgvector</code> supports two types of indexes:</p>\n<ul>\n<li><a href=\"/docs/guides/ai/vector-indexes/hnsw-indexes\">HNSW</a></li>\n<li><a href=\"/docs/guides/ai/vector-indexes/ivf-indexes\">IVFFlat</a></li>\n</ul>\n<p>In general we recommend using <a href=\"/docs/guides/ai/vector-indexes/hnsw-indexes\">HNSW</a> because of its <a href=\"https://supabase.com/blog/increase-performance-pgvector-hnsw#hnsw-performance-1536-dimensions\">performance</a> and <a href=\"/docs/guides/ai/vector-indexes/hnsw-indexes#when-should-you-create-hnsw-indexes\">robustness against changing data</a>. If you have a special use case that requires IVFFlat instead, keep reading.</p>\n<h2 id=\"usage\" class=\"group scroll-mt-24\">Usage<a href=\"#usage\" aria-hidden=\"true\" class=\"ml-2 opacity-0 group-hover:opacity-100 transition\"><span aria-hidden=\"true\">#</span></a></h2>\n<p>The way you create an IVFFlat index depends on the distance operator you are using. <code>pgvector</code> includes 3 distance operators:</p>\n<table><thead><tr><th>Operator</th><th>Description</th><th><a href=\"https://www.postgresql.org/docs/current/sql-createopclass.html\"><strong>Operator class</strong></a></th></tr></thead><tbody><tr><td><code>&lt;-&gt;</code></td><td>Euclidean distance</td><td><code>vector_l2_ops</code></td></tr><tr><td><code>&lt;#&gt;</code></td><td>negative inner product</td><td><code>vector_ip_ops</code></td></tr><tr><td><code>&lt;=&gt;</code></td><td>cosine distance</td><td><code>vector_cosine_ops</code></td></tr></tbody></table>\n<p>Use the following SQL commands to create an IVFFlat index for the operator(s) used in your queries.</p>\n<h3 id=\"euclidean-l2-distance--vectorl2ops-\" class=\"group scroll-mt-24\">Euclidean L2 distance (<code>vector_l2_ops</code>)<a href=\"#euclidean-l2-distance--vectorl2ops-\" aria-hidden=\"true\" class=\"ml-2 opacity-0 group-hover:opacity-100 transition\"><span aria-hidden=\"true\">#</span></a></h3>\n<div class=\"ch-codeblock not-prose \" data-ch-theme=\"supabase\"><div class=\"ch-code-wrapper ch-code\" data-ch-measured=\"false\"><code class=\"ch-code-scroll-parent\"><br><div><span class=\"ch-code-line-number\">_<!-- -->10</span><div style=\"display:inline-block;margin-left:16px\"><span>create index on items using ivfflat (column_name vector_l2_ops) with (lists = 100);</span></div></div><br></code></div></div>\n<h3 id=\"inner-product--vectoripops-\" class=\"group scroll-mt-24\">Inner product (<code>vector_ip_ops</code>)<a href=\"#inner-product--vectoripops-\" aria-hidden=\"true\" class=\"ml-2 opacity-0 group-hover:opacity-100 transition\"><span aria-hidden=\"true\">#</span></a></h3>\n<div class=\"ch-codeblock not-prose \" data-ch-theme=\"supabase\"><div class=\"ch-code-wrapper ch-code\" data-ch-measured=\"false\"><code class=\"ch-code-scroll-parent\"><br><div><span class=\"ch-code-line-number\">_<!-- -->10</span><div style=\"display:inline-block;margin-left:16px\"><span>create index on items using ivfflat (column_name vector_ip_ops) with (lists = 100);</span></div></div><br></code></div></div>\n<h3 id=\"cosine-distance--vectorcosineops-\" class=\"group scroll-mt-24\">Cosine distance (<code>vector_cosine_ops</code>)<a href=\"#cosine-distance--vectorcosineops-\" aria-hidden=\"true\" class=\"ml-2 opacity-0 group-hover:opacity-100 transition\"><span aria-hidden=\"true\">#</span></a></h3>\n<div class=\"ch-codeblock not-prose \" data-ch-theme=\"supabase\"><div class=\"ch-code-wrapper ch-code\" data-ch-measured=\"false\"><code class=\"ch-code-scroll-parent\"><br><div><span class=\"ch-code-line-number\">_<!-- -->10</span><div style=\"display:inline-block;margin-left:16px\"><span>create index on items using ivfflat (column_name vector_cosine_ops) with (lists = 100);</span></div></div><br></code></div></div>\n<p>Currently vectors with up to 2,000 dimensions can be indexed.</p>\n<h2 id=\"how-does-ivfflat-work\" class=\"group scroll-mt-24\">How does IVFFlat work?<a href=\"#how-does-ivfflat-work\" aria-hidden=\"true\" class=\"ml-2 opacity-0 group-hover:opacity-100 transition\"><span aria-hidden=\"true\">#</span></a></h2>\n<p>IVF stands for 'inverted file indexes'. It works by clustering your vectors in order to reduce the similarity search scope. Rather than comparing a vector to every other vector, the vector is only compared against vectors within the same cell cluster (or nearby clusters, depending on your configuration).</p>\n<h3 id=\"inverted-lists-cell-clusters\" class=\"group scroll-mt-24\">Inverted lists (cell clusters)<a href=\"#inverted-lists-cell-clusters\" aria-hidden=\"true\" class=\"ml-2 opacity-0 group-hover:opacity-100 transition\"><span aria-hidden=\"true\">#</span></a></h3>\n<p>When you create the index, you choose the number of inverted lists (cell clusters). Increase this number to speed up queries, but at the expense of recall.</p>\n<p>For example, to create an index with 100 lists on a column that uses the cosine operator:</p>\n<div class=\"ch-codeblock not-prose \" data-ch-theme=\"supabase\"><div class=\"ch-code-wrapper ch-code\" data-ch-measured=\"false\"><code class=\"ch-code-scroll-parent\"><br><div><span class=\"ch-code-line-number\">_<!-- -->10</span><div style=\"display:inline-block;margin-left:16px\"><span>create index on items using ivfflat (column_name vector_cosine_ops) with (lists = 100);</span></div></div><br></code></div></div>\n<p>For more info on the different operators, see <a href=\"#distance-operators\">Distance operations</a>.</p>\n<p>For every query, you can set the number of probes (1 by default). The number of probes corresponds to the number of nearby cells to probe for a match. Increase this for better recall at the expense of speed.</p>\n<p>To set the number of probes for the duration of the session run:</p>\n<div class=\"ch-codeblock not-prose \" data-ch-theme=\"supabase\"><div class=\"ch-code-wrapper ch-code\" data-ch-measured=\"false\"><code class=\"ch-code-scroll-parent\"><br><div><span class=\"ch-code-line-number\">_<!-- -->10</span><div style=\"display:inline-block;margin-left:16px\"><span>set ivfflat.probes = 10;</span></div></div><br></code></div></div>\n<p>To set the number of probes only for the current transaction run:</p>\n<div class=\"ch-codeblock not-prose \" data-ch-theme=\"supabase\"><div class=\"ch-code-wrapper ch-code\" data-ch-measured=\"false\"><code class=\"ch-code-scroll-parent\"><br><div><span class=\"ch-code-line-number\">_<!-- -->10</span><div style=\"display:inline-block;margin-left:16px\"><span>begin;</span></div></div><div><span class=\"ch-code-line-number\">_<!-- -->10</span><div style=\"display:inline-block;margin-left:16px\"><span>set local ivfflat.probes = 10;</span></div></div><div><span class=\"ch-code-line-number\">_<!-- -->10</span><div style=\"display:inline-block;margin-left:16px\"><span>select ...</span></div></div><div><span class=\"ch-code-line-number\">_<!-- -->10</span><div style=\"display:inline-block;margin-left:16px\"><span>commit;</span></div></div><br></code></div></div>\n<p>If the number of probes is the same as the number of lists, exact nearest neighbor search will be performed and the planner won't use the index.</p>\n<h3 id=\"approximate-nearest-neighbor\" class=\"group scroll-mt-24\">Approximate nearest neighbor<a href=\"#approximate-nearest-neighbor\" aria-hidden=\"true\" class=\"ml-2 opacity-0 group-hover:opacity-100 transition\"><span aria-hidden=\"true\">#</span></a></h3>\n<p>One important note with IVF indexes is that nearest neighbor search is approximate, since exact search on high dimensional data can't be indexed efficiently. This means that similarity results will change (slightly) after you add an index (trading recall for speed).</p>\n<h2 id=\"when-should-you-create-ivfflat-indexes\" class=\"group scroll-mt-24\">When should you create IVFFlat indexes?<a href=\"#when-should-you-create-ivfflat-indexes\" aria-hidden=\"true\" class=\"ml-2 opacity-0 group-hover:opacity-100 transition\"><span aria-hidden=\"true\">#</span></a></h2>\n<p><code>pgvector</code> recommends building IVFFlat indexes only after the table has sufficient data, so that the internal IVFFlat cell clusters are based on your data's distribution. Anytime the distribution changes significantly, consider rebuilding indexes.</p>\n<h2 id=\"resources\" class=\"group scroll-mt-24\">Resources<a href=\"#resources\" aria-hidden=\"true\" class=\"ml-2 opacity-0 group-hover:opacity-100 transition\"><span aria-hidden=\"true\">#</span></a></h2>\n<p>Read more about indexing on <code>pgvector</code>'s <a href=\"https://github.com/pgvector/pgvector#indexing\">GitHub page</a>.</p></article></div></div></div><!--$--><div class=\"max-w-7xl px-5 mx-auto py-8 pt-0\"></div><!--/$--></div><div class=\"left-0 right-0 z-10 backdrop-blur-sm backdrop-filter bg-alternative/90 hidden h-0 lg:hidden\"></div></div></main></div></div></div></div></body></html>",
      "metadata": {
        "ogUrl": "https://supabase.com/docs/guides/ai/vector-indexes/ivf-indexes",
        "title": "IVFFlat indexes | Supabase Docs",
        "robots": "index, follow",
        "ogImage": "https://obuldanrptloktxcffvn.supabase.co/functions/v1/og-images?site=docs&type=ai&title=IVFFlat%20indexes&description=Understanding%20IVFFlat%20indexes%20in%20pgvector",
        "ogTitle": "IVFFlat indexes | Supabase Docs",
        "language": "en",
        "sourceURL": "https://supabase.com/docs/guides/ai/vector-indexes/ivf-indexes",
        "description": "Understanding IVFFlat indexes in pgvector",
        "modifiedTime": "2024-09-10T20:36:24.980Z",
        "ogDescription": "Understanding IVFFlat indexes in pgvector",
        "publishedTime": "2024-09-10T20:36:24.980Z",
        "ogLocaleAlternate": [],
        "statusCode": 200
      }
    },
    {
      "markdown": "AI & Vectors\n\n# RAG with Permissions\n\n## Fine-grain access control with Retrieval Augmented Generation.\n\n* * *\n\nSince pgvector is built on top of Postgres, you can implement fine-grain access control on your vector database using [Row Level Security (RLS)](/docs/guides/database/postgres/row-level-security). This means you can restrict which documents are returned during a vector similarity search to users that have access to them. Supabase also supports [Foreign Data Wrappers (FDW)](/docs/guides/database/extensions/wrappers/overview) which means you can use an external database or data source to determine these permissions if your user data doesn't exist in Supabase.\n\nUse this guide to learn how to restrict access to documents when performing retrieval augmented generation (RAG).\n\n## Example [\\#](\\#example)\n\nIn a typical RAG setup, your documents are chunked into small subsections and similarity is performed over those sections:\n\n`\n_16\n-- Track documents/pages/files/etc\n_16\ncreate table documents (\n_16\nid bigint primary key generated always as identity,\n_16\nname text not null,\n_16\nowner_id uuid not null references auth.users (id) default auth.uid(),\n_16\ncreated_at timestamp with time zone not null default now()\n_16\n);\n_16\n_16\n-- Store the content and embedding vector for each section in the document\n_16\n-- with a reference to original document (one-to-many)\n_16\ncreate table document_sections (\n_16\nid bigint primary key generated always as identity,\n_16\ndocument_id bigint not null references documents (id),\n_16\ncontent text not null,\n_16\nembedding vector (384)\n_16\n);\n`\n\nNotice how we record the `owner_id` on each document. Let's create an RLS policy that restricts access to `document_sections` based on whether or not they own the linked document:\n\n`\n_12\n-- enable row level security\n_12\nalter table document_sections enable row level security;\n_12\n_12\n-- setup RLS for select operations\n_12\ncreate policy \"Users can query their own document sections\"\n_12\non document_sections for select to authenticated using (\n_12\ndocument_id in (\n_12\n    select id\n_12\n    from documents\n_12\n    where (owner_id = (select auth.uid()))\n_12\n)\n_12\n);\n`\n\nIn this example, the current user is determined using the built-in `auth.uid()` function when the query is executed through your project's auto-generated [REST API](/docs/guides/api). If you are connecting to your Supabase database through a direct Postgres connection, see [Direct Postgres Connection](#direct-postgres-connection) below for directions on how to achieve the same access control.\n\nNow every `select` query executed on `document_sections` will implicitly filter the returned sections based on whether or not the current user has access to them.\n\nFor example, executing:\n\n`\n_10\nselect * from document_sections;\n`\n\nas an authenticated user will only return rows that they are the owner of (as determined by the linked document). More importantly, semantic search over these sections (or any additional filtering for that matter) will continue to respect these RLS policies:\n\n`\n_10\n-- Perform inner product similarity based on a match_threshold\n_10\nselect *\n_10\nfrom document_sections\n_10\nwhere document_sections.embedding <#> embedding < -match_threshold\n_10\norder by document_sections.embedding <#> embedding;\n`\n\nThe above example only configures `select` access to users. If you wanted, you could create more RLS policies for inserts, updates, and deletes in order to apply the same permission logic for those other operations. See [Row Level Security](/docs/guides/database/postgres/row-level-security) for a more in-depth guide on RLS policies.\n\n## Alternative scenarios [\\#](\\#alternative-scenarios)\n\nEvery app has its own unique requirements and may differ from the above example. Here are some alternative scenarios we often see and how they are implemented in Supabase.\n\n### Documents owned by multiple people [\\#](\\#documents-owned-by-multiple-people)\n\nInstead of a one-to-many relationship between `users` and `documents`, you may require a many-to-many relationship so that multiple people can access the same document. Let's reimplement this using a join table:\n\n`\n_10\ncreate table document_owners (\n_10\nid bigint primary key generated always as identity,\n_10\nowner_id uuid not null references auth.users (id) default auth.uid(),\n_10\ndocument_id bigint not null references documents (id)\n_10\n);\n`\n\nThen your RLS policy would change to:\n\n`\n_10\ncreate policy \"Users can query their own document sections\"\n_10\non document_sections for select to authenticated using (\n_10\ndocument_id in (\n_10\n    select document_id\n_10\n    from document_owners\n_10\n    where (owner_id = (select auth.uid()))\n_10\n)\n_10\n);\n`\n\nInstead of directly querying the `documents` table, we query the join table.\n\n### User and document data live outside of Supabase [\\#](\\#user-and-document-data-live-outside-of-supabase)\n\nYou may have an existing system that stores users, documents, and their permissions in a separate database. Let's explore the scenario where this data exists in another Postgres database. We'll use a foreign data wrapper (FDW) to connect to the external DB from within your Supabase DB:\n\nRLS is latency-sensitive, so extra caution should be taken before implementing this method. Use the [query plan analyzer](https://supabase.com/docs/guides/platform/performance#optimizing-poor-performing-queries) to measure execution times for your queries to ensure they are within expected ranges. For enterprise applications, contact [enterprise@supabase.io](mailto:enterprise@supabase.io).\n\nFor data sources other than Postgres, see [Foreign Data Wrappers](/docs/guides/database/extensions/wrappers/overview) for a list of external sources supported today. If your data lives in a source not provided in the list, please contact [support](https://supabase.com/dashboard/support/new) and we'll be happy to discuss your use case.\n\nLet's assume your external DB contains a `users` and `documents` table like this:\n\n`\n_12\ncreate table public.users (\n_12\nid bigint primary key generated always as identity,\n_12\nemail text not null,\n_12\ncreated_at timestamp with time zone not null default now()\n_12\n);\n_12\n_12\ncreate table public.documents (\n_12\nid bigint primary key generated always as identity,\n_12\nname text not null,\n_12\nowner_id bigint not null references public.users (id),\n_12\ncreated_at timestamp with time zone not null default now()\n_12\n);\n`\n\nIn your Supabase DB, let's create foreign tables that link to the above tables:\n\n`\n_16\ncreate schema external;\n_16\ncreate extension postgres_fdw with schema extensions;\n_16\n_16\n-- Setup the foreign server\n_16\ncreate server foreign_server\n_16\nforeign data wrapper postgres_fdw\n_16\noptions (host '<db-host>', port '<db-port>', dbname '<db-name>');\n_16\n_16\n-- Map local 'authenticated' role to external 'postgres' user\n_16\ncreate user mapping for authenticated\n_16\nserver foreign_server\n_16\noptions (user 'postgres', password '<user-password>');\n_16\n_16\n-- Import foreign 'users' and 'documents' tables into 'external' schema\n_16\nimport foreign schema public limit to (users, documents)\n_16\nfrom server foreign_server into external;\n`\n\nThis example maps the `authenticated` role in Supabase to the `postgres` user in the external DB. In production, it's best to create a custom user on the external DB that has the minimum permissions necessary to access the information you need.\n\nOn the Supabase DB, we use the built-in `authenticated` role which is automatically used when end users make authenticated requests over your auto-generated REST API. If you plan to connect to your Supabase DB over a direct Postgres connection instead of the REST API, you can change this to any user you like. See [Direct Postgres Connection](#direct-postgres-connection) for more info.\n\nWe'll store `document_sections` and their embeddings in Supabase so that we can perform similarity search over them via pgvector.\n\n`\n_10\ncreate table document_sections (\n_10\nid bigint primary key generated always as identity,\n_10\ndocument_id bigint not null,\n_10\ncontent text not null,\n_10\nembedding vector (384)\n_10\n);\n`\n\nWe maintain a reference to the foreign document via `document_id`, but without a foreign key reference since foreign keys can only be added to local tables. Be sure to use the same ID data type that you use on your external documents table.\n\nSince we're managing users and authentication outside of Supabase, we have two options:\n\n1. Make a direct Postgres connection to the Supabase DB and set the current user every request\n2. Issue a custom JWT from your system and use it to authenticate with the REST API\n\n#### Direct Postgres connection [\\#](\\#direct-postgres-connection)\n\nYou can directly connect to your Supabase Postgres DB using the [connection info](/dashboard/project/_/settings/database) on your project's database settings page. To use RLS with this method, we use a custom session variable that contains the current user's ID:\n\n`\n_12\n-- enable row level security\n_12\nalter table document_sections enable row level security;\n_12\n_12\n-- setup RLS for select operations\n_12\ncreate policy \"Users can query their own document sections\"\n_12\non document_sections for select to authenticated using (\n_12\ndocument_id in (\n_12\n    select id\n_12\n    from external.documents\n_12\n    where owner_id = current_setting('app.current_user_id')::bigint\n_12\n)\n_12\n);\n`\n\nThe session variable is accessed through the `current_setting()` function. We name the variable `app.current_user_id` here, but you can modify this to any name you like. We also cast it to a `bigint` since that was the data type of the `user.id` column. Change this to whatever data type you use for your ID.\n\nNow for every request, we set the user's ID at the beginning of the session:\n\n`\n_10\nset app.current_user_id = '<current-user-id>';\n`\n\nThen all subsequent queries will inherit the permission of that user:\n\n`\n_10\n-- Only document sections owned by the user are returned\n_10\nselect *\n_10\nfrom document_sections\n_10\nwhere document_sections.embedding <#> embedding < -match_threshold\n_10\norder by document_sections.embedding <#> embedding;\n`\n\nYou might be tempted to discard RLS completely and simply filter by user within the `where` clause. Though this will work, we recommend RLS as a general best practice since RLS is always applied even as new queries and application logic is introduced in the future.\n\n#### Custom JWT with REST API [\\#](\\#custom-jwt-with-rest-api)\n\nIf you would like to use the auto-generated REST API to query your Supabase database using JWTs from an external auth provider, you can get your auth provider to issue a custom JWT for Supabase.\n\nSee the [Clerk Supabase docs](https://clerk.com/docs/integrations/databases/supabase) for an example of how this can be done. Modify the instructions to work with your own auth provider as needed.\n\nNow we can simply use the same RLS policy from our first example:\n\n`\n_12\n-- enable row level security\n_12\nalter table document_sections enable row level security;\n_12\n_12\n-- setup RLS for select operations\n_12\ncreate policy \"Users can query their own document sections\"\n_12\non document_sections for select to authenticated using (\n_12\ndocument_id in (\n_12\n    select id\n_12\n    from documents\n_12\n    where (owner_id = (select auth.uid()))\n_12\n)\n_12\n);\n`\n\nUnder the hood, `auth.uid()` references `current_setting('request.jwt.claim.sub')` which corresponds to the JWT's `sub` (subject) claim. This setting is automatically set at the beginning of each request to the REST API.\n\nAll subsequent queries will inherit the permission of that user:\n\n`\n_10\n-- Only document sections owned by the user are returned\n_10\nselect *\n_10\nfrom document_sections\n_10\nwhere document_sections.embedding <#> embedding < -match_threshold\n_10\norder by document_sections.embedding <#> embedding;\n`\n\n### Other scenarios [\\#](\\#other-scenarios)\n\nThere are endless approaches to this problem based on the complexities of each system. Luckily Postgres comes with all the primitives needed to provide access control in the way that works best for your project.\n\nIf the examples above didn't fit your use case or you need to adjust them slightly to better fit your existing system, feel free to reach out to [support](https://supabase.com/dashboard/support/new) and we'll be happy to assist you.",
      "html": "<!DOCTYPE html><html lang=\"en\" data-theme=\"light\" style=\"color-scheme: light;\"><body><div class=\"flex flex-col\"><div class=\"grow\"><div class=\"flex flex-col h-full w-full\"><div class=\"hidden lg:sticky w-full lg:flex top-0 left-0 right-0 z-50\"><!--$--><!--/$--></div><div class=\"flex flex-row h-full relative\"><main id=\"docs-content-container\" class=\"w-full transition-all ease-out relative lg:ml-0\"><div class=\"flex flex-col sticky top-0\"><div class=\"flex lg:hidden w-full top-0 left-0 right-0 z-50\"><!--$--><!--/$--></div><div class=\"sticky transition-all top-0 z-10 backdrop-blur backdrop-filter bg-background\"><div class=\"lg:hidden px-3.5 border-b z-10 transition-all ease-out top-0 flex items-center gap-1\"><button class=\"h-8 w-8 flex group items-center justify-center mr-1\"><div class=\"space-y-1 cursor-pointer relative w-4 h-[8px]\"><span class=\"transition-all ease-out block h-px bg-foreground-muted group-hover:bg-foreground w-4\"></span><span class=\"transition-all ease-out block h-px bg-foreground-muted group-hover:bg-foreground w-3 group-hover:w-4\"></span></div></button><span class=\"transition-all duration-200 text-foreground text-sm\">AI &amp; Vectors</span></div></div><div class=\"grow\"><div class=\"max-w-7xl px-5 mx-auto py-8 pb-0\"><div class=\"grid grid-cols-12 relative gap-4\"><div class=\"relative transition-all ease-out duration-100 col-span-12 md:col-span-9\"><article id=\"sb-docs-guide-main-article\" class=\"prose max-w-none\"><h1 class=\"mb-0\">RAG with Permissions</h1><h2 class=\"mt-3 text-xl text-foreground-light\">Fine-grain access control with Retrieval Augmented Generation.</h2><hr class=\"not-prose border-t-0 border-b my-8\">\n<p>Since pgvector is built on top of Postgres, you can implement fine-grain access control on your vector database using <a href=\"/docs/guides/database/postgres/row-level-security\">Row Level Security (RLS)</a>. This means you can restrict which documents are returned during a vector similarity search to users that have access to them. Supabase also supports <a href=\"/docs/guides/database/extensions/wrappers/overview\">Foreign Data Wrappers (FDW)</a> which means you can use an external database or data source to determine these permissions if your user data doesn't exist in Supabase.</p>\n<p>Use this guide to learn how to restrict access to documents when performing retrieval augmented generation (RAG).</p>\n<h2 id=\"example\" class=\"group scroll-mt-24\">Example<a href=\"#example\" aria-hidden=\"true\" class=\"ml-2 opacity-0 group-hover:opacity-100 transition\"><span aria-hidden=\"true\">#</span></a></h2>\n<p>In a typical RAG setup, your documents are chunked into small subsections and similarity is performed over those sections:</p>\n<div class=\"ch-codeblock not-prose \" data-ch-theme=\"supabase\"><div class=\"ch-code-wrapper ch-code\" data-ch-measured=\"false\"><code class=\"ch-code-scroll-parent\"><br><div><span class=\"ch-code-line-number\">_<!-- -->16</span><div style=\"display:inline-block;margin-left:16px\"><span>-- Track documents/pages/files/etc</span></div></div><div><span class=\"ch-code-line-number\">_<!-- -->16</span><div style=\"display:inline-block;margin-left:16px\"><span>create table documents (</span></div></div><div><span class=\"ch-code-line-number\">_<!-- -->16</span><div style=\"display:inline-block;margin-left:16px\"><span>  id bigint primary key generated always as identity,</span></div></div><div><span class=\"ch-code-line-number\">_<!-- -->16</span><div style=\"display:inline-block;margin-left:16px\"><span>  name text not null,</span></div></div><div><span class=\"ch-code-line-number\">_<!-- -->16</span><div style=\"display:inline-block;margin-left:16px\"><span>  owner_id uuid not null references auth.users (id) default auth.uid(),</span></div></div><div><span class=\"ch-code-line-number\">_<!-- -->16</span><div style=\"display:inline-block;margin-left:16px\"><span>  created_at timestamp with time zone not null default now()</span></div></div><div><span class=\"ch-code-line-number\">_<!-- -->16</span><div style=\"display:inline-block;margin-left:16px\"><span>);</span></div></div><div><span class=\"ch-code-line-number\">_<!-- -->16</span><div style=\"display:inline-block;margin-left:16px\"><span></span></div></div><div><span class=\"ch-code-line-number\">_<!-- -->16</span><div style=\"display:inline-block;margin-left:16px\"><span>-- Store the content and embedding vector for each section in the document</span></div></div><div><span class=\"ch-code-line-number\">_<!-- -->16</span><div style=\"display:inline-block;margin-left:16px\"><span>-- with a reference to original document (one-to-many)</span></div></div><div><span class=\"ch-code-line-number\">_<!-- -->16</span><div style=\"display:inline-block;margin-left:16px\"><span>create table document_sections (</span></div></div><div><span class=\"ch-code-line-number\">_<!-- -->16</span><div style=\"display:inline-block;margin-left:16px\"><span>  id bigint primary key generated always as identity,</span></div></div><div><span class=\"ch-code-line-number\">_<!-- -->16</span><div style=\"display:inline-block;margin-left:16px\"><span>  document_id bigint not null references documents (id),</span></div></div><div><span class=\"ch-code-line-number\">_<!-- -->16</span><div style=\"display:inline-block;margin-left:16px\"><span>  content text not null,</span></div></div><div><span class=\"ch-code-line-number\">_<!-- -->16</span><div style=\"display:inline-block;margin-left:16px\"><span>  embedding vector (384)</span></div></div><div><span class=\"ch-code-line-number\">_<!-- -->16</span><div style=\"display:inline-block;margin-left:16px\"><span>);</span></div></div><br></code></div></div>\n<p>Notice how we record the <code>owner_id</code> on each document. Let's create an RLS policy that restricts access to <code>document_sections</code> based on whether or not they own the linked document:</p>\n<div class=\"ch-codeblock not-prose \" data-ch-theme=\"supabase\"><div class=\"ch-code-wrapper ch-code\" data-ch-measured=\"false\"><code class=\"ch-code-scroll-parent\"><br><div><span class=\"ch-code-line-number\">_<!-- -->12</span><div style=\"display:inline-block;margin-left:16px\"><span>-- enable row level security</span></div></div><div><span class=\"ch-code-line-number\">_<!-- -->12</span><div style=\"display:inline-block;margin-left:16px\"><span>alter table document_sections enable row level security;</span></div></div><div><span class=\"ch-code-line-number\">_<!-- -->12</span><div style=\"display:inline-block;margin-left:16px\"><span></span></div></div><div><span class=\"ch-code-line-number\">_<!-- -->12</span><div style=\"display:inline-block;margin-left:16px\"><span>-- setup RLS for select operations</span></div></div><div><span class=\"ch-code-line-number\">_<!-- -->12</span><div style=\"display:inline-block;margin-left:16px\"><span>create policy \"Users can query their own document sections\"</span></div></div><div><span class=\"ch-code-line-number\">_<!-- -->12</span><div style=\"display:inline-block;margin-left:16px\"><span>on document_sections for select to authenticated using (</span></div></div><div><span class=\"ch-code-line-number\">_<!-- -->12</span><div style=\"display:inline-block;margin-left:16px\"><span>  document_id in (</span></div></div><div><span class=\"ch-code-line-number\">_<!-- -->12</span><div style=\"display:inline-block;margin-left:16px\"><span>    select id</span></div></div><div><span class=\"ch-code-line-number\">_<!-- -->12</span><div style=\"display:inline-block;margin-left:16px\"><span>    from documents</span></div></div><div><span class=\"ch-code-line-number\">_<!-- -->12</span><div style=\"display:inline-block;margin-left:16px\"><span>    where (owner_id = (select auth.uid()))</span></div></div><div><span class=\"ch-code-line-number\">_<!-- -->12</span><div style=\"display:inline-block;margin-left:16px\"><span>  )</span></div></div><div><span class=\"ch-code-line-number\">_<!-- -->12</span><div style=\"display:inline-block;margin-left:16px\"><span>);</span></div></div><br></code></div></div>\n<div role=\"alert\" class=\"relative w-full text-sm rounded-lg p-4 [&amp;>svg~*]:pl-10 [&amp;>svg+div]:translate-y-[-3px] [&amp;>svg]:absolute [&amp;>svg]:left-4 [&amp;>svg]:top-4 [&amp;>svg]:w-[23px] [&amp;>svg]:h-[23px] [&amp;>svg]:p-1 [&amp;>svg]:flex [&amp;>svg]:rounded text-foreground [&amp;>svg]:text-background [&amp;>svg]:bg-foreground mb-2 [&amp;_svg]:bg-foreground-muted [&amp;_svg]:text-background-muted bg-surface-200/25 border border-default\"><svg xmlns=\"http://www.w3.org/2000/svg\" viewBox=\"0 0 21 20\" class=\"w-6 h-6\" fill=\"currentColor\"><path fill-rule=\"evenodd\" clip-rule=\"evenodd\" d=\"M0.625 9.8252C0.625 4.44043 4.99023 0.0751953 10.375 0.0751953C15.7598 0.0751953 20.125 4.44043 20.125 9.8252C20.125 15.21 15.7598 19.5752 10.375 19.5752C4.99023 19.5752 0.625 15.21 0.625 9.8252ZM9.3584 4.38135C9.45117 4.28857 9.55518 4.20996 9.66699 4.14648C9.88086 4.02539 10.1245 3.96045 10.375 3.96045C10.5845 3.96045 10.7896 4.00586 10.9766 4.09229C11.1294 4.1626 11.2705 4.26025 11.3916 4.38135C11.6611 4.65088 11.8125 5.0166 11.8125 5.39795C11.8125 5.5249 11.7959 5.6499 11.7637 5.77002C11.6987 6.01172 11.5718 6.23438 11.3916 6.41455C11.1221 6.68408 10.7563 6.83545 10.375 6.83545C9.99365 6.83545 9.62793 6.68408 9.3584 6.41455C9.08887 6.14502 8.9375 5.7793 8.9375 5.39795C8.9375 5.29492 8.94873 5.19287 8.97021 5.09375C9.02783 4.82568 9.16162 4.57812 9.3584 4.38135ZM10.375 15.6899C10.0933 15.6899 9.82275 15.5781 9.62354 15.3789C9.42432 15.1797 9.3125 14.9092 9.3125 14.6274V9.31494C9.3125 9.0332 9.42432 8.7627 9.62354 8.56348C9.82275 8.36426 10.0933 8.25244 10.375 8.25244C10.6567 8.25244 10.9272 8.36426 11.1265 8.56348C11.3257 8.7627 11.4375 9.0332 11.4375 9.31494V14.6274C11.4375 14.7944 11.3979 14.9575 11.3242 15.104C11.2739 15.2046 11.2075 15.2979 11.1265 15.3789C10.9272 15.5781 10.6567 15.6899 10.375 15.6899Z\"></path></svg><div class=\"text mt [&amp;_p]:mb-1.5 [&amp;_p]:mt-0 mt-0.5 [&amp;_p:last-child]:mb-0\"><p>In this example, the current user is determined using the built-in <code>auth.uid()</code> function when the query is executed through your project's auto-generated <a href=\"/docs/guides/api\">REST API</a>. If you are connecting to your Supabase database through a direct Postgres connection, see <a href=\"#direct-postgres-connection\">Direct Postgres Connection</a> below for directions on how to achieve the same access control.</p></div></div>\n<p>Now every <code>select</code> query executed on <code>document_sections</code> will implicitly filter the returned sections based on whether or not the current user has access to them.</p>\n<p>For example, executing:</p>\n<div class=\"ch-codeblock not-prose \" data-ch-theme=\"supabase\"><div class=\"ch-code-wrapper ch-code\" data-ch-measured=\"false\"><code class=\"ch-code-scroll-parent\"><br><div><span class=\"ch-code-line-number\">_<!-- -->10</span><div style=\"display:inline-block;margin-left:16px\"><span>select * from document_sections;</span></div></div><br></code></div></div>\n<p>as an authenticated user will only return rows that they are the owner of (as determined by the linked document). More importantly, semantic search over these sections (or any additional filtering for that matter) will continue to respect these RLS policies:</p>\n<div class=\"ch-codeblock not-prose \" data-ch-theme=\"supabase\"><div class=\"ch-code-wrapper ch-code\" data-ch-measured=\"false\"><code class=\"ch-code-scroll-parent\"><br><div><span class=\"ch-code-line-number\">_<!-- -->10</span><div style=\"display:inline-block;margin-left:16px\"><span>-- Perform inner product similarity based on a match_threshold</span></div></div><div><span class=\"ch-code-line-number\">_<!-- -->10</span><div style=\"display:inline-block;margin-left:16px\"><span>select *</span></div></div><div><span class=\"ch-code-line-number\">_<!-- -->10</span><div style=\"display:inline-block;margin-left:16px\"><span>from document_sections</span></div></div><div><span class=\"ch-code-line-number\">_<!-- -->10</span><div style=\"display:inline-block;margin-left:16px\"><span>where document_sections.embedding &lt;#&gt; embedding &lt; -match_threshold</span></div></div><div><span class=\"ch-code-line-number\">_<!-- -->10</span><div style=\"display:inline-block;margin-left:16px\"><span>order by document_sections.embedding &lt;#&gt; embedding;</span></div></div><br></code></div></div>\n<p>The above example only configures <code>select</code> access to users. If you wanted, you could create more RLS policies for inserts, updates, and deletes in order to apply the same permission logic for those other operations. See <a href=\"/docs/guides/database/postgres/row-level-security\">Row Level Security</a> for a more in-depth guide on RLS policies.</p>\n<h2 id=\"alternative-scenarios\" class=\"group scroll-mt-24\">Alternative scenarios<a href=\"#alternative-scenarios\" aria-hidden=\"true\" class=\"ml-2 opacity-0 group-hover:opacity-100 transition\"><span aria-hidden=\"true\">#</span></a></h2>\n<p>Every app has its own unique requirements and may differ from the above example. Here are some alternative scenarios we often see and how they are implemented in Supabase.</p>\n<h3 id=\"documents-owned-by-multiple-people\" class=\"group scroll-mt-24\">Documents owned by multiple people<a href=\"#documents-owned-by-multiple-people\" aria-hidden=\"true\" class=\"ml-2 opacity-0 group-hover:opacity-100 transition\"><span aria-hidden=\"true\">#</span></a></h3>\n<p>Instead of a one-to-many relationship between <code>users</code> and <code>documents</code>, you may require a many-to-many relationship so that multiple people can access the same document. Let's reimplement this using a join table:</p>\n<div class=\"ch-codeblock not-prose \" data-ch-theme=\"supabase\"><div class=\"ch-code-wrapper ch-code\" data-ch-measured=\"false\"><code class=\"ch-code-scroll-parent\"><br><div><span class=\"ch-code-line-number\">_<!-- -->10</span><div style=\"display:inline-block;margin-left:16px\"><span>create table document_owners (</span></div></div><div><span class=\"ch-code-line-number\">_<!-- -->10</span><div style=\"display:inline-block;margin-left:16px\"><span>  id bigint primary key generated always as identity,</span></div></div><div><span class=\"ch-code-line-number\">_<!-- -->10</span><div style=\"display:inline-block;margin-left:16px\"><span>  owner_id uuid not null references auth.users (id) default auth.uid(),</span></div></div><div><span class=\"ch-code-line-number\">_<!-- -->10</span><div style=\"display:inline-block;margin-left:16px\"><span>  document_id bigint not null references documents (id)</span></div></div><div><span class=\"ch-code-line-number\">_<!-- -->10</span><div style=\"display:inline-block;margin-left:16px\"><span>);</span></div></div><br></code></div></div>\n<p>Then your RLS policy would change to:</p>\n<div class=\"ch-codeblock not-prose \" data-ch-theme=\"supabase\"><div class=\"ch-code-wrapper ch-code\" data-ch-measured=\"false\"><code class=\"ch-code-scroll-parent\"><br><div><span class=\"ch-code-line-number\">_<!-- -->10</span><div style=\"display:inline-block;margin-left:16px\"><span>create policy \"Users can query their own document sections\"</span></div></div><div><span class=\"ch-code-line-number\">_<!-- -->10</span><div style=\"display:inline-block;margin-left:16px\"><span>on document_sections for select to authenticated using (</span></div></div><div><span class=\"ch-code-line-number\">_<!-- -->10</span><div style=\"display:inline-block;margin-left:16px\"><span>  document_id in (</span></div></div><div><span class=\"ch-code-line-number\">_<!-- -->10</span><div style=\"display:inline-block;margin-left:16px\"><span>    select document_id</span></div></div><div><span class=\"ch-code-line-number\">_<!-- -->10</span><div style=\"display:inline-block;margin-left:16px\"><span>    from document_owners</span></div></div><div><span class=\"ch-code-line-number\">_<!-- -->10</span><div style=\"display:inline-block;margin-left:16px\"><span>    where (owner_id = (select auth.uid()))</span></div></div><div><span class=\"ch-code-line-number\">_<!-- -->10</span><div style=\"display:inline-block;margin-left:16px\"><span>  )</span></div></div><div><span class=\"ch-code-line-number\">_<!-- -->10</span><div style=\"display:inline-block;margin-left:16px\"><span>);</span></div></div><br></code></div></div>\n<p>Instead of directly querying the <code>documents</code> table, we query the join table.</p>\n<h3 id=\"user-and-document-data-live-outside-of-supabase\" class=\"group scroll-mt-24\">User and document data live outside of Supabase<a href=\"#user-and-document-data-live-outside-of-supabase\" aria-hidden=\"true\" class=\"ml-2 opacity-0 group-hover:opacity-100 transition\"><span aria-hidden=\"true\">#</span></a></h3>\n<p>You may have an existing system that stores users, documents, and their permissions in a separate database. Let's explore the scenario where this data exists in another Postgres database. We'll use a foreign data wrapper (FDW) to connect to the external DB from within your Supabase DB:</p>\n<div role=\"alert\" class=\"relative w-full text-sm rounded-lg p-4 [&amp;>svg~*]:pl-10 [&amp;>svg+div]:translate-y-[-3px] [&amp;>svg]:absolute [&amp;>svg]:left-4 [&amp;>svg]:top-4 [&amp;>svg]:w-[23px] [&amp;>svg]:h-[23px] [&amp;>svg]:p-1 [&amp;>svg]:flex [&amp;>svg]:rounded [&amp;>svg]:text-warning-200 [&amp;>svg]:bg-warning-600 mb-2 [&amp;_svg]:bg-warning [&amp;_svg]:text-warning-100 bg-alternative border border-default ![&amp;_p]:text-background-muted\"><svg xmlns=\"http://www.w3.org/2000/svg\" viewBox=\"0 0 22 20\" class=\"w-6 h-6\" fill=\"currentColor\"><path fill-rule=\"evenodd\" clip-rule=\"evenodd\" d=\"M8.15137 1.95117C9.30615 -0.0488281 12.1943 -0.0488281 13.3481 1.95117L20.7031 14.6992C21.8574 16.6992 20.4131 19.1992 18.104 19.1992H3.39502C1.08594 19.1992 -0.356933 16.6992 0.797364 14.6992L8.15137 1.95117ZM11.7666 16.0083C11.4971 16.2778 11.1313 16.4292 10.75 16.4292C10.3687 16.4292 10.0029 16.2778 9.7334 16.0083C9.46387 15.7388 9.3125 15.373 9.3125 14.9917C9.3125 14.9307 9.31641 14.8706 9.32373 14.811C9.33545 14.7197 9.35547 14.6304 9.38379 14.5439L9.41406 14.4609C9.48584 14.2803 9.59375 14.1147 9.7334 13.9751C10.0029 13.7056 10.3687 13.5542 10.75 13.5542C11.1313 13.5542 11.4971 13.7056 11.7666 13.9751C12.0361 14.2446 12.1875 14.6104 12.1875 14.9917C12.1875 15.373 12.0361 15.7388 11.7666 16.0083ZM10.75 4.69971C11.0317 4.69971 11.3022 4.81152 11.5015 5.01074C11.7007 5.20996 11.8125 5.48047 11.8125 5.76221V11.0747C11.8125 11.3564 11.7007 11.627 11.5015 11.8262C11.3022 12.0254 11.0317 12.1372 10.75 12.1372C10.4683 12.1372 10.1978 12.0254 9.99854 11.8262C9.79932 11.627 9.6875 11.3564 9.6875 11.0747V5.76221C9.6875 5.48047 9.79932 5.20996 9.99854 5.01074C10.1978 4.81152 10.4683 4.69971 10.75 4.69971Z\"></path></svg><div class=\"text mt [&amp;_p]:mb-1.5 [&amp;_p]:mt-0 mt-0.5 [&amp;_p:last-child]:mb-0\"><p>RLS is latency-sensitive, so extra caution should be taken before implementing this method. Use the <a href=\"https://supabase.com/docs/guides/platform/performance#optimizing-poor-performing-queries\">query plan analyzer</a> to measure execution times for your queries to ensure they are within expected ranges. For enterprise applications, contact <a href=\"mailto:enterprise@supabase.io\">enterprise@supabase.io</a>.</p></div></div>\n<div role=\"alert\" class=\"relative w-full text-sm rounded-lg p-4 [&amp;>svg~*]:pl-10 [&amp;>svg+div]:translate-y-[-3px] [&amp;>svg]:absolute [&amp;>svg]:left-4 [&amp;>svg]:top-4 [&amp;>svg]:w-[23px] [&amp;>svg]:h-[23px] [&amp;>svg]:p-1 [&amp;>svg]:flex [&amp;>svg]:rounded text-foreground [&amp;>svg]:text-background [&amp;>svg]:bg-foreground mb-2 [&amp;_svg]:bg-foreground-muted [&amp;_svg]:text-background-muted bg-surface-200/25 border border-default\"><svg xmlns=\"http://www.w3.org/2000/svg\" viewBox=\"0 0 21 20\" class=\"w-6 h-6\" fill=\"currentColor\"><path fill-rule=\"evenodd\" clip-rule=\"evenodd\" d=\"M0.625 9.8252C0.625 4.44043 4.99023 0.0751953 10.375 0.0751953C15.7598 0.0751953 20.125 4.44043 20.125 9.8252C20.125 15.21 15.7598 19.5752 10.375 19.5752C4.99023 19.5752 0.625 15.21 0.625 9.8252ZM9.3584 4.38135C9.45117 4.28857 9.55518 4.20996 9.66699 4.14648C9.88086 4.02539 10.1245 3.96045 10.375 3.96045C10.5845 3.96045 10.7896 4.00586 10.9766 4.09229C11.1294 4.1626 11.2705 4.26025 11.3916 4.38135C11.6611 4.65088 11.8125 5.0166 11.8125 5.39795C11.8125 5.5249 11.7959 5.6499 11.7637 5.77002C11.6987 6.01172 11.5718 6.23438 11.3916 6.41455C11.1221 6.68408 10.7563 6.83545 10.375 6.83545C9.99365 6.83545 9.62793 6.68408 9.3584 6.41455C9.08887 6.14502 8.9375 5.7793 8.9375 5.39795C8.9375 5.29492 8.94873 5.19287 8.97021 5.09375C9.02783 4.82568 9.16162 4.57812 9.3584 4.38135ZM10.375 15.6899C10.0933 15.6899 9.82275 15.5781 9.62354 15.3789C9.42432 15.1797 9.3125 14.9092 9.3125 14.6274V9.31494C9.3125 9.0332 9.42432 8.7627 9.62354 8.56348C9.82275 8.36426 10.0933 8.25244 10.375 8.25244C10.6567 8.25244 10.9272 8.36426 11.1265 8.56348C11.3257 8.7627 11.4375 9.0332 11.4375 9.31494V14.6274C11.4375 14.7944 11.3979 14.9575 11.3242 15.104C11.2739 15.2046 11.2075 15.2979 11.1265 15.3789C10.9272 15.5781 10.6567 15.6899 10.375 15.6899Z\"></path></svg><div class=\"text mt [&amp;_p]:mb-1.5 [&amp;_p]:mt-0 mt-0.5 [&amp;_p:last-child]:mb-0\"><p>For data sources other than Postgres, see <a href=\"/docs/guides/database/extensions/wrappers/overview\">Foreign Data Wrappers</a> for a list of external sources supported today. If your data lives in a source not provided in the list, please contact <a href=\"https://supabase.com/dashboard/support/new\">support</a> and we'll be happy to discuss your use case.</p></div></div>\n<p>Let's assume your external DB contains a <code>users</code> and <code>documents</code> table like this:</p>\n<div class=\"ch-codeblock not-prose \" data-ch-theme=\"supabase\"><div class=\"ch-code-wrapper ch-code\" data-ch-measured=\"false\"><code class=\"ch-code-scroll-parent\"><br><div><span class=\"ch-code-line-number\">_<!-- -->12</span><div style=\"display:inline-block;margin-left:16px\"><span>create table public.users (</span></div></div><div><span class=\"ch-code-line-number\">_<!-- -->12</span><div style=\"display:inline-block;margin-left:16px\"><span>  id bigint primary key generated always as identity,</span></div></div><div><span class=\"ch-code-line-number\">_<!-- -->12</span><div style=\"display:inline-block;margin-left:16px\"><span>  email text not null,</span></div></div><div><span class=\"ch-code-line-number\">_<!-- -->12</span><div style=\"display:inline-block;margin-left:16px\"><span>  created_at timestamp with time zone not null default now()</span></div></div><div><span class=\"ch-code-line-number\">_<!-- -->12</span><div style=\"display:inline-block;margin-left:16px\"><span>);</span></div></div><div><span class=\"ch-code-line-number\">_<!-- -->12</span><div style=\"display:inline-block;margin-left:16px\"><span></span></div></div><div><span class=\"ch-code-line-number\">_<!-- -->12</span><div style=\"display:inline-block;margin-left:16px\"><span>create table public.documents (</span></div></div><div><span class=\"ch-code-line-number\">_<!-- -->12</span><div style=\"display:inline-block;margin-left:16px\"><span>  id bigint primary key generated always as identity,</span></div></div><div><span class=\"ch-code-line-number\">_<!-- -->12</span><div style=\"display:inline-block;margin-left:16px\"><span>  name text not null,</span></div></div><div><span class=\"ch-code-line-number\">_<!-- -->12</span><div style=\"display:inline-block;margin-left:16px\"><span>  owner_id bigint not null references public.users (id),</span></div></div><div><span class=\"ch-code-line-number\">_<!-- -->12</span><div style=\"display:inline-block;margin-left:16px\"><span>  created_at timestamp with time zone not null default now()</span></div></div><div><span class=\"ch-code-line-number\">_<!-- -->12</span><div style=\"display:inline-block;margin-left:16px\"><span>);</span></div></div><br></code></div></div>\n<p>In your Supabase DB, let's create foreign tables that link to the above tables:</p>\n<div class=\"ch-codeblock not-prose \" data-ch-theme=\"supabase\"><div class=\"ch-code-wrapper ch-code\" data-ch-measured=\"false\"><code class=\"ch-code-scroll-parent\"><br><div><span class=\"ch-code-line-number\">_<!-- -->16</span><div style=\"display:inline-block;margin-left:16px\"><span>create schema external;</span></div></div><div><span class=\"ch-code-line-number\">_<!-- -->16</span><div style=\"display:inline-block;margin-left:16px\"><span>create extension postgres_fdw with schema extensions;</span></div></div><div><span class=\"ch-code-line-number\">_<!-- -->16</span><div style=\"display:inline-block;margin-left:16px\"><span></span></div></div><div><span class=\"ch-code-line-number\">_<!-- -->16</span><div style=\"display:inline-block;margin-left:16px\"><span>-- Setup the foreign server</span></div></div><div><span class=\"ch-code-line-number\">_<!-- -->16</span><div style=\"display:inline-block;margin-left:16px\"><span>create server foreign_server</span></div></div><div><span class=\"ch-code-line-number\">_<!-- -->16</span><div style=\"display:inline-block;margin-left:16px\"><span>  foreign data wrapper postgres_fdw</span></div></div><div><span class=\"ch-code-line-number\">_<!-- -->16</span><div style=\"display:inline-block;margin-left:16px\"><span>  options (host '&lt;db-host&gt;', port '&lt;db-port&gt;', dbname '&lt;db-name&gt;');</span></div></div><div><span class=\"ch-code-line-number\">_<!-- -->16</span><div style=\"display:inline-block;margin-left:16px\"><span></span></div></div><div><span class=\"ch-code-line-number\">_<!-- -->16</span><div style=\"display:inline-block;margin-left:16px\"><span>-- Map local 'authenticated' role to external 'postgres' user</span></div></div><div><span class=\"ch-code-line-number\">_<!-- -->16</span><div style=\"display:inline-block;margin-left:16px\"><span>create user mapping for authenticated</span></div></div><div><span class=\"ch-code-line-number\">_<!-- -->16</span><div style=\"display:inline-block;margin-left:16px\"><span>  server foreign_server</span></div></div><div><span class=\"ch-code-line-number\">_<!-- -->16</span><div style=\"display:inline-block;margin-left:16px\"><span>  options (user 'postgres', password '&lt;user-password&gt;');</span></div></div><div><span class=\"ch-code-line-number\">_<!-- -->16</span><div style=\"display:inline-block;margin-left:16px\"><span></span></div></div><div><span class=\"ch-code-line-number\">_<!-- -->16</span><div style=\"display:inline-block;margin-left:16px\"><span>-- Import foreign 'users' and 'documents' tables into 'external' schema</span></div></div><div><span class=\"ch-code-line-number\">_<!-- -->16</span><div style=\"display:inline-block;margin-left:16px\"><span>import foreign schema public limit to (users, documents)</span></div></div><div><span class=\"ch-code-line-number\">_<!-- -->16</span><div style=\"display:inline-block;margin-left:16px\"><span>  from server foreign_server into external;</span></div></div><br></code></div></div>\n<div role=\"alert\" class=\"relative w-full text-sm rounded-lg p-4 [&amp;>svg~*]:pl-10 [&amp;>svg+div]:translate-y-[-3px] [&amp;>svg]:absolute [&amp;>svg]:left-4 [&amp;>svg]:top-4 [&amp;>svg]:w-[23px] [&amp;>svg]:h-[23px] [&amp;>svg]:p-1 [&amp;>svg]:flex [&amp;>svg]:rounded text-foreground [&amp;>svg]:text-background [&amp;>svg]:bg-foreground mb-2 [&amp;_svg]:bg-foreground-muted [&amp;_svg]:text-background-muted bg-surface-200/25 border border-default\"><svg xmlns=\"http://www.w3.org/2000/svg\" viewBox=\"0 0 21 20\" class=\"w-6 h-6\" fill=\"currentColor\"><path fill-rule=\"evenodd\" clip-rule=\"evenodd\" d=\"M0.625 9.8252C0.625 4.44043 4.99023 0.0751953 10.375 0.0751953C15.7598 0.0751953 20.125 4.44043 20.125 9.8252C20.125 15.21 15.7598 19.5752 10.375 19.5752C4.99023 19.5752 0.625 15.21 0.625 9.8252ZM9.3584 4.38135C9.45117 4.28857 9.55518 4.20996 9.66699 4.14648C9.88086 4.02539 10.1245 3.96045 10.375 3.96045C10.5845 3.96045 10.7896 4.00586 10.9766 4.09229C11.1294 4.1626 11.2705 4.26025 11.3916 4.38135C11.6611 4.65088 11.8125 5.0166 11.8125 5.39795C11.8125 5.5249 11.7959 5.6499 11.7637 5.77002C11.6987 6.01172 11.5718 6.23438 11.3916 6.41455C11.1221 6.68408 10.7563 6.83545 10.375 6.83545C9.99365 6.83545 9.62793 6.68408 9.3584 6.41455C9.08887 6.14502 8.9375 5.7793 8.9375 5.39795C8.9375 5.29492 8.94873 5.19287 8.97021 5.09375C9.02783 4.82568 9.16162 4.57812 9.3584 4.38135ZM10.375 15.6899C10.0933 15.6899 9.82275 15.5781 9.62354 15.3789C9.42432 15.1797 9.3125 14.9092 9.3125 14.6274V9.31494C9.3125 9.0332 9.42432 8.7627 9.62354 8.56348C9.82275 8.36426 10.0933 8.25244 10.375 8.25244C10.6567 8.25244 10.9272 8.36426 11.1265 8.56348C11.3257 8.7627 11.4375 9.0332 11.4375 9.31494V14.6274C11.4375 14.7944 11.3979 14.9575 11.3242 15.104C11.2739 15.2046 11.2075 15.2979 11.1265 15.3789C10.9272 15.5781 10.6567 15.6899 10.375 15.6899Z\"></path></svg><div class=\"text mt [&amp;_p]:mb-1.5 [&amp;_p]:mt-0 mt-0.5 [&amp;_p:last-child]:mb-0\"><p>This example maps the <code>authenticated</code> role in Supabase to the <code>postgres</code> user in the external DB. In production, it's best to create a custom user on the external DB that has the minimum permissions necessary to access the information you need.</p><p>On the Supabase DB, we use the built-in <code>authenticated</code> role which is automatically used when end users make authenticated requests over your auto-generated REST API. If you plan to connect to your Supabase DB over a direct Postgres connection instead of the REST API, you can change this to any user you like. See <a href=\"#direct-postgres-connection\">Direct Postgres Connection</a> for more info.</p></div></div>\n<p>We'll store <code>document_sections</code> and their embeddings in Supabase so that we can perform similarity search over them via pgvector.</p>\n<div class=\"ch-codeblock not-prose \" data-ch-theme=\"supabase\"><div class=\"ch-code-wrapper ch-code\" data-ch-measured=\"false\"><code class=\"ch-code-scroll-parent\"><br><div><span class=\"ch-code-line-number\">_<!-- -->10</span><div style=\"display:inline-block;margin-left:16px\"><span>create table document_sections (</span></div></div><div><span class=\"ch-code-line-number\">_<!-- -->10</span><div style=\"display:inline-block;margin-left:16px\"><span>  id bigint primary key generated always as identity,</span></div></div><div><span class=\"ch-code-line-number\">_<!-- -->10</span><div style=\"display:inline-block;margin-left:16px\"><span>  document_id bigint not null,</span></div></div><div><span class=\"ch-code-line-number\">_<!-- -->10</span><div style=\"display:inline-block;margin-left:16px\"><span>  content text not null,</span></div></div><div><span class=\"ch-code-line-number\">_<!-- -->10</span><div style=\"display:inline-block;margin-left:16px\"><span>  embedding vector (384)</span></div></div><div><span class=\"ch-code-line-number\">_<!-- -->10</span><div style=\"display:inline-block;margin-left:16px\"><span>);</span></div></div><br></code></div></div>\n<p>We maintain a reference to the foreign document via <code>document_id</code>, but without a foreign key reference since foreign keys can only be added to local tables. Be sure to use the same ID data type that you use on your external documents table.</p>\n<p>Since we're managing users and authentication outside of Supabase, we have two options:</p>\n<ol>\n<li>Make a direct Postgres connection to the Supabase DB and set the current user every request</li>\n<li>Issue a custom JWT from your system and use it to authenticate with the REST API</li>\n</ol>\n<h4 id=\"direct-postgres-connection\" class=\"group scroll-mt-24\">Direct Postgres connection<a href=\"#direct-postgres-connection\" aria-hidden=\"true\" class=\"ml-2 opacity-0 group-hover:opacity-100 transition\"><span aria-hidden=\"true\">#</span></a></h4>\n<p>You can directly connect to your Supabase Postgres DB using the <a href=\"/dashboard/project/_/settings/database\">connection info</a> on your project's database settings page. To use RLS with this method, we use a custom session variable that contains the current user's ID:</p>\n<div class=\"ch-codeblock not-prose \" data-ch-theme=\"supabase\"><div class=\"ch-code-wrapper ch-code\" data-ch-measured=\"false\"><code class=\"ch-code-scroll-parent\"><br><div><span class=\"ch-code-line-number\">_<!-- -->12</span><div style=\"display:inline-block;margin-left:16px\"><span>-- enable row level security</span></div></div><div><span class=\"ch-code-line-number\">_<!-- -->12</span><div style=\"display:inline-block;margin-left:16px\"><span>alter table document_sections enable row level security;</span></div></div><div><span class=\"ch-code-line-number\">_<!-- -->12</span><div style=\"display:inline-block;margin-left:16px\"><span></span></div></div><div><span class=\"ch-code-line-number\">_<!-- -->12</span><div style=\"display:inline-block;margin-left:16px\"><span>-- setup RLS for select operations</span></div></div><div><span class=\"ch-code-line-number\">_<!-- -->12</span><div style=\"display:inline-block;margin-left:16px\"><span>create policy \"Users can query their own document sections\"</span></div></div><div><span class=\"ch-code-line-number\">_<!-- -->12</span><div style=\"display:inline-block;margin-left:16px\"><span>on document_sections for select to authenticated using (</span></div></div><div><span class=\"ch-code-line-number\">_<!-- -->12</span><div style=\"display:inline-block;margin-left:16px\"><span>  document_id in (</span></div></div><div><span class=\"ch-code-line-number\">_<!-- -->12</span><div style=\"display:inline-block;margin-left:16px\"><span>    select id</span></div></div><div><span class=\"ch-code-line-number\">_<!-- -->12</span><div style=\"display:inline-block;margin-left:16px\"><span>    from external.documents</span></div></div><div><span class=\"ch-code-line-number\">_<!-- -->12</span><div style=\"display:inline-block;margin-left:16px\"><span>    where owner_id = current_setting('app.current_user_id')::bigint</span></div></div><div><span class=\"ch-code-line-number\">_<!-- -->12</span><div style=\"display:inline-block;margin-left:16px\"><span>  )</span></div></div><div><span class=\"ch-code-line-number\">_<!-- -->12</span><div style=\"display:inline-block;margin-left:16px\"><span>);</span></div></div><br></code></div></div>\n<p>The session variable is accessed through the <code>current_setting()</code> function. We name the variable <code>app.current_user_id</code> here, but you can modify this to any name you like. We also cast it to a <code>bigint</code> since that was the data type of the <code>user.id</code> column. Change this to whatever data type you use for your ID.</p>\n<p>Now for every request, we set the user's ID at the beginning of the session:</p>\n<div class=\"ch-codeblock not-prose \" data-ch-theme=\"supabase\"><div class=\"ch-code-wrapper ch-code\" data-ch-measured=\"false\"><code class=\"ch-code-scroll-parent\"><br><div><span class=\"ch-code-line-number\">_<!-- -->10</span><div style=\"display:inline-block;margin-left:16px\"><span>set app.current_user_id = '&lt;current-user-id&gt;';</span></div></div><br></code></div></div>\n<p>Then all subsequent queries will inherit the permission of that user:</p>\n<div class=\"ch-codeblock not-prose \" data-ch-theme=\"supabase\"><div class=\"ch-code-wrapper ch-code\" data-ch-measured=\"false\"><code class=\"ch-code-scroll-parent\"><br><div><span class=\"ch-code-line-number\">_<!-- -->10</span><div style=\"display:inline-block;margin-left:16px\"><span>-- Only document sections owned by the user are returned</span></div></div><div><span class=\"ch-code-line-number\">_<!-- -->10</span><div style=\"display:inline-block;margin-left:16px\"><span>select *</span></div></div><div><span class=\"ch-code-line-number\">_<!-- -->10</span><div style=\"display:inline-block;margin-left:16px\"><span>from document_sections</span></div></div><div><span class=\"ch-code-line-number\">_<!-- -->10</span><div style=\"display:inline-block;margin-left:16px\"><span>where document_sections.embedding &lt;#&gt; embedding &lt; -match_threshold</span></div></div><div><span class=\"ch-code-line-number\">_<!-- -->10</span><div style=\"display:inline-block;margin-left:16px\"><span>order by document_sections.embedding &lt;#&gt; embedding;</span></div></div><br></code></div></div>\n<div role=\"alert\" class=\"relative w-full text-sm rounded-lg p-4 [&amp;>svg~*]:pl-10 [&amp;>svg+div]:translate-y-[-3px] [&amp;>svg]:absolute [&amp;>svg]:left-4 [&amp;>svg]:top-4 [&amp;>svg]:w-[23px] [&amp;>svg]:h-[23px] [&amp;>svg]:p-1 [&amp;>svg]:flex [&amp;>svg]:rounded text-foreground [&amp;>svg]:text-background [&amp;>svg]:bg-foreground mb-2 [&amp;_svg]:bg-foreground-muted [&amp;_svg]:text-background-muted bg-surface-200/25 border border-default\"><svg xmlns=\"http://www.w3.org/2000/svg\" viewBox=\"0 0 21 20\" class=\"w-6 h-6\" fill=\"currentColor\"><path fill-rule=\"evenodd\" clip-rule=\"evenodd\" d=\"M0.625 9.8252C0.625 4.44043 4.99023 0.0751953 10.375 0.0751953C15.7598 0.0751953 20.125 4.44043 20.125 9.8252C20.125 15.21 15.7598 19.5752 10.375 19.5752C4.99023 19.5752 0.625 15.21 0.625 9.8252ZM9.3584 4.38135C9.45117 4.28857 9.55518 4.20996 9.66699 4.14648C9.88086 4.02539 10.1245 3.96045 10.375 3.96045C10.5845 3.96045 10.7896 4.00586 10.9766 4.09229C11.1294 4.1626 11.2705 4.26025 11.3916 4.38135C11.6611 4.65088 11.8125 5.0166 11.8125 5.39795C11.8125 5.5249 11.7959 5.6499 11.7637 5.77002C11.6987 6.01172 11.5718 6.23438 11.3916 6.41455C11.1221 6.68408 10.7563 6.83545 10.375 6.83545C9.99365 6.83545 9.62793 6.68408 9.3584 6.41455C9.08887 6.14502 8.9375 5.7793 8.9375 5.39795C8.9375 5.29492 8.94873 5.19287 8.97021 5.09375C9.02783 4.82568 9.16162 4.57812 9.3584 4.38135ZM10.375 15.6899C10.0933 15.6899 9.82275 15.5781 9.62354 15.3789C9.42432 15.1797 9.3125 14.9092 9.3125 14.6274V9.31494C9.3125 9.0332 9.42432 8.7627 9.62354 8.56348C9.82275 8.36426 10.0933 8.25244 10.375 8.25244C10.6567 8.25244 10.9272 8.36426 11.1265 8.56348C11.3257 8.7627 11.4375 9.0332 11.4375 9.31494V14.6274C11.4375 14.7944 11.3979 14.9575 11.3242 15.104C11.2739 15.2046 11.2075 15.2979 11.1265 15.3789C10.9272 15.5781 10.6567 15.6899 10.375 15.6899Z\"></path></svg><div class=\"text mt [&amp;_p]:mb-1.5 [&amp;_p]:mt-0 mt-0.5 [&amp;_p:last-child]:mb-0\"><p>You might be tempted to discard RLS completely and simply filter by user within the <code>where</code> clause. Though this will work, we recommend RLS as a general best practice since RLS is always applied even as new queries and application logic is introduced in the future.</p></div></div>\n<h4 id=\"custom-jwt-with-rest-api\" class=\"group scroll-mt-24\">Custom JWT with REST API<a href=\"#custom-jwt-with-rest-api\" aria-hidden=\"true\" class=\"ml-2 opacity-0 group-hover:opacity-100 transition\"><span aria-hidden=\"true\">#</span></a></h4>\n<p>If you would like to use the auto-generated REST API to query your Supabase database using JWTs from an external auth provider, you can get your auth provider to issue a custom JWT for Supabase.</p>\n<p>See the <a href=\"https://clerk.com/docs/integrations/databases/supabase\">Clerk Supabase docs</a> for an example of how this can be done. Modify the instructions to work with your own auth provider as needed.</p>\n<p>Now we can simply use the same RLS policy from our first example:</p>\n<div class=\"ch-codeblock not-prose \" data-ch-theme=\"supabase\"><div class=\"ch-code-wrapper ch-code\" data-ch-measured=\"false\"><code class=\"ch-code-scroll-parent\"><br><div><span class=\"ch-code-line-number\">_<!-- -->12</span><div style=\"display:inline-block;margin-left:16px\"><span>-- enable row level security</span></div></div><div><span class=\"ch-code-line-number\">_<!-- -->12</span><div style=\"display:inline-block;margin-left:16px\"><span>alter table document_sections enable row level security;</span></div></div><div><span class=\"ch-code-line-number\">_<!-- -->12</span><div style=\"display:inline-block;margin-left:16px\"><span></span></div></div><div><span class=\"ch-code-line-number\">_<!-- -->12</span><div style=\"display:inline-block;margin-left:16px\"><span>-- setup RLS for select operations</span></div></div><div><span class=\"ch-code-line-number\">_<!-- -->12</span><div style=\"display:inline-block;margin-left:16px\"><span>create policy \"Users can query their own document sections\"</span></div></div><div><span class=\"ch-code-line-number\">_<!-- -->12</span><div style=\"display:inline-block;margin-left:16px\"><span>on document_sections for select to authenticated using (</span></div></div><div><span class=\"ch-code-line-number\">_<!-- -->12</span><div style=\"display:inline-block;margin-left:16px\"><span>  document_id in (</span></div></div><div><span class=\"ch-code-line-number\">_<!-- -->12</span><div style=\"display:inline-block;margin-left:16px\"><span>    select id</span></div></div><div><span class=\"ch-code-line-number\">_<!-- -->12</span><div style=\"display:inline-block;margin-left:16px\"><span>    from documents</span></div></div><div><span class=\"ch-code-line-number\">_<!-- -->12</span><div style=\"display:inline-block;margin-left:16px\"><span>    where (owner_id = (select auth.uid()))</span></div></div><div><span class=\"ch-code-line-number\">_<!-- -->12</span><div style=\"display:inline-block;margin-left:16px\"><span>  )</span></div></div><div><span class=\"ch-code-line-number\">_<!-- -->12</span><div style=\"display:inline-block;margin-left:16px\"><span>);</span></div></div><br></code></div></div>\n<p>Under the hood, <code>auth.uid()</code> references <code>current_setting('request.jwt.claim.sub')</code> which corresponds to the JWT's <code>sub</code> (subject) claim. This setting is automatically set at the beginning of each request to the REST API.</p>\n<p>All subsequent queries will inherit the permission of that user:</p>\n<div class=\"ch-codeblock not-prose \" data-ch-theme=\"supabase\"><div class=\"ch-code-wrapper ch-code\" data-ch-measured=\"false\"><code class=\"ch-code-scroll-parent\"><br><div><span class=\"ch-code-line-number\">_<!-- -->10</span><div style=\"display:inline-block;margin-left:16px\"><span>-- Only document sections owned by the user are returned</span></div></div><div><span class=\"ch-code-line-number\">_<!-- -->10</span><div style=\"display:inline-block;margin-left:16px\"><span>select *</span></div></div><div><span class=\"ch-code-line-number\">_<!-- -->10</span><div style=\"display:inline-block;margin-left:16px\"><span>from document_sections</span></div></div><div><span class=\"ch-code-line-number\">_<!-- -->10</span><div style=\"display:inline-block;margin-left:16px\"><span>where document_sections.embedding &lt;#&gt; embedding &lt; -match_threshold</span></div></div><div><span class=\"ch-code-line-number\">_<!-- -->10</span><div style=\"display:inline-block;margin-left:16px\"><span>order by document_sections.embedding &lt;#&gt; embedding;</span></div></div><br></code></div></div>\n<h3 id=\"other-scenarios\" class=\"group scroll-mt-24\">Other scenarios<a href=\"#other-scenarios\" aria-hidden=\"true\" class=\"ml-2 opacity-0 group-hover:opacity-100 transition\"><span aria-hidden=\"true\">#</span></a></h3>\n<p>There are endless approaches to this problem based on the complexities of each system. Luckily Postgres comes with all the primitives needed to provide access control in the way that works best for your project.</p>\n<p>If the examples above didn't fit your use case or you need to adjust them slightly to better fit your existing system, feel free to reach out to <a href=\"https://supabase.com/dashboard/support/new\">support</a> and we'll be happy to assist you.</p></article></div></div></div><!--$--><div class=\"max-w-7xl px-5 mx-auto py-8 pt-0\"></div><!--/$--></div><div class=\"left-0 right-0 z-10 backdrop-blur-sm backdrop-filter bg-alternative/90 hidden h-0 lg:hidden\"></div></div></main></div></div></div></div></body></html>",
      "metadata": {
        "ogUrl": "https://supabase.com/docs/guides/ai/rag-with-permissions",
        "title": "RAG with Permissions | Supabase Docs",
        "robots": "index, follow",
        "ogImage": "https://obuldanrptloktxcffvn.supabase.co/functions/v1/og-images?site=docs&type=ai&title=RAG%20with%20Permissions&description=Implement%20fine-grain%20access%20control%20with%20retrieval%20augmented%20generation",
        "ogTitle": "RAG with Permissions | Supabase Docs",
        "language": "en",
        "sourceURL": "https://supabase.com/docs/guides/ai/rag-with-permissions",
        "description": "Implement fine-grain access control with retrieval augmented generation",
        "modifiedTime": "2024-09-10T20:36:24.564Z",
        "ogDescription": "Implement fine-grain access control with retrieval augmented generation",
        "publishedTime": "2024-09-10T20:36:24.564Z",
        "ogLocaleAlternate": [],
        "statusCode": 200
      }
    },
    {
      "markdown": "AI & Vectors\n\n# Roboflow\n\n## Learn how to integrate Supabase with Roboflow, a tool for running fine-tuned and foundation vision models.\n\n* * *\n\nIn this guide, we will walk through two examples of using [Roboflow Inference](https://inference.roboflow.com) to run fine-tuned and foundation models. We will run inference and save predictions using an object detection model and [CLIP](https://github.com/openai/CLIP).\n\n## Project setup [\\#](\\#project-setup)\n\nLet's create a new Postgres database. This is as simple as starting a new Project in Supabase:\n\n1. [Create a new project](https://database.new/) in the Supabase dashboard.\n2. Enter your project details. Remember to store your password somewhere safe.\n\nYour database will be available in less than a minute.\n\n**Finding your credentials:**\n\nYou can find your project credentials inside the project [settings](https://supabase.com/dashboard/project/_/settings/), including:\n\n- [Database credentials](https://supabase.com/dashboard/project/_/settings/database): connection strings and connection pooler details.\n- [API credentials](https://supabase.com/dashboard/project/_/settings/database): your serverless API URL and `anon` / `service_role` keys.\n\n## Save computer vision predictions [\\#](\\#save-computer-vision-predictions)\n\nOnce you have a trained vision model, you need to create business logic for your application. In many cases, you want to save inference results to a file.\n\nThe steps below show you how to run a vision model locally and save predictions to Supabase.\n\n### Preparation: Set up a model [\\#](\\#preparation-set-up-a-model)\n\nBefore you begin, you will need an object detection model trained on your data.\n\nYou can [train a model on Roboflow](https://blog.roboflow.com/getting-started-with-roboflow/), leveraging end-to-end tools from data management and annotation to deployment, or [upload custom model weights](https://docs.roboflow.com/deploy/upload-custom-weights) for deployment.\n\nAll models have an infinitely scalable API through which you can query your model, and can be run locally.\n\nFor this guide, we will use a demo [rock, paper, scissors](https://universe.roboflow.com/roboflow-58fyf/rock-paper-scissors-sxsw) model.\n\n### Step 1: Install and start Roboflow Inference [\\#](\\#step-1-install-and-start-roboflow-inference)\n\nYou will deploy our model locally using Roboflow Inference, a computer vision inference server.\n\nTo install and start Roboflow Inference, first install Docker on your machine.\n\nThen, run:\n\n`\n_10\npip install inference inference-cli inference-sdk && inference server start\n`\n\nAn inference server will be available at `http://localhost:9001`.\n\n### Step 2: Run inference on an image [\\#](\\#step-2-run-inference-on-an-image)\n\nYou can run inference on images and videos. Let's run inference on an image.\n\nCreate a new Python file and add the following code:\n\n`\n_13\nfrom inference_sdk import InferenceHTTPClient\n_13\n_13\nimage = \"example.jpg\"\n_13\nMODEL_ID = \"rock-paper-scissors-sxsw/11\"\n_13\n_13\nclient = InferenceHTTPClient(\n_13\n    api_url=\"http://localhost:9001\",\n_13\n    api_key=\"ROBOFLOW_API_KEY\"\n_13\n)\n_13\nwith client.use_model(MODEL_ID):\n_13\n    predictions = client.infer(image)\n_13\n_13\nprint(predictions)\n`\n\nAbove, replace:\n\n1. The image URL with the name of the image on which you want to run inference.\n2. `ROBOFLOW_API_KEY` with your Roboflow API key. [Learn how to retrieve your Roboflow API key](https://docs.roboflow.com/api-reference/authentication#retrieve-an-api-key).\n3. `MODEL_ID` with your Roboflow model ID. [Learn how to retrieve your model ID](https://docs.roboflow.com/api-reference/workspace-and-project-ids).\n\nWhen you run the code above, a list of predictions will be printed to the console:\n\n`\n_10\n{'time': 0.05402109300121083, 'image': {'width': 640, 'height': 480}, 'predictions': [{'x': 312.5, 'y': 392.0, 'width': 255.0, 'height': 110.0, 'confidence': 0.8620790839195251, 'class': 'Paper', 'class_id': 0}]}\n`\n\n### Step 3: Save results in Supabase [\\#](\\#step-3-save-results-in-supabase)\n\nTo save results in Supabase, add the following code to your script:\n\n`\n_10\nimport os\n_10\nfrom supabase import create_client, Client\n_10\n_10\nurl: str = os.environ.get(\"SUPABASE_URL\")\n_10\nkey: str = os.environ.get(\"SUPABASE_KEY\")\n_10\nsupabase: Client = create_client(url, key)\n_10\n_10\nresult = supabase.table('predictions') \\\n_10\n    .insert({\"filename\": image, \"predictions\": predictions}) \\\n_10\n    .execute()\n`\n\nYou can then query your predictions using the following code:\n\n`\n_10\nresult = supabase.table('predictions') \\\n_10\n    .select(\"predictions\") \\\n_10\n    .filter(\"filename\", \"eq\", image) \\\n_10\n    .execute()\n_10\n_10\nprint(result)\n`\n\nHere is an example result:\n\n`\n_10\ndata=[{'predictions': {'time': 0.08492901099998562, 'image': {'width': 640, 'height': 480}, 'predictions': [{'x': 312.5, 'y': 392.0, 'width': 255.0, 'height': 110.0, 'confidence': 0.8620790839195251, 'class': 'Paper', 'class_id': 0}]}}, {'predictions': {'time': 0.08818970100037404, 'image': {'width': 640, 'height': 480}, 'predictions': [{'x': 312.5, 'y': 392.0, 'width': 255.0, 'height': 110.0, 'confidence': 0.8620790839195251, 'class': 'Paper', 'class_id': 0}]}}] count=None\n`\n\n## Calculate and save CLIP embeddings [\\#](\\#calculate-and-save-clip-embeddings)\n\nYou can use the Supabase vector database functionality to store and query CLIP embeddings.\n\nRoboflow Inference provides a HTTP interface through which you can calculate image and text embeddings using CLIP.\n\n### Step 1: Install and start Roboflow Inference [\\#](\\#step-1-install-and-start-roboflow-inference)\n\nSee [Step #1: Install and Start Roboflow Inference](#step-1-install-and-start-roboflow-inference) above to install and start Roboflow Inference.\n\n### Step 2: Run CLIP on an image [\\#](\\#step-2-run-clip-on-an-image)\n\nCreate a new Python file and add the following code:\n\n`\n_32\nimport cv2\n_32\nimport supervision as sv\n_32\nimport requests\n_32\nimport base64\n_32\nimport os\n_32\n_32\nIMAGE_DIR = \"images/train/images/\"\n_32\nAPI_KEY = \"\"\n_32\nSERVER_URL = \"http://localhost:9001\"\n_32\n_32\nresults = []\n_32\n_32\nfor i, image in enumerate(os.listdir(IMAGE_DIR)):\n_32\n    print(f\"Processing image {image}\")\n_32\n    infer_clip_payload = {\n_32\n        \"image\": {\n_32\n            \"type\": \"base64\",\n_32\n            \"value\": base64.b64encode(open(IMAGE_DIR + image, \"rb\").read()).decode(\"utf-8\"),\n_32\n        },\n_32\n    }\n_32\n_32\n    res = requests.post(\n_32\n        f\"{SERVER_URL}/clip/embed_image?api_key={API_KEY}\",\n_32\n        json=infer_clip_payload,\n_32\n    )\n_32\n_32\n    embeddings = res.json()['embeddings']\n_32\n_32\n    results.append({\n_32\n        \"filename\": image,\n_32\n        \"embeddings\": embeddings\n_32\n    })\n`\n\nThis code will calculate CLIP embeddings for each image in the directory and print the results to the console.\n\nAbove, replace:\n\n1. `IMAGE_DIR` with the directory containing the images on which you want to run inference.\n2. `ROBOFLOW_API_KEY` with your Roboflow API key. [Learn how to retrieve your Roboflow API key](https://docs.roboflow.com/api-reference/authentication#retrieve-an-api-key).\n\nYou can also calculate CLIP embeddings in the cloud by setting `SERVER_URL` to `https://infer.roboflow.com`.\n\n### Step 3: Save embeddings in Supabase [\\#](\\#step-3-save-embeddings-in-supabase)\n\nYou can store your image embeddings in Supabase using the Supabase `vecs` Python package:\n\nFirst, install `vecs`:\n\n`\n_10\npip install vecs\n`\n\nNext, add the following code to your script to create an index:\n\n`\n_26\n_26\nimport vecs\n_26\n_26\nDB_CONNECTION = \"postgresql://postgres:[password]@[host]:[port]/[database]\"\n_26\n_26\nvx = vecs.create_client(DB_CONNECTION)\n_26\n_26\n# create a collection of vectors with 3 dimensions\n_26\nimages = vx.get_or_create_collection(name=\"image_vectors\", dimension=512)\n_26\n_26\nfor result in results:\n_26\n    image = result[\"filename\"]\n_26\n    embeddings = result[\"embeddings\"][0]\n_26\n_26\n    # insert a vector into the collection\n_26\n    images.upsert(\n_26\n        records=[\\\n_26\\\n            (\\\n_26\\\n                image,\\\n_26\\\n                embeddings,\\\n_26\\\n                {} # metadata\\\n_26\\\n            )\\\n_26\\\n        ]\n_26\n    )\n_26\n_26\nimages.create_index()\n`\n\nReplace `DB_CONNECTION` with the authentication information for your database. You can retrieve this from the Supabase dashboard in `Project Settings > Database Settings`.\n\nYou can then query your embeddings using the following code:\n\n`\n_17\ninfer_clip_payload = {\n_17\n    \"text\": \"cat\",\n_17\n}\n_17\n_17\nres = requests.post(\n_17\n    f\"{SERVER_URL}/clip/embed_text?api_key={API_KEY}\",\n_17\n    json=infer_clip_payload,\n_17\n)\n_17\n_17\nembeddings = res.json()['embeddings']\n_17\n_17\nresult = images.query(\n_17\n    data=embeddings[0],\n_17\n    limit=1\n_17\n)\n_17\n_17\nprint(result[0])\n`\n\n## Resources [\\#](\\#resources)\n\n- [Roboflow Inference documentation](https://inference.roboflow.com)\n- [Roboflow Getting Started guide](https://blog.roboflow.com/getting-started-with-roboflow/)\n- [How to Build a Semantic Image Search Engine with Supabase and OpenAI CLIP](https://blog.roboflow.com/how-to-use-semantic-search-supabase-openai-clip/)",
      "html": "<!DOCTYPE html><html lang=\"en\" data-theme=\"light\" style=\"color-scheme: light;\"><body><div class=\"flex flex-col\"><div class=\"grow\"><div class=\"flex flex-col h-full w-full\"><div class=\"hidden lg:sticky w-full lg:flex top-0 left-0 right-0 z-50\"><!--$--><!--/$--></div><div class=\"flex flex-row h-full relative\"><main id=\"docs-content-container\" class=\"w-full transition-all ease-out relative lg:ml-0\"><div class=\"flex flex-col sticky top-0\"><div class=\"flex lg:hidden w-full top-0 left-0 right-0 z-50\"><!--$--><!--/$--></div><div class=\"sticky transition-all top-0 z-10 backdrop-blur backdrop-filter bg-background\"><div class=\"lg:hidden px-3.5 border-b z-10 transition-all ease-out top-0 flex items-center gap-1\"><button class=\"h-8 w-8 flex group items-center justify-center mr-1\"><div class=\"space-y-1 cursor-pointer relative w-4 h-[8px]\"><span class=\"transition-all ease-out block h-px bg-foreground-muted group-hover:bg-foreground w-4\"></span><span class=\"transition-all ease-out block h-px bg-foreground-muted group-hover:bg-foreground w-3 group-hover:w-4\"></span></div></button><span class=\"transition-all duration-200 text-foreground text-sm\">AI &amp; Vectors</span></div></div><div class=\"grow\"><div class=\"max-w-7xl px-5 mx-auto py-8 pb-0\"><div class=\"grid grid-cols-12 relative gap-4\"><div class=\"relative transition-all ease-out duration-100 col-span-12 md:col-span-9\"><article id=\"sb-docs-guide-main-article\" class=\"prose max-w-none\"><h1 class=\"mb-0\">Roboflow</h1><h2 class=\"mt-3 text-xl text-foreground-light\">Learn how to integrate Supabase with Roboflow, a tool for running fine-tuned and foundation vision models.</h2><hr class=\"not-prose border-t-0 border-b my-8\">\n<p>In this guide, we will walk through two examples of using <a href=\"https://inference.roboflow.com\">Roboflow Inference</a> to run fine-tuned and foundation models. We will run inference and save predictions using an object detection model and <a href=\"https://github.com/openai/CLIP\">CLIP</a>.</p>\n<h2 id=\"project-setup\" class=\"group scroll-mt-24\">Project setup<a href=\"#project-setup\" aria-hidden=\"true\" class=\"ml-2 opacity-0 group-hover:opacity-100 transition\"><span aria-hidden=\"true\">#</span></a></h2>\n<p>Let's create a new Postgres database. This is as simple as starting a new Project in Supabase:</p>\n<ol>\n<li><a href=\"https://database.new/\">Create a new project</a> in the Supabase dashboard.</li>\n<li>Enter your project details. Remember to store your password somewhere safe.</li>\n</ol>\n<p>Your database will be available in less than a minute.</p>\n<p><strong>Finding your credentials:</strong></p>\n<p>You can find your project credentials inside the project <a href=\"https://supabase.com/dashboard/project/_/settings/\">settings</a>, including:</p>\n<ul>\n<li><a href=\"https://supabase.com/dashboard/project/_/settings/database\">Database credentials</a>: connection strings and connection pooler details.</li>\n<li><a href=\"https://supabase.com/dashboard/project/_/settings/database\">API credentials</a>: your serverless API URL and <code>anon</code> / <code>service_role</code> keys.</li>\n</ul>\n<h2 id=\"save-computer-vision-predictions\" class=\"group scroll-mt-24\">Save computer vision predictions<a href=\"#save-computer-vision-predictions\" aria-hidden=\"true\" class=\"ml-2 opacity-0 group-hover:opacity-100 transition\"><span aria-hidden=\"true\">#</span></a></h2>\n<p>Once you have a trained vision model, you need to create business logic for your application. In many cases, you want to save inference results to a file.</p>\n<p>The steps below show you how to run a vision model locally and save predictions to Supabase.</p>\n<h3 id=\"preparation-set-up-a-model\" class=\"group scroll-mt-24\">Preparation: Set up a model<a href=\"#preparation-set-up-a-model\" aria-hidden=\"true\" class=\"ml-2 opacity-0 group-hover:opacity-100 transition\"><span aria-hidden=\"true\">#</span></a></h3>\n<p>Before you begin, you will need an object detection model trained on your data.</p>\n<p>You can <a href=\"https://blog.roboflow.com/getting-started-with-roboflow/\">train a model on Roboflow</a>, leveraging end-to-end tools from data management and annotation to deployment, or <a href=\"https://docs.roboflow.com/deploy/upload-custom-weights\">upload custom model weights</a> for deployment.</p>\n<p>All models have an infinitely scalable API through which you can query your model, and can be run locally.</p>\n<p>For this guide, we will use a demo <a href=\"https://universe.roboflow.com/roboflow-58fyf/rock-paper-scissors-sxsw\">rock, paper, scissors</a> model.</p>\n<h3 id=\"step-1-install-and-start-roboflow-inference\" class=\"group scroll-mt-24\">Step 1: Install and start Roboflow Inference<a href=\"#step-1-install-and-start-roboflow-inference\" aria-hidden=\"true\" class=\"ml-2 opacity-0 group-hover:opacity-100 transition\"><span aria-hidden=\"true\">#</span></a></h3>\n<p>You will deploy our model locally using Roboflow Inference, a computer vision inference server.</p>\n<p>To install and start Roboflow Inference, first install Docker on your machine.</p>\n<p>Then, run:</p>\n<div class=\"ch-codeblock not-prose \" data-ch-theme=\"supabase\"><div class=\"ch-code-wrapper ch-code\" data-ch-measured=\"false\"><code class=\"ch-code-scroll-parent\"><br><div><span class=\"ch-code-line-number\">_<!-- -->10</span><div style=\"display:inline-block;margin-left:16px\"><span>pip install inference inference-cli inference-sdk &amp;&amp; inference server start</span></div></div><br></code></div></div>\n<p>An inference server will be available at <code>http://localhost:9001</code>.</p>\n<h3 id=\"step-2-run-inference-on-an-image\" class=\"group scroll-mt-24\">Step 2: Run inference on an image<a href=\"#step-2-run-inference-on-an-image\" aria-hidden=\"true\" class=\"ml-2 opacity-0 group-hover:opacity-100 transition\"><span aria-hidden=\"true\">#</span></a></h3>\n<p>You can run inference on images and videos. Let's run inference on an image.</p>\n<p>Create a new Python file and add the following code:</p>\n<div class=\"ch-codeblock not-prose \" data-ch-theme=\"supabase\"><div class=\"ch-code-wrapper ch-code\" data-ch-measured=\"false\"><code class=\"ch-code-scroll-parent\"><br><div><span class=\"ch-code-line-number\">_<!-- -->13</span><div style=\"display:inline-block;margin-left:16px\"><span>from inference_sdk import InferenceHTTPClient</span></div></div><div><span class=\"ch-code-line-number\">_<!-- -->13</span><div style=\"display:inline-block;margin-left:16px\"><span></span></div></div><div><span class=\"ch-code-line-number\">_<!-- -->13</span><div style=\"display:inline-block;margin-left:16px\"><span>image = \"example.jpg\"</span></div></div><div><span class=\"ch-code-line-number\">_<!-- -->13</span><div style=\"display:inline-block;margin-left:16px\"><span>MODEL_ID = \"rock-paper-scissors-sxsw/11\"</span></div></div><div><span class=\"ch-code-line-number\">_<!-- -->13</span><div style=\"display:inline-block;margin-left:16px\"><span></span></div></div><div><span class=\"ch-code-line-number\">_<!-- -->13</span><div style=\"display:inline-block;margin-left:16px\"><span>client = InferenceHTTPClient(</span></div></div><div><span class=\"ch-code-line-number\">_<!-- -->13</span><div style=\"display:inline-block;margin-left:16px\"><span>    api_url=\"http://localhost:9001\",</span></div></div><div><span class=\"ch-code-line-number\">_<!-- -->13</span><div style=\"display:inline-block;margin-left:16px\"><span>    api_key=\"ROBOFLOW_API_KEY\"</span></div></div><div><span class=\"ch-code-line-number\">_<!-- -->13</span><div style=\"display:inline-block;margin-left:16px\"><span>)</span></div></div><div><span class=\"ch-code-line-number\">_<!-- -->13</span><div style=\"display:inline-block;margin-left:16px\"><span>with client.use_model(MODEL_ID):</span></div></div><div><span class=\"ch-code-line-number\">_<!-- -->13</span><div style=\"display:inline-block;margin-left:16px\"><span>    predictions = client.infer(image)</span></div></div><div><span class=\"ch-code-line-number\">_<!-- -->13</span><div style=\"display:inline-block;margin-left:16px\"><span></span></div></div><div><span class=\"ch-code-line-number\">_<!-- -->13</span><div style=\"display:inline-block;margin-left:16px\"><span>print(predictions)</span></div></div><br></code></div></div>\n<p>Above, replace:</p>\n<ol>\n<li>The image URL with the name of the image on which you want to run inference.</li>\n<li><code>ROBOFLOW_API_KEY</code> with your Roboflow API key. <a href=\"https://docs.roboflow.com/api-reference/authentication#retrieve-an-api-key\">Learn how to retrieve your Roboflow API key</a>.</li>\n<li><code>MODEL_ID</code> with your Roboflow model ID. <a href=\"https://docs.roboflow.com/api-reference/workspace-and-project-ids\">Learn how to retrieve your model ID</a>.</li>\n</ol>\n<p>When you run the code above, a list of predictions will be printed to the console:</p>\n<div class=\"ch-codeblock not-prose \" data-ch-theme=\"supabase\"><div class=\"ch-code-wrapper ch-code\" data-ch-measured=\"false\"><code class=\"ch-code-scroll-parent\"><br><div><span class=\"ch-code-line-number\">_<!-- -->10</span><div style=\"display:inline-block;margin-left:16px\"><span>{'time': 0.05402109300121083, 'image': {'width': 640, 'height': 480}, 'predictions': [{'x': 312.5, 'y': 392.0, 'width': 255.0, 'height': 110.0, 'confidence': 0.8620790839195251, 'class': 'Paper', 'class_id': 0}]}</span></div></div><br></code></div></div>\n<h3 id=\"step-3-save-results-in-supabase\" class=\"group scroll-mt-24\">Step 3: Save results in Supabase<a href=\"#step-3-save-results-in-supabase\" aria-hidden=\"true\" class=\"ml-2 opacity-0 group-hover:opacity-100 transition\"><span aria-hidden=\"true\">#</span></a></h3>\n<p>To save results in Supabase, add the following code to your script:</p>\n<div class=\"ch-codeblock not-prose \" data-ch-theme=\"supabase\"><div class=\"ch-code-wrapper ch-code\" data-ch-measured=\"false\"><code class=\"ch-code-scroll-parent\"><br><div><span class=\"ch-code-line-number\">_<!-- -->10</span><div style=\"display:inline-block;margin-left:16px\"><span>import os</span></div></div><div><span class=\"ch-code-line-number\">_<!-- -->10</span><div style=\"display:inline-block;margin-left:16px\"><span>from supabase import create_client, Client</span></div></div><div><span class=\"ch-code-line-number\">_<!-- -->10</span><div style=\"display:inline-block;margin-left:16px\"><span></span></div></div><div><span class=\"ch-code-line-number\">_<!-- -->10</span><div style=\"display:inline-block;margin-left:16px\"><span>url: str = os.environ.get(\"SUPABASE_URL\")</span></div></div><div><span class=\"ch-code-line-number\">_<!-- -->10</span><div style=\"display:inline-block;margin-left:16px\"><span>key: str = os.environ.get(\"SUPABASE_KEY\")</span></div></div><div><span class=\"ch-code-line-number\">_<!-- -->10</span><div style=\"display:inline-block;margin-left:16px\"><span>supabase: Client = create_client(url, key)</span></div></div><div><span class=\"ch-code-line-number\">_<!-- -->10</span><div style=\"display:inline-block;margin-left:16px\"><span></span></div></div><div><span class=\"ch-code-line-number\">_<!-- -->10</span><div style=\"display:inline-block;margin-left:16px\"><span>result = supabase.table('predictions') \\</span></div></div><div><span class=\"ch-code-line-number\">_<!-- -->10</span><div style=\"display:inline-block;margin-left:16px\"><span>    .insert({\"filename\": image, \"predictions\": predictions}) \\</span></div></div><div><span class=\"ch-code-line-number\">_<!-- -->10</span><div style=\"display:inline-block;margin-left:16px\"><span>    .execute()</span></div></div><br></code></div></div>\n<p>You can then query your predictions using the following code:</p>\n<div class=\"ch-codeblock not-prose \" data-ch-theme=\"supabase\"><div class=\"ch-code-wrapper ch-code\" data-ch-measured=\"false\"><code class=\"ch-code-scroll-parent\"><br><div><span class=\"ch-code-line-number\">_<!-- -->10</span><div style=\"display:inline-block;margin-left:16px\"><span>result = supabase.table('predictions') \\</span></div></div><div><span class=\"ch-code-line-number\">_<!-- -->10</span><div style=\"display:inline-block;margin-left:16px\"><span>    .select(\"predictions\") \\</span></div></div><div><span class=\"ch-code-line-number\">_<!-- -->10</span><div style=\"display:inline-block;margin-left:16px\"><span>    .filter(\"filename\", \"eq\", image) \\</span></div></div><div><span class=\"ch-code-line-number\">_<!-- -->10</span><div style=\"display:inline-block;margin-left:16px\"><span>    .execute()</span></div></div><div><span class=\"ch-code-line-number\">_<!-- -->10</span><div style=\"display:inline-block;margin-left:16px\"><span></span></div></div><div><span class=\"ch-code-line-number\">_<!-- -->10</span><div style=\"display:inline-block;margin-left:16px\"><span>print(result)</span></div></div><br></code></div></div>\n<p>Here is an example result:</p>\n<div class=\"ch-codeblock not-prose \" data-ch-theme=\"supabase\"><div class=\"ch-code-wrapper ch-code\" data-ch-measured=\"false\"><code class=\"ch-code-scroll-parent\"><br><div><span class=\"ch-code-line-number\">_<!-- -->10</span><div style=\"display:inline-block;margin-left:16px\"><span>data=[{'predictions': {'time': 0.08492901099998562, 'image': {'width': 640, 'height': 480}, 'predictions': [{'x': 312.5, 'y': 392.0, 'width': 255.0, 'height': 110.0, 'confidence': 0.8620790839195251, 'class': 'Paper', 'class_id': 0}]}}, {'predictions': {'time': 0.08818970100037404, 'image': {'width': 640, 'height': 480}, 'predictions': [{'x': 312.5, 'y': 392.0, 'width': 255.0, 'height': 110.0, 'confidence': 0.8620790839195251, 'class': 'Paper', 'class_id': 0}]}}] count=None</span></div></div><br></code></div></div>\n<h2 id=\"calculate-and-save-clip-embeddings\" class=\"group scroll-mt-24\">Calculate and save CLIP embeddings<a href=\"#calculate-and-save-clip-embeddings\" aria-hidden=\"true\" class=\"ml-2 opacity-0 group-hover:opacity-100 transition\"><span aria-hidden=\"true\">#</span></a></h2>\n<p>You can use the Supabase vector database functionality to store and query CLIP embeddings.</p>\n<p>Roboflow Inference provides a HTTP interface through which you can calculate image and text embeddings using CLIP.</p>\n<h3 id=\"step-1-install-and-start-roboflow-inference\" class=\"group scroll-mt-24\">Step 1: Install and start Roboflow Inference<a href=\"#step-1-install-and-start-roboflow-inference\" aria-hidden=\"true\" class=\"ml-2 opacity-0 group-hover:opacity-100 transition\"><span aria-hidden=\"true\">#</span></a></h3>\n<p>See <a href=\"#step-1-install-and-start-roboflow-inference\">Step #1: Install and Start Roboflow Inference</a> above to install and start Roboflow Inference.</p>\n<h3 id=\"step-2-run-clip-on-an-image\" class=\"group scroll-mt-24\">Step 2: Run CLIP on an image<a href=\"#step-2-run-clip-on-an-image\" aria-hidden=\"true\" class=\"ml-2 opacity-0 group-hover:opacity-100 transition\"><span aria-hidden=\"true\">#</span></a></h3>\n<p>Create a new Python file and add the following code:</p>\n<div class=\"ch-codeblock not-prose \" data-ch-theme=\"supabase\"><div class=\"ch-code-wrapper ch-code\" data-ch-measured=\"false\"><code class=\"ch-code-scroll-parent\"><br><div><span class=\"ch-code-line-number\">_<!-- -->32</span><div style=\"display:inline-block;margin-left:16px\"><span>import cv2</span></div></div><div><span class=\"ch-code-line-number\">_<!-- -->32</span><div style=\"display:inline-block;margin-left:16px\"><span>import supervision as sv</span></div></div><div><span class=\"ch-code-line-number\">_<!-- -->32</span><div style=\"display:inline-block;margin-left:16px\"><span>import requests</span></div></div><div><span class=\"ch-code-line-number\">_<!-- -->32</span><div style=\"display:inline-block;margin-left:16px\"><span>import base64</span></div></div><div><span class=\"ch-code-line-number\">_<!-- -->32</span><div style=\"display:inline-block;margin-left:16px\"><span>import os</span></div></div><div><span class=\"ch-code-line-number\">_<!-- -->32</span><div style=\"display:inline-block;margin-left:16px\"><span></span></div></div><div><span class=\"ch-code-line-number\">_<!-- -->32</span><div style=\"display:inline-block;margin-left:16px\"><span>IMAGE_DIR = \"images/train/images/\"</span></div></div><div><span class=\"ch-code-line-number\">_<!-- -->32</span><div style=\"display:inline-block;margin-left:16px\"><span>API_KEY = \"\"</span></div></div><div><span class=\"ch-code-line-number\">_<!-- -->32</span><div style=\"display:inline-block;margin-left:16px\"><span>SERVER_URL = \"http://localhost:9001\"</span></div></div><div><span class=\"ch-code-line-number\">_<!-- -->32</span><div style=\"display:inline-block;margin-left:16px\"><span></span></div></div><div><span class=\"ch-code-line-number\">_<!-- -->32</span><div style=\"display:inline-block;margin-left:16px\"><span>results = []</span></div></div><div><span class=\"ch-code-line-number\">_<!-- -->32</span><div style=\"display:inline-block;margin-left:16px\"><span></span></div></div><div><span class=\"ch-code-line-number\">_<!-- -->32</span><div style=\"display:inline-block;margin-left:16px\"><span>for i, image in enumerate(os.listdir(IMAGE_DIR)):</span></div></div><div><span class=\"ch-code-line-number\">_<!-- -->32</span><div style=\"display:inline-block;margin-left:16px\"><span>    print(f\"Processing image {image}\")</span></div></div><div><span class=\"ch-code-line-number\">_<!-- -->32</span><div style=\"display:inline-block;margin-left:16px\"><span>    infer_clip_payload = {</span></div></div><div><span class=\"ch-code-line-number\">_<!-- -->32</span><div style=\"display:inline-block;margin-left:16px\"><span>        \"image\": {</span></div></div><div><span class=\"ch-code-line-number\">_<!-- -->32</span><div style=\"display:inline-block;margin-left:16px\"><span>            \"type\": \"base64\",</span></div></div><div><span class=\"ch-code-line-number\">_<!-- -->32</span><div style=\"display:inline-block;margin-left:16px\"><span>            \"value\": base64.b64encode(open(IMAGE_DIR + image, \"rb\").read()).decode(\"utf-8\"),</span></div></div><div><span class=\"ch-code-line-number\">_<!-- -->32</span><div style=\"display:inline-block;margin-left:16px\"><span>        },</span></div></div><div><span class=\"ch-code-line-number\">_<!-- -->32</span><div style=\"display:inline-block;margin-left:16px\"><span>    }</span></div></div><div><span class=\"ch-code-line-number\">_<!-- -->32</span><div style=\"display:inline-block;margin-left:16px\"><span></span></div></div><div><span class=\"ch-code-line-number\">_<!-- -->32</span><div style=\"display:inline-block;margin-left:16px\"><span>    res = requests.post(</span></div></div><div><span class=\"ch-code-line-number\">_<!-- -->32</span><div style=\"display:inline-block;margin-left:16px\"><span>        f\"{SERVER_URL}/clip/embed_image?api_key={API_KEY}\",</span></div></div><div><span class=\"ch-code-line-number\">_<!-- -->32</span><div style=\"display:inline-block;margin-left:16px\"><span>        json=infer_clip_payload,</span></div></div><div><span class=\"ch-code-line-number\">_<!-- -->32</span><div style=\"display:inline-block;margin-left:16px\"><span>    )</span></div></div><div><span class=\"ch-code-line-number\">_<!-- -->32</span><div style=\"display:inline-block;margin-left:16px\"><span></span></div></div><div><span class=\"ch-code-line-number\">_<!-- -->32</span><div style=\"display:inline-block;margin-left:16px\"><span>    embeddings = res.json()['embeddings']</span></div></div><div><span class=\"ch-code-line-number\">_<!-- -->32</span><div style=\"display:inline-block;margin-left:16px\"><span></span></div></div><div><span class=\"ch-code-line-number\">_<!-- -->32</span><div style=\"display:inline-block;margin-left:16px\"><span>    results.append({</span></div></div><div><span class=\"ch-code-line-number\">_<!-- -->32</span><div style=\"display:inline-block;margin-left:16px\"><span>        \"filename\": image,</span></div></div><div><span class=\"ch-code-line-number\">_<!-- -->32</span><div style=\"display:inline-block;margin-left:16px\"><span>        \"embeddings\": embeddings</span></div></div><div><span class=\"ch-code-line-number\">_<!-- -->32</span><div style=\"display:inline-block;margin-left:16px\"><span>    })</span></div></div><br></code></div></div>\n<p>This code will calculate CLIP embeddings for each image in the directory and print the results to the console.</p>\n<p>Above, replace:</p>\n<ol>\n<li><code>IMAGE_DIR</code> with the directory containing the images on which you want to run inference.</li>\n<li><code>ROBOFLOW_API_KEY</code> with your Roboflow API key. <a href=\"https://docs.roboflow.com/api-reference/authentication#retrieve-an-api-key\">Learn how to retrieve your Roboflow API key</a>.</li>\n</ol>\n<p>You can also calculate CLIP embeddings in the cloud by setting <code>SERVER_URL</code> to <code>https://infer.roboflow.com</code>.</p>\n<h3 id=\"step-3-save-embeddings-in-supabase\" class=\"group scroll-mt-24\">Step 3: Save embeddings in Supabase<a href=\"#step-3-save-embeddings-in-supabase\" aria-hidden=\"true\" class=\"ml-2 opacity-0 group-hover:opacity-100 transition\"><span aria-hidden=\"true\">#</span></a></h3>\n<p>You can store your image embeddings in Supabase using the Supabase <code>vecs</code> Python package:</p>\n<p>First, install <code>vecs</code>:</p>\n<div class=\"ch-codeblock not-prose \" data-ch-theme=\"supabase\"><div class=\"ch-code-wrapper ch-code\" data-ch-measured=\"false\"><code class=\"ch-code-scroll-parent\"><br><div><span class=\"ch-code-line-number\">_<!-- -->10</span><div style=\"display:inline-block;margin-left:16px\"><span>pip install vecs</span></div></div><br></code></div></div>\n<p>Next, add the following code to your script to create an index:</p>\n<div class=\"ch-codeblock not-prose \" data-ch-theme=\"supabase\"><div class=\"ch-code-wrapper ch-code\" data-ch-measured=\"false\"><code class=\"ch-code-scroll-parent\"><br><div><span class=\"ch-code-line-number\">_<!-- -->26</span><div style=\"display:inline-block;margin-left:16px\"><span></span></div></div><div><span class=\"ch-code-line-number\">_<!-- -->26</span><div style=\"display:inline-block;margin-left:16px\"><span>import vecs</span></div></div><div><span class=\"ch-code-line-number\">_<!-- -->26</span><div style=\"display:inline-block;margin-left:16px\"><span></span></div></div><div><span class=\"ch-code-line-number\">_<!-- -->26</span><div style=\"display:inline-block;margin-left:16px\"><span>DB_CONNECTION = \"postgresql://postgres:[password]@[host]:[port]/[database]\"</span></div></div><div><span class=\"ch-code-line-number\">_<!-- -->26</span><div style=\"display:inline-block;margin-left:16px\"><span></span></div></div><div><span class=\"ch-code-line-number\">_<!-- -->26</span><div style=\"display:inline-block;margin-left:16px\"><span>vx = vecs.create_client(DB_CONNECTION)</span></div></div><div><span class=\"ch-code-line-number\">_<!-- -->26</span><div style=\"display:inline-block;margin-left:16px\"><span></span></div></div><div><span class=\"ch-code-line-number\">_<!-- -->26</span><div style=\"display:inline-block;margin-left:16px\"><span># create a collection of vectors with 3 dimensions</span></div></div><div><span class=\"ch-code-line-number\">_<!-- -->26</span><div style=\"display:inline-block;margin-left:16px\"><span>images = vx.get_or_create_collection(name=\"image_vectors\", dimension=512)</span></div></div><div><span class=\"ch-code-line-number\">_<!-- -->26</span><div style=\"display:inline-block;margin-left:16px\"><span></span></div></div><div><span class=\"ch-code-line-number\">_<!-- -->26</span><div style=\"display:inline-block;margin-left:16px\"><span>for result in results:</span></div></div><div><span class=\"ch-code-line-number\">_<!-- -->26</span><div style=\"display:inline-block;margin-left:16px\"><span>    image = result[\"filename\"]</span></div></div><div><span class=\"ch-code-line-number\">_<!-- -->26</span><div style=\"display:inline-block;margin-left:16px\"><span>    embeddings = result[\"embeddings\"][0]</span></div></div><div><span class=\"ch-code-line-number\">_<!-- -->26</span><div style=\"display:inline-block;margin-left:16px\"><span></span></div></div><div><span class=\"ch-code-line-number\">_<!-- -->26</span><div style=\"display:inline-block;margin-left:16px\"><span>    # insert a vector into the collection</span></div></div><div><span class=\"ch-code-line-number\">_<!-- -->26</span><div style=\"display:inline-block;margin-left:16px\"><span>    images.upsert(</span></div></div><div><span class=\"ch-code-line-number\">_<!-- -->26</span><div style=\"display:inline-block;margin-left:16px\"><span>        records=[</span></div></div><div><span class=\"ch-code-line-number\">_<!-- -->26</span><div style=\"display:inline-block;margin-left:16px\"><span>            (</span></div></div><div><span class=\"ch-code-line-number\">_<!-- -->26</span><div style=\"display:inline-block;margin-left:16px\"><span>                image,</span></div></div><div><span class=\"ch-code-line-number\">_<!-- -->26</span><div style=\"display:inline-block;margin-left:16px\"><span>                embeddings,</span></div></div><div><span class=\"ch-code-line-number\">_<!-- -->26</span><div style=\"display:inline-block;margin-left:16px\"><span>                {} # metadata</span></div></div><div><span class=\"ch-code-line-number\">_<!-- -->26</span><div style=\"display:inline-block;margin-left:16px\"><span>            )</span></div></div><div><span class=\"ch-code-line-number\">_<!-- -->26</span><div style=\"display:inline-block;margin-left:16px\"><span>        ]</span></div></div><div><span class=\"ch-code-line-number\">_<!-- -->26</span><div style=\"display:inline-block;margin-left:16px\"><span>    )</span></div></div><div><span class=\"ch-code-line-number\">_<!-- -->26</span><div style=\"display:inline-block;margin-left:16px\"><span></span></div></div><div><span class=\"ch-code-line-number\">_<!-- -->26</span><div style=\"display:inline-block;margin-left:16px\"><span>images.create_index()</span></div></div><br></code></div></div>\n<p>Replace <code>DB_CONNECTION</code> with the authentication information for your database. You can retrieve this from the Supabase dashboard in <code>Project Settings &gt; Database Settings</code>.</p>\n<p>You can then query your embeddings using the following code:</p>\n<div class=\"ch-codeblock not-prose \" data-ch-theme=\"supabase\"><div class=\"ch-code-wrapper ch-code\" data-ch-measured=\"false\"><code class=\"ch-code-scroll-parent\"><br><div><span class=\"ch-code-line-number\">_<!-- -->17</span><div style=\"display:inline-block;margin-left:16px\"><span>infer_clip_payload = {</span></div></div><div><span class=\"ch-code-line-number\">_<!-- -->17</span><div style=\"display:inline-block;margin-left:16px\"><span>    \"text\": \"cat\",</span></div></div><div><span class=\"ch-code-line-number\">_<!-- -->17</span><div style=\"display:inline-block;margin-left:16px\"><span>}</span></div></div><div><span class=\"ch-code-line-number\">_<!-- -->17</span><div style=\"display:inline-block;margin-left:16px\"><span></span></div></div><div><span class=\"ch-code-line-number\">_<!-- -->17</span><div style=\"display:inline-block;margin-left:16px\"><span>res = requests.post(</span></div></div><div><span class=\"ch-code-line-number\">_<!-- -->17</span><div style=\"display:inline-block;margin-left:16px\"><span>    f\"{SERVER_URL}/clip/embed_text?api_key={API_KEY}\",</span></div></div><div><span class=\"ch-code-line-number\">_<!-- -->17</span><div style=\"display:inline-block;margin-left:16px\"><span>    json=infer_clip_payload,</span></div></div><div><span class=\"ch-code-line-number\">_<!-- -->17</span><div style=\"display:inline-block;margin-left:16px\"><span>)</span></div></div><div><span class=\"ch-code-line-number\">_<!-- -->17</span><div style=\"display:inline-block;margin-left:16px\"><span></span></div></div><div><span class=\"ch-code-line-number\">_<!-- -->17</span><div style=\"display:inline-block;margin-left:16px\"><span>embeddings = res.json()['embeddings']</span></div></div><div><span class=\"ch-code-line-number\">_<!-- -->17</span><div style=\"display:inline-block;margin-left:16px\"><span></span></div></div><div><span class=\"ch-code-line-number\">_<!-- -->17</span><div style=\"display:inline-block;margin-left:16px\"><span>result = images.query(</span></div></div><div><span class=\"ch-code-line-number\">_<!-- -->17</span><div style=\"display:inline-block;margin-left:16px\"><span>    data=embeddings[0],</span></div></div><div><span class=\"ch-code-line-number\">_<!-- -->17</span><div style=\"display:inline-block;margin-left:16px\"><span>    limit=1</span></div></div><div><span class=\"ch-code-line-number\">_<!-- -->17</span><div style=\"display:inline-block;margin-left:16px\"><span>)</span></div></div><div><span class=\"ch-code-line-number\">_<!-- -->17</span><div style=\"display:inline-block;margin-left:16px\"><span></span></div></div><div><span class=\"ch-code-line-number\">_<!-- -->17</span><div style=\"display:inline-block;margin-left:16px\"><span>print(result[0])</span></div></div><br></code></div></div>\n<h2 id=\"resources\" class=\"group scroll-mt-24\">Resources<a href=\"#resources\" aria-hidden=\"true\" class=\"ml-2 opacity-0 group-hover:opacity-100 transition\"><span aria-hidden=\"true\">#</span></a></h2>\n<ul>\n<li><a href=\"https://inference.roboflow.com\">Roboflow Inference documentation</a></li>\n<li><a href=\"https://blog.roboflow.com/getting-started-with-roboflow/\">Roboflow Getting Started guide</a></li>\n<li><a href=\"https://blog.roboflow.com/how-to-use-semantic-search-supabase-openai-clip/\">How to Build a Semantic Image Search Engine with Supabase and OpenAI CLIP</a></li>\n</ul></article></div></div></div><!--$--><div class=\"max-w-7xl px-5 mx-auto py-8 pt-0\"></div><!--/$--></div><div class=\"left-0 right-0 z-10 backdrop-blur-sm backdrop-filter bg-alternative/90 hidden h-0 lg:hidden\"></div></div></main></div></div></div></div></body></html>",
      "metadata": {
        "ogUrl": "https://supabase.com/docs/guides/ai/integrations/roboflow",
        "title": "Roboflow | Supabase Docs",
        "robots": "index, follow",
        "ogImage": "https://obuldanrptloktxcffvn.supabase.co/functions/v1/og-images?site=docs&type=ai&title=Roboflow&description=undefined",
        "ogTitle": "Roboflow | Supabase Docs",
        "language": "en",
        "sourceURL": "https://supabase.com/docs/guides/ai/integrations/roboflow",
        "description": "Learn how to integrate Supabase with Roboflow, a tool for running fine-tuned and foundation vision models.",
        "modifiedTime": "2024-09-10T20:36:25.434Z",
        "ogDescription": "Learn how to integrate Supabase with Roboflow, a tool for running fine-tuned and foundation vision models.",
        "publishedTime": "2024-09-10T20:36:25.434Z",
        "ogLocaleAlternate": [],
        "statusCode": 200
      }
    },
    {
      "markdown": "AI & Vectors\n\n# Building ChatGPT plugins\n\n## Use Supabase as a Retrieval Store for your ChatGPT plugin.\n\n* * *\n\nChatGPT recently released [Plugins](https://openai.com/blog/chatgpt-plugins) which help ChatGPT access up-to-date information, run computations, or use third-party services.\nIf you're building a plugin for ChatGPT, you'll probably want to answer questions from a specific source. We can solve this with \u201cretrieval plugins\u201d, which allow ChatGPT to access information from a database.\n\n## What is ChatGPT Retrieval Plugin? [\\#](\\#what-is-chatgpt-retrieval-plugin)\n\nA [Retrieval Plugin](https://github.com/openai/chatgpt-retrieval-plugin) is a Python project designed to inject external data into a ChatGPT conversation. It does a few things:\n\n1. Turn documents into smaller chunks.\n2. Converts chunks into embeddings using OpenAI's `text-embedding-ada-002` model.\n3. Stores the embeddings into a vector database.\n4. Queries the vector database for relevant documents when a question is asked.\n\nIt allows ChatGPT to dynamically pull relevant information into conversations from your data sources. This could be PDF documents, Confluence, or Notion knowledge bases.\n\n## Example: Chat with Postgres docs [\\#](\\#example-chat-with-postgres-docs)\n\nLet\u2019s build an example where we can \u201cask ChatGPT questions\u201d about the Postgres documentation. Although ChatGPT already knows about the Postgres documentation because it is publicly available, this is a simple example which demonstrates how to work with PDF files.\n\nThis plugin requires several steps:\n\n1. Download all the [Postgres docs as a PDF](https://www.postgresql.org/files/documentation/pdf/15/postgresql-15-US.pdf)\n2. Convert the docs into chunks of embedded text and store them in Supabase\n3. Run our plugin locally so that we can ask questions about the Postgres docs.\n\nWe'll be saving the Postgres documentation in Postgres, and ChatGPT will be retrieving the documentation whenever a user asks a question:\n\n### Step 1: Fork the ChatGPT Retrieval Plugin repository [\\#](\\#step-1-fork-the-chatgpt-retrieval-plugin-repository)\n\nFork the ChatGPT Retrieval Plugin repository to your GitHub account and clone it to your local machine. Read through the `README.md` file to understand the project structure.\n\n### Step 2: Install dependencies [\\#](\\#step-2-install-dependencies)\n\nChoose your desired datastore provider and remove unused dependencies from `pyproject.toml`. For this example, we'll use Supabase. And install dependencies with Poetry:\n\n`\n_10\npoetry install\n`\n\n### Step 3: Create a Supabase project [\\#](\\#step-3-create-a-supabase-project)\n\nCreate a [Supabase project](https://supabase.com/dashboard) and database by following the instructions [here](https://supabase.com/docs/guides/platform). Export the environment variables required for the retrieval plugin to work:\n\n`\n_10\nexport OPENAI_API_KEY=<open_ai_api_key>\n_10\nexport DATASTORE=supabase\n_10\nexport SUPABASE_URL=<supabase_url>\n_10\nexport SUPABASE_SERVICE_ROLE_KEY=<supabase_key>\n`\n\nFor Postgres datastore, you'll need to export these environment variables instead:\n\n`\n_10\nexport OPENAI_API_KEY=<open_ai_api_key>\n_10\nexport DATASTORE=postgres\n_10\nexport PG_HOST=<postgres_host_url>\n_10\nexport PG_PASSWORD=<postgres_password>\n`\n\n### Step 4: Run Postgres locally [\\#](\\#step-4-run-postgres-locally)\n\nTo start quicker you may use Supabase CLI to spin everything up locally as it already includes pgvector from the start. Install `supabase-cli`, go to the `examples/providers` folder in the repo and run:\n\n`\n_10\nsupabase start\n`\n\nThis will pull all docker images and run supabase stack in docker on your local machine. It will also apply all the necessary migrations to set the whole thing up. You can then use your local setup the same way, just export the environment variables and follow to the next steps.\n\nUsing `supabase-cli` is not required and you can use any other docker image or hosted version of PostgresDB that includes `pgvector`. Just make sure you run migrations from `examples/providers/supabase/migrations/20230414142107_init_pg_vector.sql`.\n\n### Step 5: Obtain OpenAI API key [\\#](\\#step-5-obtain-openai-api-key)\n\nTo create embeddings Plugin uses OpenAI API and `text-embedding-ada-002` model. Each time we add some data to our datastore, or try to query relevant information from it, embedding will be created either for inserted data chunk, or for the query itself. To make it work we need to export `OPENAI_API_KEY`. If you already have an account in OpenAI, you just need to go to [User Settings - API keys](https://platform.openai.com/account/api-keys) and Create new secret key.\n\n![OpenAI Secret Keys](https://supabase.com/docs/img/ai/chatgpt-plugins/openai-secret-keys.png)\n\n### Step 6: Run the plugin [\\#](\\#step-6-run-the-plugin)\n\nExecute the following command to run the plugin:\n\n`\n_10\npoetry run dev\n_10\n# output\n_10\nINFO:     Will watch for changes in these directories: ['./chatgpt-retrieval-plugin']\n_10\nINFO:     Uvicorn running on http://localhost:3333 (Press CTRL+C to quit)\n_10\nINFO:     Started reloader process [87843] using WatchFiles\n_10\nINFO:     Started server process [87849]\n_10\nINFO:     Waiting for application startup.\n_10\nINFO:     Application startup complete.\n`\n\nThe plugin will start on your localhost - port `:3333` by default.\n\n### Step 6: Populating data in the datastore [\\#](\\#step-6-populating-data-in-the-datastore)\n\nFor this example, we'll upload Postgres documentation to the datastore. Download the [Postgres documentation](https://www.postgresql.org/files/documentation/pdf/15/postgresql-15-US.pdf) and use the `/upsert-file` endpoint to upload it:\n\n`\n_10\ncurl -X POST -F \\\\\"file=@./postgresql-15-US.pdf\\\\\" <http://localhost:3333/upsert-file>\n`\n\nThe plugin will split your data and documents into smaller chunks automatically. You can view the chunks using the Supabase dashboard or any other SQL client you prefer. For the whole Postgres Documentation I got 7,904 records in my documents table, which is not a lot, but we can try to add index for `embedding` column to speed things up by a little. To do so, you should run the following SQL command:\n\n`\n_10\ncreate index on documents\n_10\nusing hnsw (embedding vector_ip_ops)\n_10\nwith (lists = 10);\n`\n\nThis will create an index for the inner product distance function. Important to note that it is an approximate index. It will change the logic from performing the exact nearest neighbor search to the approximate nearest neighbor search.\n\nWe are using `lists = 10`, because as a general guideline, you should start looking for optimal lists constant value with the formula: `rows / 1000` when you have less than 1 million records in your table.\n\n### Step 7: Using our plugin within ChatGPT [\\#](\\#step-7-using-our-plugin-within-chatgpt)\n\nTo integrate our plugin with ChatGPT, register it in the ChatGPT dashboard. Assuming you have access to ChatGPT Plugins and plugin development, select the Plugins model in a new chat, then choose \"Plugin store\" and \"Develop your own plugin.\" Enter `localhost:3333` into the domain input, and your plugin is now part of ChatGPT.\n\n![ChatGPT Plugin Store](https://supabase.com/docs/img/ai/chatgpt-plugins/chatgpt-plugin-store.png)\n\n![ChatGPT Local Plugin](https://supabase.com/docs/img/ai/chatgpt-plugins/chatgpt-local-plugin.png)\n\nYou can now ask questions about Postgres and receive answers derived from the documentation.\n\nLet's try it out: ask ChatGPT to find out when to use `check` and when to use `using`. You will be able to see what queries were sent to our plugin and what it responded to.\n\n![Ask ChatGPT](https://supabase.com/docs/img/ai/chatgpt-plugins/ask-chatgpt.png)\n\nAnd after ChatGPT receives a response from the plugin it will answer your question with the data from the documentation.\n\n![ChatGPT Reply](https://supabase.com/docs/img/ai/chatgpt-plugins/chatgpt-reply.png)\n\n## Resources [\\#](\\#resources)\n\n- ChatGPT Retrieval Plugin: [github.com/openai/chatgpt-retrieval-plugin](https://github.com/openai/chatgpt-retrieval-plugin)\n- ChatGPT Plugins: [official documentation](https://platform.openai.com/docs/plugins/introduction)",
      "html": "<!DOCTYPE html><html lang=\"en\" data-theme=\"light\" style=\"color-scheme: light;\"><body><div class=\"flex flex-col\"><div class=\"grow\"><div class=\"flex flex-col h-full w-full\"><div class=\"hidden lg:sticky w-full lg:flex top-0 left-0 right-0 z-50\"><!--$--><!--/$--></div><div class=\"flex flex-row h-full relative\"><main id=\"docs-content-container\" class=\"w-full transition-all ease-out relative lg:ml-0\"><div class=\"flex flex-col sticky top-0\"><div class=\"flex lg:hidden w-full top-0 left-0 right-0 z-50\"><!--$--><!--/$--></div><div class=\"sticky transition-all top-0 z-10 backdrop-blur backdrop-filter bg-background\"><div class=\"lg:hidden px-3.5 border-b z-10 transition-all ease-out top-0 flex items-center gap-1\"><button class=\"h-8 w-8 flex group items-center justify-center mr-1\"><div class=\"space-y-1 cursor-pointer relative w-4 h-[8px]\"><span class=\"transition-all ease-out block h-px bg-foreground-muted group-hover:bg-foreground w-4\"></span><span class=\"transition-all ease-out block h-px bg-foreground-muted group-hover:bg-foreground w-3 group-hover:w-4\"></span></div></button><span class=\"transition-all duration-200 text-foreground text-sm\">AI &amp; Vectors</span></div></div><div class=\"grow\"><div class=\"max-w-7xl px-5 mx-auto py-8 pb-0\"><div class=\"grid grid-cols-12 relative gap-4\"><div class=\"relative transition-all ease-out duration-100 col-span-12 md:col-span-9\"><article id=\"sb-docs-guide-main-article\" class=\"prose max-w-none\"><h1 class=\"mb-0\">Building ChatGPT plugins</h1><h2 class=\"mt-3 text-xl text-foreground-light\">Use Supabase as a Retrieval Store for your ChatGPT plugin.</h2><hr class=\"not-prose border-t-0 border-b my-8\">\n<p>ChatGPT recently released <a href=\"https://openai.com/blog/chatgpt-plugins\">Plugins</a> which help ChatGPT access up-to-date information, run computations, or use third-party services.\nIf you're building a plugin for ChatGPT, you'll probably want to answer questions from a specific source. We can solve this with \u201cretrieval plugins\u201d, which allow ChatGPT to access information from a database.</p>\n<h2 id=\"what-is-chatgpt-retrieval-plugin\" class=\"group scroll-mt-24\">What is ChatGPT Retrieval Plugin?<a href=\"#what-is-chatgpt-retrieval-plugin\" aria-hidden=\"true\" class=\"ml-2 opacity-0 group-hover:opacity-100 transition\"><span aria-hidden=\"true\">#</span></a></h2>\n<p>A <a href=\"https://github.com/openai/chatgpt-retrieval-plugin\">Retrieval Plugin</a> is a Python project designed to inject external data into a ChatGPT conversation. It does a few things:</p>\n<ol>\n<li>Turn documents into smaller chunks.</li>\n<li>Converts chunks into embeddings using OpenAI's <code>text-embedding-ada-002</code> model.</li>\n<li>Stores the embeddings into a vector database.</li>\n<li>Queries the vector database for relevant documents when a question is asked.</li>\n</ol>\n<p>It allows ChatGPT to dynamically pull relevant information into conversations from your data sources. This could be PDF documents, Confluence, or Notion knowledge bases.</p>\n<h2 id=\"example-chat-with-postgres-docs\" class=\"group scroll-mt-24\">Example: Chat with Postgres docs<a href=\"#example-chat-with-postgres-docs\" aria-hidden=\"true\" class=\"ml-2 opacity-0 group-hover:opacity-100 transition\"><span aria-hidden=\"true\">#</span></a></h2>\n<p>Let\u2019s build an example where we can \u201cask ChatGPT questions\u201d about the Postgres documentation. Although ChatGPT already knows about the Postgres documentation because it is publicly available, this is a simple example which demonstrates how to work with PDF files.</p>\n<p>This plugin requires several steps:</p>\n<ol>\n<li>Download all the <a href=\"https://www.postgresql.org/files/documentation/pdf/15/postgresql-15-US.pdf\">Postgres docs as a PDF</a></li>\n<li>Convert the docs into chunks of embedded text and store them in Supabase</li>\n<li>Run our plugin locally so that we can ask questions about the Postgres docs.</li>\n</ol>\n<p>We'll be saving the Postgres documentation in Postgres, and ChatGPT will be retrieving the documentation whenever a user asks a question:</p>\n<!-- -->\n<h3 id=\"step-1-fork-the-chatgpt-retrieval-plugin-repository\" class=\"group scroll-mt-24\">Step 1: Fork the ChatGPT Retrieval Plugin repository<a href=\"#step-1-fork-the-chatgpt-retrieval-plugin-repository\" aria-hidden=\"true\" class=\"ml-2 opacity-0 group-hover:opacity-100 transition\"><span aria-hidden=\"true\">#</span></a></h3>\n<p>Fork the ChatGPT Retrieval Plugin repository to your GitHub account and clone it to your local machine. Read through the <code>README.md</code> file to understand the project structure.</p>\n<h3 id=\"step-2-install-dependencies\" class=\"group scroll-mt-24\">Step 2: Install dependencies<a href=\"#step-2-install-dependencies\" aria-hidden=\"true\" class=\"ml-2 opacity-0 group-hover:opacity-100 transition\"><span aria-hidden=\"true\">#</span></a></h3>\n<p>Choose your desired datastore provider and remove unused dependencies from <code>pyproject.toml</code>. For this example, we'll use Supabase. And install dependencies with Poetry:</p>\n<div class=\"ch-codeblock not-prose \" data-ch-theme=\"supabase\"><div class=\"ch-code-wrapper ch-code\" data-ch-measured=\"false\"><code class=\"ch-code-scroll-parent\"><br><div><span class=\"ch-code-line-number\">_<!-- -->10</span><div style=\"display:inline-block;margin-left:16px\"><span>poetry install</span></div></div><br></code></div></div>\n<h3 id=\"step-3-create-a-supabase-project\" class=\"group scroll-mt-24\">Step 3: Create a Supabase project<a href=\"#step-3-create-a-supabase-project\" aria-hidden=\"true\" class=\"ml-2 opacity-0 group-hover:opacity-100 transition\"><span aria-hidden=\"true\">#</span></a></h3>\n<p>Create a <a href=\"https://supabase.com/dashboard\">Supabase project</a> and database by following the instructions <a href=\"https://supabase.com/docs/guides/platform\">here</a>. Export the environment variables required for the retrieval plugin to work:</p>\n<div class=\"ch-codeblock not-prose \" data-ch-theme=\"supabase\"><div class=\"ch-code-wrapper ch-code\" data-ch-measured=\"false\"><code class=\"ch-code-scroll-parent\"><br><div><span class=\"ch-code-line-number\">_<!-- -->10</span><div style=\"display:inline-block;margin-left:16px\"><span>export OPENAI_API_KEY=&lt;open_ai_api_key&gt;</span></div></div><div><span class=\"ch-code-line-number\">_<!-- -->10</span><div style=\"display:inline-block;margin-left:16px\"><span>export DATASTORE=supabase</span></div></div><div><span class=\"ch-code-line-number\">_<!-- -->10</span><div style=\"display:inline-block;margin-left:16px\"><span>export SUPABASE_URL=&lt;supabase_url&gt;</span></div></div><div><span class=\"ch-code-line-number\">_<!-- -->10</span><div style=\"display:inline-block;margin-left:16px\"><span>export SUPABASE_SERVICE_ROLE_KEY=&lt;supabase_key&gt;</span></div></div><br></code></div></div>\n<p>For Postgres datastore, you'll need to export these environment variables instead:</p>\n<div class=\"ch-codeblock not-prose \" data-ch-theme=\"supabase\"><div class=\"ch-code-wrapper ch-code\" data-ch-measured=\"false\"><code class=\"ch-code-scroll-parent\"><br><div><span class=\"ch-code-line-number\">_<!-- -->10</span><div style=\"display:inline-block;margin-left:16px\"><span>export OPENAI_API_KEY=&lt;open_ai_api_key&gt;</span></div></div><div><span class=\"ch-code-line-number\">_<!-- -->10</span><div style=\"display:inline-block;margin-left:16px\"><span>export DATASTORE=postgres</span></div></div><div><span class=\"ch-code-line-number\">_<!-- -->10</span><div style=\"display:inline-block;margin-left:16px\"><span>export PG_HOST=&lt;postgres_host_url&gt;</span></div></div><div><span class=\"ch-code-line-number\">_<!-- -->10</span><div style=\"display:inline-block;margin-left:16px\"><span>export PG_PASSWORD=&lt;postgres_password&gt;</span></div></div><br></code></div></div>\n<h3 id=\"step-4-run-postgres-locally\" class=\"group scroll-mt-24\">Step 4: Run Postgres locally<a href=\"#step-4-run-postgres-locally\" aria-hidden=\"true\" class=\"ml-2 opacity-0 group-hover:opacity-100 transition\"><span aria-hidden=\"true\">#</span></a></h3>\n<p>To start quicker you may use Supabase CLI to spin everything up locally as it already includes pgvector from the start. Install <code>supabase-cli</code>, go to the <code>examples/providers</code> folder in the repo and run:</p>\n<div class=\"ch-codeblock not-prose \" data-ch-theme=\"supabase\"><div class=\"ch-code-wrapper ch-code\" data-ch-measured=\"false\"><code class=\"ch-code-scroll-parent\"><br><div><span class=\"ch-code-line-number\">_<!-- -->10</span><div style=\"display:inline-block;margin-left:16px\"><span>supabase start</span></div></div><br></code></div></div>\n<p>This will pull all docker images and run supabase stack in docker on your local machine. It will also apply all the necessary migrations to set the whole thing up. You can then use your local setup the same way, just export the environment variables and follow to the next steps.</p>\n<p>Using <code>supabase-cli</code> is not required and you can use any other docker image or hosted version of PostgresDB that includes <code>pgvector</code>. Just make sure you run migrations from <code>examples/providers/supabase/migrations/20230414142107_init_pg_vector.sql</code>.</p>\n<h3 id=\"step-5-obtain-openai-api-key\" class=\"group scroll-mt-24\">Step 5: Obtain OpenAI API key<a href=\"#step-5-obtain-openai-api-key\" aria-hidden=\"true\" class=\"ml-2 opacity-0 group-hover:opacity-100 transition\"><span aria-hidden=\"true\">#</span></a></h3>\n<p>To create embeddings Plugin uses OpenAI API and <code>text-embedding-ada-002</code> model. Each time we add some data to our datastore, or try to query relevant information from it, embedding will be created either for inserted data chunk, or for the query itself. To make it work we need to export <code>OPENAI_API_KEY</code>. If you already have an account in OpenAI, you just need to go to <a href=\"https://platform.openai.com/account/api-keys\">User Settings - API keys</a> and Create new secret key.</p>\n<p><img src=\"/docs/img/ai/chatgpt-plugins/openai-secret-keys.png\" alt=\"OpenAI Secret Keys\"></p>\n<h3 id=\"step-6-run-the-plugin\" class=\"group scroll-mt-24\">Step 6: Run the plugin<a href=\"#step-6-run-the-plugin\" aria-hidden=\"true\" class=\"ml-2 opacity-0 group-hover:opacity-100 transition\"><span aria-hidden=\"true\">#</span></a></h3>\n<p>Execute the following command to run the plugin:</p>\n<div class=\"ch-codeblock not-prose \" data-ch-theme=\"supabase\"><div class=\"ch-code-wrapper ch-code\" data-ch-measured=\"false\"><code class=\"ch-code-scroll-parent\"><br><div><span class=\"ch-code-line-number\">_<!-- -->10</span><div style=\"display:inline-block;margin-left:16px\"><span>poetry run dev</span></div></div><div><span class=\"ch-code-line-number\">_<!-- -->10</span><div style=\"display:inline-block;margin-left:16px\"><span># output</span></div></div><div><span class=\"ch-code-line-number\">_<!-- -->10</span><div style=\"display:inline-block;margin-left:16px\"><span>INFO:     Will watch for changes in these directories: ['./chatgpt-retrieval-plugin']</span></div></div><div><span class=\"ch-code-line-number\">_<!-- -->10</span><div style=\"display:inline-block;margin-left:16px\"><span>INFO:     Uvicorn running on http://localhost:3333 (Press CTRL+C to quit)</span></div></div><div><span class=\"ch-code-line-number\">_<!-- -->10</span><div style=\"display:inline-block;margin-left:16px\"><span>INFO:     Started reloader process [87843] using WatchFiles</span></div></div><div><span class=\"ch-code-line-number\">_<!-- -->10</span><div style=\"display:inline-block;margin-left:16px\"><span>INFO:     Started server process [87849]</span></div></div><div><span class=\"ch-code-line-number\">_<!-- -->10</span><div style=\"display:inline-block;margin-left:16px\"><span>INFO:     Waiting for application startup.</span></div></div><div><span class=\"ch-code-line-number\">_<!-- -->10</span><div style=\"display:inline-block;margin-left:16px\"><span>INFO:     Application startup complete.</span></div></div><br></code></div></div>\n<p>The plugin will start on your localhost - port <code>:3333</code> by default.</p>\n<h3 id=\"step-6-populating-data-in-the-datastore\" class=\"group scroll-mt-24\">Step 6: Populating data in the datastore<a href=\"#step-6-populating-data-in-the-datastore\" aria-hidden=\"true\" class=\"ml-2 opacity-0 group-hover:opacity-100 transition\"><span aria-hidden=\"true\">#</span></a></h3>\n<p>For this example, we'll upload Postgres documentation to the datastore. Download the <a href=\"https://www.postgresql.org/files/documentation/pdf/15/postgresql-15-US.pdf\">Postgres documentation</a> and use the <code>/upsert-file</code> endpoint to upload it:</p>\n<div class=\"ch-codeblock not-prose \" data-ch-theme=\"supabase\"><div class=\"ch-code-wrapper ch-code\" data-ch-measured=\"false\"><code class=\"ch-code-scroll-parent\"><br><div><span class=\"ch-code-line-number\">_<!-- -->10</span><div style=\"display:inline-block;margin-left:16px\"><span>curl -X POST -F \\\\\"file=@./postgresql-15-US.pdf\\\\\" &lt;http://localhost:3333/upsert-file&gt;</span></div></div><br></code></div></div>\n<p>The plugin will split your data and documents into smaller chunks automatically. You can view the chunks using the Supabase dashboard or any other SQL client you prefer. For the whole Postgres Documentation I got 7,904 records in my documents table, which is not a lot, but we can try to add index for <code>embedding</code> column to speed things up by a little. To do so, you should run the following SQL command:</p>\n<div class=\"ch-codeblock not-prose \" data-ch-theme=\"supabase\"><div class=\"ch-code-wrapper ch-code\" data-ch-measured=\"false\"><code class=\"ch-code-scroll-parent\"><br><div><span class=\"ch-code-line-number\">_<!-- -->10</span><div style=\"display:inline-block;margin-left:16px\"><span>create index on documents</span></div></div><div><span class=\"ch-code-line-number\">_<!-- -->10</span><div style=\"display:inline-block;margin-left:16px\"><span>using hnsw (embedding vector_ip_ops)</span></div></div><div><span class=\"ch-code-line-number\">_<!-- -->10</span><div style=\"display:inline-block;margin-left:16px\"><span>with (lists = 10);</span></div></div><br></code></div></div>\n<p>This will create an index for the inner product distance function. Important to note that it is an approximate index. It will change the logic from performing the exact nearest neighbor search to the approximate nearest neighbor search.</p>\n<p>We are using <code>lists = 10</code>, because as a general guideline, you should start looking for optimal lists constant value with the formula: <code>rows / 1000</code> when you have less than 1 million records in your table.</p>\n<h3 id=\"step-7-using-our-plugin-within-chatgpt\" class=\"group scroll-mt-24\">Step 7: Using our plugin within ChatGPT<a href=\"#step-7-using-our-plugin-within-chatgpt\" aria-hidden=\"true\" class=\"ml-2 opacity-0 group-hover:opacity-100 transition\"><span aria-hidden=\"true\">#</span></a></h3>\n<p>To integrate our plugin with ChatGPT, register it in the ChatGPT dashboard. Assuming you have access to ChatGPT Plugins and plugin development, select the Plugins model in a new chat, then choose \"Plugin store\" and \"Develop your own plugin.\" Enter <code>localhost:3333</code> into the domain input, and your plugin is now part of ChatGPT.</p>\n<p><img src=\"/docs/img/ai/chatgpt-plugins/chatgpt-plugin-store.png\" alt=\"ChatGPT Plugin Store\"></p>\n<p><img src=\"/docs/img/ai/chatgpt-plugins/chatgpt-local-plugin.png\" alt=\"ChatGPT Local Plugin\"></p>\n<p>You can now ask questions about Postgres and receive answers derived from the documentation.</p>\n<p>Let's try it out: ask ChatGPT to find out when to use <code>check</code> and when to use <code>using</code>. You will be able to see what queries were sent to our plugin and what it responded to.</p>\n<p><img src=\"/docs/img/ai/chatgpt-plugins/ask-chatgpt.png\" alt=\"Ask ChatGPT\"></p>\n<p>And after ChatGPT receives a response from the plugin it will answer your question with the data from the documentation.</p>\n<p><img src=\"/docs/img/ai/chatgpt-plugins/chatgpt-reply.png\" alt=\"ChatGPT Reply\"></p>\n<h2 id=\"resources\" class=\"group scroll-mt-24\">Resources<a href=\"#resources\" aria-hidden=\"true\" class=\"ml-2 opacity-0 group-hover:opacity-100 transition\"><span aria-hidden=\"true\">#</span></a></h2>\n<ul>\n<li>ChatGPT Retrieval Plugin: <a href=\"https://github.com/openai/chatgpt-retrieval-plugin\">github.com/openai/chatgpt-retrieval-plugin</a></li>\n<li>ChatGPT Plugins: <a href=\"https://platform.openai.com/docs/plugins/introduction\">official documentation</a></li>\n</ul></article></div></div></div><!--$--><div class=\"max-w-7xl px-5 mx-auto py-8 pt-0\"></div><!--/$--></div><div class=\"left-0 right-0 z-10 backdrop-blur-sm backdrop-filter bg-alternative/90 hidden h-0 lg:hidden\"></div></div></main></div></div></div></div></body></html>",
      "metadata": {
        "ogUrl": "https://supabase.com/docs/guides/ai/examples/building-chatgpt-plugins",
        "title": "Building ChatGPT plugins | Supabase Docs",
        "robots": "index, follow",
        "ogImage": "https://obuldanrptloktxcffvn.supabase.co/functions/v1/og-images?site=docs&type=ai&title=Building%20ChatGPT%20plugins&description=undefined",
        "ogTitle": "Building ChatGPT plugins | Supabase Docs",
        "language": "en",
        "sourceURL": "https://supabase.com/docs/guides/ai/examples/building-chatgpt-plugins",
        "description": "Use Supabase as a Retrieval Store for your ChatGPT plugin.",
        "modifiedTime": "2024-09-10T20:36:24.564Z",
        "ogDescription": "Use Supabase as a Retrieval Store for your ChatGPT plugin.",
        "publishedTime": "2024-09-10T20:36:24.564Z",
        "ogLocaleAlternate": [],
        "statusCode": 200
      }
    },
    {
      "markdown": "AI & Vectors\n\n# Hugging Face Inference API\n\n* * *\n\n[Hugging Face](https://huggingface.co) is an open source hub for AI/ML models and tools. With over 100,000 machine learning models available, Hugging Face provides a great way to integrate specialized AI & ML tasks into your application.\n\nThere are 3 ways to use Hugging Face models in your application:\n\n1. Use the [Transformers](https://huggingface.co/docs/transformers/index) Python library to perform inference in a Python backend.\n2. [Generate embeddings](/docs/guides/ai/quickstarts/generate-text-embeddings) directly in Edge Functions using Transformers.js.\n3. Use Hugging Face's hosted [Inference API](https://huggingface.co/inference-api) to execute AI tasks remotely on Hugging Face servers. This guide will walk you through this approach.\n\n## AI tasks [\\#](\\#ai-tasks)\n\nBelow are some of the types of tasks you can perform with Hugging Face:\n\n### Natural language [\\#](\\#natural-language)\n\n- [Summarization](https://huggingface.co/tasks/summarization)\n- [Text classification](https://huggingface.co/tasks/text-classification)\n- [Text generation](https://huggingface.co/tasks/text-generation)\n- [Translation](https://huggingface.co/tasks/translation)\n- [Fill in the blank](https://huggingface.co/tasks/fill-mask)\n\n### Computer vision [\\#](\\#computer-vision)\n\n- [Image to text](https://huggingface.co/tasks/image-to-text)\n- [Text to image](https://huggingface.co/tasks/text-to-image)\n- [Image classification](https://huggingface.co/tasks/image-classification)\n- [Video classification](https://huggingface.co/tasks/video-classification)\n- [Object detection](https://huggingface.co/tasks/object-detection)\n- [Image segmentation](https://huggingface.co/tasks/image-segmentation)\n\n### Audio [\\#](\\#audio)\n\n- [Text to speech](https://huggingface.co/tasks/text-to-speech)\n- [Speech to text](https://huggingface.co/tasks/automatic-speech-recognition)\n- [Audio classification](https://huggingface.co/tasks/audio-classification)\n\nSee a [full list of tasks](https://huggingface.co/tasks).\n\n## Access token [\\#](\\#access-token)\n\nFirst generate a Hugging Face access token for your app:\n\n[https://huggingface.co/settings/tokens](https://huggingface.co/settings/tokens)\n\nName your token based on the app its being used for and the environment. For example, if you are building an image generation app you might create 2 tokens:\n\n- \"My Image Generator (Dev)\"\n- \"My Image Generator (Prod)\"\n\nSince we will be using this token for the inference API, choose the `read` role.\n\nThough it is possible to use the Hugging Face inference API today without an access token, [you may be rate limited](https://huggingface.co/docs/huggingface.js/inference/README#usage).\n\nTo ensure you don't experience any unexpected downtime or errors, we recommend creating an access token.\n\n## Edge Functions [\\#](\\#edge-functions)\n\nEdge Functions are server-side TypeScript functions that run on-demand. Since Edge Functions run on a server, you can safely give them access to your Hugging Face access token.\n\nYou will need the `supabase` CLI [installed](/docs/guides/cli) for the following commands to work.\n\nTo create a new Edge Function, navigate to your local project and initialize Supabase if you haven't already:\n\n`\n_10\nsupabase init\n`\n\nThen create an Edge Function:\n\n`\n_10\nsupabase functions new text-to-image\n`\n\nCreate a file called `.env.local` to store your Hugging Face access token:\n\n`\n_10\nHUGGING_FACE_ACCESS_TOKEN=<your-token-here>\n`\n\nLet's modify the Edge Function to import Hugging Face's inference client and perform a `text-to-image` request:\n\n`\n_20\nimport { serve } from 'https://deno.land/std@0.168.0/http/server.ts'\n_20\nimport { HfInference } from 'https://esm.sh/@huggingface/inference@2.3.2'\n_20\n_20\nconst hf = new HfInference(Deno.env.get('HUGGING_FACE_ACCESS_TOKEN'))\n_20\n_20\nserve(async (req) => {\n_20\nconst { prompt } = await req.json()\n_20\n_20\nconst image = await hf.textToImage(\n_20\n    {\n_20\n      inputs: prompt,\n_20\n      model: 'stabilityai/stable-diffusion-2',\n_20\n    },\n_20\n    {\n_20\n      use_cache: false,\n_20\n    }\n_20\n)\n_20\n_20\nreturn new Response(image)\n_20\n})\n`\n\n1. This function creates a new instance of `HfInference` using the `HUGGING_FACE_ACCESS_TOKEN` environment variable.\n\n2. It expects a POST request that includes a JSON request body. The JSON body should include a parameter called `prompt` that represents the text-to-image prompt that we will pass to Hugging Face's inference API.\n\n3. Next we call `textToImage()`, passing in the user's prompt along with the model that we would like to use for the image generation. Today Hugging Face recommends `stabilityai/stable-diffusion-2`, but you can change this to any other text-to-image model. You can see a list of which models are supported for each task by navigating to their [models page](https://huggingface.co/models?pipeline_tag=text-to-image) and filtering by task.\n\n4. We set `use_cache` to `false` so that repeat queries with the same prompt will produce new images. If the task and model you are using is deterministic (will always produce the same result based on the same input), consider setting `use_cache` to `true` for faster responses.\n\n5. The `image` result returned from the API will be a `Blob`. We can pass the `Blob` directly into a `new Response()` which will automatically set the content type and body of the response from the `image`.\n\n\nFinally let's serve the Edge Function locally to test it:\n\n`\n_10\nsupabase functions serve --env-file .env.local --no-verify-jwt\n`\n\nRemember to pass in the `.env.local` file using the `--env-file` parameter so that the Edge Function can access the `HUGGING_FACE_ACCESS_TOKEN`.\n\nFor demo purposes we set `--no-verify-jwt` to make it easy to test the Edge Function without passing in a JWT token. In a real application you will need to pass the JWT as a `Bearer` token in the `Authorization` header.\n\nAt this point, you can make an API request to your Edge Function using your preferred frontend framework (Next.js, React, Expo, etc). We can also test from the terminal using `curl`:\n\n`\n_10\ncurl --output result.jpg --location --request POST 'http://localhost:54321/functions/v1/text-to-image' \\\n_10\n  --header 'Content-Type: application/json' \\\n_10\n  --data '{\"prompt\":\"Llama wearing sunglasses\"}'\n`\n\nIn this example, your generated image will save to `result.jpg`:\n\n![Llama wearing sunglasses example](https://supabase.com/docs/img/ai/hugging-face/llama-sunglasses-example.png)\n\n## Next steps [\\#](\\#next-steps)\n\nYou can now create an Edge Function that invokes a Hugging Face task using your model of choice.\n\nTry running some other [AI tasks](#ai-tasks).\n\n## Resources [\\#](\\#resources)\n\n- Official [Hugging Face site](https://huggingface.co/).\n- Official [Hugging Face JS docs](https://huggingface.co/docs/huggingface.js).\n- [Generate image captions](/docs/guides/ai/examples/huggingface-image-captioning) using Hugging Face.",
      "html": "<!DOCTYPE html><html lang=\"en\" data-theme=\"light\" style=\"color-scheme: light;\"><body><div class=\"flex flex-col\"><div class=\"grow\"><div class=\"flex flex-col h-full w-full\"><div class=\"hidden lg:sticky w-full lg:flex top-0 left-0 right-0 z-50\"><!--$--><!--/$--></div><div class=\"flex flex-row h-full relative\"><main id=\"docs-content-container\" class=\"w-full transition-all ease-out relative lg:ml-0\"><div class=\"flex flex-col sticky top-0\"><div class=\"flex lg:hidden w-full top-0 left-0 right-0 z-50\"><!--$--><!--/$--></div><div class=\"sticky transition-all top-0 z-10 backdrop-blur backdrop-filter bg-background\"><div class=\"lg:hidden px-3.5 border-b z-10 transition-all ease-out top-0 flex items-center gap-1\"><button class=\"h-8 w-8 flex group items-center justify-center mr-1\"><div class=\"space-y-1 cursor-pointer relative w-4 h-[8px]\"><span class=\"transition-all ease-out block h-px bg-foreground-muted group-hover:bg-foreground w-4\"></span><span class=\"transition-all ease-out block h-px bg-foreground-muted group-hover:bg-foreground w-3 group-hover:w-4\"></span></div></button><span class=\"transition-all duration-200 text-foreground text-sm\">AI &amp; Vectors</span></div></div><div class=\"grow\"><div class=\"max-w-7xl px-5 mx-auto py-8 pb-0\"><div class=\"grid grid-cols-12 relative gap-4\"><div class=\"relative transition-all ease-out duration-100 col-span-12 md:col-span-9\"><article id=\"sb-docs-guide-main-article\" class=\"prose max-w-none\"><h1 class=\"mb-0\">Hugging Face Inference API</h1><hr class=\"not-prose border-t-0 border-b my-8\">\n<p><a href=\"https://huggingface.co\">Hugging Face</a> is an open source hub for AI/ML models and tools. With over 100,000 machine learning models available, Hugging Face provides a great way to integrate specialized AI &amp; ML tasks into your application.</p>\n<p>There are 3 ways to use Hugging Face models in your application:</p>\n<ol>\n<li>Use the <a href=\"https://huggingface.co/docs/transformers/index\">Transformers</a> Python library to perform inference in a Python backend.</li>\n<li><a href=\"/docs/guides/ai/quickstarts/generate-text-embeddings\">Generate embeddings</a> directly in Edge Functions using Transformers.js.</li>\n<li>Use Hugging Face's hosted <a href=\"https://huggingface.co/inference-api\">Inference API</a> to execute AI tasks remotely on Hugging Face servers. This guide will walk you through this approach.</li>\n</ol>\n<h2 id=\"ai-tasks\" class=\"group scroll-mt-24\">AI tasks<a href=\"#ai-tasks\" aria-hidden=\"true\" class=\"ml-2 opacity-0 group-hover:opacity-100 transition\"><span aria-hidden=\"true\">#</span></a></h2>\n<p>Below are some of the types of tasks you can perform with Hugging Face:</p>\n<h3 id=\"natural-language\" class=\"group scroll-mt-24\">Natural language<a href=\"#natural-language\" aria-hidden=\"true\" class=\"ml-2 opacity-0 group-hover:opacity-100 transition\"><span aria-hidden=\"true\">#</span></a></h3>\n<ul>\n<li><a href=\"https://huggingface.co/tasks/summarization\">Summarization</a></li>\n<li><a href=\"https://huggingface.co/tasks/text-classification\">Text classification</a></li>\n<li><a href=\"https://huggingface.co/tasks/text-generation\">Text generation</a></li>\n<li><a href=\"https://huggingface.co/tasks/translation\">Translation</a></li>\n<li><a href=\"https://huggingface.co/tasks/fill-mask\">Fill in the blank</a></li>\n</ul>\n<h3 id=\"computer-vision\" class=\"group scroll-mt-24\">Computer vision<a href=\"#computer-vision\" aria-hidden=\"true\" class=\"ml-2 opacity-0 group-hover:opacity-100 transition\"><span aria-hidden=\"true\">#</span></a></h3>\n<ul>\n<li><a href=\"https://huggingface.co/tasks/image-to-text\">Image to text</a></li>\n<li><a href=\"https://huggingface.co/tasks/text-to-image\">Text to image</a></li>\n<li><a href=\"https://huggingface.co/tasks/image-classification\">Image classification</a></li>\n<li><a href=\"https://huggingface.co/tasks/video-classification\">Video classification</a></li>\n<li><a href=\"https://huggingface.co/tasks/object-detection\">Object detection</a></li>\n<li><a href=\"https://huggingface.co/tasks/image-segmentation\">Image segmentation</a></li>\n</ul>\n<h3 id=\"audio\" class=\"group scroll-mt-24\">Audio<a href=\"#audio\" aria-hidden=\"true\" class=\"ml-2 opacity-0 group-hover:opacity-100 transition\"><span aria-hidden=\"true\">#</span></a></h3>\n<ul>\n<li><a href=\"https://huggingface.co/tasks/text-to-speech\">Text to speech</a></li>\n<li><a href=\"https://huggingface.co/tasks/automatic-speech-recognition\">Speech to text</a></li>\n<li><a href=\"https://huggingface.co/tasks/audio-classification\">Audio classification</a></li>\n</ul>\n<p>See a <a href=\"https://huggingface.co/tasks\">full list of tasks</a>.</p>\n<h2 id=\"access-token\" class=\"group scroll-mt-24\">Access token<a href=\"#access-token\" aria-hidden=\"true\" class=\"ml-2 opacity-0 group-hover:opacity-100 transition\"><span aria-hidden=\"true\">#</span></a></h2>\n<p>First generate a Hugging Face access token for your app:</p>\n<p><a href=\"https://huggingface.co/settings/tokens\">https://huggingface.co/settings/tokens</a></p>\n<p>Name your token based on the app its being used for and the environment. For example, if you are building an image generation app you might create 2 tokens:</p>\n<ul>\n<li>\"My Image Generator (Dev)\"</li>\n<li>\"My Image Generator (Prod)\"</li>\n</ul>\n<p>Since we will be using this token for the inference API, choose the <code>read</code> role.</p>\n<div role=\"alert\" class=\"relative w-full text-sm rounded-lg p-4 [&amp;>svg~*]:pl-10 [&amp;>svg+div]:translate-y-[-3px] [&amp;>svg]:absolute [&amp;>svg]:left-4 [&amp;>svg]:top-4 [&amp;>svg]:w-[23px] [&amp;>svg]:h-[23px] [&amp;>svg]:p-1 [&amp;>svg]:flex [&amp;>svg]:rounded text-foreground [&amp;>svg]:text-background [&amp;>svg]:bg-foreground mb-2 [&amp;_svg]:bg-foreground-muted [&amp;_svg]:text-background-muted bg-surface-200/25 border border-default\"><svg xmlns=\"http://www.w3.org/2000/svg\" viewBox=\"0 0 21 20\" class=\"w-6 h-6\" fill=\"currentColor\"><path fill-rule=\"evenodd\" clip-rule=\"evenodd\" d=\"M0.625 9.8252C0.625 4.44043 4.99023 0.0751953 10.375 0.0751953C15.7598 0.0751953 20.125 4.44043 20.125 9.8252C20.125 15.21 15.7598 19.5752 10.375 19.5752C4.99023 19.5752 0.625 15.21 0.625 9.8252ZM9.3584 4.38135C9.45117 4.28857 9.55518 4.20996 9.66699 4.14648C9.88086 4.02539 10.1245 3.96045 10.375 3.96045C10.5845 3.96045 10.7896 4.00586 10.9766 4.09229C11.1294 4.1626 11.2705 4.26025 11.3916 4.38135C11.6611 4.65088 11.8125 5.0166 11.8125 5.39795C11.8125 5.5249 11.7959 5.6499 11.7637 5.77002C11.6987 6.01172 11.5718 6.23438 11.3916 6.41455C11.1221 6.68408 10.7563 6.83545 10.375 6.83545C9.99365 6.83545 9.62793 6.68408 9.3584 6.41455C9.08887 6.14502 8.9375 5.7793 8.9375 5.39795C8.9375 5.29492 8.94873 5.19287 8.97021 5.09375C9.02783 4.82568 9.16162 4.57812 9.3584 4.38135ZM10.375 15.6899C10.0933 15.6899 9.82275 15.5781 9.62354 15.3789C9.42432 15.1797 9.3125 14.9092 9.3125 14.6274V9.31494C9.3125 9.0332 9.42432 8.7627 9.62354 8.56348C9.82275 8.36426 10.0933 8.25244 10.375 8.25244C10.6567 8.25244 10.9272 8.36426 11.1265 8.56348C11.3257 8.7627 11.4375 9.0332 11.4375 9.31494V14.6274C11.4375 14.7944 11.3979 14.9575 11.3242 15.104C11.2739 15.2046 11.2075 15.2979 11.1265 15.3789C10.9272 15.5781 10.6567 15.6899 10.375 15.6899Z\"></path></svg><div class=\"text mt [&amp;_p]:mb-1.5 [&amp;_p]:mt-0 mt-0.5 [&amp;_p:last-child]:mb-0\"><p>Though it is possible to use the Hugging Face inference API today without an access token, <a href=\"https://huggingface.co/docs/huggingface.js/inference/README#usage\">you may be rate limited</a>.</p><p>To ensure you don't experience any unexpected downtime or errors, we recommend creating an access token.</p></div></div>\n<h2 id=\"edge-functions\" class=\"group scroll-mt-24\">Edge Functions<a href=\"#edge-functions\" aria-hidden=\"true\" class=\"ml-2 opacity-0 group-hover:opacity-100 transition\"><span aria-hidden=\"true\">#</span></a></h2>\n<p>Edge Functions are server-side TypeScript functions that run on-demand. Since Edge Functions run on a server, you can safely give them access to your Hugging Face access token.</p>\n<div role=\"alert\" class=\"relative w-full text-sm rounded-lg p-4 [&amp;>svg~*]:pl-10 [&amp;>svg+div]:translate-y-[-3px] [&amp;>svg]:absolute [&amp;>svg]:left-4 [&amp;>svg]:top-4 [&amp;>svg]:w-[23px] [&amp;>svg]:h-[23px] [&amp;>svg]:p-1 [&amp;>svg]:flex [&amp;>svg]:rounded text-foreground [&amp;>svg]:text-background [&amp;>svg]:bg-foreground mb-2 [&amp;_svg]:bg-foreground-muted [&amp;_svg]:text-background-muted bg-surface-200/25 border border-default\"><svg xmlns=\"http://www.w3.org/2000/svg\" viewBox=\"0 0 21 20\" class=\"w-6 h-6\" fill=\"currentColor\"><path fill-rule=\"evenodd\" clip-rule=\"evenodd\" d=\"M0.625 9.8252C0.625 4.44043 4.99023 0.0751953 10.375 0.0751953C15.7598 0.0751953 20.125 4.44043 20.125 9.8252C20.125 15.21 15.7598 19.5752 10.375 19.5752C4.99023 19.5752 0.625 15.21 0.625 9.8252ZM9.3584 4.38135C9.45117 4.28857 9.55518 4.20996 9.66699 4.14648C9.88086 4.02539 10.1245 3.96045 10.375 3.96045C10.5845 3.96045 10.7896 4.00586 10.9766 4.09229C11.1294 4.1626 11.2705 4.26025 11.3916 4.38135C11.6611 4.65088 11.8125 5.0166 11.8125 5.39795C11.8125 5.5249 11.7959 5.6499 11.7637 5.77002C11.6987 6.01172 11.5718 6.23438 11.3916 6.41455C11.1221 6.68408 10.7563 6.83545 10.375 6.83545C9.99365 6.83545 9.62793 6.68408 9.3584 6.41455C9.08887 6.14502 8.9375 5.7793 8.9375 5.39795C8.9375 5.29492 8.94873 5.19287 8.97021 5.09375C9.02783 4.82568 9.16162 4.57812 9.3584 4.38135ZM10.375 15.6899C10.0933 15.6899 9.82275 15.5781 9.62354 15.3789C9.42432 15.1797 9.3125 14.9092 9.3125 14.6274V9.31494C9.3125 9.0332 9.42432 8.7627 9.62354 8.56348C9.82275 8.36426 10.0933 8.25244 10.375 8.25244C10.6567 8.25244 10.9272 8.36426 11.1265 8.56348C11.3257 8.7627 11.4375 9.0332 11.4375 9.31494V14.6274C11.4375 14.7944 11.3979 14.9575 11.3242 15.104C11.2739 15.2046 11.2075 15.2979 11.1265 15.3789C10.9272 15.5781 10.6567 15.6899 10.375 15.6899Z\"></path></svg><div class=\"text mt [&amp;_p]:mb-1.5 [&amp;_p]:mt-0 mt-0.5 [&amp;_p:last-child]:mb-0\"><p>You will need the <code>supabase</code> CLI <a href=\"/docs/guides/cli\">installed</a> for the following commands to work.</p></div></div>\n<p>To create a new Edge Function, navigate to your local project and initialize Supabase if you haven't already:</p>\n<div class=\"ch-codeblock not-prose \" data-ch-theme=\"supabase\"><div class=\"ch-code-wrapper ch-code\" data-ch-measured=\"false\"><code class=\"ch-code-scroll-parent\"><br><div><span class=\"ch-code-line-number\">_<!-- -->10</span><div style=\"display:inline-block;margin-left:16px\"><span>supabase init</span></div></div><br></code></div></div>\n<p>Then create an Edge Function:</p>\n<div class=\"ch-codeblock not-prose \" data-ch-theme=\"supabase\"><div class=\"ch-code-wrapper ch-code\" data-ch-measured=\"false\"><code class=\"ch-code-scroll-parent\"><br><div><span class=\"ch-code-line-number\">_<!-- -->10</span><div style=\"display:inline-block;margin-left:16px\"><span>supabase functions new text-to-image</span></div></div><br></code></div></div>\n<p>Create a file called <code>.env.local</code> to store your Hugging Face access token:</p>\n<div class=\"ch-codeblock not-prose \" data-ch-theme=\"supabase\"><div class=\"ch-code-wrapper ch-code\" data-ch-measured=\"false\"><code class=\"ch-code-scroll-parent\"><br><div><span class=\"ch-code-line-number\">_<!-- -->10</span><div style=\"display:inline-block;margin-left:16px\"><span>HUGGING_FACE_ACCESS_TOKEN=&lt;your-token-here&gt;</span></div></div><br></code></div></div>\n<p>Let's modify the Edge Function to import Hugging Face's inference client and perform a <code>text-to-image</code> request:</p>\n<div class=\"ch-codeblock not-prose \" data-ch-theme=\"supabase\"><div class=\"ch-code-wrapper ch-code\" data-ch-measured=\"false\"><code class=\"ch-code-scroll-parent\"><br><div><span class=\"ch-code-line-number\">_<!-- -->20</span><div style=\"display:inline-block;margin-left:16px\"><span>import { serve } from 'https://deno.land/std@0.168.0/http/server.ts'</span></div></div><div><span class=\"ch-code-line-number\">_<!-- -->20</span><div style=\"display:inline-block;margin-left:16px\"><span>import { HfInference } from 'https://esm.sh/@huggingface/inference@2.3.2'</span></div></div><div><span class=\"ch-code-line-number\">_<!-- -->20</span><div style=\"display:inline-block;margin-left:16px\"><span></span></div></div><div><span class=\"ch-code-line-number\">_<!-- -->20</span><div style=\"display:inline-block;margin-left:16px\"><span>const hf = new HfInference(Deno.env.get('HUGGING_FACE_ACCESS_TOKEN'))</span></div></div><div><span class=\"ch-code-line-number\">_<!-- -->20</span><div style=\"display:inline-block;margin-left:16px\"><span></span></div></div><div><span class=\"ch-code-line-number\">_<!-- -->20</span><div style=\"display:inline-block;margin-left:16px\"><span>serve(async (req) =&gt; {</span></div></div><div><span class=\"ch-code-line-number\">_<!-- -->20</span><div style=\"display:inline-block;margin-left:16px\"><span>  const { prompt } = await req.json()</span></div></div><div><span class=\"ch-code-line-number\">_<!-- -->20</span><div style=\"display:inline-block;margin-left:16px\"><span></span></div></div><div><span class=\"ch-code-line-number\">_<!-- -->20</span><div style=\"display:inline-block;margin-left:16px\"><span>  const image = await hf.textToImage(</span></div></div><div><span class=\"ch-code-line-number\">_<!-- -->20</span><div style=\"display:inline-block;margin-left:16px\"><span>    {</span></div></div><div><span class=\"ch-code-line-number\">_<!-- -->20</span><div style=\"display:inline-block;margin-left:16px\"><span>      inputs: prompt,</span></div></div><div><span class=\"ch-code-line-number\">_<!-- -->20</span><div style=\"display:inline-block;margin-left:16px\"><span>      model: 'stabilityai/stable-diffusion-2',</span></div></div><div><span class=\"ch-code-line-number\">_<!-- -->20</span><div style=\"display:inline-block;margin-left:16px\"><span>    },</span></div></div><div><span class=\"ch-code-line-number\">_<!-- -->20</span><div style=\"display:inline-block;margin-left:16px\"><span>    {</span></div></div><div><span class=\"ch-code-line-number\">_<!-- -->20</span><div style=\"display:inline-block;margin-left:16px\"><span>      use_cache: false,</span></div></div><div><span class=\"ch-code-line-number\">_<!-- -->20</span><div style=\"display:inline-block;margin-left:16px\"><span>    }</span></div></div><div><span class=\"ch-code-line-number\">_<!-- -->20</span><div style=\"display:inline-block;margin-left:16px\"><span>  )</span></div></div><div><span class=\"ch-code-line-number\">_<!-- -->20</span><div style=\"display:inline-block;margin-left:16px\"><span></span></div></div><div><span class=\"ch-code-line-number\">_<!-- -->20</span><div style=\"display:inline-block;margin-left:16px\"><span>  return new Response(image)</span></div></div><div><span class=\"ch-code-line-number\">_<!-- -->20</span><div style=\"display:inline-block;margin-left:16px\"><span>})</span></div></div><br></code></div></div>\n<ol>\n<li>\n<p>This function creates a new instance of <code>HfInference</code> using the <code>HUGGING_FACE_ACCESS_TOKEN</code> environment variable.</p>\n</li>\n<li>\n<p>It expects a POST request that includes a JSON request body. The JSON body should include a parameter called <code>prompt</code> that represents the text-to-image prompt that we will pass to Hugging Face's inference API.</p>\n</li>\n<li>\n<p>Next we call <code>textToImage()</code>, passing in the user's prompt along with the model that we would like to use for the image generation. Today Hugging Face recommends <code>stabilityai/stable-diffusion-2</code>, but you can change this to any other text-to-image model. You can see a list of which models are supported for each task by navigating to their <a href=\"https://huggingface.co/models?pipeline_tag=text-to-image\">models page</a> and filtering by task.</p>\n</li>\n<li>\n<p>We set <code>use_cache</code> to <code>false</code> so that repeat queries with the same prompt will produce new images. If the task and model you are using is deterministic (will always produce the same result based on the same input), consider setting <code>use_cache</code> to <code>true</code> for faster responses.</p>\n</li>\n<li>\n<p>The <code>image</code> result returned from the API will be a <code>Blob</code>. We can pass the <code>Blob</code> directly into a <code>new Response()</code> which will automatically set the content type and body of the response from the <code>image</code>.</p>\n</li>\n</ol>\n<p>Finally let's serve the Edge Function locally to test it:</p>\n<div class=\"ch-codeblock not-prose \" data-ch-theme=\"supabase\"><div class=\"ch-code-wrapper ch-code\" data-ch-measured=\"false\"><code class=\"ch-code-scroll-parent\"><br><div><span class=\"ch-code-line-number\">_<!-- -->10</span><div style=\"display:inline-block;margin-left:16px\"><span>supabase functions serve --env-file .env.local --no-verify-jwt</span></div></div><br></code></div></div>\n<p>Remember to pass in the <code>.env.local</code> file using the <code>--env-file</code> parameter so that the Edge Function can access the <code>HUGGING_FACE_ACCESS_TOKEN</code>.</p>\n<div role=\"alert\" class=\"relative w-full text-sm rounded-lg p-4 [&amp;>svg~*]:pl-10 [&amp;>svg+div]:translate-y-[-3px] [&amp;>svg]:absolute [&amp;>svg]:left-4 [&amp;>svg]:top-4 [&amp;>svg]:w-[23px] [&amp;>svg]:h-[23px] [&amp;>svg]:p-1 [&amp;>svg]:flex [&amp;>svg]:rounded text-foreground [&amp;>svg]:text-background [&amp;>svg]:bg-foreground mb-2 [&amp;_svg]:bg-foreground-muted [&amp;_svg]:text-background-muted bg-surface-200/25 border border-default\"><svg xmlns=\"http://www.w3.org/2000/svg\" viewBox=\"0 0 21 20\" class=\"w-6 h-6\" fill=\"currentColor\"><path fill-rule=\"evenodd\" clip-rule=\"evenodd\" d=\"M0.625 9.8252C0.625 4.44043 4.99023 0.0751953 10.375 0.0751953C15.7598 0.0751953 20.125 4.44043 20.125 9.8252C20.125 15.21 15.7598 19.5752 10.375 19.5752C4.99023 19.5752 0.625 15.21 0.625 9.8252ZM9.3584 4.38135C9.45117 4.28857 9.55518 4.20996 9.66699 4.14648C9.88086 4.02539 10.1245 3.96045 10.375 3.96045C10.5845 3.96045 10.7896 4.00586 10.9766 4.09229C11.1294 4.1626 11.2705 4.26025 11.3916 4.38135C11.6611 4.65088 11.8125 5.0166 11.8125 5.39795C11.8125 5.5249 11.7959 5.6499 11.7637 5.77002C11.6987 6.01172 11.5718 6.23438 11.3916 6.41455C11.1221 6.68408 10.7563 6.83545 10.375 6.83545C9.99365 6.83545 9.62793 6.68408 9.3584 6.41455C9.08887 6.14502 8.9375 5.7793 8.9375 5.39795C8.9375 5.29492 8.94873 5.19287 8.97021 5.09375C9.02783 4.82568 9.16162 4.57812 9.3584 4.38135ZM10.375 15.6899C10.0933 15.6899 9.82275 15.5781 9.62354 15.3789C9.42432 15.1797 9.3125 14.9092 9.3125 14.6274V9.31494C9.3125 9.0332 9.42432 8.7627 9.62354 8.56348C9.82275 8.36426 10.0933 8.25244 10.375 8.25244C10.6567 8.25244 10.9272 8.36426 11.1265 8.56348C11.3257 8.7627 11.4375 9.0332 11.4375 9.31494V14.6274C11.4375 14.7944 11.3979 14.9575 11.3242 15.104C11.2739 15.2046 11.2075 15.2979 11.1265 15.3789C10.9272 15.5781 10.6567 15.6899 10.375 15.6899Z\"></path></svg><div class=\"text mt [&amp;_p]:mb-1.5 [&amp;_p]:mt-0 mt-0.5 [&amp;_p:last-child]:mb-0\"><p>For demo purposes we set <code>--no-verify-jwt</code> to make it easy to test the Edge Function without passing in a JWT token. In a real application you will need to pass the JWT as a <code>Bearer</code> token in the <code>Authorization</code> header.</p></div></div>\n<p>At this point, you can make an API request to your Edge Function using your preferred frontend framework (Next.js, React, Expo, etc). We can also test from the terminal using <code>curl</code>:</p>\n<div class=\"ch-codeblock not-prose \" data-ch-theme=\"supabase\"><div class=\"ch-code-wrapper ch-code\" data-ch-measured=\"false\"><code class=\"ch-code-scroll-parent\"><br><div><span class=\"ch-code-line-number\">_<!-- -->10</span><div style=\"display:inline-block;margin-left:16px\"><span>curl --output result.jpg --location --request POST 'http://localhost:54321/functions/v1/text-to-image' \\</span></div></div><div><span class=\"ch-code-line-number\">_<!-- -->10</span><div style=\"display:inline-block;margin-left:16px\"><span>  --header 'Content-Type: application/json' \\</span></div></div><div><span class=\"ch-code-line-number\">_<!-- -->10</span><div style=\"display:inline-block;margin-left:16px\"><span>  --data '{\"prompt\":\"Llama wearing sunglasses\"}'</span></div></div><br></code></div></div>\n<p>In this example, your generated image will save to <code>result.jpg</code>:</p>\n<img src=\"/docs/img/ai/hugging-face/llama-sunglasses-example.png\" alt=\"Llama wearing sunglasses example\" width=\"400\" height=\"400\">\n<h2 id=\"next-steps\" class=\"group scroll-mt-24\">Next steps<a href=\"#next-steps\" aria-hidden=\"true\" class=\"ml-2 opacity-0 group-hover:opacity-100 transition\"><span aria-hidden=\"true\">#</span></a></h2>\n<p>You can now create an Edge Function that invokes a Hugging Face task using your model of choice.</p>\n<p>Try running some other <a href=\"#ai-tasks\">AI tasks</a>.</p>\n<h2 id=\"resources\" class=\"group scroll-mt-24\">Resources<a href=\"#resources\" aria-hidden=\"true\" class=\"ml-2 opacity-0 group-hover:opacity-100 transition\"><span aria-hidden=\"true\">#</span></a></h2>\n<ul>\n<li>Official <a href=\"https://huggingface.co/\">Hugging Face site</a>.</li>\n<li>Official <a href=\"https://huggingface.co/docs/huggingface.js\">Hugging Face JS docs</a>.</li>\n<li><a href=\"/docs/guides/ai/examples/huggingface-image-captioning\">Generate image captions</a> using Hugging Face.</li>\n</ul></article></div></div></div><!--$--><div class=\"max-w-7xl px-5 mx-auto py-8 pt-0\"></div><!--/$--></div><div class=\"left-0 right-0 z-10 backdrop-blur-sm backdrop-filter bg-alternative/90 hidden h-0 lg:hidden\"></div></div></main></div></div></div></div></body></html>",
      "metadata": {
        "ogUrl": "https://supabase.com/docs/guides/ai/hugging-face",
        "title": "Hugging Face Inference API | Supabase Docs",
        "robots": "index, follow",
        "ogImage": "https://obuldanrptloktxcffvn.supabase.co/functions/v1/og-images?site=docs&type=ai&title=Hugging%20Face%20Inference%20API&description=Learn%20how%20to%20integrate%20hugging%20face%20models%20with%20Supabase",
        "ogTitle": "Hugging Face Inference API | Supabase Docs",
        "language": "en",
        "sourceURL": "https://supabase.com/docs/guides/ai/hugging-face",
        "description": "Learn how to integrate hugging face models with Supabase",
        "modifiedTime": "2024-09-10T20:36:25.434Z",
        "ogDescription": "Learn how to integrate hugging face models with Supabase",
        "publishedTime": "2024-09-10T20:36:25.434Z",
        "ogLocaleAlternate": [],
        "statusCode": 200
      }
    },
    {
      "markdown": "AI & Vectors\n\n# Generate image captions using Hugging Face\n\n## Use the Hugging Face Inference API to make calls to 100,000+ Machine Learning models from Supabase Edge Functions.\n\n* * *\n\nWe can combine Hugging Face with [Supabase Storage](https://supabase.com/storage) and [Database Webhooks](https://supabase.com/docs/guides/database/webhooks) to automatically caption for any image we upload to a storage bucket.\n\n## About Hugging Face [\\#](\\#about-hugging-face)\n\n[Hugging Face](https://huggingface.co/) is the collaboration platform for the machine learning community.\n\n[Huggingface.js](https://huggingface.co/docs/huggingface.js/index) provides a convenient way to make calls to 100,000+ Machine Learning models, making it easy to incorporate AI functionality into your [Supabase Edge Functions](https://supabase.com/edge-functions).\n\n## Setup [\\#](\\#setup)\n\n- Open your Supabase project dashboard or [create a new project](https://supabase.com/dashboard/projects).\n- [Create a new bucket](https://supabase.com/dashboard/project/_/storage/buckets) called `images`.\n- Generate TypeScript types from remote Database.\n- Create a new Database table called `image_caption`.\n  - Create `id` column of type `uuid` which references `storage.objects.id`.\n  - Create a `caption` column of type `text`.\n- Regenerate TypeScript types to include new `image_caption` table.\n- Deploy the function to Supabase: `supabase functions deploy huggingface-image-captioning`.\n- Create the Database Webhook in the [Supabase Dashboard](https://supabase.com/dashboard/project/_/database/hooks) to trigger the `huggingface-image-captioning` function anytime a record is added to the `storage.objects` table.\n\n## Generate TypeScript types [\\#](\\#generate-typescript-types)\n\nTo generate the types.ts file for the storage and public schemas, run the following command in the terminal:\n\n`\n_10\nsupabase gen types typescript --project-id=your-project-ref --schema=storage,public > supabase/functions/huggingface-image-captioning/types.ts\n`\n\n## Code [\\#](\\#code)\n\nFind the complete code on [GitHub](https://github.com/supabase/supabase/tree/master/examples/edge-functions/supabase/functions/huggingface-image-captioning).\n\n``\n_49\nimport { serve } from 'https://deno.land/std@0.168.0/http/server.ts'\n_49\nimport { HfInference } from 'https://esm.sh/@huggingface/inference@2.3.2'\n_49\nimport { createClient } from 'jsr:@supabase/supabase-js@2'\n_49\nimport { Database } from './types.ts'\n_49\n_49\nconsole.log('Hello from `huggingface-image-captioning` function!')\n_49\n_49\nconst hf = new HfInference(Deno.env.get('HUGGINGFACE_ACCESS_TOKEN'))\n_49\n_49\ntype SoRecord = Database['storage']['Tables']['objects']['Row']\n_49\ninterface WebhookPayload {\n_49\ntype: 'INSERT' | 'UPDATE' | 'DELETE'\n_49\ntable: string\n_49\nrecord: SoRecord\n_49\nschema: 'public'\n_49\nold_record: null | SoRecord\n_49\n}\n_49\n_49\nserve(async (req) => {\n_49\nconst payload: WebhookPayload = await req.json()\n_49\nconst soRecord = payload.record\n_49\nconst supabaseAdminClient = createClient<Database>(\n_49\n    // Supabase API URL - env var exported by default when deployed.\n_49\n    Deno.env.get('SUPABASE_URL') ?? '',\n_49\n    // Supabase API SERVICE ROLE KEY - env var exported by default when deployed.\n_49\n    Deno.env.get('SUPABASE_SERVICE_ROLE_KEY') ?? ''\n_49\n)\n_49\n_49\n// Construct image url from storage\n_49\nconst { data, error } = await supabaseAdminClient.storage\n_49\n    .from(soRecord.bucket_id!)\n_49\n    .createSignedUrl(soRecord.path_tokens!.join('/'), 60)\n_49\nif (error) throw error\n_49\nconst { signedUrl } = data\n_49\n_49\n// Run image captioning with Huggingface\n_49\nconst imgDesc = await hf.imageToText({\n_49\n    data: await (await fetch(signedUrl)).blob(),\n_49\n    model: 'nlpconnect/vit-gpt2-image-captioning',\n_49\n})\n_49\n_49\n// Store image caption in Database table\n_49\nawait supabaseAdminClient\n_49\n    .from('image_caption')\n_49\n    .insert({ id: soRecord.id!, caption: imgDesc.generated_text })\n_49\n    .throwOnError()\n_49\n_49\nreturn new Response('ok')\n_49\n})\n``",
      "html": "<!DOCTYPE html><html lang=\"en\" data-theme=\"light\" style=\"color-scheme: light;\"><body><div class=\"flex flex-col\"><div class=\"grow\"><div class=\"flex flex-col h-full w-full\"><div class=\"hidden lg:sticky w-full lg:flex top-0 left-0 right-0 z-50\"><!--$--><!--/$--></div><div class=\"flex flex-row h-full relative\"><main id=\"docs-content-container\" class=\"w-full transition-all ease-out relative lg:ml-0\"><div class=\"flex flex-col sticky top-0\"><div class=\"flex lg:hidden w-full top-0 left-0 right-0 z-50\"><!--$--><!--/$--></div><div class=\"sticky transition-all top-0 z-10 backdrop-blur backdrop-filter bg-background\"><div class=\"lg:hidden px-3.5 border-b z-10 transition-all ease-out top-0 flex items-center gap-1\"><button class=\"h-8 w-8 flex group items-center justify-center mr-1\"><div class=\"space-y-1 cursor-pointer relative w-4 h-[8px]\"><span class=\"transition-all ease-out block h-px bg-foreground-muted group-hover:bg-foreground w-4\"></span><span class=\"transition-all ease-out block h-px bg-foreground-muted group-hover:bg-foreground w-3 group-hover:w-4\"></span></div></button><span class=\"transition-all duration-200 text-foreground text-sm\">AI &amp; Vectors</span></div></div><div class=\"grow\"><div class=\"max-w-7xl px-5 mx-auto py-8 pb-0\"><div class=\"grid grid-cols-12 relative gap-4\"><div class=\"relative transition-all ease-out duration-100 col-span-12 md:col-span-9\"><article id=\"sb-docs-guide-main-article\" class=\"prose max-w-none\"><h1 class=\"mb-0\">Generate image captions using Hugging Face</h1><h2 class=\"mt-3 text-xl text-foreground-light\">Use the Hugging Face Inference API to make calls to 100,000+ Machine Learning models from Supabase Edge Functions.</h2><hr class=\"not-prose border-t-0 border-b my-8\">\n<p>We can combine Hugging Face with <a href=\"https://supabase.com/storage\">Supabase Storage</a> and <a href=\"https://supabase.com/docs/guides/database/webhooks\">Database Webhooks</a> to automatically caption for any image we upload to a storage bucket.</p>\n<h2 id=\"about-hugging-face\" class=\"group scroll-mt-24\">About Hugging Face<a href=\"#about-hugging-face\" aria-hidden=\"true\" class=\"ml-2 opacity-0 group-hover:opacity-100 transition\"><span aria-hidden=\"true\">#</span></a></h2>\n<p><a href=\"https://huggingface.co/\">Hugging Face</a> is the collaboration platform for the machine learning community.</p>\n<p><a href=\"https://huggingface.co/docs/huggingface.js/index\">Huggingface.js</a> provides a convenient way to make calls to 100,000+ Machine Learning models, making it easy to incorporate AI functionality into your <a href=\"https://supabase.com/edge-functions\">Supabase Edge Functions</a>.</p>\n<h2 id=\"setup\" class=\"group scroll-mt-24\">Setup<a href=\"#setup\" aria-hidden=\"true\" class=\"ml-2 opacity-0 group-hover:opacity-100 transition\"><span aria-hidden=\"true\">#</span></a></h2>\n<ul>\n<li>Open your Supabase project dashboard or <a href=\"https://supabase.com/dashboard/projects\">create a new project</a>.</li>\n<li><a href=\"https://supabase.com/dashboard/project/_/storage/buckets\">Create a new bucket</a> called <code>images</code>.</li>\n<li>Generate TypeScript types from remote Database.</li>\n<li>Create a new Database table called <code>image_caption</code>.<!-- -->\n<ul>\n<li>Create <code>id</code> column of type <code>uuid</code> which references <code>storage.objects.id</code>.</li>\n<li>Create a <code>caption</code> column of type <code>text</code>.</li>\n</ul>\n</li>\n<li>Regenerate TypeScript types to include new <code>image_caption</code> table.</li>\n<li>Deploy the function to Supabase: <code>supabase functions deploy huggingface-image-captioning</code>.</li>\n<li>Create the Database Webhook in the <a href=\"https://supabase.com/dashboard/project/_/database/hooks\">Supabase Dashboard</a> to trigger the <code>huggingface-image-captioning</code> function anytime a record is added to the <code>storage.objects</code> table.</li>\n</ul>\n<h2 id=\"generate-typescript-types\" class=\"group scroll-mt-24\">Generate TypeScript types<a href=\"#generate-typescript-types\" aria-hidden=\"true\" class=\"ml-2 opacity-0 group-hover:opacity-100 transition\"><span aria-hidden=\"true\">#</span></a></h2>\n<p>To generate the types.ts file for the storage and public schemas, run the following command in the terminal:</p>\n<div class=\"ch-codeblock not-prose \" data-ch-theme=\"supabase\"><div class=\"ch-code-wrapper ch-code\" data-ch-measured=\"false\"><code class=\"ch-code-scroll-parent\"><br><div><span class=\"ch-code-line-number\">_<!-- -->10</span><div style=\"display:inline-block;margin-left:16px\"><span>supabase gen types typescript --project-id=your-project-ref --schema=storage,public &gt; supabase/functions/huggingface-image-captioning/types.ts</span></div></div><br></code></div></div>\n<h2 id=\"code\" class=\"group scroll-mt-24\">Code<a href=\"#code\" aria-hidden=\"true\" class=\"ml-2 opacity-0 group-hover:opacity-100 transition\"><span aria-hidden=\"true\">#</span></a></h2>\n<p>Find the complete code on <a href=\"https://github.com/supabase/supabase/tree/master/examples/edge-functions/supabase/functions/huggingface-image-captioning\">GitHub</a>.</p>\n<div class=\"ch-codeblock not-prose \" data-ch-theme=\"supabase\"><div class=\"ch-code-wrapper ch-code\" data-ch-measured=\"false\"><code class=\"ch-code-scroll-parent\"><br><div><span class=\"ch-code-line-number\">_<!-- -->49</span><div style=\"display:inline-block;margin-left:16px\"><span>import { serve } from 'https://deno.land/std@0.168.0/http/server.ts'</span></div></div><div><span class=\"ch-code-line-number\">_<!-- -->49</span><div style=\"display:inline-block;margin-left:16px\"><span>import { HfInference } from 'https://esm.sh/@huggingface/inference@2.3.2'</span></div></div><div><span class=\"ch-code-line-number\">_<!-- -->49</span><div style=\"display:inline-block;margin-left:16px\"><span>import { createClient } from 'jsr:@supabase/supabase-js@2'</span></div></div><div><span class=\"ch-code-line-number\">_<!-- -->49</span><div style=\"display:inline-block;margin-left:16px\"><span>import { Database } from './types.ts'</span></div></div><div><span class=\"ch-code-line-number\">_<!-- -->49</span><div style=\"display:inline-block;margin-left:16px\"><span></span></div></div><div><span class=\"ch-code-line-number\">_<!-- -->49</span><div style=\"display:inline-block;margin-left:16px\"><span>console.log('Hello from `huggingface-image-captioning` function!')</span></div></div><div><span class=\"ch-code-line-number\">_<!-- -->49</span><div style=\"display:inline-block;margin-left:16px\"><span></span></div></div><div><span class=\"ch-code-line-number\">_<!-- -->49</span><div style=\"display:inline-block;margin-left:16px\"><span>const hf = new HfInference(Deno.env.get('HUGGINGFACE_ACCESS_TOKEN'))</span></div></div><div><span class=\"ch-code-line-number\">_<!-- -->49</span><div style=\"display:inline-block;margin-left:16px\"><span></span></div></div><div><span class=\"ch-code-line-number\">_<!-- -->49</span><div style=\"display:inline-block;margin-left:16px\"><span>type SoRecord = Database['storage']['Tables']['objects']['Row']</span></div></div><div><span class=\"ch-code-line-number\">_<!-- -->49</span><div style=\"display:inline-block;margin-left:16px\"><span>interface WebhookPayload {</span></div></div><div><span class=\"ch-code-line-number\">_<!-- -->49</span><div style=\"display:inline-block;margin-left:16px\"><span>  type: 'INSERT' | 'UPDATE' | 'DELETE'</span></div></div><div><span class=\"ch-code-line-number\">_<!-- -->49</span><div style=\"display:inline-block;margin-left:16px\"><span>  table: string</span></div></div><div><span class=\"ch-code-line-number\">_<!-- -->49</span><div style=\"display:inline-block;margin-left:16px\"><span>  record: SoRecord</span></div></div><div><span class=\"ch-code-line-number\">_<!-- -->49</span><div style=\"display:inline-block;margin-left:16px\"><span>  schema: 'public'</span></div></div><div><span class=\"ch-code-line-number\">_<!-- -->49</span><div style=\"display:inline-block;margin-left:16px\"><span>  old_record: null | SoRecord</span></div></div><div><span class=\"ch-code-line-number\">_<!-- -->49</span><div style=\"display:inline-block;margin-left:16px\"><span>}</span></div></div><div><span class=\"ch-code-line-number\">_<!-- -->49</span><div style=\"display:inline-block;margin-left:16px\"><span></span></div></div><div><span class=\"ch-code-line-number\">_<!-- -->49</span><div style=\"display:inline-block;margin-left:16px\"><span>serve(async (req) =&gt; {</span></div></div><div><span class=\"ch-code-line-number\">_<!-- -->49</span><div style=\"display:inline-block;margin-left:16px\"><span>  const payload: WebhookPayload = await req.json()</span></div></div><div><span class=\"ch-code-line-number\">_<!-- -->49</span><div style=\"display:inline-block;margin-left:16px\"><span>  const soRecord = payload.record</span></div></div><div><span class=\"ch-code-line-number\">_<!-- -->49</span><div style=\"display:inline-block;margin-left:16px\"><span>  const supabaseAdminClient = createClient&lt;Database&gt;(</span></div></div><div><span class=\"ch-code-line-number\">_<!-- -->49</span><div style=\"display:inline-block;margin-left:16px\"><span>    // Supabase API URL - env var exported by default when deployed.</span></div></div><div><span class=\"ch-code-line-number\">_<!-- -->49</span><div style=\"display:inline-block;margin-left:16px\"><span>    Deno.env.get('SUPABASE_URL') ?? '',</span></div></div><div><span class=\"ch-code-line-number\">_<!-- -->49</span><div style=\"display:inline-block;margin-left:16px\"><span>    // Supabase API SERVICE ROLE KEY - env var exported by default when deployed.</span></div></div><div><span class=\"ch-code-line-number\">_<!-- -->49</span><div style=\"display:inline-block;margin-left:16px\"><span>    Deno.env.get('SUPABASE_SERVICE_ROLE_KEY') ?? ''</span></div></div><div><span class=\"ch-code-line-number\">_<!-- -->49</span><div style=\"display:inline-block;margin-left:16px\"><span>  )</span></div></div><div><span class=\"ch-code-line-number\">_<!-- -->49</span><div style=\"display:inline-block;margin-left:16px\"><span></span></div></div><div><span class=\"ch-code-line-number\">_<!-- -->49</span><div style=\"display:inline-block;margin-left:16px\"><span>  // Construct image url from storage</span></div></div><div><span class=\"ch-code-line-number\">_<!-- -->49</span><div style=\"display:inline-block;margin-left:16px\"><span>  const { data, error } = await supabaseAdminClient.storage</span></div></div><div><span class=\"ch-code-line-number\">_<!-- -->49</span><div style=\"display:inline-block;margin-left:16px\"><span>    .from(soRecord.bucket_id!)</span></div></div><div><span class=\"ch-code-line-number\">_<!-- -->49</span><div style=\"display:inline-block;margin-left:16px\"><span>    .createSignedUrl(soRecord.path_tokens!.join('/'), 60)</span></div></div><div><span class=\"ch-code-line-number\">_<!-- -->49</span><div style=\"display:inline-block;margin-left:16px\"><span>  if (error) throw error</span></div></div><div><span class=\"ch-code-line-number\">_<!-- -->49</span><div style=\"display:inline-block;margin-left:16px\"><span>  const { signedUrl } = data</span></div></div><div><span class=\"ch-code-line-number\">_<!-- -->49</span><div style=\"display:inline-block;margin-left:16px\"><span></span></div></div><div><span class=\"ch-code-line-number\">_<!-- -->49</span><div style=\"display:inline-block;margin-left:16px\"><span>  // Run image captioning with Huggingface</span></div></div><div><span class=\"ch-code-line-number\">_<!-- -->49</span><div style=\"display:inline-block;margin-left:16px\"><span>  const imgDesc = await hf.imageToText({</span></div></div><div><span class=\"ch-code-line-number\">_<!-- -->49</span><div style=\"display:inline-block;margin-left:16px\"><span>    data: await (await fetch(signedUrl)).blob(),</span></div></div><div><span class=\"ch-code-line-number\">_<!-- -->49</span><div style=\"display:inline-block;margin-left:16px\"><span>    model: 'nlpconnect/vit-gpt2-image-captioning',</span></div></div><div><span class=\"ch-code-line-number\">_<!-- -->49</span><div style=\"display:inline-block;margin-left:16px\"><span>  })</span></div></div><div><span class=\"ch-code-line-number\">_<!-- -->49</span><div style=\"display:inline-block;margin-left:16px\"><span></span></div></div><div><span class=\"ch-code-line-number\">_<!-- -->49</span><div style=\"display:inline-block;margin-left:16px\"><span>  // Store image caption in Database table</span></div></div><div><span class=\"ch-code-line-number\">_<!-- -->49</span><div style=\"display:inline-block;margin-left:16px\"><span>  await supabaseAdminClient</span></div></div><div><span class=\"ch-code-line-number\">_<!-- -->49</span><div style=\"display:inline-block;margin-left:16px\"><span>    .from('image_caption')</span></div></div><div><span class=\"ch-code-line-number\">_<!-- -->49</span><div style=\"display:inline-block;margin-left:16px\"><span>    .insert({ id: soRecord.id!, caption: imgDesc.generated_text })</span></div></div><div><span class=\"ch-code-line-number\">_<!-- -->49</span><div style=\"display:inline-block;margin-left:16px\"><span>    .throwOnError()</span></div></div><div><span class=\"ch-code-line-number\">_<!-- -->49</span><div style=\"display:inline-block;margin-left:16px\"><span></span></div></div><div><span class=\"ch-code-line-number\">_<!-- -->49</span><div style=\"display:inline-block;margin-left:16px\"><span>  return new Response('ok')</span></div></div><div><span class=\"ch-code-line-number\">_<!-- -->49</span><div style=\"display:inline-block;margin-left:16px\"><span>})</span></div></div><br></code></div></div></article></div></div></div><!--$--><div class=\"max-w-7xl px-5 mx-auto py-8 pt-0\"></div><!--/$--></div><div class=\"left-0 right-0 z-10 backdrop-blur-sm backdrop-filter bg-alternative/90 hidden h-0 lg:hidden\"></div></div></main></div></div></div></div></body></html>",
      "metadata": {
        "ogUrl": "https://supabase.com/docs/guides/ai/examples/huggingface-image-captioning",
        "title": "Generate image captions using Hugging Face | Supabase Docs",
        "robots": "index, follow",
        "ogImage": "https://obuldanrptloktxcffvn.supabase.co/functions/v1/og-images?site=docs&type=ai&title=Generate%20image%20captions%20using%20Hugging%20Face&description=Use%20the%20Hugging%20Face%20Inference%20API%20to%20make%20calls%20to%20100%2C000%2B%20Machine%20Learning%20models%20from%20Supabase%20Edge%20Functions.",
        "ogTitle": "Generate image captions using Hugging Face | Supabase Docs",
        "language": "en",
        "sourceURL": "https://supabase.com/docs/guides/ai/examples/huggingface-image-captioning",
        "description": "Use the Hugging Face Inference API to make calls to 100,000+ Machine Learning models from Supabase Edge Functions.",
        "modifiedTime": "2024-09-10T20:36:25.434Z",
        "ogDescription": "Use the Hugging Face Inference API to make calls to 100,000+ Machine Learning models from Supabase Edge Functions.",
        "publishedTime": "2024-09-10T20:36:25.434Z",
        "ogLocaleAlternate": [],
        "statusCode": 200
      }
    },
    {
      "markdown": "AI & Vectors\n\n# Semantic search\n\n## Learn how to search by meaning rather than exact keywords.\n\n* * *\n\nSemantic search interprets the meaning behind user queries rather than exact [keywords](/docs/guides/ai/keyword-search). It uses machine learning to capture the intent and context behind the query, handling language nuances like synonyms, phrasing variations, and word relationships.\n\n## When to use semantic search [\\#](\\#when-to-use-semantic-search)\n\nSemantic search is useful in applications where the depth of understanding and context is important for delivering relevant results. A good example is in customer support or knowledge base search engines. Users often phrase their problems or questions in various ways, and a traditional keyword-based search might not always retrieve the most helpful documents. With semantic search, the system can understand the meaning behind the queries and match them with relevant solutions or articles, even if the exact wording differs.\n\nFor instance, a user searching for \"increase text size on display\" might miss articles titled \"How to adjust font size in settings\" in a keyword-based search system. However, a semantic search engine would understand the intent behind the query and correctly match it to relevant articles, regardless of the specific terminology used.\n\nIt's also possible to combine semantic search with keyword search to get the best of both worlds. See [Hybrid search](/docs/guides/ai/hybrid-search) for more details.\n\n## How semantic search works [\\#](\\#how-semantic-search-works)\n\nSemantic search uses an intermediate representation called an \u201cembedding vector\u201d to link database records with search queries. A vector, in the context of semantic search, is a list of numerical values. They represent various features of the text and allow for the semantic comparison between different pieces of text.\n\nThe best way to think of embeddings is by plotting them on a graph, where each embedding is a single point whose coordinates are the numerical values within its vector. Importantly, embeddings are plotted such that similar concepts are positioned close together while dissimilar concepts are far apart. For more details, see [What are embeddings?](/docs/guides/ai/concepts#what-are-embeddings)\n\nEmbeddings are generated using a language model, and embeddings are compared to each other using a similarity metric. The language model is trained to understand the semantics of language, including syntax, context, and the relationships between words. It generates embeddings for both the content in the database and the search queries. Then the similarity metric, often a function like cosine similarity or dot product, is used to compare the query embeddings with the document embeddings (in other words, to measure how close they are to each other on the graph). The documents with embeddings most similar to the query's are deemed the most relevant and are returned as search results.\n\n## Embedding models [\\#](\\#embedding-models)\n\nThere are many embedding models available today. Supabase Edge Functions has [built in support](/docs/guides/functions/examples/semantic-search) for the `gte-small` model. Others can be accessed through third-party APIs like [OpenAI](https://platform.openai.com/docs/guides/embeddings), where you send your text in the request and receive an embedding vector in the response. Others can run locally on your own compute, such as through Transformers.js for JavaScript implementations. For more information on local implementation, see [Generate embeddings](/docs/guides/ai/quickstarts/generate-text-embeddings).\n\nIt's crucial to remember that when using embedding models with semantic search, you must use the same model for all embedding comparisons. Comparing embeddings created by different models will yield meaningless results.\n\n## Semantic search in Postgres [\\#](\\#semantic-search-in-postgres)\n\nTo implement semantic search in Postgres we use `pgvector` \\- an extension that allows for efficient storage and retrieval of high-dimensional vectors. These vectors are numerical representations of text (or other types of data) generated by embedding models.\n\n1. Enable the `pgvector` extension by running:\n\n\n\n`\n_10\ncreate extension vector\n_10\nwith\n_10\nschema extensions;\n`\n\n2. Create a table to store the embeddings:\n\n\n\n`\n_10\ncreate table documents (\n_10\nid bigint primary key generated always as identity,\n_10\ncontent text,\n_10\nembedding vector(512)\n_10\n);\n`\n\n\n\nOr if you have an existing table, you can add a vector column like so:\n\n\n\n`\n_10\nalter table documents\n_10\nadd column embedding vector(512);\n`\n\n\n\nIn this example, we create a column named `embedding` which uses the newly enabled `vector` data type. The size of the vector (as indicated in parentheses) represents the number of dimensions in the embedding. Here we use 512, but adjust this to match the number of dimensions produced by your embedding model.\n\n\nFor more details on vector columns, including how to generate embeddings and store them, see [Vector columns](/docs/guides/ai/vector-columns).\n\n### Similarity metric [\\#](\\#similarity-metric)\n\n`pgvector` support 3 operators for computing distance between embeddings:\n\n| **Operator** | **Description** |\n| --- | --- |\n| `<->` | Euclidean distance |\n| `<#>` | negative inner product |\n| `<=>` | cosine distance |\n\nThese operators are used directly in your SQL query to retrieve records that are most similar to the user's search query. Choosing the right operator depends on your needs. Inner product (also known as dot product) tends to be the fastest if your vectors are normalized.\n\nThe easiest way to perform semantic search in Postgres in by creating a function:\n\n`\n_15\n-- Match documents using cosine distance (<=>)\n_15\ncreate or replace function match_documents (\n_15\nquery_embedding vector(512),\n_15\nmatch_threshold float,\n_15\nmatch_count int\n_15\n)\n_15\nreturns setof documents\n_15\nlanguage sql\n_15\nas $$\n_15\nselect *\n_15\nfrom documents\n_15\nwhere documents.embedding <=> query_embedding < 1 - match_threshold\n_15\norder by documents.embedding <=> query_embedding asc\n_15\nlimit least(match_count, 200);\n_15\n$$;\n`\n\nHere we create a function `match_documents` that accepts three parameters:\n\n1. `query_embedding`: a one-time embedding generated for the user's search query. Here we set the size to 512, but adjust this to match the number of dimensions produced by your embedding model.\n2. `match_threshold`: the minimum similarity between embeddings. This is a value between 1 and -1, where 1 is most similar and -1 is most dissimilar.\n3. `match_count`: the maximum number of results to return. Note the query may return less than this number if `match_threshold` resulted in a small shortlist. Limited to 200 records to avoid unintentionally overloading your database.\n\nIn this example, we return a `setof documents` and refer to `documents` throughout the query. Adjust this to use the relevant tables in your application.\n\nYou'll notice we are using the cosine distance ( `<=>`) operator in our query. Cosine distance is a safe default when you don't know whether or not your embeddings are normalized. If you know for a fact that they are normalized (for example, your embedding is returned from OpenAI), you can use negative inner product ( `<#>`) for better performance:\n\n`\n_15\n-- Match documents using negative inner product (<#>)\n_15\ncreate or replace function match_documents (\n_15\nquery_embedding vector(512),\n_15\nmatch_threshold float,\n_15\nmatch_count int\n_15\n)\n_15\nreturns setof documents\n_15\nlanguage sql\n_15\nas $$\n_15\nselect *\n_15\nfrom documents\n_15\nwhere documents.embedding <#> query_embedding < -match_threshold\n_15\norder by documents.embedding <#> query_embedding asc\n_15\nlimit least(match_count, 200);\n_15\n$$;\n`\n\nNote that since `<#>` is negative, we negate `match_threshold` accordingly in the `where` clause. For more information on the different operators, see the [pgvector docs](https://github.com/pgvector/pgvector?tab=readme-ov-file#vector-operators).\n\n### Calling from your application [\\#](\\#calling-from-your-application)\n\nFinally you can execute this function from your application. If you are using a Supabase client library such as [`supabase-js`](https://github.com/supabase/supabase-js), you can invoke it using the `rpc()` method:\n\n`\n_10\nconst { data: documents } = await supabase.rpc('match_documents', {\n_10\nquery_embedding: embedding, // pass the query embedding\n_10\nmatch_threshold: 0.78, // choose an appropriate threshold for your data\n_10\nmatch_count: 10, // choose the number of matches\n_10\n})\n`\n\nYou can also call this method directly from SQL:\n\n`\n_10\nselect *\n_10\nfrom match_documents(\n_10\n'[...]'::vector(512), -- pass the query embedding\n_10\n0.78, -- chose an appropriate threshold for your data\n_10\n10 -- choose the number of matches\n_10\n);\n`\n\nIn this scenario, you'll likely use a Postgres client library to establish a direct connection from your application to the database. It's best practice to parameterize your arguments before executing the query.\n\n## Next steps [\\#](\\#next-steps)\n\nAs your database scales, you will need an index on your vector columns to maintain fast query speeds. See [Vector indexes](/docs/guides/ai/vector-indexes) for an in-depth guide on the different types of indexes and how they work.\n\n## See also [\\#](\\#see-also)\n\n- [Embedding concepts](/docs/guides/ai/concepts)\n- [Vector columns](/docs/guides/ai/vector-columns)\n- [Vector indexes](/docs/guides/ai/vector-indexes)\n- [Hybrid search](/docs/guides/ai/hybrid-search)\n- [Keyword search](/docs/guides/ai/keyword-search)",
      "html": "<!DOCTYPE html><html lang=\"en\" data-theme=\"light\" style=\"color-scheme: light;\"><body><div class=\"flex flex-col\"><div class=\"grow\"><div class=\"flex flex-col h-full w-full\"><div class=\"hidden lg:sticky w-full lg:flex top-0 left-0 right-0 z-50\"><!--$--><!--/$--></div><div class=\"flex flex-row h-full relative\"><main id=\"docs-content-container\" class=\"w-full transition-all ease-out relative lg:ml-0\"><div class=\"flex flex-col sticky top-0\"><div class=\"flex lg:hidden w-full top-0 left-0 right-0 z-50\"><!--$--><!--/$--></div><div class=\"sticky transition-all top-0 z-10 backdrop-blur backdrop-filter bg-background\"><div class=\"lg:hidden px-3.5 border-b z-10 transition-all ease-out top-0 flex items-center gap-1\"><button class=\"h-8 w-8 flex group items-center justify-center mr-1\"><div class=\"space-y-1 cursor-pointer relative w-4 h-[8px]\"><span class=\"transition-all ease-out block h-px bg-foreground-muted group-hover:bg-foreground w-4\"></span><span class=\"transition-all ease-out block h-px bg-foreground-muted group-hover:bg-foreground w-3 group-hover:w-4\"></span></div></button><span class=\"transition-all duration-200 text-foreground text-sm\">AI &amp; Vectors</span></div></div><div class=\"grow\"><div class=\"max-w-7xl px-5 mx-auto py-8 pb-0\"><div class=\"grid grid-cols-12 relative gap-4\"><div class=\"relative transition-all ease-out duration-100 col-span-12 md:col-span-9\"><article id=\"sb-docs-guide-main-article\" class=\"prose max-w-none\"><h1 class=\"mb-0\">Semantic search</h1><h2 class=\"mt-3 text-xl text-foreground-light\">Learn how to search by meaning rather than exact keywords.</h2><hr class=\"not-prose border-t-0 border-b my-8\">\n<p>Semantic search interprets the meaning behind user queries rather than exact <a href=\"/docs/guides/ai/keyword-search\">keywords</a>. It uses machine learning to capture the intent and context behind the query, handling language nuances like synonyms, phrasing variations, and word relationships.</p>\n<h2 id=\"when-to-use-semantic-search\" class=\"group scroll-mt-24\">When to use semantic search<a href=\"#when-to-use-semantic-search\" aria-hidden=\"true\" class=\"ml-2 opacity-0 group-hover:opacity-100 transition\"><span aria-hidden=\"true\">#</span></a></h2>\n<p>Semantic search is useful in applications where the depth of understanding and context is important for delivering relevant results. A good example is in customer support or knowledge base search engines. Users often phrase their problems or questions in various ways, and a traditional keyword-based search might not always retrieve the most helpful documents. With semantic search, the system can understand the meaning behind the queries and match them with relevant solutions or articles, even if the exact wording differs.</p>\n<p>For instance, a user searching for \"increase text size on display\" might miss articles titled \"How to adjust font size in settings\" in a keyword-based search system. However, a semantic search engine would understand the intent behind the query and correctly match it to relevant articles, regardless of the specific terminology used.</p>\n<p>It's also possible to combine semantic search with keyword search to get the best of both worlds. See <a href=\"/docs/guides/ai/hybrid-search\">Hybrid search</a> for more details.</p>\n<h2 id=\"how-semantic-search-works\" class=\"group scroll-mt-24\">How semantic search works<a href=\"#how-semantic-search-works\" aria-hidden=\"true\" class=\"ml-2 opacity-0 group-hover:opacity-100 transition\"><span aria-hidden=\"true\">#</span></a></h2>\n<p>Semantic search uses an intermediate representation called an \u201cembedding vector\u201d to link database records with search queries. A vector, in the context of semantic search, is a list of numerical values. They represent various features of the text and allow for the semantic comparison between different pieces of text.</p>\n<p>The best way to think of embeddings is by plotting them on a graph, where each embedding is a single point whose coordinates are the numerical values within its vector. Importantly, embeddings are plotted such that similar concepts are positioned close together while dissimilar concepts are far apart. For more details, see <a href=\"/docs/guides/ai/concepts#what-are-embeddings\">What are embeddings?</a></p>\n<p>Embeddings are generated using a language model, and embeddings are compared to each other using a similarity metric. The language model is trained to understand the semantics of language, including syntax, context, and the relationships between words. It generates embeddings for both the content in the database and the search queries. Then the similarity metric, often a function like cosine similarity or dot product, is used to compare the query embeddings with the document embeddings (in other words, to measure how close they are to each other on the graph). The documents with embeddings most similar to the query's are deemed the most relevant and are returned as search results.</p>\n<h2 id=\"embedding-models\" class=\"group scroll-mt-24\">Embedding models<a href=\"#embedding-models\" aria-hidden=\"true\" class=\"ml-2 opacity-0 group-hover:opacity-100 transition\"><span aria-hidden=\"true\">#</span></a></h2>\n<p>There are many embedding models available today. Supabase Edge Functions has <a href=\"/docs/guides/functions/examples/semantic-search\">built in support</a> for the <code>gte-small</code> model. Others can be accessed through third-party APIs like <a href=\"https://platform.openai.com/docs/guides/embeddings\">OpenAI</a>, where you send your text in the request and receive an embedding vector in the response. Others can run locally on your own compute, such as through Transformers.js for JavaScript implementations. For more information on local implementation, see <a href=\"/docs/guides/ai/quickstarts/generate-text-embeddings\">Generate embeddings</a>.</p>\n<p>It's crucial to remember that when using embedding models with semantic search, you must use the same model for all embedding comparisons. Comparing embeddings created by different models will yield meaningless results.</p>\n<h2 id=\"semantic-search-in-postgres\" class=\"group scroll-mt-24\">Semantic search in Postgres<a href=\"#semantic-search-in-postgres\" aria-hidden=\"true\" class=\"ml-2 opacity-0 group-hover:opacity-100 transition\"><span aria-hidden=\"true\">#</span></a></h2>\n<p>To implement semantic search in Postgres we use <code>pgvector</code> - an extension that allows for efficient storage and retrieval of high-dimensional vectors. These vectors are numerical representations of text (or other types of data) generated by embedding models.</p>\n<ol>\n<li>\n<p>Enable the <code>pgvector</code> extension by running:</p>\n<div class=\"ch-codeblock not-prose \" data-ch-theme=\"supabase\"><div class=\"ch-code-wrapper ch-code\" data-ch-measured=\"false\"><code class=\"ch-code-scroll-parent\"><br><div><span class=\"ch-code-line-number\">_<!-- -->10</span><div style=\"display:inline-block;margin-left:16px\"><span>create extension vector</span></div></div><div><span class=\"ch-code-line-number\">_<!-- -->10</span><div style=\"display:inline-block;margin-left:16px\"><span>with</span></div></div><div><span class=\"ch-code-line-number\">_<!-- -->10</span><div style=\"display:inline-block;margin-left:16px\"><span>  schema extensions;</span></div></div><br></code></div></div>\n</li>\n<li>\n<p>Create a table to store the embeddings:</p>\n<div class=\"ch-codeblock not-prose \" data-ch-theme=\"supabase\"><div class=\"ch-code-wrapper ch-code\" data-ch-measured=\"false\"><code class=\"ch-code-scroll-parent\"><br><div><span class=\"ch-code-line-number\">_<!-- -->10</span><div style=\"display:inline-block;margin-left:16px\"><span>create table documents (</span></div></div><div><span class=\"ch-code-line-number\">_<!-- -->10</span><div style=\"display:inline-block;margin-left:16px\"><span>  id bigint primary key generated always as identity,</span></div></div><div><span class=\"ch-code-line-number\">_<!-- -->10</span><div style=\"display:inline-block;margin-left:16px\"><span>  content text,</span></div></div><div><span class=\"ch-code-line-number\">_<!-- -->10</span><div style=\"display:inline-block;margin-left:16px\"><span>  embedding vector(512)</span></div></div><div><span class=\"ch-code-line-number\">_<!-- -->10</span><div style=\"display:inline-block;margin-left:16px\"><span>);</span></div></div><br></code></div></div>\n<p>Or if you have an existing table, you can add a vector column like so:</p>\n<div class=\"ch-codeblock not-prose \" data-ch-theme=\"supabase\"><div class=\"ch-code-wrapper ch-code\" data-ch-measured=\"false\"><code class=\"ch-code-scroll-parent\"><br><div><span class=\"ch-code-line-number\">_<!-- -->10</span><div style=\"display:inline-block;margin-left:16px\"><span>alter table documents</span></div></div><div><span class=\"ch-code-line-number\">_<!-- -->10</span><div style=\"display:inline-block;margin-left:16px\"><span>add column embedding vector(512);</span></div></div><br></code></div></div>\n<p>In this example, we create a column named <code>embedding</code> which uses the newly enabled <code>vector</code> data type. The size of the vector (as indicated in parentheses) represents the number of dimensions in the embedding. Here we use 512, but adjust this to match the number of dimensions produced by your embedding model.</p>\n</li>\n</ol>\n<p>For more details on vector columns, including how to generate embeddings and store them, see <a href=\"/docs/guides/ai/vector-columns\">Vector columns</a>.</p>\n<h3 id=\"similarity-metric\" class=\"group scroll-mt-24\">Similarity metric<a href=\"#similarity-metric\" aria-hidden=\"true\" class=\"ml-2 opacity-0 group-hover:opacity-100 transition\"><span aria-hidden=\"true\">#</span></a></h3>\n<p><code>pgvector</code> support 3 operators for computing distance between embeddings:</p>\n<table><thead><tr><th><strong>Operator</strong></th><th><strong>Description</strong></th></tr></thead><tbody><tr><td><code>&lt;-&gt;</code></td><td>Euclidean distance</td></tr><tr><td><code>&lt;#&gt;</code></td><td>negative inner product</td></tr><tr><td><code>&lt;=&gt;</code></td><td>cosine distance</td></tr></tbody></table>\n<p>These operators are used directly in your SQL query to retrieve records that are most similar to the user's search query. Choosing the right operator depends on your needs. Inner product (also known as dot product) tends to be the fastest if your vectors are normalized.</p>\n<p>The easiest way to perform semantic search in Postgres in by creating a function:</p>\n<div class=\"ch-codeblock not-prose \" data-ch-theme=\"supabase\"><div class=\"ch-code-wrapper ch-code\" data-ch-measured=\"false\"><code class=\"ch-code-scroll-parent\"><br><div><span class=\"ch-code-line-number\">_<!-- -->15</span><div style=\"display:inline-block;margin-left:16px\"><span>-- Match documents using cosine distance (&lt;=&gt;)</span></div></div><div><span class=\"ch-code-line-number\">_<!-- -->15</span><div style=\"display:inline-block;margin-left:16px\"><span>create or replace function match_documents (</span></div></div><div><span class=\"ch-code-line-number\">_<!-- -->15</span><div style=\"display:inline-block;margin-left:16px\"><span>  query_embedding vector(512),</span></div></div><div><span class=\"ch-code-line-number\">_<!-- -->15</span><div style=\"display:inline-block;margin-left:16px\"><span>  match_threshold float,</span></div></div><div><span class=\"ch-code-line-number\">_<!-- -->15</span><div style=\"display:inline-block;margin-left:16px\"><span>  match_count int</span></div></div><div><span class=\"ch-code-line-number\">_<!-- -->15</span><div style=\"display:inline-block;margin-left:16px\"><span>)</span></div></div><div><span class=\"ch-code-line-number\">_<!-- -->15</span><div style=\"display:inline-block;margin-left:16px\"><span>returns setof documents</span></div></div><div><span class=\"ch-code-line-number\">_<!-- -->15</span><div style=\"display:inline-block;margin-left:16px\"><span>language sql</span></div></div><div><span class=\"ch-code-line-number\">_<!-- -->15</span><div style=\"display:inline-block;margin-left:16px\"><span>as $$</span></div></div><div><span class=\"ch-code-line-number\">_<!-- -->15</span><div style=\"display:inline-block;margin-left:16px\"><span>  select *</span></div></div><div><span class=\"ch-code-line-number\">_<!-- -->15</span><div style=\"display:inline-block;margin-left:16px\"><span>  from documents</span></div></div><div><span class=\"ch-code-line-number\">_<!-- -->15</span><div style=\"display:inline-block;margin-left:16px\"><span>  where documents.embedding &lt;=&gt; query_embedding &lt; 1 - match_threshold</span></div></div><div><span class=\"ch-code-line-number\">_<!-- -->15</span><div style=\"display:inline-block;margin-left:16px\"><span>  order by documents.embedding &lt;=&gt; query_embedding asc</span></div></div><div><span class=\"ch-code-line-number\">_<!-- -->15</span><div style=\"display:inline-block;margin-left:16px\"><span>  limit least(match_count, 200);</span></div></div><div><span class=\"ch-code-line-number\">_<!-- -->15</span><div style=\"display:inline-block;margin-left:16px\"><span>$$;</span></div></div><br></code></div></div>\n<p>Here we create a function <code>match_documents</code> that accepts three parameters:</p>\n<ol>\n<li><code>query_embedding</code>: a one-time embedding generated for the user's search query. Here we set the size to 512, but adjust this to match the number of dimensions produced by your embedding model.</li>\n<li><code>match_threshold</code>: the minimum similarity between embeddings. This is a value between 1 and -1, where 1 is most similar and -1 is most dissimilar.</li>\n<li><code>match_count</code>: the maximum number of results to return. Note the query may return less than this number if <code>match_threshold</code> resulted in a small shortlist. Limited to 200 records to avoid unintentionally overloading your database.</li>\n</ol>\n<p>In this example, we return a <code>setof documents</code> and refer to <code>documents</code> throughout the query. Adjust this to use the relevant tables in your application.</p>\n<p>You'll notice we are using the cosine distance (<code>&lt;=&gt;</code>) operator in our query. Cosine distance is a safe default when you don't know whether or not your embeddings are normalized. If you know for a fact that they are normalized (for example, your embedding is returned from OpenAI), you can use negative inner product (<code>&lt;#&gt;</code>) for better performance:</p>\n<div class=\"ch-codeblock not-prose \" data-ch-theme=\"supabase\"><div class=\"ch-code-wrapper ch-code\" data-ch-measured=\"false\"><code class=\"ch-code-scroll-parent\"><br><div><span class=\"ch-code-line-number\">_<!-- -->15</span><div style=\"display:inline-block;margin-left:16px\"><span>-- Match documents using negative inner product (&lt;#&gt;)</span></div></div><div><span class=\"ch-code-line-number\">_<!-- -->15</span><div style=\"display:inline-block;margin-left:16px\"><span>create or replace function match_documents (</span></div></div><div><span class=\"ch-code-line-number\">_<!-- -->15</span><div style=\"display:inline-block;margin-left:16px\"><span>  query_embedding vector(512),</span></div></div><div><span class=\"ch-code-line-number\">_<!-- -->15</span><div style=\"display:inline-block;margin-left:16px\"><span>  match_threshold float,</span></div></div><div><span class=\"ch-code-line-number\">_<!-- -->15</span><div style=\"display:inline-block;margin-left:16px\"><span>  match_count int</span></div></div><div><span class=\"ch-code-line-number\">_<!-- -->15</span><div style=\"display:inline-block;margin-left:16px\"><span>)</span></div></div><div><span class=\"ch-code-line-number\">_<!-- -->15</span><div style=\"display:inline-block;margin-left:16px\"><span>returns setof documents</span></div></div><div><span class=\"ch-code-line-number\">_<!-- -->15</span><div style=\"display:inline-block;margin-left:16px\"><span>language sql</span></div></div><div><span class=\"ch-code-line-number\">_<!-- -->15</span><div style=\"display:inline-block;margin-left:16px\"><span>as $$</span></div></div><div><span class=\"ch-code-line-number\">_<!-- -->15</span><div style=\"display:inline-block;margin-left:16px\"><span>  select *</span></div></div><div><span class=\"ch-code-line-number\">_<!-- -->15</span><div style=\"display:inline-block;margin-left:16px\"><span>  from documents</span></div></div><div><span class=\"ch-code-line-number\">_<!-- -->15</span><div style=\"display:inline-block;margin-left:16px\"><span>  where documents.embedding &lt;#&gt; query_embedding &lt; -match_threshold</span></div></div><div><span class=\"ch-code-line-number\">_<!-- -->15</span><div style=\"display:inline-block;margin-left:16px\"><span>  order by documents.embedding &lt;#&gt; query_embedding asc</span></div></div><div><span class=\"ch-code-line-number\">_<!-- -->15</span><div style=\"display:inline-block;margin-left:16px\"><span>  limit least(match_count, 200);</span></div></div><div><span class=\"ch-code-line-number\">_<!-- -->15</span><div style=\"display:inline-block;margin-left:16px\"><span>$$;</span></div></div><br></code></div></div>\n<p>Note that since <code>&lt;#&gt;</code> is negative, we negate <code>match_threshold</code> accordingly in the <code>where</code> clause. For more information on the different operators, see the <a href=\"https://github.com/pgvector/pgvector?tab=readme-ov-file#vector-operators\">pgvector docs</a>.</p>\n<h3 id=\"calling-from-your-application\" class=\"group scroll-mt-24\">Calling from your application<a href=\"#calling-from-your-application\" aria-hidden=\"true\" class=\"ml-2 opacity-0 group-hover:opacity-100 transition\"><span aria-hidden=\"true\">#</span></a></h3>\n<p>Finally you can execute this function from your application. If you are using a Supabase client library such as <a href=\"https://github.com/supabase/supabase-js\"><code>supabase-js</code></a>, you can invoke it using the <code>rpc()</code> method:</p>\n<div class=\"ch-codeblock not-prose \" data-ch-theme=\"supabase\"><div class=\"ch-code-wrapper ch-code\" data-ch-measured=\"false\"><code class=\"ch-code-scroll-parent\"><br><div><span class=\"ch-code-line-number\">_<!-- -->10</span><div style=\"display:inline-block;margin-left:16px\"><span>const { data: documents } = await supabase.rpc('match_documents', {</span></div></div><div><span class=\"ch-code-line-number\">_<!-- -->10</span><div style=\"display:inline-block;margin-left:16px\"><span>  query_embedding: embedding, // pass the query embedding</span></div></div><div><span class=\"ch-code-line-number\">_<!-- -->10</span><div style=\"display:inline-block;margin-left:16px\"><span>  match_threshold: 0.78, // choose an appropriate threshold for your data</span></div></div><div><span class=\"ch-code-line-number\">_<!-- -->10</span><div style=\"display:inline-block;margin-left:16px\"><span>  match_count: 10, // choose the number of matches</span></div></div><div><span class=\"ch-code-line-number\">_<!-- -->10</span><div style=\"display:inline-block;margin-left:16px\"><span>})</span></div></div><br></code></div></div>\n<p>You can also call this method directly from SQL:</p>\n<div class=\"ch-codeblock not-prose \" data-ch-theme=\"supabase\"><div class=\"ch-code-wrapper ch-code\" data-ch-measured=\"false\"><code class=\"ch-code-scroll-parent\"><br><div><span class=\"ch-code-line-number\">_<!-- -->10</span><div style=\"display:inline-block;margin-left:16px\"><span>select *</span></div></div><div><span class=\"ch-code-line-number\">_<!-- -->10</span><div style=\"display:inline-block;margin-left:16px\"><span>from match_documents(</span></div></div><div><span class=\"ch-code-line-number\">_<!-- -->10</span><div style=\"display:inline-block;margin-left:16px\"><span>  '[...]'::vector(512), -- pass the query embedding</span></div></div><div><span class=\"ch-code-line-number\">_<!-- -->10</span><div style=\"display:inline-block;margin-left:16px\"><span>  0.78, -- chose an appropriate threshold for your data</span></div></div><div><span class=\"ch-code-line-number\">_<!-- -->10</span><div style=\"display:inline-block;margin-left:16px\"><span>  10 -- choose the number of matches</span></div></div><div><span class=\"ch-code-line-number\">_<!-- -->10</span><div style=\"display:inline-block;margin-left:16px\"><span>);</span></div></div><br></code></div></div>\n<p>In this scenario, you'll likely use a Postgres client library to establish a direct connection from your application to the database. It's best practice to parameterize your arguments before executing the query.</p>\n<h2 id=\"next-steps\" class=\"group scroll-mt-24\">Next steps<a href=\"#next-steps\" aria-hidden=\"true\" class=\"ml-2 opacity-0 group-hover:opacity-100 transition\"><span aria-hidden=\"true\">#</span></a></h2>\n<p>As your database scales, you will need an index on your vector columns to maintain fast query speeds. See <a href=\"/docs/guides/ai/vector-indexes\">Vector indexes</a> for an in-depth guide on the different types of indexes and how they work.</p>\n<h2 id=\"see-also\" class=\"group scroll-mt-24\">See also<a href=\"#see-also\" aria-hidden=\"true\" class=\"ml-2 opacity-0 group-hover:opacity-100 transition\"><span aria-hidden=\"true\">#</span></a></h2>\n<ul>\n<li><a href=\"/docs/guides/ai/concepts\">Embedding concepts</a></li>\n<li><a href=\"/docs/guides/ai/vector-columns\">Vector columns</a></li>\n<li><a href=\"/docs/guides/ai/vector-indexes\">Vector indexes</a></li>\n<li><a href=\"/docs/guides/ai/hybrid-search\">Hybrid search</a></li>\n<li><a href=\"/docs/guides/ai/keyword-search\">Keyword search</a></li>\n</ul></article></div></div></div><!--$--><div class=\"max-w-7xl px-5 mx-auto py-8 pt-0\"></div><!--/$--></div><div class=\"left-0 right-0 z-10 backdrop-blur-sm backdrop-filter bg-alternative/90 hidden h-0 lg:hidden\"></div></div></main></div></div></div></div></body></html>",
      "metadata": {
        "ogUrl": "https://supabase.com/docs/guides/ai/semantic-search",
        "title": "Semantic search | Supabase Docs",
        "robots": "index, follow",
        "ogImage": "https://obuldanrptloktxcffvn.supabase.co/functions/v1/og-images?site=docs&type=ai&title=Semantic%20search&description=Learn%20how%20to%20search%20by%20meaning%20rather%20than%20exact%20keywords.",
        "ogTitle": "Semantic search | Supabase Docs",
        "language": "en",
        "sourceURL": "https://supabase.com/docs/guides/ai/semantic-search",
        "description": "Learn how to search by meaning rather than exact keywords.",
        "modifiedTime": "2024-09-10T20:36:24.980Z",
        "ogDescription": "Learn how to search by meaning rather than exact keywords.",
        "publishedTime": "2024-09-10T20:36:24.980Z",
        "ogLocaleAlternate": [],
        "statusCode": 200
      }
    },
    {
      "markdown": "AI & Vectors\n\n# Indexes\n\n* * *\n\n# Indexes\n\nIndexes are tools for optimizing query performance of a [collection](collections).\n\nCollections can be [queried](https://supabase.github.io/vecs/../api.md#query) without an index, but that will emit a python warning and should never be done in production.\n\n`\n_10\nquery does not have a covering index for cosine_similarity. See Collection.create_index\n`\n\nAs each query vector must be checked against every record in the collection. When the number of dimensions and/or number of records becomes large, that becomes extremely slow and computationally expensive.\n\nAn index is a heuristic data structure that pre-computes distances between key points in the vector space. It is smaller and can be traversed more quickly than the whole collection enabling much more performant searching.\n\nOnly one index may exist per-collection. An index optimizes a collection for searching according to a selected distance measure.\n\nTo create an index:\n\n`\n_10\ndocs.create_index()\n`\n\nYou may optionally provide a distance measure and index method.\n\nAvailable options for distance `measure` are:\n\n- `vecs.IndexMeasure.cosine_distance`\n- `vecs.IndexMeasure.l2_distance`\n- `vecs.IndexMeasure.max_inner_product`\n\nwhich correspond to different methods for comparing query vectors to the vectors in the database.\n\nIf you aren't sure which to use, the default of cosine\\_distance is the most widely compatible with off-the-shelf embedding methods.\n\nAvailable options for index `method` are:\n\n- `vecs.IndexMethod.auto`\n- `vecs.IndexMethod.hnsw`\n- `vecs.IndexMethod.ivfflat`\n\nWhere `auto` selects the best available index method, `hnsw` uses the [HNSW](https://github.com/pgvector/pgvector#hnsw) method and `ivfflat` uses [IVFFlat](https://github.com/pgvector/pgvector#ivfflat).\n\nHNSW and IVFFlat indexes both allow for parameterization to control the speed/accuracy tradeoff. vecs provides sane defaults for these parameters. For a greater level of control you can optionally pass an instance of `vecs.IndexArgsIVFFlat` or `vecs.IndexArgsHNSW` to `create_index`'s `index_arguments` argument. Descriptions of the impact for each parameter are available in the [pgvector docs](https://github.com/pgvector/pgvector).\n\nWhen using IVFFlat indexes, the index must be created **after** the collection has been populated with records. Building an IVFFlat index on an empty collection will result in significantly reduced recall. You can continue upserting new documents after the index has been created, but should rebuild the index if the size of the collection more than doubles since the last index operation.\n\nHNSW indexes can be created immediately after the collection without populating records.\n\nTo manually specify `method`, `measure`, and `index_arguments` add them as arguments to `create_index` for example:\n\n`\n_10\ndocs.create_index(\n_10\n    method=IndexMethod.hnsw,\n_10\n    measure=IndexMeasure.cosine_distance,\n_10\n    index_arguments=IndexArgsHNSW(m=8),\n_10\n)\n`\n\nThe time required to create an index grows with the number of records and size of vectors.\nFor a few thousand records expect sub-minute a response in under a minute. It may take a few\nminutes for larger collections.",
      "html": "<!DOCTYPE html><html lang=\"en\" data-theme=\"light\" style=\"color-scheme: light;\"><body><div class=\"flex flex-col\"><div class=\"grow\"><div class=\"flex flex-col h-full w-full\"><div class=\"hidden lg:sticky w-full lg:flex top-0 left-0 right-0 z-50\"><!--$--><!--/$--></div><div class=\"flex flex-row h-full relative\"><main id=\"docs-content-container\" class=\"w-full transition-all ease-out relative lg:ml-0\"><div class=\"flex flex-col sticky top-0\"><div class=\"flex lg:hidden w-full top-0 left-0 right-0 z-50\"><!--$--><!--/$--></div><div class=\"sticky transition-all top-0 z-10 backdrop-blur backdrop-filter bg-background\"><div class=\"lg:hidden px-3.5 border-b z-10 transition-all ease-out top-0 flex items-center gap-1\"><button class=\"h-8 w-8 flex group items-center justify-center mr-1\"><div class=\"space-y-1 cursor-pointer relative w-4 h-[8px]\"><span class=\"transition-all ease-out block h-px bg-foreground-muted group-hover:bg-foreground w-4\"></span><span class=\"transition-all ease-out block h-px bg-foreground-muted group-hover:bg-foreground w-3 group-hover:w-4\"></span></div></button><span class=\"transition-all duration-200 text-foreground text-sm\">AI &amp; Vectors</span></div></div><div class=\"grow\"><div class=\"max-w-7xl px-5 mx-auto py-8 pb-0\"><div class=\"grid grid-cols-12 relative gap-4\"><div class=\"relative transition-all ease-out duration-100 col-span-12 md:col-span-9\"><article id=\"sb-docs-guide-main-article\" class=\"prose max-w-none\"><h1 class=\"mb-0\">Indexes</h1><hr class=\"not-prose border-t-0 border-b my-8\">\n<h1 id=\"indexes\">Indexes</h1>\n<p>Indexes are tools for optimizing query performance of a <a href=\"collections\">collection</a>.</p>\n<p>Collections can be <a href=\"https://supabase.github.io/vecs/../api.md#query\">queried</a> without an index, but that will emit a python warning and should never be done in production.</p>\n<div class=\"ch-codeblock not-prose \" data-ch-theme=\"supabase\"><div class=\"ch-code-wrapper ch-code\" data-ch-measured=\"false\"><code class=\"ch-code-scroll-parent\"><br><div><span class=\"ch-code-line-number\">_<!-- -->10</span><div style=\"display:inline-block;margin-left:16px\"><span>query does not have a covering index for cosine_similarity. See Collection.create_index</span></div></div><br></code></div></div>\n<p>As each query vector must be checked against every record in the collection. When the number of dimensions and/or number of records becomes large, that becomes extremely slow and computationally expensive.</p>\n<p>An index is a heuristic data structure that pre-computes distances between key points in the vector space. It is smaller and can be traversed more quickly than the whole collection enabling much more performant searching.</p>\n<p>Only one index may exist per-collection. An index optimizes a collection for searching according to a selected distance measure.</p>\n<p>To create an index:</p>\n<div class=\"ch-codeblock not-prose \" data-ch-theme=\"supabase\"><div class=\"ch-code-wrapper ch-code\" data-ch-measured=\"false\"><code class=\"ch-code-scroll-parent\"><br><div><span class=\"ch-code-line-number\">_<!-- -->10</span><div style=\"display:inline-block;margin-left:16px\"><span>docs.create_index()</span></div></div><br></code></div></div>\n<p>You may optionally provide a distance measure and index method.</p>\n<p>Available options for distance <code>measure</code> are:</p>\n<ul>\n<li><code>vecs.IndexMeasure.cosine_distance</code></li>\n<li><code>vecs.IndexMeasure.l2_distance</code></li>\n<li><code>vecs.IndexMeasure.max_inner_product</code></li>\n</ul>\n<p>which correspond to different methods for comparing query vectors to the vectors in the database.</p>\n<p>If you aren't sure which to use, the default of cosine_distance is the most widely compatible with off-the-shelf embedding methods.</p>\n<p>Available options for index <code>method</code> are:</p>\n<ul>\n<li><code>vecs.IndexMethod.auto</code></li>\n<li><code>vecs.IndexMethod.hnsw</code></li>\n<li><code>vecs.IndexMethod.ivfflat</code></li>\n</ul>\n<p>Where <code>auto</code> selects the best available index method, <code>hnsw</code> uses the <a href=\"https://github.com/pgvector/pgvector#hnsw\">HNSW</a> method and <code>ivfflat</code> uses <a href=\"https://github.com/pgvector/pgvector#ivfflat\">IVFFlat</a>.</p>\n<p>HNSW and IVFFlat indexes both allow for parameterization to control the speed/accuracy tradeoff. vecs provides sane defaults for these parameters. For a greater level of control you can optionally pass an instance of <code>vecs.IndexArgsIVFFlat</code> or <code>vecs.IndexArgsHNSW</code> to <code>create_index</code>'s <code>index_arguments</code> argument. Descriptions of the impact for each parameter are available in the <a href=\"https://github.com/pgvector/pgvector\">pgvector docs</a>.</p>\n<p>When using IVFFlat indexes, the index must be created <strong>after</strong> the collection has been populated with records. Building an IVFFlat index on an empty collection will result in significantly reduced recall. You can continue upserting new documents after the index has been created, but should rebuild the index if the size of the collection more than doubles since the last index operation.</p>\n<p>HNSW indexes can be created immediately after the collection without populating records.</p>\n<p>To manually specify <code>method</code>, <code>measure</code>, and <code>index_arguments</code> add them as arguments to <code>create_index</code> for example:</p>\n<div class=\"ch-codeblock not-prose \" data-ch-theme=\"supabase\"><div class=\"ch-code-wrapper ch-code\" data-ch-measured=\"false\"><code class=\"ch-code-scroll-parent\"><br><div><span class=\"ch-code-line-number\">_<!-- -->10</span><div style=\"display:inline-block;margin-left:16px\"><span>docs.create_index(</span></div></div><div><span class=\"ch-code-line-number\">_<!-- -->10</span><div style=\"display:inline-block;margin-left:16px\"><span>    method=IndexMethod.hnsw,</span></div></div><div><span class=\"ch-code-line-number\">_<!-- -->10</span><div style=\"display:inline-block;margin-left:16px\"><span>    measure=IndexMeasure.cosine_distance,</span></div></div><div><span class=\"ch-code-line-number\">_<!-- -->10</span><div style=\"display:inline-block;margin-left:16px\"><span>    index_arguments=IndexArgsHNSW(m=8),</span></div></div><div><span class=\"ch-code-line-number\">_<!-- -->10</span><div style=\"display:inline-block;margin-left:16px\"><span>)</span></div></div><br></code></div></div>\n<div role=\"alert\" class=\"relative w-full text-sm rounded-lg p-4 [&amp;>svg~*]:pl-10 [&amp;>svg+div]:translate-y-[-3px] [&amp;>svg]:absolute [&amp;>svg]:left-4 [&amp;>svg]:top-4 [&amp;>svg]:w-[23px] [&amp;>svg]:h-[23px] [&amp;>svg]:p-1 [&amp;>svg]:flex [&amp;>svg]:rounded text-foreground [&amp;>svg]:text-background [&amp;>svg]:bg-foreground mb-2 [&amp;_svg]:bg-foreground-muted [&amp;_svg]:text-background-muted bg-surface-200/25 border border-default\"><svg xmlns=\"http://www.w3.org/2000/svg\" viewBox=\"0 0 21 20\" class=\"w-6 h-6\" fill=\"currentColor\"><path fill-rule=\"evenodd\" clip-rule=\"evenodd\" d=\"M0.625 9.8252C0.625 4.44043 4.99023 0.0751953 10.375 0.0751953C15.7598 0.0751953 20.125 4.44043 20.125 9.8252C20.125 15.21 15.7598 19.5752 10.375 19.5752C4.99023 19.5752 0.625 15.21 0.625 9.8252ZM9.3584 4.38135C9.45117 4.28857 9.55518 4.20996 9.66699 4.14648C9.88086 4.02539 10.1245 3.96045 10.375 3.96045C10.5845 3.96045 10.7896 4.00586 10.9766 4.09229C11.1294 4.1626 11.2705 4.26025 11.3916 4.38135C11.6611 4.65088 11.8125 5.0166 11.8125 5.39795C11.8125 5.5249 11.7959 5.6499 11.7637 5.77002C11.6987 6.01172 11.5718 6.23438 11.3916 6.41455C11.1221 6.68408 10.7563 6.83545 10.375 6.83545C9.99365 6.83545 9.62793 6.68408 9.3584 6.41455C9.08887 6.14502 8.9375 5.7793 8.9375 5.39795C8.9375 5.29492 8.94873 5.19287 8.97021 5.09375C9.02783 4.82568 9.16162 4.57812 9.3584 4.38135ZM10.375 15.6899C10.0933 15.6899 9.82275 15.5781 9.62354 15.3789C9.42432 15.1797 9.3125 14.9092 9.3125 14.6274V9.31494C9.3125 9.0332 9.42432 8.7627 9.62354 8.56348C9.82275 8.36426 10.0933 8.25244 10.375 8.25244C10.6567 8.25244 10.9272 8.36426 11.1265 8.56348C11.3257 8.7627 11.4375 9.0332 11.4375 9.31494V14.6274C11.4375 14.7944 11.3979 14.9575 11.3242 15.104C11.2739 15.2046 11.2075 15.2979 11.1265 15.3789C10.9272 15.5781 10.6567 15.6899 10.375 15.6899Z\"></path></svg><div class=\"text mt [&amp;_p]:mb-1.5 [&amp;_p]:mt-0 mt-0.5 [&amp;_p:last-child]:mb-0\">The time required to create an index grows with the number of records and size of vectors.\nFor a few thousand records expect sub-minute a response in under a minute. It may take a few\nminutes for larger collections.</div></div></article></div></div></div><!--$--><div class=\"max-w-7xl px-5 mx-auto py-8 pt-0\"></div><!--/$--></div><div class=\"left-0 right-0 z-10 backdrop-blur-sm backdrop-filter bg-alternative/90 hidden h-0 lg:hidden\"></div></div></main></div></div></div></div></body></html>",
      "metadata": {
        "ogUrl": "https://supabase.com/docs/guides/ai/python/indexes",
        "title": "Indexes | Supabase Docs",
        "robots": "index, follow",
        "ogImage": "https://obuldanrptloktxcffvn.supabase.co/functions/v1/og-images?site=docs&type=ai&title=Indexes&description=undefined",
        "ogTitle": "Indexes | Supabase Docs",
        "language": "en",
        "sourceURL": "https://supabase.com/docs/guides/ai/python/indexes",
        "modifiedTime": "2024-09-10T20:36:24.564Z",
        "publishedTime": "2024-09-10T20:36:24.564Z",
        "ogLocaleAlternate": [],
        "statusCode": 200
      }
    },
    {
      "markdown": "AI & Vectors\n\n# Choosing a Client\n\n* * *\n\nAs described in [Structured & Unstructured Embeddings](/docs/guides/ai/structured-unstructured), AI workloads come in many forms.\n\nFor data science or ephemeral workloads, the [Supabase Vecs](https://supabase.github.io/vecs/) client gets you started quickly. All you need is a connection string and vecs handles setting up your database to store and query vectors with associated metadata.\n\nYou can get your connection string from the [**Database Settings**](https://supabase.com/dashboard/project/_/settings/database) page in your dashboard. Make sure to check **Use connection pooling**, then copy the URI. Also, change the URI scheme from `postgres` to `postgresql`. `vecs` uses SQLAlchemy under the hood, which only supports `postgresql` as a dialect.\n\nFor production python applications with version controlled migrations, we recommend adding first class vector support to your toolchain by [registering the vector type with your ORM](https://github.com/pgvector/pgvector-python). pgvector provides bindings for the most commonly used SQL drivers/libraries including Django, SQLAlchemy, SQLModel, psycopg, asyncpg and Peewee.",
      "html": "<!DOCTYPE html><html lang=\"en\" data-theme=\"light\" style=\"color-scheme: light;\"><body><div class=\"flex flex-col\"><div class=\"grow\"><div class=\"flex flex-col h-full w-full\"><div class=\"hidden lg:sticky w-full lg:flex top-0 left-0 right-0 z-50\"><!--$--><!--/$--></div><div class=\"flex flex-row h-full relative\"><main id=\"docs-content-container\" class=\"w-full transition-all ease-out relative lg:ml-0\"><div class=\"flex flex-col sticky top-0\"><div class=\"flex lg:hidden w-full top-0 left-0 right-0 z-50\"><!--$--><!--/$--></div><div class=\"sticky transition-all top-0 z-10 backdrop-blur backdrop-filter bg-background\"><div class=\"lg:hidden px-3.5 border-b z-10 transition-all ease-out top-0 flex items-center gap-1\"><button class=\"h-8 w-8 flex group items-center justify-center mr-1\"><div class=\"space-y-1 cursor-pointer relative w-4 h-[8px]\"><span class=\"transition-all ease-out block h-px bg-foreground-muted group-hover:bg-foreground w-4\"></span><span class=\"transition-all ease-out block h-px bg-foreground-muted group-hover:bg-foreground w-3 group-hover:w-4\"></span></div></button><span class=\"transition-all duration-200 text-foreground text-sm\">AI &amp; Vectors</span></div></div><div class=\"grow\"><div class=\"max-w-7xl px-5 mx-auto py-8 pb-0\"><div class=\"grid grid-cols-12 relative gap-4\"><div class=\"relative transition-all ease-out duration-100 col-span-12 md:col-span-9\"><article id=\"sb-docs-guide-main-article\" class=\"prose max-w-none\"><h1 class=\"mb-0\">Choosing a Client</h1><hr class=\"not-prose border-t-0 border-b my-8\"><p>As described in <a href=\"/docs/guides/ai/structured-unstructured\">Structured &amp; Unstructured Embeddings</a>, AI workloads come in many forms.</p>\n<p>For data science or ephemeral workloads, the <a href=\"https://supabase.github.io/vecs/\">Supabase Vecs</a> client gets you started quickly. All you need is a connection string and vecs handles setting up your database to store and query vectors with associated metadata.</p>\n<div role=\"alert\" class=\"relative w-full text-sm rounded-lg p-4 [&amp;>svg~*]:pl-10 [&amp;>svg+div]:translate-y-[-3px] [&amp;>svg]:absolute [&amp;>svg]:left-4 [&amp;>svg]:top-4 [&amp;>svg]:w-[23px] [&amp;>svg]:h-[23px] [&amp;>svg]:p-1 [&amp;>svg]:flex [&amp;>svg]:rounded text-foreground [&amp;>svg]:text-background [&amp;>svg]:bg-foreground mb-2 [&amp;_svg]:bg-foreground-muted [&amp;_svg]:text-background-muted bg-surface-200/25 border border-default\"><svg xmlns=\"http://www.w3.org/2000/svg\" viewBox=\"0 0 21 20\" class=\"w-6 h-6\" fill=\"currentColor\"><path fill-rule=\"evenodd\" clip-rule=\"evenodd\" d=\"M0.625 9.8252C0.625 4.44043 4.99023 0.0751953 10.375 0.0751953C15.7598 0.0751953 20.125 4.44043 20.125 9.8252C20.125 15.21 15.7598 19.5752 10.375 19.5752C4.99023 19.5752 0.625 15.21 0.625 9.8252ZM9.3584 4.38135C9.45117 4.28857 9.55518 4.20996 9.66699 4.14648C9.88086 4.02539 10.1245 3.96045 10.375 3.96045C10.5845 3.96045 10.7896 4.00586 10.9766 4.09229C11.1294 4.1626 11.2705 4.26025 11.3916 4.38135C11.6611 4.65088 11.8125 5.0166 11.8125 5.39795C11.8125 5.5249 11.7959 5.6499 11.7637 5.77002C11.6987 6.01172 11.5718 6.23438 11.3916 6.41455C11.1221 6.68408 10.7563 6.83545 10.375 6.83545C9.99365 6.83545 9.62793 6.68408 9.3584 6.41455C9.08887 6.14502 8.9375 5.7793 8.9375 5.39795C8.9375 5.29492 8.94873 5.19287 8.97021 5.09375C9.02783 4.82568 9.16162 4.57812 9.3584 4.38135ZM10.375 15.6899C10.0933 15.6899 9.82275 15.5781 9.62354 15.3789C9.42432 15.1797 9.3125 14.9092 9.3125 14.6274V9.31494C9.3125 9.0332 9.42432 8.7627 9.62354 8.56348C9.82275 8.36426 10.0933 8.25244 10.375 8.25244C10.6567 8.25244 10.9272 8.36426 11.1265 8.56348C11.3257 8.7627 11.4375 9.0332 11.4375 9.31494V14.6274C11.4375 14.7944 11.3979 14.9575 11.3242 15.104C11.2739 15.2046 11.2075 15.2979 11.1265 15.3789C10.9272 15.5781 10.6567 15.6899 10.375 15.6899Z\"></path></svg><div class=\"text mt [&amp;_p]:mb-1.5 [&amp;_p]:mt-0 mt-0.5 [&amp;_p:last-child]:mb-0\"><p>You can get your connection string from the <a href=\"https://supabase.com/dashboard/project/_/settings/database\"><strong>Database Settings</strong></a> page in your dashboard. Make sure to check <strong>Use connection pooling</strong>, then copy the URI. Also, change the URI scheme from <code>postgres</code> to <code>postgresql</code>. <code>vecs</code> uses SQLAlchemy under the hood, which only supports <code>postgresql</code> as a dialect.</p></div></div>\n<p>For production python applications with version controlled migrations, we recommend adding first class vector support to your toolchain by <a href=\"https://github.com/pgvector/pgvector-python\">registering the vector type with your ORM</a>. pgvector provides bindings for the most commonly used SQL drivers/libraries including Django, SQLAlchemy, SQLModel, psycopg, asyncpg and Peewee.</p></article></div></div></div><!--$--><div class=\"max-w-7xl px-5 mx-auto py-8 pt-0\"></div><!--/$--></div><div class=\"left-0 right-0 z-10 backdrop-blur-sm backdrop-filter bg-alternative/90 hidden h-0 lg:hidden\"></div></div></main></div></div></div></div></body></html>",
      "metadata": {
        "ogUrl": "https://supabase.com/docs/guides/ai/python-clients",
        "title": "Choosing a Client | Supabase Docs",
        "robots": "index, follow",
        "ogImage": "https://obuldanrptloktxcffvn.supabase.co/functions/v1/og-images?site=docs&type=ai&title=Choosing%20a%20Client&description=Learn%20how%20to%20manage%20vectors%20using%20Python",
        "ogTitle": "Choosing a Client | Supabase Docs",
        "language": "en",
        "sourceURL": "https://supabase.com/docs/guides/ai/python-clients",
        "description": "Learn how to manage vectors using Python",
        "modifiedTime": "2024-09-10T20:36:24.980Z",
        "ogDescription": "Learn how to manage vectors using Python",
        "publishedTime": "2024-09-10T20:36:24.980Z",
        "ogLocaleAlternate": [],
        "statusCode": 200
      }
    },
    {
      "markdown": "AI & Vectors\n\n# Metadata\n\n* * *\n\n# Metadata\n\nvecs allows you to associate key-value pairs of metadata with indexes and ids in your collections.\nYou can then add filters to queries that reference the metadata metadata.\n\n## Types [\\#](\\#types)\n\nMetadata is stored as binary JSON. As a result, allowed metadata types are drawn from JSON primitive types.\n\n- Boolean\n- String\n- Number\n\nThe technical limit of a metadata field associated with a vector is 1GB.\nIn practice you should keep metadata fields as small as possible to maximize performance.\n\n## Metadata Query Language [\\#](\\#metadata-query-language)\n\nThe metadata query language is based loosely on [mongodb's selectors](https://www.mongodb.com/docs/manual/reference/operator/query/).\n\n`vecs` currently supports a subset of those operators.\n\n### Comparison Operators [\\#](\\#comparison-operators)\n\nComparison operators compare a provided value with a value stored in metadata field of the vector store.\n\n| Operator | Description |\n| --- | --- |\n| $eq | Matches values that are equal to a specified value |\n| $ne | Matches values that are not equal to a specified value |\n| $gt | Matches values that are greater than a specified value |\n| $gte | Matches values that are greater than or equal to a specified value |\n| $lt | Matches values that are less than a specified value |\n| $lte | Matches values that are less than or equal to a specified value |\n| $in | Matches values that are contained by scalar list of specified values |\n| $contains | Matches values where a scalar is contained within an array metadata field |\n\n### Logical Operators [\\#](\\#logical-operators)\n\nLogical operators compose other operators, and can be nested.\n\n| Operator | Description |\n| --- | --- |\n| $and | Joins query clauses with a logical AND returns all documents that match the conditions of both clauses. |\n| $or | Joins query clauses with a logical OR returns all documents that match the conditions of either clause. |\n\n### Performance [\\#](\\#performance)\n\nFor best performance, use scalar key-value pairs for metadata and prefer `$eq`, `$and` and `$or` filters where possible.\nThose variants are most consistently able to make use of indexes.\n\n### Examples [\\#](\\#examples)\n\n* * *\n\n`year` equals 2020\n\n`\n_10\n{\"year\": {\"$eq\": 2020}}\n`\n\n* * *\n\n`year` equals 2020 or `gross` greater than or equal to 5000.0\n\n`\n_10\n{\n_10\n    \"$or\": [\\\n_10\\\n        {\"year\": {\"$eq\": 2020}},\\\n_10\\\n        {\"gross\": {\"$gte\": 5000.0}}\\\n_10\\\n    ]\n_10\n}\n`\n\n* * *\n\n`last_name` is less than \"Brown\" and `is_priority_customer` is true\n\n`\n_10\n{\n_10\n    \"$and\": [\\\n_10\\\n        {\"last_name\": {\"$lt\": \"Brown\"}},\\\n_10\\\n        {\"is_priority_customer\": {\"$gte\": 5000.00}}\\\n_10\\\n    ]\n_10\n}\n`\n\n* * *\n\n`priority` contained by \\[\"enterprise\", \"pro\"\\]\n\n`\n_10\n{\n_10\n    \"priority\": {\"$in\": [\"enterprise\", \"pro\"]}\n_10\n}\n`\n\n`tags`, an array, contains the string \"important\"\n\n`\n_10\n{\n_10\n    \"tags\": {\"$contains\": \"important\"}\n_10\n}\n`",
      "html": "<!DOCTYPE html><html lang=\"en\" data-theme=\"light\" style=\"color-scheme: light;\"><body><div class=\"flex flex-col\"><div class=\"grow\"><div class=\"flex flex-col h-full w-full\"><div class=\"hidden lg:sticky w-full lg:flex top-0 left-0 right-0 z-50\"><!--$--><!--/$--></div><div class=\"flex flex-row h-full relative\"><main id=\"docs-content-container\" class=\"w-full transition-all ease-out relative lg:ml-0\"><div class=\"flex flex-col sticky top-0\"><div class=\"flex lg:hidden w-full top-0 left-0 right-0 z-50\"><!--$--><!--/$--></div><div class=\"sticky transition-all top-0 z-10 backdrop-blur backdrop-filter bg-background\"><div class=\"lg:hidden px-3.5 border-b z-10 transition-all ease-out top-0 flex items-center gap-1\"><button class=\"h-8 w-8 flex group items-center justify-center mr-1\"><div class=\"space-y-1 cursor-pointer relative w-4 h-[8px]\"><span class=\"transition-all ease-out block h-px bg-foreground-muted group-hover:bg-foreground w-4\"></span><span class=\"transition-all ease-out block h-px bg-foreground-muted group-hover:bg-foreground w-3 group-hover:w-4\"></span></div></button><span class=\"transition-all duration-200 text-foreground text-sm\">AI &amp; Vectors</span></div></div><div class=\"grow\"><div class=\"max-w-7xl px-5 mx-auto py-8 pb-0\"><div class=\"grid grid-cols-12 relative gap-4\"><div class=\"relative transition-all ease-out duration-100 col-span-12 md:col-span-9\"><article id=\"sb-docs-guide-main-article\" class=\"prose max-w-none\"><h1 class=\"mb-0\">Metadata</h1><hr class=\"not-prose border-t-0 border-b my-8\">\n<h1 id=\"metadata\">Metadata</h1>\n<p>vecs allows you to associate key-value pairs of metadata with indexes and ids in your collections.\nYou can then add filters to queries that reference the metadata metadata.</p>\n<h2 id=\"types\" class=\"group scroll-mt-24\">Types<a href=\"#types\" aria-hidden=\"true\" class=\"ml-2 opacity-0 group-hover:opacity-100 transition\"><span aria-hidden=\"true\">#</span></a></h2>\n<p>Metadata is stored as binary JSON. As a result, allowed metadata types are drawn from JSON primitive types.</p>\n<ul>\n<li>Boolean</li>\n<li>String</li>\n<li>Number</li>\n</ul>\n<p>The technical limit of a metadata field associated with a vector is 1GB.\nIn practice you should keep metadata fields as small as possible to maximize performance.</p>\n<h2 id=\"metadata-query-language\" class=\"group scroll-mt-24\">Metadata Query Language<a href=\"#metadata-query-language\" aria-hidden=\"true\" class=\"ml-2 opacity-0 group-hover:opacity-100 transition\"><span aria-hidden=\"true\">#</span></a></h2>\n<p>The metadata query language is based loosely on <a href=\"https://www.mongodb.com/docs/manual/reference/operator/query/\">mongodb's selectors</a>.</p>\n<p><code>vecs</code> currently supports a subset of those operators.</p>\n<h3 id=\"comparison-operators\" class=\"group scroll-mt-24\">Comparison Operators<a href=\"#comparison-operators\" aria-hidden=\"true\" class=\"ml-2 opacity-0 group-hover:opacity-100 transition\"><span aria-hidden=\"true\">#</span></a></h3>\n<p>Comparison operators compare a provided value with a value stored in metadata field of the vector store.</p>\n<table><thead><tr><th>Operator</th><th>Description</th></tr></thead><tbody><tr><td>$eq</td><td>Matches values that are equal to a specified value</td></tr><tr><td>$ne</td><td>Matches values that are not equal to a specified value</td></tr><tr><td>$gt</td><td>Matches values that are greater than a specified value</td></tr><tr><td>$gte</td><td>Matches values that are greater than or equal to a specified value</td></tr><tr><td>$lt</td><td>Matches values that are less than a specified value</td></tr><tr><td>$lte</td><td>Matches values that are less than or equal to a specified value</td></tr><tr><td>$in</td><td>Matches values that are contained by scalar list of specified values</td></tr><tr><td>$contains</td><td>Matches values where a scalar is contained within an array metadata field</td></tr></tbody></table>\n<h3 id=\"logical-operators\" class=\"group scroll-mt-24\">Logical Operators<a href=\"#logical-operators\" aria-hidden=\"true\" class=\"ml-2 opacity-0 group-hover:opacity-100 transition\"><span aria-hidden=\"true\">#</span></a></h3>\n<p>Logical operators compose other operators, and can be nested.</p>\n<table><thead><tr><th>Operator</th><th>Description</th></tr></thead><tbody><tr><td>$and</td><td>Joins query clauses with a logical AND returns all documents that match the conditions of both clauses.</td></tr><tr><td>$or</td><td>Joins query clauses with a logical OR returns all documents that match the conditions of either clause.</td></tr></tbody></table>\n<h3 id=\"performance\" class=\"group scroll-mt-24\">Performance<a href=\"#performance\" aria-hidden=\"true\" class=\"ml-2 opacity-0 group-hover:opacity-100 transition\"><span aria-hidden=\"true\">#</span></a></h3>\n<p>For best performance, use scalar key-value pairs for metadata and prefer <code>$eq</code>, <code>$and</code> and <code>$or</code> filters where possible.\nThose variants are most consistently able to make use of indexes.</p>\n<h3 id=\"examples\" class=\"group scroll-mt-24\">Examples<a href=\"#examples\" aria-hidden=\"true\" class=\"ml-2 opacity-0 group-hover:opacity-100 transition\"><span aria-hidden=\"true\">#</span></a></h3>\n<hr>\n<p><code>year</code> equals 2020</p>\n<div class=\"ch-codeblock not-prose \" data-ch-theme=\"supabase\"><div class=\"ch-code-wrapper ch-code\" data-ch-measured=\"false\"><code class=\"ch-code-scroll-parent\"><br><div><span class=\"ch-code-line-number\">_<!-- -->10</span><div style=\"display:inline-block;margin-left:16px\"><span>{\"year\": {\"$eq\": 2020}}</span></div></div><br></code></div></div>\n<hr>\n<p><code>year</code> equals 2020 or <code>gross</code> greater than or equal to 5000.0</p>\n<div class=\"ch-codeblock not-prose \" data-ch-theme=\"supabase\"><div class=\"ch-code-wrapper ch-code\" data-ch-measured=\"false\"><code class=\"ch-code-scroll-parent\"><br><div><span class=\"ch-code-line-number\">_<!-- -->10</span><div style=\"display:inline-block;margin-left:16px\"><span>{</span></div></div><div><span class=\"ch-code-line-number\">_<!-- -->10</span><div style=\"display:inline-block;margin-left:16px\"><span>    \"$or\": [</span></div></div><div><span class=\"ch-code-line-number\">_<!-- -->10</span><div style=\"display:inline-block;margin-left:16px\"><span>        {\"year\": {\"$eq\": 2020}},</span></div></div><div><span class=\"ch-code-line-number\">_<!-- -->10</span><div style=\"display:inline-block;margin-left:16px\"><span>        {\"gross\": {\"$gte\": 5000.0}}</span></div></div><div><span class=\"ch-code-line-number\">_<!-- -->10</span><div style=\"display:inline-block;margin-left:16px\"><span>    ]</span></div></div><div><span class=\"ch-code-line-number\">_<!-- -->10</span><div style=\"display:inline-block;margin-left:16px\"><span>}</span></div></div><br></code></div></div>\n<hr>\n<p><code>last_name</code> is less than \"Brown\" and <code>is_priority_customer</code> is true</p>\n<div class=\"ch-codeblock not-prose \" data-ch-theme=\"supabase\"><div class=\"ch-code-wrapper ch-code\" data-ch-measured=\"false\"><code class=\"ch-code-scroll-parent\"><br><div><span class=\"ch-code-line-number\">_<!-- -->10</span><div style=\"display:inline-block;margin-left:16px\"><span>{</span></div></div><div><span class=\"ch-code-line-number\">_<!-- -->10</span><div style=\"display:inline-block;margin-left:16px\"><span>    \"$and\": [</span></div></div><div><span class=\"ch-code-line-number\">_<!-- -->10</span><div style=\"display:inline-block;margin-left:16px\"><span>        {\"last_name\": {\"$lt\": \"Brown\"}},</span></div></div><div><span class=\"ch-code-line-number\">_<!-- -->10</span><div style=\"display:inline-block;margin-left:16px\"><span>        {\"is_priority_customer\": {\"$gte\": 5000.00}}</span></div></div><div><span class=\"ch-code-line-number\">_<!-- -->10</span><div style=\"display:inline-block;margin-left:16px\"><span>    ]</span></div></div><div><span class=\"ch-code-line-number\">_<!-- -->10</span><div style=\"display:inline-block;margin-left:16px\"><span>}</span></div></div><br></code></div></div>\n<hr>\n<p><code>priority</code> contained by [\"enterprise\", \"pro\"]</p>\n<div class=\"ch-codeblock not-prose \" data-ch-theme=\"supabase\"><div class=\"ch-code-wrapper ch-code\" data-ch-measured=\"false\"><code class=\"ch-code-scroll-parent\"><br><div><span class=\"ch-code-line-number\">_<!-- -->10</span><div style=\"display:inline-block;margin-left:16px\"><span>{</span></div></div><div><span class=\"ch-code-line-number\">_<!-- -->10</span><div style=\"display:inline-block;margin-left:16px\"><span>    \"priority\": {\"$in\": [\"enterprise\", \"pro\"]}</span></div></div><div><span class=\"ch-code-line-number\">_<!-- -->10</span><div style=\"display:inline-block;margin-left:16px\"><span>}</span></div></div><br></code></div></div>\n<p><code>tags</code>, an array, contains the string \"important\"</p>\n<div class=\"ch-codeblock not-prose \" data-ch-theme=\"supabase\"><div class=\"ch-code-wrapper ch-code\" data-ch-measured=\"false\"><code class=\"ch-code-scroll-parent\"><br><div><span class=\"ch-code-line-number\">_<!-- -->10</span><div style=\"display:inline-block;margin-left:16px\"><span>{</span></div></div><div><span class=\"ch-code-line-number\">_<!-- -->10</span><div style=\"display:inline-block;margin-left:16px\"><span>    \"tags\": {\"$contains\": \"important\"}</span></div></div><div><span class=\"ch-code-line-number\">_<!-- -->10</span><div style=\"display:inline-block;margin-left:16px\"><span>}</span></div></div><br></code></div></div></article></div></div></div><!--$--><div class=\"max-w-7xl px-5 mx-auto py-8 pt-0\"></div><!--/$--></div><div class=\"left-0 right-0 z-10 backdrop-blur-sm backdrop-filter bg-alternative/90 hidden h-0 lg:hidden\"></div></div></main></div></div></div></div></body></html>",
      "metadata": {
        "ogUrl": "https://supabase.com/docs/guides/ai/python/metadata",
        "title": "Metadata | Supabase Docs",
        "robots": "index, follow",
        "ogImage": "https://obuldanrptloktxcffvn.supabase.co/functions/v1/og-images?site=docs&type=ai&title=Metadata&description=undefined",
        "ogTitle": "Metadata | Supabase Docs",
        "language": "en",
        "sourceURL": "https://supabase.com/docs/guides/ai/python/metadata",
        "modifiedTime": "2024-09-10T20:36:24.980Z",
        "publishedTime": "2024-09-10T20:36:24.980Z",
        "ogLocaleAlternate": [],
        "statusCode": 200
      }
    },
    {
      "markdown": "AI & Vectors\n\n# Video Search with Mixpeek Multimodal Embeddings\n\n## Implement video search with the Mixpeek Multimodal Embed API and Supabase Vector.\n\n* * *\n\nThe [Mixpeek Embed API](https://docs.mixpeek.com/api-documentation/inference/embed) allows you to generate embeddings for various types of content, including videos and text. You can use these embeddings for:\n\n- Text-to-Video / Video-To-Text / Video-to-Video / Text-to-Text Search\n- Fine-tuning on your own video and text data\n\nThis guide demonstrates how to implement video search using Mixpeek Embed for video processing and embedding, and Supabase Vector for storing and querying embeddings.\n\nYou can find the full application code as a Python Poetry project on [GitHub](https://github.com/yourusername/your-repo-name).\n\n## Create a new Python project with Poetry [\\#](\\#create-a-new-python-project-with-poetry)\n\n[Poetry](https://python-poetry.org/) provides packaging and dependency management for Python. If you haven't already, install poetry via pip:\n\n`\n_10\npip install poetry\n`\n\nThen initialize a new project:\n\n`\n_10\npoetry new video-search\n`\n\n## Setup Supabase project [\\#](\\#setup-supabase-project)\n\nIf you haven't already, [install the Supabase CLI](https://supabase.com/docs/guides/cli), then initialize Supabase in the root of your newly created poetry project:\n\n`\n_10\nsupabase init\n`\n\nNext, start your local Supabase stack:\n\n`\n_10\nsupabase start\n`\n\nThis will start up the Supabase stack locally and print out a bunch of environment details, including your local `DB URL`. Make a note of that for later use.\n\n## Install the dependencies [\\#](\\#install-the-dependencies)\n\nAdd the following dependencies to your project:\n\n- [`supabase`](https://github.com/supabase-community/supabase-py): Supabase Python Client\n- [`mixpeek`](https://github.com/mixpeek/python-client): Mixpeek Python Client for embedding generation\n\n`\n_10\npoetry add supabase mixpeek\n`\n\n## Import the necessary dependencies [\\#](\\#import-the-necessary-dependencies)\n\nAt the top of your main Python script, import the dependencies and store your environment variables:\n\n`\n_10\nfrom supabase import create_client, Client\n_10\nfrom mixpeek import Mixpeek\n_10\nimport os\n_10\n_10\nSUPABASE_URL = os.getenv(\"SUPABASE_URL\")\n_10\nSUPABASE_KEY = os.getenv(\"SUPABASE_API_KEY\")\n_10\nMIXPEEK_API_KEY = os.getenv(\"MIXPEEK_API_KEY\")\n`\n\n## Create embeddings for your videos [\\#](\\#create-embeddings-for-your-videos)\n\nNext, create a `seed` method, which will create a new Supabase table, generate embeddings for your video chunks, and insert the embeddings into your database:\n\n`\n_46\ndef seed():\n_46\n    # Initialize Supabase and Mixpeek clients\n_46\n    supabase: Client = create_client(SUPABASE_URL, SUPABASE_KEY)\n_46\n    mixpeek = Mixpeek(MIXPEEK_API_KEY)\n_46\n_46\n    # Create a table for storing video chunk embeddings\n_46\n    supabase.table(\"video_chunks\").create({\n_46\n        \"id\": \"text\",\n_46\n        \"start_time\": \"float8\",\n_46\n        \"end_time\": \"float8\",\n_46\n        \"embedding\": \"vector(768)\",\n_46\n        \"metadata\": \"jsonb\"\n_46\n    })\n_46\n_46\n    # Process and embed video\n_46\n    video_url = \"https://example.com/your_video.mp4\"\n_46\n    processed_chunks = mixpeek.tools.video.process(\n_46\n        video_source=video_url,\n_46\n        chunk_interval=1,  # 1 second intervals\n_46\n        resolution=[720, 1280]\n_46\n    )\n_46\n_46\n    for chunk in processed_chunks:\n_46\n        print(f\"Processing video chunk: {chunk['start_time']}\")\n_46\n_46\n        # Generate embedding using Mixpeek\n_46\n        embed_response = mixpeek.embed.video(\n_46\n            model_id=\"vuse-generic-v1\",\n_46\n            input=chunk['base64_chunk'],\n_46\n            input_type=\"base64\"\n_46\n        )\n_46\n_46\n        # Insert into Supabase\n_46\n        supabase.table(\"video_chunks\").insert({\n_46\n            \"id\": f\"chunk_{chunk['start_time']}\",\n_46\n            \"start_time\": chunk[\"start_time\"],\n_46\n            \"end_time\": chunk[\"end_time\"],\n_46\n            \"embedding\": embed_response['embedding'],\n_46\n            \"metadata\": {\"video_url\": video_url}\n_46\n        }).execute()\n_46\n_46\n    print(\"Video processed and embeddings inserted\")\n_46\n_46\n    # Create index for fast search performance\n_46\n    supabase.query(\"CREATE INDEX ON video_chunks USING ivfflat (embedding vector_cosine_ops) WITH (lists = 100)\").execute()\n_46\n    print(\"Created index\")\n`\n\nAdd this method as a script in your `pyproject.toml` file:\n\n`\n_10\n[tool.poetry.scripts]\n_10\nseed = \"video_search.main:seed\"\n_10\nsearch = \"video_search.main:search\"\n`\n\nAfter activating the virtual environment with `poetry shell`, you can now run your seed script via `poetry run seed`. You can inspect the generated embeddings in your local database by visiting the local Supabase dashboard at [localhost:54323](http://localhost:54323/project/default/editor).\n\n## Perform a video search from a text query [\\#](\\#perform-a-video-search-from-a-text-query)\n\nWith Supabase Vector, you can query your embeddings. You can use either a video clip as search input or alternatively, you can generate an embedding from a string input and use that as the query input:\n\n`\n_32\ndef search():\n_32\n    # Initialize Supabase and Mixpeek clients\n_32\n    supabase: Client = create_client(SUPABASE_URL, SUPABASE_KEY)\n_32\n    mixpeek = Mixpeek(MIXPEEK_API_KEY)\n_32\n_32\n    # Generate embedding for text query\n_32\n    query_string = \"a car chase scene\"\n_32\n    text_emb = mixpeek.embed.video(\n_32\n        model_id=\"vuse-generic-v1\",\n_32\n        input=query_string,\n_32\n        input_type=\"text\"\n_32\n    )\n_32\n_32\n    # Query the collection\n_32\n    results = supabase.rpc(\n_32\n        'match_video_chunks',\n_32\n        {\n_32\n            'query_embedding': text_emb['embedding'],\n_32\n            'match_threshold': 0.8,\n_32\n            'match_count': 5\n_32\n        }\n_32\n    ).execute()\n_32\n_32\n    # Display the results\n_32\n    if results.data:\n_32\n        for result in results.data:\n_32\n            print(f\"Matched chunk from {result['start_time']} to {result['end_time']} seconds\")\n_32\n            print(f\"Video URL: {result['metadata']['video_url']}\")\n_32\n            print(f\"Similarity: {result['similarity']}\")\n_32\n            print(\"---\")\n_32\n    else:\n_32\n        print(\"No matching video chunks found\")\n`\n\nThis query will return the top 5 most similar video chunks from your database.\n\nYou can now test it out by running `poetry run search`, and you will be presented with the most relevant video chunks to the query \"a car chase scene\".\n\n## Conclusion [\\#](\\#conclusion)\n\nWith just a couple of Python scripts, you are able to implement video search as well as reverse video search using Mixpeek Embed and Supabase Vector. This approach allows for powerful semantic search capabilities that can be integrated into various applications, enabling you to search through video content using both text and video queries.",
      "html": "<!DOCTYPE html><html lang=\"en\" data-theme=\"light\" style=\"color-scheme: light;\"><body><div class=\"flex flex-col\"><div class=\"grow\"><div class=\"flex flex-col h-full w-full\"><div class=\"hidden lg:sticky w-full lg:flex top-0 left-0 right-0 z-50\"><!--$--><!--/$--></div><div class=\"flex flex-row h-full relative\"><main id=\"docs-content-container\" class=\"w-full transition-all ease-out relative lg:ml-0\"><div class=\"flex flex-col sticky top-0\"><div class=\"flex lg:hidden w-full top-0 left-0 right-0 z-50\"><!--$--><!--/$--></div><div class=\"sticky transition-all top-0 z-10 backdrop-blur backdrop-filter bg-background\"><div class=\"lg:hidden px-3.5 border-b z-10 transition-all ease-out top-0 flex items-center gap-1\"><button class=\"h-8 w-8 flex group items-center justify-center mr-1\"><div class=\"space-y-1 cursor-pointer relative w-4 h-[8px]\"><span class=\"transition-all ease-out block h-px bg-foreground-muted group-hover:bg-foreground w-4\"></span><span class=\"transition-all ease-out block h-px bg-foreground-muted group-hover:bg-foreground w-3 group-hover:w-4\"></span></div></button><span class=\"transition-all duration-200 text-foreground text-sm\">AI &amp; Vectors</span></div></div><div class=\"grow\"><div class=\"max-w-7xl px-5 mx-auto py-8 pb-0\"><div class=\"grid grid-cols-12 relative gap-4\"><div class=\"relative transition-all ease-out duration-100 col-span-12 md:col-span-9\"><article id=\"sb-docs-guide-main-article\" class=\"prose max-w-none\"><h1 class=\"mb-0\">Video Search with Mixpeek Multimodal Embeddings</h1><h2 class=\"mt-3 text-xl text-foreground-light\">Implement video search with the Mixpeek Multimodal Embed API and Supabase Vector.</h2><hr class=\"not-prose border-t-0 border-b my-8\">\n<p>The <a href=\"https://docs.mixpeek.com/api-documentation/inference/embed\">Mixpeek Embed API</a> allows you to generate embeddings for various types of content, including videos and text. You can use these embeddings for:</p>\n<ul>\n<li>Text-to-Video / Video-To-Text / Video-to-Video / Text-to-Text Search</li>\n<li>Fine-tuning on your own video and text data</li>\n</ul>\n<p>This guide demonstrates how to implement video search using Mixpeek Embed for video processing and embedding, and Supabase Vector for storing and querying embeddings.</p>\n<p>You can find the full application code as a Python Poetry project on <a href=\"https://github.com/yourusername/your-repo-name\">GitHub</a>.</p>\n<h2 id=\"create-a-new-python-project-with-poetry\" class=\"group scroll-mt-24\">Create a new Python project with Poetry<a href=\"#create-a-new-python-project-with-poetry\" aria-hidden=\"true\" class=\"ml-2 opacity-0 group-hover:opacity-100 transition\"><span aria-hidden=\"true\">#</span></a></h2>\n<p><a href=\"https://python-poetry.org/\">Poetry</a> provides packaging and dependency management for Python. If you haven't already, install poetry via pip:</p>\n<div class=\"ch-codeblock not-prose \" data-ch-theme=\"supabase\"><div class=\"ch-code-wrapper ch-code\" data-ch-measured=\"false\"><code class=\"ch-code-scroll-parent\"><br><div><span class=\"ch-code-line-number\">_<!-- -->10</span><div style=\"display:inline-block;margin-left:16px\"><span>pip install poetry</span></div></div><br></code></div></div>\n<p>Then initialize a new project:</p>\n<div class=\"ch-codeblock not-prose \" data-ch-theme=\"supabase\"><div class=\"ch-code-wrapper ch-code\" data-ch-measured=\"false\"><code class=\"ch-code-scroll-parent\"><br><div><span class=\"ch-code-line-number\">_<!-- -->10</span><div style=\"display:inline-block;margin-left:16px\"><span>poetry new video-search</span></div></div><br></code></div></div>\n<h2 id=\"setup-supabase-project\" class=\"group scroll-mt-24\">Setup Supabase project<a href=\"#setup-supabase-project\" aria-hidden=\"true\" class=\"ml-2 opacity-0 group-hover:opacity-100 transition\"><span aria-hidden=\"true\">#</span></a></h2>\n<p>If you haven't already, <a href=\"https://supabase.com/docs/guides/cli\">install the Supabase CLI</a>, then initialize Supabase in the root of your newly created poetry project:</p>\n<div class=\"ch-codeblock not-prose \" data-ch-theme=\"supabase\"><div class=\"ch-code-wrapper ch-code\" data-ch-measured=\"false\"><code class=\"ch-code-scroll-parent\"><br><div><span class=\"ch-code-line-number\">_<!-- -->10</span><div style=\"display:inline-block;margin-left:16px\"><span>supabase init</span></div></div><br></code></div></div>\n<p>Next, start your local Supabase stack:</p>\n<div class=\"ch-codeblock not-prose \" data-ch-theme=\"supabase\"><div class=\"ch-code-wrapper ch-code\" data-ch-measured=\"false\"><code class=\"ch-code-scroll-parent\"><br><div><span class=\"ch-code-line-number\">_<!-- -->10</span><div style=\"display:inline-block;margin-left:16px\"><span>supabase start</span></div></div><br></code></div></div>\n<p>This will start up the Supabase stack locally and print out a bunch of environment details, including your local <code>DB URL</code>. Make a note of that for later use.</p>\n<h2 id=\"install-the-dependencies\" class=\"group scroll-mt-24\">Install the dependencies<a href=\"#install-the-dependencies\" aria-hidden=\"true\" class=\"ml-2 opacity-0 group-hover:opacity-100 transition\"><span aria-hidden=\"true\">#</span></a></h2>\n<p>Add the following dependencies to your project:</p>\n<ul>\n<li><a href=\"https://github.com/supabase-community/supabase-py\"><code>supabase</code></a>: Supabase Python Client</li>\n<li><a href=\"https://github.com/mixpeek/python-client\"><code>mixpeek</code></a>: Mixpeek Python Client for embedding generation</li>\n</ul>\n<div class=\"ch-codeblock not-prose \" data-ch-theme=\"supabase\"><div class=\"ch-code-wrapper ch-code\" data-ch-measured=\"false\"><code class=\"ch-code-scroll-parent\"><br><div><span class=\"ch-code-line-number\">_<!-- -->10</span><div style=\"display:inline-block;margin-left:16px\"><span>poetry add supabase mixpeek</span></div></div><br></code></div></div>\n<h2 id=\"import-the-necessary-dependencies\" class=\"group scroll-mt-24\">Import the necessary dependencies<a href=\"#import-the-necessary-dependencies\" aria-hidden=\"true\" class=\"ml-2 opacity-0 group-hover:opacity-100 transition\"><span aria-hidden=\"true\">#</span></a></h2>\n<p>At the top of your main Python script, import the dependencies and store your environment variables:</p>\n<div class=\"ch-codeblock not-prose \" data-ch-theme=\"supabase\"><div class=\"ch-code-wrapper ch-code\" data-ch-measured=\"false\"><code class=\"ch-code-scroll-parent\"><br><div><span class=\"ch-code-line-number\">_<!-- -->10</span><div style=\"display:inline-block;margin-left:16px\"><span>from supabase import create_client, Client</span></div></div><div><span class=\"ch-code-line-number\">_<!-- -->10</span><div style=\"display:inline-block;margin-left:16px\"><span>from mixpeek import Mixpeek</span></div></div><div><span class=\"ch-code-line-number\">_<!-- -->10</span><div style=\"display:inline-block;margin-left:16px\"><span>import os</span></div></div><div><span class=\"ch-code-line-number\">_<!-- -->10</span><div style=\"display:inline-block;margin-left:16px\"><span></span></div></div><div><span class=\"ch-code-line-number\">_<!-- -->10</span><div style=\"display:inline-block;margin-left:16px\"><span>SUPABASE_URL = os.getenv(\"SUPABASE_URL\")</span></div></div><div><span class=\"ch-code-line-number\">_<!-- -->10</span><div style=\"display:inline-block;margin-left:16px\"><span>SUPABASE_KEY = os.getenv(\"SUPABASE_API_KEY\")</span></div></div><div><span class=\"ch-code-line-number\">_<!-- -->10</span><div style=\"display:inline-block;margin-left:16px\"><span>MIXPEEK_API_KEY = os.getenv(\"MIXPEEK_API_KEY\")</span></div></div><br></code></div></div>\n<h2 id=\"create-embeddings-for-your-videos\" class=\"group scroll-mt-24\">Create embeddings for your videos<a href=\"#create-embeddings-for-your-videos\" aria-hidden=\"true\" class=\"ml-2 opacity-0 group-hover:opacity-100 transition\"><span aria-hidden=\"true\">#</span></a></h2>\n<p>Next, create a <code>seed</code> method, which will create a new Supabase table, generate embeddings for your video chunks, and insert the embeddings into your database:</p>\n<div class=\"ch-codeblock not-prose \" data-ch-theme=\"supabase\"><div class=\"ch-code-wrapper ch-code\" data-ch-measured=\"false\"><code class=\"ch-code-scroll-parent\"><br><div><span class=\"ch-code-line-number\">_<!-- -->46</span><div style=\"display:inline-block;margin-left:16px\"><span>def seed():</span></div></div><div><span class=\"ch-code-line-number\">_<!-- -->46</span><div style=\"display:inline-block;margin-left:16px\"><span>    # Initialize Supabase and Mixpeek clients</span></div></div><div><span class=\"ch-code-line-number\">_<!-- -->46</span><div style=\"display:inline-block;margin-left:16px\"><span>    supabase: Client = create_client(SUPABASE_URL, SUPABASE_KEY)</span></div></div><div><span class=\"ch-code-line-number\">_<!-- -->46</span><div style=\"display:inline-block;margin-left:16px\"><span>    mixpeek = Mixpeek(MIXPEEK_API_KEY)</span></div></div><div><span class=\"ch-code-line-number\">_<!-- -->46</span><div style=\"display:inline-block;margin-left:16px\"><span></span></div></div><div><span class=\"ch-code-line-number\">_<!-- -->46</span><div style=\"display:inline-block;margin-left:16px\"><span>    # Create a table for storing video chunk embeddings</span></div></div><div><span class=\"ch-code-line-number\">_<!-- -->46</span><div style=\"display:inline-block;margin-left:16px\"><span>    supabase.table(\"video_chunks\").create({</span></div></div><div><span class=\"ch-code-line-number\">_<!-- -->46</span><div style=\"display:inline-block;margin-left:16px\"><span>        \"id\": \"text\",</span></div></div><div><span class=\"ch-code-line-number\">_<!-- -->46</span><div style=\"display:inline-block;margin-left:16px\"><span>        \"start_time\": \"float8\",</span></div></div><div><span class=\"ch-code-line-number\">_<!-- -->46</span><div style=\"display:inline-block;margin-left:16px\"><span>        \"end_time\": \"float8\",</span></div></div><div><span class=\"ch-code-line-number\">_<!-- -->46</span><div style=\"display:inline-block;margin-left:16px\"><span>        \"embedding\": \"vector(768)\",</span></div></div><div><span class=\"ch-code-line-number\">_<!-- -->46</span><div style=\"display:inline-block;margin-left:16px\"><span>        \"metadata\": \"jsonb\"</span></div></div><div><span class=\"ch-code-line-number\">_<!-- -->46</span><div style=\"display:inline-block;margin-left:16px\"><span>    })</span></div></div><div><span class=\"ch-code-line-number\">_<!-- -->46</span><div style=\"display:inline-block;margin-left:16px\"><span></span></div></div><div><span class=\"ch-code-line-number\">_<!-- -->46</span><div style=\"display:inline-block;margin-left:16px\"><span>    # Process and embed video</span></div></div><div><span class=\"ch-code-line-number\">_<!-- -->46</span><div style=\"display:inline-block;margin-left:16px\"><span>    video_url = \"https://example.com/your_video.mp4\"</span></div></div><div><span class=\"ch-code-line-number\">_<!-- -->46</span><div style=\"display:inline-block;margin-left:16px\"><span>    processed_chunks = mixpeek.tools.video.process(</span></div></div><div><span class=\"ch-code-line-number\">_<!-- -->46</span><div style=\"display:inline-block;margin-left:16px\"><span>        video_source=video_url,</span></div></div><div><span class=\"ch-code-line-number\">_<!-- -->46</span><div style=\"display:inline-block;margin-left:16px\"><span>        chunk_interval=1,  # 1 second intervals</span></div></div><div><span class=\"ch-code-line-number\">_<!-- -->46</span><div style=\"display:inline-block;margin-left:16px\"><span>        resolution=[720, 1280]</span></div></div><div><span class=\"ch-code-line-number\">_<!-- -->46</span><div style=\"display:inline-block;margin-left:16px\"><span>    )</span></div></div><div><span class=\"ch-code-line-number\">_<!-- -->46</span><div style=\"display:inline-block;margin-left:16px\"><span></span></div></div><div><span class=\"ch-code-line-number\">_<!-- -->46</span><div style=\"display:inline-block;margin-left:16px\"><span>    for chunk in processed_chunks:</span></div></div><div><span class=\"ch-code-line-number\">_<!-- -->46</span><div style=\"display:inline-block;margin-left:16px\"><span>        print(f\"Processing video chunk: {chunk['start_time']}\")</span></div></div><div><span class=\"ch-code-line-number\">_<!-- -->46</span><div style=\"display:inline-block;margin-left:16px\"><span></span></div></div><div><span class=\"ch-code-line-number\">_<!-- -->46</span><div style=\"display:inline-block;margin-left:16px\"><span>        # Generate embedding using Mixpeek</span></div></div><div><span class=\"ch-code-line-number\">_<!-- -->46</span><div style=\"display:inline-block;margin-left:16px\"><span>        embed_response = mixpeek.embed.video(</span></div></div><div><span class=\"ch-code-line-number\">_<!-- -->46</span><div style=\"display:inline-block;margin-left:16px\"><span>            model_id=\"vuse-generic-v1\",</span></div></div><div><span class=\"ch-code-line-number\">_<!-- -->46</span><div style=\"display:inline-block;margin-left:16px\"><span>            input=chunk['base64_chunk'],</span></div></div><div><span class=\"ch-code-line-number\">_<!-- -->46</span><div style=\"display:inline-block;margin-left:16px\"><span>            input_type=\"base64\"</span></div></div><div><span class=\"ch-code-line-number\">_<!-- -->46</span><div style=\"display:inline-block;margin-left:16px\"><span>        )</span></div></div><div><span class=\"ch-code-line-number\">_<!-- -->46</span><div style=\"display:inline-block;margin-left:16px\"><span></span></div></div><div><span class=\"ch-code-line-number\">_<!-- -->46</span><div style=\"display:inline-block;margin-left:16px\"><span>        # Insert into Supabase</span></div></div><div><span class=\"ch-code-line-number\">_<!-- -->46</span><div style=\"display:inline-block;margin-left:16px\"><span>        supabase.table(\"video_chunks\").insert({</span></div></div><div><span class=\"ch-code-line-number\">_<!-- -->46</span><div style=\"display:inline-block;margin-left:16px\"><span>            \"id\": f\"chunk_{chunk['start_time']}\",</span></div></div><div><span class=\"ch-code-line-number\">_<!-- -->46</span><div style=\"display:inline-block;margin-left:16px\"><span>            \"start_time\": chunk[\"start_time\"],</span></div></div><div><span class=\"ch-code-line-number\">_<!-- -->46</span><div style=\"display:inline-block;margin-left:16px\"><span>            \"end_time\": chunk[\"end_time\"],</span></div></div><div><span class=\"ch-code-line-number\">_<!-- -->46</span><div style=\"display:inline-block;margin-left:16px\"><span>            \"embedding\": embed_response['embedding'],</span></div></div><div><span class=\"ch-code-line-number\">_<!-- -->46</span><div style=\"display:inline-block;margin-left:16px\"><span>            \"metadata\": {\"video_url\": video_url}</span></div></div><div><span class=\"ch-code-line-number\">_<!-- -->46</span><div style=\"display:inline-block;margin-left:16px\"><span>        }).execute()</span></div></div><div><span class=\"ch-code-line-number\">_<!-- -->46</span><div style=\"display:inline-block;margin-left:16px\"><span></span></div></div><div><span class=\"ch-code-line-number\">_<!-- -->46</span><div style=\"display:inline-block;margin-left:16px\"><span>    print(\"Video processed and embeddings inserted\")</span></div></div><div><span class=\"ch-code-line-number\">_<!-- -->46</span><div style=\"display:inline-block;margin-left:16px\"><span></span></div></div><div><span class=\"ch-code-line-number\">_<!-- -->46</span><div style=\"display:inline-block;margin-left:16px\"><span>    # Create index for fast search performance</span></div></div><div><span class=\"ch-code-line-number\">_<!-- -->46</span><div style=\"display:inline-block;margin-left:16px\"><span>    supabase.query(\"CREATE INDEX ON video_chunks USING ivfflat (embedding vector_cosine_ops) WITH (lists = 100)\").execute()</span></div></div><div><span class=\"ch-code-line-number\">_<!-- -->46</span><div style=\"display:inline-block;margin-left:16px\"><span>    print(\"Created index\")</span></div></div><br></code></div></div>\n<p>Add this method as a script in your <code>pyproject.toml</code> file:</p>\n<div class=\"ch-codeblock not-prose \" data-ch-theme=\"supabase\"><div class=\"ch-code-wrapper ch-code\" data-ch-measured=\"false\"><code class=\"ch-code-scroll-parent\"><br><div><span class=\"ch-code-line-number\">_<!-- -->10</span><div style=\"display:inline-block;margin-left:16px\"><span>[tool.poetry.scripts]</span></div></div><div><span class=\"ch-code-line-number\">_<!-- -->10</span><div style=\"display:inline-block;margin-left:16px\"><span>seed = \"video_search.main:seed\"</span></div></div><div><span class=\"ch-code-line-number\">_<!-- -->10</span><div style=\"display:inline-block;margin-left:16px\"><span>search = \"video_search.main:search\"</span></div></div><br></code></div></div>\n<p>After activating the virtual environment with <code>poetry shell</code>, you can now run your seed script via <code>poetry run seed</code>. You can inspect the generated embeddings in your local database by visiting the local Supabase dashboard at <a href=\"http://localhost:54323/project/default/editor\">localhost:54323</a>.</p>\n<h2 id=\"perform-a-video-search-from-a-text-query\" class=\"group scroll-mt-24\">Perform a video search from a text query<a href=\"#perform-a-video-search-from-a-text-query\" aria-hidden=\"true\" class=\"ml-2 opacity-0 group-hover:opacity-100 transition\"><span aria-hidden=\"true\">#</span></a></h2>\n<p>With Supabase Vector, you can query your embeddings. You can use either a video clip as search input or alternatively, you can generate an embedding from a string input and use that as the query input:</p>\n<div class=\"ch-codeblock not-prose \" data-ch-theme=\"supabase\"><div class=\"ch-code-wrapper ch-code\" data-ch-measured=\"false\"><code class=\"ch-code-scroll-parent\"><br><div><span class=\"ch-code-line-number\">_<!-- -->32</span><div style=\"display:inline-block;margin-left:16px\"><span>def search():</span></div></div><div><span class=\"ch-code-line-number\">_<!-- -->32</span><div style=\"display:inline-block;margin-left:16px\"><span>    # Initialize Supabase and Mixpeek clients</span></div></div><div><span class=\"ch-code-line-number\">_<!-- -->32</span><div style=\"display:inline-block;margin-left:16px\"><span>    supabase: Client = create_client(SUPABASE_URL, SUPABASE_KEY)</span></div></div><div><span class=\"ch-code-line-number\">_<!-- -->32</span><div style=\"display:inline-block;margin-left:16px\"><span>    mixpeek = Mixpeek(MIXPEEK_API_KEY)</span></div></div><div><span class=\"ch-code-line-number\">_<!-- -->32</span><div style=\"display:inline-block;margin-left:16px\"><span></span></div></div><div><span class=\"ch-code-line-number\">_<!-- -->32</span><div style=\"display:inline-block;margin-left:16px\"><span>    # Generate embedding for text query</span></div></div><div><span class=\"ch-code-line-number\">_<!-- -->32</span><div style=\"display:inline-block;margin-left:16px\"><span>    query_string = \"a car chase scene\"</span></div></div><div><span class=\"ch-code-line-number\">_<!-- -->32</span><div style=\"display:inline-block;margin-left:16px\"><span>    text_emb = mixpeek.embed.video(</span></div></div><div><span class=\"ch-code-line-number\">_<!-- -->32</span><div style=\"display:inline-block;margin-left:16px\"><span>        model_id=\"vuse-generic-v1\",</span></div></div><div><span class=\"ch-code-line-number\">_<!-- -->32</span><div style=\"display:inline-block;margin-left:16px\"><span>        input=query_string,</span></div></div><div><span class=\"ch-code-line-number\">_<!-- -->32</span><div style=\"display:inline-block;margin-left:16px\"><span>        input_type=\"text\"</span></div></div><div><span class=\"ch-code-line-number\">_<!-- -->32</span><div style=\"display:inline-block;margin-left:16px\"><span>    )</span></div></div><div><span class=\"ch-code-line-number\">_<!-- -->32</span><div style=\"display:inline-block;margin-left:16px\"><span></span></div></div><div><span class=\"ch-code-line-number\">_<!-- -->32</span><div style=\"display:inline-block;margin-left:16px\"><span>    # Query the collection</span></div></div><div><span class=\"ch-code-line-number\">_<!-- -->32</span><div style=\"display:inline-block;margin-left:16px\"><span>    results = supabase.rpc(</span></div></div><div><span class=\"ch-code-line-number\">_<!-- -->32</span><div style=\"display:inline-block;margin-left:16px\"><span>        'match_video_chunks',</span></div></div><div><span class=\"ch-code-line-number\">_<!-- -->32</span><div style=\"display:inline-block;margin-left:16px\"><span>        {</span></div></div><div><span class=\"ch-code-line-number\">_<!-- -->32</span><div style=\"display:inline-block;margin-left:16px\"><span>            'query_embedding': text_emb['embedding'],</span></div></div><div><span class=\"ch-code-line-number\">_<!-- -->32</span><div style=\"display:inline-block;margin-left:16px\"><span>            'match_threshold': 0.8,</span></div></div><div><span class=\"ch-code-line-number\">_<!-- -->32</span><div style=\"display:inline-block;margin-left:16px\"><span>            'match_count': 5</span></div></div><div><span class=\"ch-code-line-number\">_<!-- -->32</span><div style=\"display:inline-block;margin-left:16px\"><span>        }</span></div></div><div><span class=\"ch-code-line-number\">_<!-- -->32</span><div style=\"display:inline-block;margin-left:16px\"><span>    ).execute()</span></div></div><div><span class=\"ch-code-line-number\">_<!-- -->32</span><div style=\"display:inline-block;margin-left:16px\"><span></span></div></div><div><span class=\"ch-code-line-number\">_<!-- -->32</span><div style=\"display:inline-block;margin-left:16px\"><span>    # Display the results</span></div></div><div><span class=\"ch-code-line-number\">_<!-- -->32</span><div style=\"display:inline-block;margin-left:16px\"><span>    if results.data:</span></div></div><div><span class=\"ch-code-line-number\">_<!-- -->32</span><div style=\"display:inline-block;margin-left:16px\"><span>        for result in results.data:</span></div></div><div><span class=\"ch-code-line-number\">_<!-- -->32</span><div style=\"display:inline-block;margin-left:16px\"><span>            print(f\"Matched chunk from {result['start_time']} to {result['end_time']} seconds\")</span></div></div><div><span class=\"ch-code-line-number\">_<!-- -->32</span><div style=\"display:inline-block;margin-left:16px\"><span>            print(f\"Video URL: {result['metadata']['video_url']}\")</span></div></div><div><span class=\"ch-code-line-number\">_<!-- -->32</span><div style=\"display:inline-block;margin-left:16px\"><span>            print(f\"Similarity: {result['similarity']}\")</span></div></div><div><span class=\"ch-code-line-number\">_<!-- -->32</span><div style=\"display:inline-block;margin-left:16px\"><span>            print(\"---\")</span></div></div><div><span class=\"ch-code-line-number\">_<!-- -->32</span><div style=\"display:inline-block;margin-left:16px\"><span>    else:</span></div></div><div><span class=\"ch-code-line-number\">_<!-- -->32</span><div style=\"display:inline-block;margin-left:16px\"><span>        print(\"No matching video chunks found\")</span></div></div><br></code></div></div>\n<p>This query will return the top 5 most similar video chunks from your database.</p>\n<p>You can now test it out by running <code>poetry run search</code>, and you will be presented with the most relevant video chunks to the query \"a car chase scene\".</p>\n<h2 id=\"conclusion\" class=\"group scroll-mt-24\">Conclusion<a href=\"#conclusion\" aria-hidden=\"true\" class=\"ml-2 opacity-0 group-hover:opacity-100 transition\"><span aria-hidden=\"true\">#</span></a></h2>\n<p>With just a couple of Python scripts, you are able to implement video search as well as reverse video search using Mixpeek Embed and Supabase Vector. This approach allows for powerful semantic search capabilities that can be integrated into various applications, enabling you to search through video content using both text and video queries.</p></article></div></div></div><!--$--><div class=\"max-w-7xl px-5 mx-auto py-8 pt-0\"></div><!--/$--></div><div class=\"left-0 right-0 z-10 backdrop-blur-sm backdrop-filter bg-alternative/90 hidden h-0 lg:hidden\"></div></div></main></div></div></div></div></body></html>",
      "metadata": {
        "ogUrl": "https://supabase.com/docs/guides/ai/examples/mixpeek-video-search",
        "title": "Video Search with Mixpeek Multimodal Embeddings | Supabase Docs",
        "robots": "index, follow",
        "ogImage": "https://obuldanrptloktxcffvn.supabase.co/functions/v1/og-images?site=docs&type=ai&title=Video%20Search%20with%20Mixpeek%20Multimodal%20Embeddings&description=Implement%20video%20search%20with%20the%20Mixpeek%20Multimodal%20Embed%20API%20and%20Supabase%20Vector.",
        "ogTitle": "Video Search with Mixpeek Multimodal Embeddings | Supabase Docs",
        "language": "en",
        "sourceURL": "https://supabase.com/docs/guides/ai/examples/mixpeek-video-search",
        "description": "Implement video search with the Mixpeek Multimodal Embed API and Supabase Vector.",
        "modifiedTime": "2024-09-10T20:36:24.564Z",
        "ogDescription": "Implement video search with the Mixpeek Multimodal Embed API and Supabase Vector.",
        "publishedTime": "2024-09-10T20:36:24.564Z",
        "ogLocaleAlternate": [],
        "statusCode": 200
      }
    },
    {
      "markdown": "AI & Vectors\n\n# HNSW indexes\n\n* * *\n\nHNSW is an algorithm for approximate nearest neighbor search. It is a frequently used index type that can improve performance when querying highly-dimensional vectors, like those representing embeddings.\n\n## Usage [\\#](\\#usage)\n\nThe way you create an HNSW index depends on the distance operator you are using. `pgvector` includes 3 distance operators:\n\n| Operator | Description | [**Operator class**](https://www.postgresql.org/docs/current/sql-createopclass.html) |\n| --- | --- | --- |\n| `<->` | Euclidean distance | `vector_l2_ops` |\n| `<#>` | negative inner product | `vector_ip_ops` |\n| `<=>` | cosine distance | `vector_cosine_ops` |\n\nUse the following SQL commands to create an HNSW index for the operator(s) used in your queries.\n\n### Euclidean L2 distance ( `vector_l2_ops`) [\\#](\\#euclidean-l2-distance--vectorl2ops-)\n\n`\n_10\ncreate index on items using hnsw (column_name vector_l2_ops);\n`\n\n### Inner product ( `vector_ip_ops`) [\\#](\\#inner-product--vectoripops-)\n\n`\n_10\ncreate index on items using hnsw (column_name vector_ip_ops);\n`\n\n### Cosine distance ( `vector_cosine_ops`) [\\#](\\#cosine-distance--vectorcosineops-)\n\n`\n_10\ncreate index on items using hnsw (column_name vector_cosine_ops);\n`\n\nCurrently vectors with up to 2,000 dimensions can be indexed.\n\n## How does HNSW work? [\\#](\\#how-does-hnsw-work)\n\nHNSW uses proximity graphs (graphs connecting nodes based on distance between them) to approximate nearest-neighbor search. To understand HNSW, we can break it down into 2 parts:\n\n- **Hierarchical (H):** The algorithm operates over multiple layers\n- **Navigable Small World (NSW):** Each vector is a node within a graph and is connected to several other nodes\n\n### Hierarchical [\\#](\\#hierarchical)\n\nThe hierarchical aspect of HNSW builds off of the idea of skip lists.\n\nSkip lists are multi-layer linked lists. The bottom layer is a regular linked list connecting an ordered sequence of elements. Each new layer above removes some elements from the underlying layer (based on a fixed probability), producing a sparser subsequence that \u201cskips\u201d over elements.\n\nWhen searching for an element, the algorithm begins at the top layer and traverses its linked list horizontally. If the target element is found, the algorithm stops and returns it. Otherwise if the next element in the list is greater than the target (or `NULL`), the algorithm drops down to the next layer below. Since each layer below is less sparse than the layer above (with the bottom layer connecting all elements), the target will eventually be found. Skip lists offer O(log n) average complexity for both search and insertion/deletion.\n\n### Navigable Small World [\\#](\\#navigable-small-world)\n\nA navigable small world (NSW) is a special type of proximity graph that also includes long-range connections between nodes. These long-range connections support the \u201csmall world\u201d property of the graph, meaning almost every node can be reached from any other node within a few hops. Without these additional long-range connections, many hops would be required to reach a far-away node.\n\nThe \u201cnavigable\u201d part of NSW specifically refers to the ability to logarithmically scale the greedy search algorithm on the graph, an algorithm that attempts to make only the locally optimal choice at each hop. Without this property, the graph may still be considered a small world with short paths between far-away nodes, but the greedy algorithm tends to miss them. Greedy search is ideal for NSW because it is quick to navigate and has low computational costs.\n\n### **Hierarchical +** Navigable Small World [\\#](\\#hierarchical--navigable-small-world)\n\nHNSW combines these two concepts. From the hierarchical perspective, the bottom layer consists of a NSW made up of short links between nodes. Each layer above \u201cskips\u201d elements and creates longer links between nodes further away from each other.\n\nJust like skip lists, search starts at the top layer and works its way down until it finds the target element. However, instead of comparing a scalar value at each layer to determine whether or not to descend to the layer below, a multi-dimensional distance measure (such as Euclidean distance) is used.\n\n## When should you create HNSW indexes? [\\#](\\#when-should-you-create-hnsw-indexes)\n\nHNSW should be your default choice when creating a vector index. Add the index when you don't need 100% accuracy and are willing to trade a small amount of accuracy for a lot of throughput.\n\nUnlike IVFFlat indexes, you are safe to build an HNSW index immediately after the table is created. HNSW indexes are based on graphs which inherently are not affected by the same limitations as IVFFlat. As new data is added to the table, the index will be filled automatically and the index structure will remain optimal.\n\n## Resources [\\#](\\#resources)\n\nRead more about indexing on `pgvector`'s [GitHub page](https://github.com/pgvector/pgvector#indexing).",
      "html": "<!DOCTYPE html><html lang=\"en\" data-theme=\"light\" style=\"color-scheme: light;\"><body><div class=\"flex flex-col\"><div class=\"grow\"><div class=\"flex flex-col h-full w-full\"><div class=\"hidden lg:sticky w-full lg:flex top-0 left-0 right-0 z-50\"><!--$--><!--/$--></div><div class=\"flex flex-row h-full relative\"><main id=\"docs-content-container\" class=\"w-full transition-all ease-out relative lg:ml-0\"><div class=\"flex flex-col sticky top-0\"><div class=\"flex lg:hidden w-full top-0 left-0 right-0 z-50\"><!--$--><!--/$--></div><div class=\"sticky transition-all top-0 z-10 backdrop-blur backdrop-filter bg-background\"><div class=\"lg:hidden px-3.5 border-b z-10 transition-all ease-out top-0 flex items-center gap-1\"><button class=\"h-8 w-8 flex group items-center justify-center mr-1\"><div class=\"space-y-1 cursor-pointer relative w-4 h-[8px]\"><span class=\"transition-all ease-out block h-px bg-foreground-muted group-hover:bg-foreground w-4\"></span><span class=\"transition-all ease-out block h-px bg-foreground-muted group-hover:bg-foreground w-3 group-hover:w-4\"></span></div></button><span class=\"transition-all duration-200 text-foreground text-sm\">AI &amp; Vectors</span></div></div><div class=\"grow\"><div class=\"max-w-7xl px-5 mx-auto py-8 pb-0\"><div class=\"grid grid-cols-12 relative gap-4\"><div class=\"relative transition-all ease-out duration-100 col-span-12 md:col-span-9\"><article id=\"sb-docs-guide-main-article\" class=\"prose max-w-none\"><h1 class=\"mb-0\">HNSW indexes</h1><hr class=\"not-prose border-t-0 border-b my-8\">\n<p>HNSW is an algorithm for approximate nearest neighbor search. It is a frequently used index type that can improve performance when querying highly-dimensional vectors, like those representing embeddings.</p>\n<h2 id=\"usage\" class=\"group scroll-mt-24\">Usage<a href=\"#usage\" aria-hidden=\"true\" class=\"ml-2 opacity-0 group-hover:opacity-100 transition\"><span aria-hidden=\"true\">#</span></a></h2>\n<p>The way you create an HNSW index depends on the distance operator you are using. <code>pgvector</code> includes 3 distance operators:</p>\n<table><thead><tr><th>Operator</th><th>Description</th><th><a href=\"https://www.postgresql.org/docs/current/sql-createopclass.html\"><strong>Operator class</strong></a></th></tr></thead><tbody><tr><td><code>&lt;-&gt;</code></td><td>Euclidean distance</td><td><code>vector_l2_ops</code></td></tr><tr><td><code>&lt;#&gt;</code></td><td>negative inner product</td><td><code>vector_ip_ops</code></td></tr><tr><td><code>&lt;=&gt;</code></td><td>cosine distance</td><td><code>vector_cosine_ops</code></td></tr></tbody></table>\n<p>Use the following SQL commands to create an HNSW index for the operator(s) used in your queries.</p>\n<h3 id=\"euclidean-l2-distance--vectorl2ops-\" class=\"group scroll-mt-24\">Euclidean L2 distance (<code>vector_l2_ops</code>)<a href=\"#euclidean-l2-distance--vectorl2ops-\" aria-hidden=\"true\" class=\"ml-2 opacity-0 group-hover:opacity-100 transition\"><span aria-hidden=\"true\">#</span></a></h3>\n<div class=\"ch-codeblock not-prose \" data-ch-theme=\"supabase\"><div class=\"ch-code-wrapper ch-code\" data-ch-measured=\"false\"><code class=\"ch-code-scroll-parent\"><br><div><span class=\"ch-code-line-number\">_<!-- -->10</span><div style=\"display:inline-block;margin-left:16px\"><span>create index on items using hnsw (column_name vector_l2_ops);</span></div></div><br></code></div></div>\n<h3 id=\"inner-product--vectoripops-\" class=\"group scroll-mt-24\">Inner product (<code>vector_ip_ops</code>)<a href=\"#inner-product--vectoripops-\" aria-hidden=\"true\" class=\"ml-2 opacity-0 group-hover:opacity-100 transition\"><span aria-hidden=\"true\">#</span></a></h3>\n<div class=\"ch-codeblock not-prose \" data-ch-theme=\"supabase\"><div class=\"ch-code-wrapper ch-code\" data-ch-measured=\"false\"><code class=\"ch-code-scroll-parent\"><br><div><span class=\"ch-code-line-number\">_<!-- -->10</span><div style=\"display:inline-block;margin-left:16px\"><span>create index on items using hnsw (column_name vector_ip_ops);</span></div></div><br></code></div></div>\n<h3 id=\"cosine-distance--vectorcosineops-\" class=\"group scroll-mt-24\">Cosine distance (<code>vector_cosine_ops</code>)<a href=\"#cosine-distance--vectorcosineops-\" aria-hidden=\"true\" class=\"ml-2 opacity-0 group-hover:opacity-100 transition\"><span aria-hidden=\"true\">#</span></a></h3>\n<div class=\"ch-codeblock not-prose \" data-ch-theme=\"supabase\"><div class=\"ch-code-wrapper ch-code\" data-ch-measured=\"false\"><code class=\"ch-code-scroll-parent\"><br><div><span class=\"ch-code-line-number\">_<!-- -->10</span><div style=\"display:inline-block;margin-left:16px\"><span>create index on items using hnsw (column_name vector_cosine_ops);</span></div></div><br></code></div></div>\n<p>Currently vectors with up to 2,000 dimensions can be indexed.</p>\n<h2 id=\"how-does-hnsw-work\" class=\"group scroll-mt-24\">How does HNSW work?<a href=\"#how-does-hnsw-work\" aria-hidden=\"true\" class=\"ml-2 opacity-0 group-hover:opacity-100 transition\"><span aria-hidden=\"true\">#</span></a></h2>\n<p>HNSW uses proximity graphs (graphs connecting nodes based on distance between them) to approximate nearest-neighbor search. To understand HNSW, we can break it down into 2 parts:</p>\n<ul>\n<li><strong>Hierarchical (H):</strong> The algorithm operates over multiple layers</li>\n<li><strong>Navigable Small World (NSW):</strong> Each vector is a node within a graph and is connected to several other nodes</li>\n</ul>\n<h3 id=\"hierarchical\" class=\"group scroll-mt-24\">Hierarchical<a href=\"#hierarchical\" aria-hidden=\"true\" class=\"ml-2 opacity-0 group-hover:opacity-100 transition\"><span aria-hidden=\"true\">#</span></a></h3>\n<p>The hierarchical aspect of HNSW builds off of the idea of skip lists.</p>\n<p>Skip lists are multi-layer linked lists. The bottom layer is a regular linked list connecting an ordered sequence of elements. Each new layer above removes some elements from the underlying layer (based on a fixed probability), producing a sparser subsequence that \u201cskips\u201d over elements.</p>\n<!-- -->\n<p>When searching for an element, the algorithm begins at the top layer and traverses its linked list horizontally. If the target element is found, the algorithm stops and returns it. Otherwise if the next element in the list is greater than the target (or <code>NULL</code>), the algorithm drops down to the next layer below. Since each layer below is less sparse than the layer above (with the bottom layer connecting all elements), the target will eventually be found. Skip lists offer O(log n) average complexity for both search and insertion/deletion.</p>\n<h3 id=\"navigable-small-world\" class=\"group scroll-mt-24\">Navigable Small World<a href=\"#navigable-small-world\" aria-hidden=\"true\" class=\"ml-2 opacity-0 group-hover:opacity-100 transition\"><span aria-hidden=\"true\">#</span></a></h3>\n<p>A navigable small world (NSW) is a special type of proximity graph that also includes long-range connections between nodes. These long-range connections support the \u201csmall world\u201d property of the graph, meaning almost every node can be reached from any other node within a few hops. Without these additional long-range connections, many hops would be required to reach a far-away node.</p>\n<!-- -->\n<p>The \u201cnavigable\u201d part of NSW specifically refers to the ability to logarithmically scale the greedy search algorithm on the graph, an algorithm that attempts to make only the locally optimal choice at each hop. Without this property, the graph may still be considered a small world with short paths between far-away nodes, but the greedy algorithm tends to miss them. Greedy search is ideal for NSW because it is quick to navigate and has low computational costs.</p>\n<h3 id=\"hierarchical--navigable-small-world\" class=\"group scroll-mt-24\"><strong>Hierarchical +</strong> Navigable Small World<a href=\"#hierarchical--navigable-small-world\" aria-hidden=\"true\" class=\"ml-2 opacity-0 group-hover:opacity-100 transition\"><span aria-hidden=\"true\">#</span></a></h3>\n<p>HNSW combines these two concepts. From the hierarchical perspective, the bottom layer consists of a NSW made up of short links between nodes. Each layer above \u201cskips\u201d elements and creates longer links between nodes further away from each other.</p>\n<p>Just like skip lists, search starts at the top layer and works its way down until it finds the target element. However, instead of comparing a scalar value at each layer to determine whether or not to descend to the layer below, a multi-dimensional distance measure (such as Euclidean distance) is used.</p>\n<h2 id=\"when-should-you-create-hnsw-indexes\" class=\"group scroll-mt-24\">When should you create HNSW indexes?<a href=\"#when-should-you-create-hnsw-indexes\" aria-hidden=\"true\" class=\"ml-2 opacity-0 group-hover:opacity-100 transition\"><span aria-hidden=\"true\">#</span></a></h2>\n<p>HNSW should be your default choice when creating a vector index. Add the index when you don't need 100% accuracy and are willing to trade a small amount of accuracy for a lot of throughput.</p>\n<p>Unlike IVFFlat indexes, you are safe to build an HNSW index immediately after the table is created. HNSW indexes are based on graphs which inherently are not affected by the same limitations as IVFFlat. As new data is added to the table, the index will be filled automatically and the index structure will remain optimal.</p>\n<h2 id=\"resources\" class=\"group scroll-mt-24\">Resources<a href=\"#resources\" aria-hidden=\"true\" class=\"ml-2 opacity-0 group-hover:opacity-100 transition\"><span aria-hidden=\"true\">#</span></a></h2>\n<p>Read more about indexing on <code>pgvector</code>'s <a href=\"https://github.com/pgvector/pgvector#indexing\">GitHub page</a>.</p></article></div></div></div><!--$--><div class=\"max-w-7xl px-5 mx-auto py-8 pt-0\"></div><!--/$--></div><div class=\"left-0 right-0 z-10 backdrop-blur-sm backdrop-filter bg-alternative/90 hidden h-0 lg:hidden\"></div></div></main></div></div></div></div></body></html>",
      "metadata": {
        "ogUrl": "https://supabase.com/docs/guides/ai/vector-indexes/hnsw-indexes",
        "title": "HNSW indexes | Supabase Docs",
        "robots": "index, follow",
        "ogImage": "https://obuldanrptloktxcffvn.supabase.co/functions/v1/og-images?site=docs&type=ai&title=HNSW%20indexes&description=Understanding%20HNSW%20indexes%20in%20pgvector",
        "ogTitle": "HNSW indexes | Supabase Docs",
        "language": "en",
        "sourceURL": "https://supabase.com/docs/guides/ai/vector-indexes/hnsw-indexes",
        "description": "Understanding HNSW indexes in pgvector",
        "modifiedTime": "2024-09-10T20:36:25.434Z",
        "ogDescription": "Understanding HNSW indexes in pgvector",
        "publishedTime": "2024-09-10T20:36:25.434Z",
        "ogLocaleAlternate": [],
        "statusCode": 200
      }
    },
    {
      "markdown": "AI & Vectors\n\n# Semantic Image Search with Amazon Titan\n\n## Implement semantic image search with Amazon Titan and Supabase Vector in Python.\n\n* * *\n\n[Amazon Bedrock](https://aws.amazon.com/bedrock) is a fully managed service that offers a choice of high-performing foundation models (FMs) from leading AI companies like AI21 Labs, Anthropic, Cohere, Meta, Mistral AI, Stability AI, and Amazon. Each model is accessible through a common API which implements a broad set of features to help build generative AI applications with security, privacy, and responsible AI in mind.\n\n[Amazon Titan](https://aws.amazon.com/bedrock/titan/) is a family of foundation models (FMs) for text and image generation, summarization, classification, open-ended Q&A, information extraction, and text or image search.\n\nIn this guide we'll look at how we can get started with Amazon Bedrock and Supabase Vector in Python using the Amazon Titan multimodal model and the [vecs client](/docs/guides/ai/vecs-python-client).\n\nYou can find the full application code as a Python Poetry project on [GitHub](https://github.com/supabase/supabase/tree/master/examples/ai/aws_bedrock_image_search).\n\n## Create a new Python project with Poetry [\\#](\\#create-a-new-python-project-with-poetry)\n\n[Poetry](https://python-poetry.org/) provides packaging and dependency management for Python. If you haven't already, install poetry via pip:\n\n`\n_10\npip install poetry\n`\n\nThen initialize a new project:\n\n`\n_10\npoetry new aws_bedrock_image_search\n`\n\n## Spin up a Postgres Database with pgvector [\\#](\\#spin-up-a-postgres-database-with-pgvector)\n\nIf you haven't already, head over to [database.new](https://database.new) and create a new project. Every Supabase project comes with a full Postgres database and the [pgvector extension](/docs/guides/database/extensions/pgvector) preconfigured.\n\nWhen creating your project, make sure to note down your database password as you will need it to construct the `DB_URL` in the next step.\n\nYou can find the database connection string in your Supabase Dashboard [database settings](https://supabase.com/dashboard/project/_/settings/database). Select \"Use connection pooling\" with `Mode: Session` for a direct connection to your Postgres database. It will look something like this:\n\n`\n_10\npostgresql://postgres.[PROJECT-REF]:[YOUR-PASSWORD]@aws-0-[REGION].pooler.supabase.com:5432/postgres\n`\n\n## Install the dependencies [\\#](\\#install-the-dependencies)\n\nWe will need to add the following dependencies to our project:\n\n- [`vecs`](https://github.com/supabase/vecs#vecs): Supabase Vector Python Client.\n- [`boto3`](https://boto3.amazonaws.com/v1/documentation/api/latest/index.html): AWS SDK for Python.\n- [`matplotlib`](https://matplotlib.org/): for displaying our image result.\n\n`\n_10\npoetry add vecs boto3 matplotlib\n`\n\n## Import the necessary dependencies [\\#](\\#import-the-necessary-dependencies)\n\nAt the top of your main python script, import the dependencies and store your `DB URL` from above in a variable:\n\n`\n_10\nimport sys\n_10\nimport boto3\n_10\nimport vecs\n_10\nimport json\n_10\nimport base64\n_10\nfrom matplotlib import pyplot as plt\n_10\nfrom matplotlib import image as mpimg\n_10\nfrom typing import Optional\n_10\n_10\nDB_CONNECTION = \"postgresql://postgres.[PROJECT-REF]:[YOUR-PASSWORD]@aws-0-[REGION].pooler.supabase.com:5432/postgres\"\n`\n\nNext, get the [credentials to your AWS account](https://boto3.amazonaws.com/v1/documentation/api/latest/guide/credentials.html) and instantiate the `boto3` client:\n\n`\n_10\nbedrock_client = boto3.client(\n_10\n    'bedrock-runtime',\n_10\n    region_name='us-west-2',\n_10\n    # Credentials from your AWS account\n_10\n    aws_access_key_id='<replace_your_own_credentials>',\n_10\n    aws_secret_access_key='<replace_your_own_credentials>',\n_10\n    aws_session_token='<replace_your_own_credentials>',\n_10\n)\n`\n\n## Create embeddings for your images [\\#](\\#create-embeddings-for-your-images)\n\nIn the root of your project, create a new folder called `images` and add some images. You can use the images from the example project on [GitHub](https://github.com/supabase/supabase/tree/master/examples/ai/aws_bedrock_image_search/images) or you can find license free images on [unsplash](https://unsplash.com).\n\nTo send images to the Amazon Bedrock API we need to need to encode them as `base64` strings. Create the following helper methods:\n\n`\n_44\ndef readFileAsBase64(file_path):\n_44\n    \"\"\"Encode image as base64 string.\"\"\"\n_44\n    try:\n_44\n        with open(file_path, \"rb\") as image_file:\n_44\n            input_image = base64.b64encode(image_file.read()).decode(\"utf8\")\n_44\n        return input_image\n_44\n    except:\n_44\n        print(\"bad file name\")\n_44\n        sys.exit(0)\n_44\n_44\n_44\ndef construct_bedrock_image_body(base64_string):\n_44\n    \"\"\"Construct the request body.\n_44\n_44\n    https://docs.aws.amazon.com/bedrock/latest/userguide/model-parameters-titan-embed-mm.html\n_44\n    \"\"\"\n_44\n    return json.dumps(\n_44\n        {\n_44\n            \"inputImage\": base64_string,\n_44\n            \"embeddingConfig\": {\"outputEmbeddingLength\": 1024},\n_44\n        }\n_44\n    )\n_44\n_44\n_44\ndef get_embedding_from_titan_multimodal(body):\n_44\n    \"\"\"Invoke the Amazon Titan Model via API request.\"\"\"\n_44\n    response = bedrock_client.invoke_model(\n_44\n        body=body,\n_44\n        modelId=\"amazon.titan-embed-image-v1\",\n_44\n        accept=\"application/json\",\n_44\n        contentType=\"application/json\",\n_44\n    )\n_44\n_44\n    response_body = json.loads(response.get(\"body\").read())\n_44\n    print(response_body)\n_44\n    return response_body[\"embedding\"]\n_44\n_44\n_44\ndef encode_image(file_path):\n_44\n    \"\"\"Generate embedding for the image at file_path.\"\"\"\n_44\n    base64_string = readFileAsBase64(file_path)\n_44\n    body = construct_bedrock_image_body(base64_string)\n_44\n    emb = get_embedding_from_titan_multimodal(body)\n_44\n    return emb\n`\n\nNext, create a `seed` method, which will create a new Supabase Vector Collection, generate embeddings for your images, and upsert the embeddings into your database:\n\n`\n_40\ndef seed():\n_40\n    # create vector store client\n_40\n    vx = vecs.create_client(DB_CONNECTION)\n_40\n_40\n    # get or create a collection of vectors with 1024 dimensions\n_40\n    images = vx.get_or_create_collection(name=\"image_vectors\", dimension=1024)\n_40\n_40\n    # Generate image embeddings with Amazon Titan Model\n_40\n    img_emb1 = encode_image('./images/one.jpg')\n_40\n    img_emb2 = encode_image('./images/two.jpg')\n_40\n    img_emb3 = encode_image('./images/three.jpg')\n_40\n    img_emb4 = encode_image('./images/four.jpg')\n_40\n_40\n    # add records to the *images* collection\n_40\n    images.upsert(\n_40\n        records=[\\\n_40\\\n            (\\\n_40\\\n                \"one.jpg\",       # the vector's identifier\\\n_40\\\n                img_emb1,        # the vector. list or np.array\\\n_40\\\n                {\"type\": \"jpg\"}  # associated  metadata\\\n_40\\\n            ), (\\\n_40\\\n                \"two.jpg\",\\\n_40\\\n                img_emb2,\\\n_40\\\n                {\"type\": \"jpg\"}\\\n_40\\\n            ), (\\\n_40\\\n                \"three.jpg\",\\\n_40\\\n                img_emb3,\\\n_40\\\n                {\"type\": \"jpg\"}\\\n_40\\\n            ), (\\\n_40\\\n                \"four.jpg\",\\\n_40\\\n                img_emb4,\\\n_40\\\n                {\"type\": \"jpg\"}\\\n_40\\\n            )\\\n_40\\\n        ]\n_40\n    )\n_40\n    print(\"Inserted images\")\n_40\n_40\n    # index the collection for fast search performance\n_40\n    images.create_index()\n_40\n    print(\"Created index\")\n`\n\nAdd this method as a script in your `pyproject.toml` file:\n\n`\n_10\n[tool.poetry.scripts]\n_10\nseed = \"image_search.main:seed\"\n_10\nsearch = \"image_search.main:search\"\n`\n\nAfter activating the virtual environtment with `poetry shell` you can now run your seed script via `poetry run seed`. You can inspect the generated embeddings in your Supabase Dashboard by visiting the [Table Editor](https://supabase.com/dashboard/project/_/editor), selecting the `vecs` schema, and the `image_vectors` table.\n\n## Perform an image search from a text query [\\#](\\#perform-an-image-search-from-a-text-query)\n\nWith Supabase Vector we can easily query our embeddings. We can use either an image as the search input or alternatively we can generate an embedding from a string input and use that as the query input:\n\n`\n_28\ndef search(query_term: Optional[str] = None):\n_28\n    if query_term is None:\n_28\n        query_term = sys.argv[1]\n_28\n_28\n    # create vector store client\n_28\n    vx = vecs.create_client(DB_CONNECTION)\n_28\n    images = vx.get_or_create_collection(name=\"image_vectors\", dimension=1024)\n_28\n_28\n    # Encode text query\n_28\n    text_emb = get_embedding_from_titan_multimodal(json.dumps(\n_28\n        {\n_28\n            \"inputText\": query_term,\n_28\n            \"embeddingConfig\": {\"outputEmbeddingLength\": 1024},\n_28\n        }\n_28\n    ))\n_28\n_28\n    # query the collection filtering metadata for \"type\" = \"jpg\"\n_28\n    results = images.query(\n_28\n        data=text_emb,                      # required\n_28\n        limit=1,                            # number of records to return\n_28\n        filters={\"type\": {\"$eq\": \"jpg\"}},   # metadata filters\n_28\n    )\n_28\n    result = results[0]\n_28\n    print(result)\n_28\n    plt.title(result)\n_28\n    image = mpimg.imread('./images/' + result)\n_28\n    plt.imshow(image)\n_28\n    plt.show()\n`\n\nBy limiting the query to one result, we can show the most relevant image to the user. Finally we use `matplotlib` to show the image result to the user.\n\nThat's it, go ahead and test it out by running `poetry run search` and you will be presented with an image of a \"bike in front of a red brick wall\".\n\n## Conclusion [\\#](\\#conclusion)\n\nWith just a couple of lines of Python you are able to implement image search as well as reverse image search using the Amazon Titan multimodal model and Supabase Vector.",
      "html": "<!DOCTYPE html><html lang=\"en\" data-theme=\"light\" style=\"color-scheme: light;\"><body><div class=\"flex flex-col\"><div class=\"grow\"><div class=\"flex flex-col h-full w-full\"><div class=\"hidden lg:sticky w-full lg:flex top-0 left-0 right-0 z-50\"><!--$--><!--/$--></div><div class=\"flex flex-row h-full relative\"><main id=\"docs-content-container\" class=\"w-full transition-all ease-out relative lg:ml-0\"><div class=\"flex flex-col sticky top-0\"><div class=\"flex lg:hidden w-full top-0 left-0 right-0 z-50\"><!--$--><!--/$--></div><div class=\"sticky transition-all top-0 z-10 backdrop-blur backdrop-filter bg-background\"><div class=\"lg:hidden px-3.5 border-b z-10 transition-all ease-out top-0 flex items-center gap-1\"><button class=\"h-8 w-8 flex group items-center justify-center mr-1\"><div class=\"space-y-1 cursor-pointer relative w-4 h-[8px]\"><span class=\"transition-all ease-out block h-px bg-foreground-muted group-hover:bg-foreground w-4\"></span><span class=\"transition-all ease-out block h-px bg-foreground-muted group-hover:bg-foreground w-3 group-hover:w-4\"></span></div></button><span class=\"transition-all duration-200 text-foreground text-sm\">AI &amp; Vectors</span></div></div><div class=\"grow\"><div class=\"max-w-7xl px-5 mx-auto py-8 pb-0\"><div class=\"grid grid-cols-12 relative gap-4\"><div class=\"relative transition-all ease-out duration-100 col-span-12 md:col-span-9\"><article id=\"sb-docs-guide-main-article\" class=\"prose max-w-none\"><h1 class=\"mb-0\">Semantic Image Search with Amazon Titan</h1><h2 class=\"mt-3 text-xl text-foreground-light\">Implement semantic image search with Amazon Titan and Supabase Vector in Python.</h2><hr class=\"not-prose border-t-0 border-b my-8\">\n<p><a href=\"https://aws.amazon.com/bedrock\">Amazon Bedrock</a> is a fully managed service that offers a choice of high-performing foundation models (FMs) from leading AI companies like AI21 Labs, Anthropic, Cohere, Meta, Mistral AI, Stability AI, and Amazon. Each model is accessible through a common API which implements a broad set of features to help build generative AI applications with security, privacy, and responsible AI in mind.</p>\n<p><a href=\"https://aws.amazon.com/bedrock/titan/\">Amazon Titan</a> is a family of foundation models (FMs) for text and image generation, summarization, classification, open-ended Q&amp;A, information extraction, and text or image search.</p>\n<p>In this guide we'll look at how we can get started with Amazon Bedrock and Supabase Vector in Python using the Amazon Titan multimodal model and the <a href=\"/docs/guides/ai/vecs-python-client\">vecs client</a>.</p>\n<p>You can find the full application code as a Python Poetry project on <a href=\"https://github.com/supabase/supabase/tree/master/examples/ai/aws_bedrock_image_search\">GitHub</a>.</p>\n<h2 id=\"create-a-new-python-project-with-poetry\" class=\"group scroll-mt-24\">Create a new Python project with Poetry<a href=\"#create-a-new-python-project-with-poetry\" aria-hidden=\"true\" class=\"ml-2 opacity-0 group-hover:opacity-100 transition\"><span aria-hidden=\"true\">#</span></a></h2>\n<p><a href=\"https://python-poetry.org/\">Poetry</a> provides packaging and dependency management for Python. If you haven't already, install poetry via pip:</p>\n<div class=\"ch-codeblock not-prose \" data-ch-theme=\"supabase\"><div class=\"ch-code-wrapper ch-code\" data-ch-measured=\"false\"><code class=\"ch-code-scroll-parent\"><br><div><span class=\"ch-code-line-number\">_<!-- -->10</span><div style=\"display:inline-block;margin-left:16px\"><span>pip install poetry</span></div></div><br></code></div></div>\n<p>Then initialize a new project:</p>\n<div class=\"ch-codeblock not-prose \" data-ch-theme=\"supabase\"><div class=\"ch-code-wrapper ch-code\" data-ch-measured=\"false\"><code class=\"ch-code-scroll-parent\"><br><div><span class=\"ch-code-line-number\">_<!-- -->10</span><div style=\"display:inline-block;margin-left:16px\"><span>poetry new aws_bedrock_image_search</span></div></div><br></code></div></div>\n<h2 id=\"spin-up-a-postgres-database-with-pgvector\" class=\"group scroll-mt-24\">Spin up a Postgres Database with pgvector<a href=\"#spin-up-a-postgres-database-with-pgvector\" aria-hidden=\"true\" class=\"ml-2 opacity-0 group-hover:opacity-100 transition\"><span aria-hidden=\"true\">#</span></a></h2>\n<p>If you haven't already, head over to <a href=\"https://database.new\">database.new</a> and create a new project. Every Supabase project comes with a full Postgres database and the <a href=\"/docs/guides/database/extensions/pgvector\">pgvector extension</a> preconfigured.</p>\n<p>When creating your project, make sure to note down your database password as you will need it to construct the <code>DB_URL</code> in the next step.</p>\n<p>You can find the database connection string in your Supabase Dashboard <a href=\"https://supabase.com/dashboard/project/_/settings/database\">database settings</a>. Select \"Use connection pooling\" with <code>Mode: Session</code> for a direct connection to your Postgres database. It will look something like this:</p>\n<div class=\"ch-codeblock not-prose \" data-ch-theme=\"supabase\"><div class=\"ch-code-wrapper ch-code\" data-ch-measured=\"false\"><code class=\"ch-code-scroll-parent\"><br><div><span class=\"ch-code-line-number\">_<!-- -->10</span><div style=\"display:inline-block;margin-left:16px\"><span>postgresql://postgres.[PROJECT-REF]:[YOUR-PASSWORD]@aws-0-[REGION].pooler.supabase.com:5432/postgres</span></div></div><br></code></div></div>\n<h2 id=\"install-the-dependencies\" class=\"group scroll-mt-24\">Install the dependencies<a href=\"#install-the-dependencies\" aria-hidden=\"true\" class=\"ml-2 opacity-0 group-hover:opacity-100 transition\"><span aria-hidden=\"true\">#</span></a></h2>\n<p>We will need to add the following dependencies to our project:</p>\n<ul>\n<li><a href=\"https://github.com/supabase/vecs#vecs\"><code>vecs</code></a>: Supabase Vector Python Client.</li>\n<li><a href=\"https://boto3.amazonaws.com/v1/documentation/api/latest/index.html\"><code>boto3</code></a>: AWS SDK for Python.</li>\n<li><a href=\"https://matplotlib.org/\"><code>matplotlib</code></a>: for displaying our image result.</li>\n</ul>\n<div class=\"ch-codeblock not-prose \" data-ch-theme=\"supabase\"><div class=\"ch-code-wrapper ch-code\" data-ch-measured=\"false\"><code class=\"ch-code-scroll-parent\"><br><div><span class=\"ch-code-line-number\">_<!-- -->10</span><div style=\"display:inline-block;margin-left:16px\"><span>poetry add vecs boto3 matplotlib</span></div></div><br></code></div></div>\n<h2 id=\"import-the-necessary-dependencies\" class=\"group scroll-mt-24\">Import the necessary dependencies<a href=\"#import-the-necessary-dependencies\" aria-hidden=\"true\" class=\"ml-2 opacity-0 group-hover:opacity-100 transition\"><span aria-hidden=\"true\">#</span></a></h2>\n<p>At the top of your main python script, import the dependencies and store your <code>DB URL</code> from above in a variable:</p>\n<div class=\"ch-codeblock not-prose \" data-ch-theme=\"supabase\"><div class=\"ch-code-wrapper ch-code\" data-ch-measured=\"false\"><code class=\"ch-code-scroll-parent\"><br><div><span class=\"ch-code-line-number\">_<!-- -->10</span><div style=\"display:inline-block;margin-left:16px\"><span>import sys</span></div></div><div><span class=\"ch-code-line-number\">_<!-- -->10</span><div style=\"display:inline-block;margin-left:16px\"><span>import boto3</span></div></div><div><span class=\"ch-code-line-number\">_<!-- -->10</span><div style=\"display:inline-block;margin-left:16px\"><span>import vecs</span></div></div><div><span class=\"ch-code-line-number\">_<!-- -->10</span><div style=\"display:inline-block;margin-left:16px\"><span>import json</span></div></div><div><span class=\"ch-code-line-number\">_<!-- -->10</span><div style=\"display:inline-block;margin-left:16px\"><span>import base64</span></div></div><div><span class=\"ch-code-line-number\">_<!-- -->10</span><div style=\"display:inline-block;margin-left:16px\"><span>from matplotlib import pyplot as plt</span></div></div><div><span class=\"ch-code-line-number\">_<!-- -->10</span><div style=\"display:inline-block;margin-left:16px\"><span>from matplotlib import image as mpimg</span></div></div><div><span class=\"ch-code-line-number\">_<!-- -->10</span><div style=\"display:inline-block;margin-left:16px\"><span>from typing import Optional</span></div></div><div><span class=\"ch-code-line-number\">_<!-- -->10</span><div style=\"display:inline-block;margin-left:16px\"><span></span></div></div><div><span class=\"ch-code-line-number\">_<!-- -->10</span><div style=\"display:inline-block;margin-left:16px\"><span>DB_CONNECTION = \"postgresql://postgres.[PROJECT-REF]:[YOUR-PASSWORD]@aws-0-[REGION].pooler.supabase.com:5432/postgres\"</span></div></div><br></code></div></div>\n<p>Next, get the <a href=\"https://boto3.amazonaws.com/v1/documentation/api/latest/guide/credentials.html\">credentials to your AWS account</a> and instantiate the <code>boto3</code> client:</p>\n<div class=\"ch-codeblock not-prose \" data-ch-theme=\"supabase\"><div class=\"ch-code-wrapper ch-code\" data-ch-measured=\"false\"><code class=\"ch-code-scroll-parent\"><br><div><span class=\"ch-code-line-number\">_<!-- -->10</span><div style=\"display:inline-block;margin-left:16px\"><span>bedrock_client = boto3.client(</span></div></div><div><span class=\"ch-code-line-number\">_<!-- -->10</span><div style=\"display:inline-block;margin-left:16px\"><span>    'bedrock-runtime',</span></div></div><div><span class=\"ch-code-line-number\">_<!-- -->10</span><div style=\"display:inline-block;margin-left:16px\"><span>    region_name='us-west-2',</span></div></div><div><span class=\"ch-code-line-number\">_<!-- -->10</span><div style=\"display:inline-block;margin-left:16px\"><span>    # Credentials from your AWS account</span></div></div><div><span class=\"ch-code-line-number\">_<!-- -->10</span><div style=\"display:inline-block;margin-left:16px\"><span>    aws_access_key_id='&lt;replace_your_own_credentials&gt;',</span></div></div><div><span class=\"ch-code-line-number\">_<!-- -->10</span><div style=\"display:inline-block;margin-left:16px\"><span>    aws_secret_access_key='&lt;replace_your_own_credentials&gt;',</span></div></div><div><span class=\"ch-code-line-number\">_<!-- -->10</span><div style=\"display:inline-block;margin-left:16px\"><span>    aws_session_token='&lt;replace_your_own_credentials&gt;',</span></div></div><div><span class=\"ch-code-line-number\">_<!-- -->10</span><div style=\"display:inline-block;margin-left:16px\"><span>)</span></div></div><br></code></div></div>\n<h2 id=\"create-embeddings-for-your-images\" class=\"group scroll-mt-24\">Create embeddings for your images<a href=\"#create-embeddings-for-your-images\" aria-hidden=\"true\" class=\"ml-2 opacity-0 group-hover:opacity-100 transition\"><span aria-hidden=\"true\">#</span></a></h2>\n<p>In the root of your project, create a new folder called <code>images</code> and add some images. You can use the images from the example project on <a href=\"https://github.com/supabase/supabase/tree/master/examples/ai/aws_bedrock_image_search/images\">GitHub</a> or you can find license free images on <a href=\"https://unsplash.com\">unsplash</a>.</p>\n<p>To send images to the Amazon Bedrock API we need to need to encode them as <code>base64</code> strings. Create the following helper methods:</p>\n<div class=\"ch-codeblock not-prose \" data-ch-theme=\"supabase\"><div class=\"ch-code-wrapper ch-code\" data-ch-measured=\"false\"><code class=\"ch-code-scroll-parent\"><br><div><span class=\"ch-code-line-number\">_<!-- -->44</span><div style=\"display:inline-block;margin-left:16px\"><span>def readFileAsBase64(file_path):</span></div></div><div><span class=\"ch-code-line-number\">_<!-- -->44</span><div style=\"display:inline-block;margin-left:16px\"><span>    \"\"\"Encode image as base64 string.\"\"\"</span></div></div><div><span class=\"ch-code-line-number\">_<!-- -->44</span><div style=\"display:inline-block;margin-left:16px\"><span>    try:</span></div></div><div><span class=\"ch-code-line-number\">_<!-- -->44</span><div style=\"display:inline-block;margin-left:16px\"><span>        with open(file_path, \"rb\") as image_file:</span></div></div><div><span class=\"ch-code-line-number\">_<!-- -->44</span><div style=\"display:inline-block;margin-left:16px\"><span>            input_image = base64.b64encode(image_file.read()).decode(\"utf8\")</span></div></div><div><span class=\"ch-code-line-number\">_<!-- -->44</span><div style=\"display:inline-block;margin-left:16px\"><span>        return input_image</span></div></div><div><span class=\"ch-code-line-number\">_<!-- -->44</span><div style=\"display:inline-block;margin-left:16px\"><span>    except:</span></div></div><div><span class=\"ch-code-line-number\">_<!-- -->44</span><div style=\"display:inline-block;margin-left:16px\"><span>        print(\"bad file name\")</span></div></div><div><span class=\"ch-code-line-number\">_<!-- -->44</span><div style=\"display:inline-block;margin-left:16px\"><span>        sys.exit(0)</span></div></div><div><span class=\"ch-code-line-number\">_<!-- -->44</span><div style=\"display:inline-block;margin-left:16px\"><span></span></div></div><div><span class=\"ch-code-line-number\">_<!-- -->44</span><div style=\"display:inline-block;margin-left:16px\"><span></span></div></div><div><span class=\"ch-code-line-number\">_<!-- -->44</span><div style=\"display:inline-block;margin-left:16px\"><span>def construct_bedrock_image_body(base64_string):</span></div></div><div><span class=\"ch-code-line-number\">_<!-- -->44</span><div style=\"display:inline-block;margin-left:16px\"><span>    \"\"\"Construct the request body.</span></div></div><div><span class=\"ch-code-line-number\">_<!-- -->44</span><div style=\"display:inline-block;margin-left:16px\"><span></span></div></div><div><span class=\"ch-code-line-number\">_<!-- -->44</span><div style=\"display:inline-block;margin-left:16px\"><span>    https://docs.aws.amazon.com/bedrock/latest/userguide/model-parameters-titan-embed-mm.html</span></div></div><div><span class=\"ch-code-line-number\">_<!-- -->44</span><div style=\"display:inline-block;margin-left:16px\"><span>    \"\"\"</span></div></div><div><span class=\"ch-code-line-number\">_<!-- -->44</span><div style=\"display:inline-block;margin-left:16px\"><span>    return json.dumps(</span></div></div><div><span class=\"ch-code-line-number\">_<!-- -->44</span><div style=\"display:inline-block;margin-left:16px\"><span>        {</span></div></div><div><span class=\"ch-code-line-number\">_<!-- -->44</span><div style=\"display:inline-block;margin-left:16px\"><span>            \"inputImage\": base64_string,</span></div></div><div><span class=\"ch-code-line-number\">_<!-- -->44</span><div style=\"display:inline-block;margin-left:16px\"><span>            \"embeddingConfig\": {\"outputEmbeddingLength\": 1024},</span></div></div><div><span class=\"ch-code-line-number\">_<!-- -->44</span><div style=\"display:inline-block;margin-left:16px\"><span>        }</span></div></div><div><span class=\"ch-code-line-number\">_<!-- -->44</span><div style=\"display:inline-block;margin-left:16px\"><span>    )</span></div></div><div><span class=\"ch-code-line-number\">_<!-- -->44</span><div style=\"display:inline-block;margin-left:16px\"><span></span></div></div><div><span class=\"ch-code-line-number\">_<!-- -->44</span><div style=\"display:inline-block;margin-left:16px\"><span></span></div></div><div><span class=\"ch-code-line-number\">_<!-- -->44</span><div style=\"display:inline-block;margin-left:16px\"><span>def get_embedding_from_titan_multimodal(body):</span></div></div><div><span class=\"ch-code-line-number\">_<!-- -->44</span><div style=\"display:inline-block;margin-left:16px\"><span>    \"\"\"Invoke the Amazon Titan Model via API request.\"\"\"</span></div></div><div><span class=\"ch-code-line-number\">_<!-- -->44</span><div style=\"display:inline-block;margin-left:16px\"><span>    response = bedrock_client.invoke_model(</span></div></div><div><span class=\"ch-code-line-number\">_<!-- -->44</span><div style=\"display:inline-block;margin-left:16px\"><span>        body=body,</span></div></div><div><span class=\"ch-code-line-number\">_<!-- -->44</span><div style=\"display:inline-block;margin-left:16px\"><span>        modelId=\"amazon.titan-embed-image-v1\",</span></div></div><div><span class=\"ch-code-line-number\">_<!-- -->44</span><div style=\"display:inline-block;margin-left:16px\"><span>        accept=\"application/json\",</span></div></div><div><span class=\"ch-code-line-number\">_<!-- -->44</span><div style=\"display:inline-block;margin-left:16px\"><span>        contentType=\"application/json\",</span></div></div><div><span class=\"ch-code-line-number\">_<!-- -->44</span><div style=\"display:inline-block;margin-left:16px\"><span>    )</span></div></div><div><span class=\"ch-code-line-number\">_<!-- -->44</span><div style=\"display:inline-block;margin-left:16px\"><span></span></div></div><div><span class=\"ch-code-line-number\">_<!-- -->44</span><div style=\"display:inline-block;margin-left:16px\"><span>    response_body = json.loads(response.get(\"body\").read())</span></div></div><div><span class=\"ch-code-line-number\">_<!-- -->44</span><div style=\"display:inline-block;margin-left:16px\"><span>    print(response_body)</span></div></div><div><span class=\"ch-code-line-number\">_<!-- -->44</span><div style=\"display:inline-block;margin-left:16px\"><span>    return response_body[\"embedding\"]</span></div></div><div><span class=\"ch-code-line-number\">_<!-- -->44</span><div style=\"display:inline-block;margin-left:16px\"><span></span></div></div><div><span class=\"ch-code-line-number\">_<!-- -->44</span><div style=\"display:inline-block;margin-left:16px\"><span></span></div></div><div><span class=\"ch-code-line-number\">_<!-- -->44</span><div style=\"display:inline-block;margin-left:16px\"><span>def encode_image(file_path):</span></div></div><div><span class=\"ch-code-line-number\">_<!-- -->44</span><div style=\"display:inline-block;margin-left:16px\"><span>    \"\"\"Generate embedding for the image at file_path.\"\"\"</span></div></div><div><span class=\"ch-code-line-number\">_<!-- -->44</span><div style=\"display:inline-block;margin-left:16px\"><span>    base64_string = readFileAsBase64(file_path)</span></div></div><div><span class=\"ch-code-line-number\">_<!-- -->44</span><div style=\"display:inline-block;margin-left:16px\"><span>    body = construct_bedrock_image_body(base64_string)</span></div></div><div><span class=\"ch-code-line-number\">_<!-- -->44</span><div style=\"display:inline-block;margin-left:16px\"><span>    emb = get_embedding_from_titan_multimodal(body)</span></div></div><div><span class=\"ch-code-line-number\">_<!-- -->44</span><div style=\"display:inline-block;margin-left:16px\"><span>    return emb</span></div></div><br></code></div></div>\n<p>Next, create a <code>seed</code> method, which will create a new Supabase Vector Collection, generate embeddings for your images, and upsert the embeddings into your database:</p>\n<div class=\"ch-codeblock not-prose \" data-ch-theme=\"supabase\"><div class=\"ch-code-wrapper ch-code\" data-ch-measured=\"false\"><code class=\"ch-code-scroll-parent\"><br><div><span class=\"ch-code-line-number\">_<!-- -->40</span><div style=\"display:inline-block;margin-left:16px\"><span>def seed():</span></div></div><div><span class=\"ch-code-line-number\">_<!-- -->40</span><div style=\"display:inline-block;margin-left:16px\"><span>    # create vector store client</span></div></div><div><span class=\"ch-code-line-number\">_<!-- -->40</span><div style=\"display:inline-block;margin-left:16px\"><span>    vx = vecs.create_client(DB_CONNECTION)</span></div></div><div><span class=\"ch-code-line-number\">_<!-- -->40</span><div style=\"display:inline-block;margin-left:16px\"><span></span></div></div><div><span class=\"ch-code-line-number\">_<!-- -->40</span><div style=\"display:inline-block;margin-left:16px\"><span>    # get or create a collection of vectors with 1024 dimensions</span></div></div><div><span class=\"ch-code-line-number\">_<!-- -->40</span><div style=\"display:inline-block;margin-left:16px\"><span>    images = vx.get_or_create_collection(name=\"image_vectors\", dimension=1024)</span></div></div><div><span class=\"ch-code-line-number\">_<!-- -->40</span><div style=\"display:inline-block;margin-left:16px\"><span></span></div></div><div><span class=\"ch-code-line-number\">_<!-- -->40</span><div style=\"display:inline-block;margin-left:16px\"><span>    # Generate image embeddings with Amazon Titan Model</span></div></div><div><span class=\"ch-code-line-number\">_<!-- -->40</span><div style=\"display:inline-block;margin-left:16px\"><span>    img_emb1 = encode_image('./images/one.jpg')</span></div></div><div><span class=\"ch-code-line-number\">_<!-- -->40</span><div style=\"display:inline-block;margin-left:16px\"><span>    img_emb2 = encode_image('./images/two.jpg')</span></div></div><div><span class=\"ch-code-line-number\">_<!-- -->40</span><div style=\"display:inline-block;margin-left:16px\"><span>    img_emb3 = encode_image('./images/three.jpg')</span></div></div><div><span class=\"ch-code-line-number\">_<!-- -->40</span><div style=\"display:inline-block;margin-left:16px\"><span>    img_emb4 = encode_image('./images/four.jpg')</span></div></div><div><span class=\"ch-code-line-number\">_<!-- -->40</span><div style=\"display:inline-block;margin-left:16px\"><span></span></div></div><div><span class=\"ch-code-line-number\">_<!-- -->40</span><div style=\"display:inline-block;margin-left:16px\"><span>    # add records to the *images* collection</span></div></div><div><span class=\"ch-code-line-number\">_<!-- -->40</span><div style=\"display:inline-block;margin-left:16px\"><span>    images.upsert(</span></div></div><div><span class=\"ch-code-line-number\">_<!-- -->40</span><div style=\"display:inline-block;margin-left:16px\"><span>        records=[</span></div></div><div><span class=\"ch-code-line-number\">_<!-- -->40</span><div style=\"display:inline-block;margin-left:16px\"><span>            (</span></div></div><div><span class=\"ch-code-line-number\">_<!-- -->40</span><div style=\"display:inline-block;margin-left:16px\"><span>                \"one.jpg\",       # the vector's identifier</span></div></div><div><span class=\"ch-code-line-number\">_<!-- -->40</span><div style=\"display:inline-block;margin-left:16px\"><span>                img_emb1,        # the vector. list or np.array</span></div></div><div><span class=\"ch-code-line-number\">_<!-- -->40</span><div style=\"display:inline-block;margin-left:16px\"><span>                {\"type\": \"jpg\"}  # associated  metadata</span></div></div><div><span class=\"ch-code-line-number\">_<!-- -->40</span><div style=\"display:inline-block;margin-left:16px\"><span>            ), (</span></div></div><div><span class=\"ch-code-line-number\">_<!-- -->40</span><div style=\"display:inline-block;margin-left:16px\"><span>                \"two.jpg\",</span></div></div><div><span class=\"ch-code-line-number\">_<!-- -->40</span><div style=\"display:inline-block;margin-left:16px\"><span>                img_emb2,</span></div></div><div><span class=\"ch-code-line-number\">_<!-- -->40</span><div style=\"display:inline-block;margin-left:16px\"><span>                {\"type\": \"jpg\"}</span></div></div><div><span class=\"ch-code-line-number\">_<!-- -->40</span><div style=\"display:inline-block;margin-left:16px\"><span>            ), (</span></div></div><div><span class=\"ch-code-line-number\">_<!-- -->40</span><div style=\"display:inline-block;margin-left:16px\"><span>                \"three.jpg\",</span></div></div><div><span class=\"ch-code-line-number\">_<!-- -->40</span><div style=\"display:inline-block;margin-left:16px\"><span>                img_emb3,</span></div></div><div><span class=\"ch-code-line-number\">_<!-- -->40</span><div style=\"display:inline-block;margin-left:16px\"><span>                {\"type\": \"jpg\"}</span></div></div><div><span class=\"ch-code-line-number\">_<!-- -->40</span><div style=\"display:inline-block;margin-left:16px\"><span>            ), (</span></div></div><div><span class=\"ch-code-line-number\">_<!-- -->40</span><div style=\"display:inline-block;margin-left:16px\"><span>                \"four.jpg\",</span></div></div><div><span class=\"ch-code-line-number\">_<!-- -->40</span><div style=\"display:inline-block;margin-left:16px\"><span>                img_emb4,</span></div></div><div><span class=\"ch-code-line-number\">_<!-- -->40</span><div style=\"display:inline-block;margin-left:16px\"><span>                {\"type\": \"jpg\"}</span></div></div><div><span class=\"ch-code-line-number\">_<!-- -->40</span><div style=\"display:inline-block;margin-left:16px\"><span>            )</span></div></div><div><span class=\"ch-code-line-number\">_<!-- -->40</span><div style=\"display:inline-block;margin-left:16px\"><span>        ]</span></div></div><div><span class=\"ch-code-line-number\">_<!-- -->40</span><div style=\"display:inline-block;margin-left:16px\"><span>    )</span></div></div><div><span class=\"ch-code-line-number\">_<!-- -->40</span><div style=\"display:inline-block;margin-left:16px\"><span>    print(\"Inserted images\")</span></div></div><div><span class=\"ch-code-line-number\">_<!-- -->40</span><div style=\"display:inline-block;margin-left:16px\"><span></span></div></div><div><span class=\"ch-code-line-number\">_<!-- -->40</span><div style=\"display:inline-block;margin-left:16px\"><span>    # index the collection for fast search performance</span></div></div><div><span class=\"ch-code-line-number\">_<!-- -->40</span><div style=\"display:inline-block;margin-left:16px\"><span>    images.create_index()</span></div></div><div><span class=\"ch-code-line-number\">_<!-- -->40</span><div style=\"display:inline-block;margin-left:16px\"><span>    print(\"Created index\")</span></div></div><br></code></div></div>\n<p>Add this method as a script in your <code>pyproject.toml</code> file:</p>\n<div class=\"ch-codeblock not-prose \" data-ch-theme=\"supabase\"><div class=\"ch-code-wrapper ch-code\" data-ch-measured=\"false\"><code class=\"ch-code-scroll-parent\"><br><div><span class=\"ch-code-line-number\">_<!-- -->10</span><div style=\"display:inline-block;margin-left:16px\"><span>[tool.poetry.scripts]</span></div></div><div><span class=\"ch-code-line-number\">_<!-- -->10</span><div style=\"display:inline-block;margin-left:16px\"><span>seed = \"image_search.main:seed\"</span></div></div><div><span class=\"ch-code-line-number\">_<!-- -->10</span><div style=\"display:inline-block;margin-left:16px\"><span>search = \"image_search.main:search\"</span></div></div><br></code></div></div>\n<p>After activating the virtual environtment with <code>poetry shell</code> you can now run your seed script via <code>poetry run seed</code>. You can inspect the generated embeddings in your Supabase Dashboard by visiting the <a href=\"https://supabase.com/dashboard/project/_/editor\">Table Editor</a>, selecting the <code>vecs</code> schema, and the <code>image_vectors</code> table.</p>\n<h2 id=\"perform-an-image-search-from-a-text-query\" class=\"group scroll-mt-24\">Perform an image search from a text query<a href=\"#perform-an-image-search-from-a-text-query\" aria-hidden=\"true\" class=\"ml-2 opacity-0 group-hover:opacity-100 transition\"><span aria-hidden=\"true\">#</span></a></h2>\n<p>With Supabase Vector we can easily query our embeddings. We can use either an image as the search input or alternatively we can generate an embedding from a string input and use that as the query input:</p>\n<div class=\"ch-codeblock not-prose \" data-ch-theme=\"supabase\"><div class=\"ch-code-wrapper ch-code\" data-ch-measured=\"false\"><code class=\"ch-code-scroll-parent\"><br><div><span class=\"ch-code-line-number\">_<!-- -->28</span><div style=\"display:inline-block;margin-left:16px\"><span>def search(query_term: Optional[str] = None):</span></div></div><div><span class=\"ch-code-line-number\">_<!-- -->28</span><div style=\"display:inline-block;margin-left:16px\"><span>    if query_term is None:</span></div></div><div><span class=\"ch-code-line-number\">_<!-- -->28</span><div style=\"display:inline-block;margin-left:16px\"><span>        query_term = sys.argv[1]</span></div></div><div><span class=\"ch-code-line-number\">_<!-- -->28</span><div style=\"display:inline-block;margin-left:16px\"><span></span></div></div><div><span class=\"ch-code-line-number\">_<!-- -->28</span><div style=\"display:inline-block;margin-left:16px\"><span>    # create vector store client</span></div></div><div><span class=\"ch-code-line-number\">_<!-- -->28</span><div style=\"display:inline-block;margin-left:16px\"><span>    vx = vecs.create_client(DB_CONNECTION)</span></div></div><div><span class=\"ch-code-line-number\">_<!-- -->28</span><div style=\"display:inline-block;margin-left:16px\"><span>    images = vx.get_or_create_collection(name=\"image_vectors\", dimension=1024)</span></div></div><div><span class=\"ch-code-line-number\">_<!-- -->28</span><div style=\"display:inline-block;margin-left:16px\"><span></span></div></div><div><span class=\"ch-code-line-number\">_<!-- -->28</span><div style=\"display:inline-block;margin-left:16px\"><span>    # Encode text query</span></div></div><div><span class=\"ch-code-line-number\">_<!-- -->28</span><div style=\"display:inline-block;margin-left:16px\"><span>    text_emb = get_embedding_from_titan_multimodal(json.dumps(</span></div></div><div><span class=\"ch-code-line-number\">_<!-- -->28</span><div style=\"display:inline-block;margin-left:16px\"><span>        {</span></div></div><div><span class=\"ch-code-line-number\">_<!-- -->28</span><div style=\"display:inline-block;margin-left:16px\"><span>            \"inputText\": query_term,</span></div></div><div><span class=\"ch-code-line-number\">_<!-- -->28</span><div style=\"display:inline-block;margin-left:16px\"><span>            \"embeddingConfig\": {\"outputEmbeddingLength\": 1024},</span></div></div><div><span class=\"ch-code-line-number\">_<!-- -->28</span><div style=\"display:inline-block;margin-left:16px\"><span>        }</span></div></div><div><span class=\"ch-code-line-number\">_<!-- -->28</span><div style=\"display:inline-block;margin-left:16px\"><span>    ))</span></div></div><div><span class=\"ch-code-line-number\">_<!-- -->28</span><div style=\"display:inline-block;margin-left:16px\"><span></span></div></div><div><span class=\"ch-code-line-number\">_<!-- -->28</span><div style=\"display:inline-block;margin-left:16px\"><span>    # query the collection filtering metadata for \"type\" = \"jpg\"</span></div></div><div><span class=\"ch-code-line-number\">_<!-- -->28</span><div style=\"display:inline-block;margin-left:16px\"><span>    results = images.query(</span></div></div><div><span class=\"ch-code-line-number\">_<!-- -->28</span><div style=\"display:inline-block;margin-left:16px\"><span>        data=text_emb,                      # required</span></div></div><div><span class=\"ch-code-line-number\">_<!-- -->28</span><div style=\"display:inline-block;margin-left:16px\"><span>        limit=1,                            # number of records to return</span></div></div><div><span class=\"ch-code-line-number\">_<!-- -->28</span><div style=\"display:inline-block;margin-left:16px\"><span>        filters={\"type\": {\"$eq\": \"jpg\"}},   # metadata filters</span></div></div><div><span class=\"ch-code-line-number\">_<!-- -->28</span><div style=\"display:inline-block;margin-left:16px\"><span>    )</span></div></div><div><span class=\"ch-code-line-number\">_<!-- -->28</span><div style=\"display:inline-block;margin-left:16px\"><span>    result = results[0]</span></div></div><div><span class=\"ch-code-line-number\">_<!-- -->28</span><div style=\"display:inline-block;margin-left:16px\"><span>    print(result)</span></div></div><div><span class=\"ch-code-line-number\">_<!-- -->28</span><div style=\"display:inline-block;margin-left:16px\"><span>    plt.title(result)</span></div></div><div><span class=\"ch-code-line-number\">_<!-- -->28</span><div style=\"display:inline-block;margin-left:16px\"><span>    image = mpimg.imread('./images/' + result)</span></div></div><div><span class=\"ch-code-line-number\">_<!-- -->28</span><div style=\"display:inline-block;margin-left:16px\"><span>    plt.imshow(image)</span></div></div><div><span class=\"ch-code-line-number\">_<!-- -->28</span><div style=\"display:inline-block;margin-left:16px\"><span>    plt.show()</span></div></div><br></code></div></div>\n<p>By limiting the query to one result, we can show the most relevant image to the user. Finally we use <code>matplotlib</code> to show the image result to the user.</p>\n<p>That's it, go ahead and test it out by running <code>poetry run search</code> and you will be presented with an image of a \"bike in front of a red brick wall\".</p>\n<h2 id=\"conclusion\" class=\"group scroll-mt-24\">Conclusion<a href=\"#conclusion\" aria-hidden=\"true\" class=\"ml-2 opacity-0 group-hover:opacity-100 transition\"><span aria-hidden=\"true\">#</span></a></h2>\n<p>With just a couple of lines of Python you are able to implement image search as well as reverse image search using the Amazon Titan multimodal model and Supabase Vector.</p></article></div></div></div><!--$--><div class=\"max-w-7xl px-5 mx-auto py-8 pt-0\"></div><!--/$--></div><div class=\"left-0 right-0 z-10 backdrop-blur-sm backdrop-filter bg-alternative/90 hidden h-0 lg:hidden\"></div></div></main></div></div></div></div></body></html>",
      "metadata": {
        "ogUrl": "https://supabase.com/docs/guides/ai/examples/semantic-image-search-amazon-titan",
        "title": "Semantic Image Search with Amazon Titan | Supabase Docs",
        "robots": "index, follow",
        "ogImage": "https://obuldanrptloktxcffvn.supabase.co/functions/v1/og-images?site=docs&type=ai&title=Semantic%20Image%20Search%20with%20Amazon%20Titan&description=Implement%20semantic%20image%20search%20with%20Amazon%20Titan%20and%20Supabase%20Vector%20in%20Python.",
        "ogTitle": "Semantic Image Search with Amazon Titan | Supabase Docs",
        "language": "en",
        "sourceURL": "https://supabase.com/docs/guides/ai/examples/semantic-image-search-amazon-titan",
        "description": "Implement semantic image search with Amazon Titan and Supabase Vector in Python.",
        "modifiedTime": "2024-09-10T20:36:24.564Z",
        "ogDescription": "Implement semantic image search with Amazon Titan and Supabase Vector in Python.",
        "publishedTime": "2024-09-10T20:36:24.564Z",
        "ogLocaleAlternate": [],
        "statusCode": 200
      }
    },
    {
      "markdown": "AI & Vectors\n\n# Amazon Bedrock\n\n* * *\n\n[Amazon Bedrock](https://aws.amazon.com/bedrock) is a fully managed service that offers a choice of high-performing foundation models (FMs) from leading AI companies like AI21 Labs, Anthropic, Cohere, Meta, Mistral AI, Stability AI, and Amazon. Each model is accessible through a common API which implements a broad set of features to help build generative AI applications with security, privacy, and responsible AI in mind.\n\nThis guide will walk you through an example using Amazon Bedrock SDK with `vecs`. We will create embeddings using the Amazon Titan Embeddings G1 \u2013 Text v1.2 (amazon.titan-embed-text-v1) model, insert these embeddings into a PostgreSQL database using vecs, and then query the collection to find the most similar sentences to a given query sentence.\n\n## Create an Environment [\\#](\\#create-an-environment)\n\nFirst, you need to set up your environment. You will need Python 3.7+ with the `vecs` and `boto3` libraries installed.\n\nYou can install the necessary Python libraries using pip:\n\n`\n_10\npip install vecs boto3\n`\n\nYou'll also need:\n\n- [Credentials to your AWS account](https://boto3.amazonaws.com/v1/documentation/api/latest/guide/credentials.html)\n- [A Postgres Database with the pgvector extension](hosting.md)\n\n## Create Embeddings [\\#](\\#create-embeddings)\n\nNext, we will use Amazon\u2019s Titan Embedding G1 - Text v1.2 model to create embeddings for a set of sentences.\n\n`\n_34\nimport boto3\n_34\nimport vecs\n_34\nimport json\n_34\n_34\nclient = boto3.client(\n_34\n    'bedrock-runtime',\n_34\n    region_name='us-east-1',\n_34\n\t# Credentials from your AWS account\n_34\n    aws_access_key_id='<replace_your_own_credentials>',\n_34\n    aws_secret_access_key='<replace_your_own_credentials>',\n_34\n    aws_session_token='<replace_your_own_credentials>',\n_34\n)\n_34\n_34\ndataset = [\\\n_34\\\n    \"The cat sat on the mat.\",\\\n_34\\\n    \"The quick brown fox jumps over the lazy dog.\",\\\n_34\\\n    \"Friends, Romans, countrymen, lend me your ears\",\\\n_34\\\n    \"To be or not to be, that is the question.\",\\\n_34\\\n]\n_34\n_34\nembeddings = []\n_34\n_34\nfor sentence in dataset:\n_34\n    # invoke the embeddings model for each sentence\n_34\n    response = client.invoke_model(\n_34\n        body= json.dumps({\"inputText\": sentence}),\n_34\n        modelId= \"amazon.titan-embed-text-v1\",\n_34\n        accept = \"application/json\",\n_34\n        contentType = \"application/json\"\n_34\n    )\n_34\n    # collect the embedding from the response\n_34\n    response_body = json.loads(response[\"body\"].read())\n_34\n    # add the embedding to the embedding list\n_34\n    embeddings.append((sentence, response_body.get(\"embedding\"), {}))\n`\n\n### Store the Embeddings with vecs [\\#](\\#store-the-embeddings-with-vecs)\n\nNow that we have our embeddings, we can insert them into a PostgreSQL database using vecs.\n\n`\n_16\nimport vecs\n_16\n_16\nDB_CONNECTION = \"postgresql://<user>:<password>@<host>:<port>/<db_name>\"\n_16\n_16\n# create vector store client\n_16\nvx = vecs.Client(DB_CONNECTION)\n_16\n_16\n# create a collection named 'sentences' with 1536 dimensional vectors\n_16\n# to match the default dimension of the Titan Embeddings G1 - Text model\n_16\nsentences = vx.get_or_create_collection(name=\"sentences\", dimension=1536)\n_16\n_16\n# upsert the embeddings into the 'sentences' collection\n_16\nsentences.upsert(records=embeddings)\n_16\n_16\n# create an index for the 'sentences' collection\n_16\nsentences.create_index()\n`\n\n### Querying for Most Similar Sentences [\\#](\\#querying-for-most-similar-sentences)\n\nNow, we query the `sentences` collection to find the most similar sentences to a sample query sentence. First need to create an embedding for the query sentence. Next, we query the collection we created earlier to find the most similar sentences.\n\n`\n_27\nquery_sentence = \"A quick animal jumps over a lazy one.\"\n_27\n_27\n# create vector store client\n_27\nvx = vecs.Client(DB_CONNECTION)\n_27\n_27\n# create an embedding for the query sentence\n_27\nresponse = client.invoke_model(\n_27\n        body= json.dumps({\"inputText\": query_sentence}),\n_27\n        modelId= \"amazon.titan-embed-text-v1\",\n_27\n        accept = \"application/json\",\n_27\n        contentType = \"application/json\"\n_27\n    )\n_27\n_27\nresponse_body = json.loads(response[\"body\"].read())\n_27\n_27\nquery_embedding = response_body.get(\"embedding\")\n_27\n_27\n# query the 'sentences' collection for the most similar sentences\n_27\nresults = sentences.query(\n_27\n    data=query_embedding,\n_27\n    limit=3,\n_27\n    include_value = True\n_27\n)\n_27\n_27\n# print the results\n_27\nfor result in results:\n_27\n    print(result)\n`\n\nThis returns the most similar 3 records and their distance to the query vector.\n\n`\n_10\n('The quick brown fox jumps over the lazy dog.', 0.27600620558852)\n_10\n('The cat sat on the mat.', 0.609986272479202)\n_10\n('To be or not to be, that is the question.', 0.744849503688346)\n`\n\n## Resources [\\#](\\#resources)\n\n- [Amazon Bedrock](https://aws.amazon.com/bedrock)\n- [Amazon Titan](https://aws.amazon.com/bedrock/titan)\n- [Semantic Image Search with Amazon Titan](/docs/guides/ai/examples/semantic-image-search-amazon-titan)",
      "html": "<!DOCTYPE html><html lang=\"en\" data-theme=\"light\" style=\"color-scheme: light;\"><body><div class=\"flex flex-col\"><div class=\"grow\"><div class=\"flex flex-col h-full w-full\"><div class=\"hidden lg:sticky w-full lg:flex top-0 left-0 right-0 z-50\"><!--$--><!--/$--></div><div class=\"flex flex-row h-full relative\"><main id=\"docs-content-container\" class=\"w-full transition-all ease-out relative lg:ml-0\"><div class=\"flex flex-col sticky top-0\"><div class=\"flex lg:hidden w-full top-0 left-0 right-0 z-50\"><!--$--><!--/$--></div><div class=\"sticky transition-all top-0 z-10 backdrop-blur backdrop-filter bg-background\"><div class=\"lg:hidden px-3.5 border-b z-10 transition-all ease-out top-0 flex items-center gap-1\"><button class=\"h-8 w-8 flex group items-center justify-center mr-1\"><div class=\"space-y-1 cursor-pointer relative w-4 h-[8px]\"><span class=\"transition-all ease-out block h-px bg-foreground-muted group-hover:bg-foreground w-4\"></span><span class=\"transition-all ease-out block h-px bg-foreground-muted group-hover:bg-foreground w-3 group-hover:w-4\"></span></div></button><span class=\"transition-all duration-200 text-foreground text-sm\">AI &amp; Vectors</span></div></div><div class=\"grow\"><div class=\"max-w-7xl px-5 mx-auto py-8 pb-0\"><div class=\"grid grid-cols-12 relative gap-4\"><div class=\"relative transition-all ease-out duration-100 col-span-12 md:col-span-9\"><article id=\"sb-docs-guide-main-article\" class=\"prose max-w-none\"><h1 class=\"mb-0\">Amazon Bedrock</h1><hr class=\"not-prose border-t-0 border-b my-8\">\n<p><a href=\"https://aws.amazon.com/bedrock\">Amazon Bedrock</a> is a fully managed service that offers a choice of high-performing foundation models (FMs) from leading AI companies like AI21 Labs, Anthropic, Cohere, Meta, Mistral AI, Stability AI, and Amazon. Each model is accessible through a common API which implements a broad set of features to help build generative AI applications with security, privacy, and responsible AI in mind.</p>\n<p>This guide will walk you through an example using Amazon Bedrock SDK with <code>vecs</code>. We will create embeddings using the Amazon Titan Embeddings G1 \u2013 Text v1.2 (amazon.titan-embed-text-v1) model, insert these embeddings into a PostgreSQL database using vecs, and then query the collection to find the most similar sentences to a given query sentence.</p>\n<h2 id=\"create-an-environment\" class=\"group scroll-mt-24\">Create an Environment<a href=\"#create-an-environment\" aria-hidden=\"true\" class=\"ml-2 opacity-0 group-hover:opacity-100 transition\"><span aria-hidden=\"true\">#</span></a></h2>\n<p>First, you need to set up your environment. You will need Python 3.7+ with the <code>vecs</code> and <code>boto3</code> libraries installed.</p>\n<p>You can install the necessary Python libraries using pip:</p>\n<div class=\"ch-codeblock not-prose \" data-ch-theme=\"supabase\"><div class=\"ch-code-wrapper ch-code\" data-ch-measured=\"false\"><code class=\"ch-code-scroll-parent\"><br><div><span class=\"ch-code-line-number\">_<!-- -->10</span><div style=\"display:inline-block;margin-left:16px\"><span>pip install vecs boto3</span></div></div><br></code></div></div>\n<p>You'll also need:</p>\n<ul>\n<li><a href=\"https://boto3.amazonaws.com/v1/documentation/api/latest/guide/credentials.html\">Credentials to your AWS account</a></li>\n<li><a href=\"hosting.md\">A Postgres Database with the pgvector extension</a></li>\n</ul>\n<h2 id=\"create-embeddings\" class=\"group scroll-mt-24\">Create Embeddings<a href=\"#create-embeddings\" aria-hidden=\"true\" class=\"ml-2 opacity-0 group-hover:opacity-100 transition\"><span aria-hidden=\"true\">#</span></a></h2>\n<p>Next, we will use Amazon\u2019s Titan Embedding G1 - Text v1.2 model to create embeddings for a set of sentences.</p>\n<div class=\"ch-codeblock not-prose \" data-ch-theme=\"supabase\"><div class=\"ch-code-wrapper ch-code\" data-ch-measured=\"false\"><code class=\"ch-code-scroll-parent\"><br><div><span class=\"ch-code-line-number\">_<!-- -->34</span><div style=\"display:inline-block;margin-left:16px\"><span>import boto3</span></div></div><div><span class=\"ch-code-line-number\">_<!-- -->34</span><div style=\"display:inline-block;margin-left:16px\"><span>import vecs</span></div></div><div><span class=\"ch-code-line-number\">_<!-- -->34</span><div style=\"display:inline-block;margin-left:16px\"><span>import json</span></div></div><div><span class=\"ch-code-line-number\">_<!-- -->34</span><div style=\"display:inline-block;margin-left:16px\"><span></span></div></div><div><span class=\"ch-code-line-number\">_<!-- -->34</span><div style=\"display:inline-block;margin-left:16px\"><span>client = boto3.client(</span></div></div><div><span class=\"ch-code-line-number\">_<!-- -->34</span><div style=\"display:inline-block;margin-left:16px\"><span>    'bedrock-runtime',</span></div></div><div><span class=\"ch-code-line-number\">_<!-- -->34</span><div style=\"display:inline-block;margin-left:16px\"><span>    region_name='us-east-1',</span></div></div><div><span class=\"ch-code-line-number\">_<!-- -->34</span><div style=\"display:inline-block;margin-left:16px\"><span>\t# Credentials from your AWS account</span></div></div><div><span class=\"ch-code-line-number\">_<!-- -->34</span><div style=\"display:inline-block;margin-left:16px\"><span>    aws_access_key_id='&lt;replace_your_own_credentials&gt;',</span></div></div><div><span class=\"ch-code-line-number\">_<!-- -->34</span><div style=\"display:inline-block;margin-left:16px\"><span>    aws_secret_access_key='&lt;replace_your_own_credentials&gt;',</span></div></div><div><span class=\"ch-code-line-number\">_<!-- -->34</span><div style=\"display:inline-block;margin-left:16px\"><span>    aws_session_token='&lt;replace_your_own_credentials&gt;',</span></div></div><div><span class=\"ch-code-line-number\">_<!-- -->34</span><div style=\"display:inline-block;margin-left:16px\"><span>)</span></div></div><div><span class=\"ch-code-line-number\">_<!-- -->34</span><div style=\"display:inline-block;margin-left:16px\"><span></span></div></div><div><span class=\"ch-code-line-number\">_<!-- -->34</span><div style=\"display:inline-block;margin-left:16px\"><span>dataset = [</span></div></div><div><span class=\"ch-code-line-number\">_<!-- -->34</span><div style=\"display:inline-block;margin-left:16px\"><span>    \"The cat sat on the mat.\",</span></div></div><div><span class=\"ch-code-line-number\">_<!-- -->34</span><div style=\"display:inline-block;margin-left:16px\"><span>    \"The quick brown fox jumps over the lazy dog.\",</span></div></div><div><span class=\"ch-code-line-number\">_<!-- -->34</span><div style=\"display:inline-block;margin-left:16px\"><span>    \"Friends, Romans, countrymen, lend me your ears\",</span></div></div><div><span class=\"ch-code-line-number\">_<!-- -->34</span><div style=\"display:inline-block;margin-left:16px\"><span>    \"To be or not to be, that is the question.\",</span></div></div><div><span class=\"ch-code-line-number\">_<!-- -->34</span><div style=\"display:inline-block;margin-left:16px\"><span>]</span></div></div><div><span class=\"ch-code-line-number\">_<!-- -->34</span><div style=\"display:inline-block;margin-left:16px\"><span></span></div></div><div><span class=\"ch-code-line-number\">_<!-- -->34</span><div style=\"display:inline-block;margin-left:16px\"><span>embeddings = []</span></div></div><div><span class=\"ch-code-line-number\">_<!-- -->34</span><div style=\"display:inline-block;margin-left:16px\"><span></span></div></div><div><span class=\"ch-code-line-number\">_<!-- -->34</span><div style=\"display:inline-block;margin-left:16px\"><span>for sentence in dataset:</span></div></div><div><span class=\"ch-code-line-number\">_<!-- -->34</span><div style=\"display:inline-block;margin-left:16px\"><span>    # invoke the embeddings model for each sentence</span></div></div><div><span class=\"ch-code-line-number\">_<!-- -->34</span><div style=\"display:inline-block;margin-left:16px\"><span>    response = client.invoke_model(</span></div></div><div><span class=\"ch-code-line-number\">_<!-- -->34</span><div style=\"display:inline-block;margin-left:16px\"><span>        body= json.dumps({\"inputText\": sentence}),</span></div></div><div><span class=\"ch-code-line-number\">_<!-- -->34</span><div style=\"display:inline-block;margin-left:16px\"><span>        modelId= \"amazon.titan-embed-text-v1\",</span></div></div><div><span class=\"ch-code-line-number\">_<!-- -->34</span><div style=\"display:inline-block;margin-left:16px\"><span>        accept = \"application/json\",</span></div></div><div><span class=\"ch-code-line-number\">_<!-- -->34</span><div style=\"display:inline-block;margin-left:16px\"><span>        contentType = \"application/json\"</span></div></div><div><span class=\"ch-code-line-number\">_<!-- -->34</span><div style=\"display:inline-block;margin-left:16px\"><span>    )</span></div></div><div><span class=\"ch-code-line-number\">_<!-- -->34</span><div style=\"display:inline-block;margin-left:16px\"><span>    # collect the embedding from the response</span></div></div><div><span class=\"ch-code-line-number\">_<!-- -->34</span><div style=\"display:inline-block;margin-left:16px\"><span>    response_body = json.loads(response[\"body\"].read())</span></div></div><div><span class=\"ch-code-line-number\">_<!-- -->34</span><div style=\"display:inline-block;margin-left:16px\"><span>    # add the embedding to the embedding list</span></div></div><div><span class=\"ch-code-line-number\">_<!-- -->34</span><div style=\"display:inline-block;margin-left:16px\"><span>    embeddings.append((sentence, response_body.get(\"embedding\"), {}))</span></div></div><br></code></div></div>\n<h3 id=\"store-the-embeddings-with-vecs\" class=\"group scroll-mt-24\">Store the Embeddings with vecs<a href=\"#store-the-embeddings-with-vecs\" aria-hidden=\"true\" class=\"ml-2 opacity-0 group-hover:opacity-100 transition\"><span aria-hidden=\"true\">#</span></a></h3>\n<p>Now that we have our embeddings, we can insert them into a PostgreSQL database using vecs.</p>\n<div class=\"ch-codeblock not-prose \" data-ch-theme=\"supabase\"><div class=\"ch-code-wrapper ch-code\" data-ch-measured=\"false\"><code class=\"ch-code-scroll-parent\"><br><div><span class=\"ch-code-line-number\">_<!-- -->16</span><div style=\"display:inline-block;margin-left:16px\"><span>import vecs</span></div></div><div><span class=\"ch-code-line-number\">_<!-- -->16</span><div style=\"display:inline-block;margin-left:16px\"><span></span></div></div><div><span class=\"ch-code-line-number\">_<!-- -->16</span><div style=\"display:inline-block;margin-left:16px\"><span>DB_CONNECTION = \"postgresql://&lt;user&gt;:&lt;password&gt;@&lt;host&gt;:&lt;port&gt;/&lt;db_name&gt;\"</span></div></div><div><span class=\"ch-code-line-number\">_<!-- -->16</span><div style=\"display:inline-block;margin-left:16px\"><span></span></div></div><div><span class=\"ch-code-line-number\">_<!-- -->16</span><div style=\"display:inline-block;margin-left:16px\"><span># create vector store client</span></div></div><div><span class=\"ch-code-line-number\">_<!-- -->16</span><div style=\"display:inline-block;margin-left:16px\"><span>vx = vecs.Client(DB_CONNECTION)</span></div></div><div><span class=\"ch-code-line-number\">_<!-- -->16</span><div style=\"display:inline-block;margin-left:16px\"><span></span></div></div><div><span class=\"ch-code-line-number\">_<!-- -->16</span><div style=\"display:inline-block;margin-left:16px\"><span># create a collection named 'sentences' with 1536 dimensional vectors</span></div></div><div><span class=\"ch-code-line-number\">_<!-- -->16</span><div style=\"display:inline-block;margin-left:16px\"><span># to match the default dimension of the Titan Embeddings G1 - Text model</span></div></div><div><span class=\"ch-code-line-number\">_<!-- -->16</span><div style=\"display:inline-block;margin-left:16px\"><span>sentences = vx.get_or_create_collection(name=\"sentences\", dimension=1536)</span></div></div><div><span class=\"ch-code-line-number\">_<!-- -->16</span><div style=\"display:inline-block;margin-left:16px\"><span></span></div></div><div><span class=\"ch-code-line-number\">_<!-- -->16</span><div style=\"display:inline-block;margin-left:16px\"><span># upsert the embeddings into the 'sentences' collection</span></div></div><div><span class=\"ch-code-line-number\">_<!-- -->16</span><div style=\"display:inline-block;margin-left:16px\"><span>sentences.upsert(records=embeddings)</span></div></div><div><span class=\"ch-code-line-number\">_<!-- -->16</span><div style=\"display:inline-block;margin-left:16px\"><span></span></div></div><div><span class=\"ch-code-line-number\">_<!-- -->16</span><div style=\"display:inline-block;margin-left:16px\"><span># create an index for the 'sentences' collection</span></div></div><div><span class=\"ch-code-line-number\">_<!-- -->16</span><div style=\"display:inline-block;margin-left:16px\"><span>sentences.create_index()</span></div></div><br></code></div></div>\n<h3 id=\"querying-for-most-similar-sentences\" class=\"group scroll-mt-24\">Querying for Most Similar Sentences<a href=\"#querying-for-most-similar-sentences\" aria-hidden=\"true\" class=\"ml-2 opacity-0 group-hover:opacity-100 transition\"><span aria-hidden=\"true\">#</span></a></h3>\n<p>Now, we query the <code>sentences</code> collection to find the most similar sentences to a sample query sentence. First need to create an embedding for the query sentence. Next, we query the collection we created earlier to find the most similar sentences.</p>\n<div class=\"ch-codeblock not-prose \" data-ch-theme=\"supabase\"><div class=\"ch-code-wrapper ch-code\" data-ch-measured=\"false\"><code class=\"ch-code-scroll-parent\"><br><div><span class=\"ch-code-line-number\">_<!-- -->27</span><div style=\"display:inline-block;margin-left:16px\"><span>query_sentence = \"A quick animal jumps over a lazy one.\"</span></div></div><div><span class=\"ch-code-line-number\">_<!-- -->27</span><div style=\"display:inline-block;margin-left:16px\"><span></span></div></div><div><span class=\"ch-code-line-number\">_<!-- -->27</span><div style=\"display:inline-block;margin-left:16px\"><span># create vector store client</span></div></div><div><span class=\"ch-code-line-number\">_<!-- -->27</span><div style=\"display:inline-block;margin-left:16px\"><span>vx = vecs.Client(DB_CONNECTION)</span></div></div><div><span class=\"ch-code-line-number\">_<!-- -->27</span><div style=\"display:inline-block;margin-left:16px\"><span></span></div></div><div><span class=\"ch-code-line-number\">_<!-- -->27</span><div style=\"display:inline-block;margin-left:16px\"><span># create an embedding for the query sentence</span></div></div><div><span class=\"ch-code-line-number\">_<!-- -->27</span><div style=\"display:inline-block;margin-left:16px\"><span>response = client.invoke_model(</span></div></div><div><span class=\"ch-code-line-number\">_<!-- -->27</span><div style=\"display:inline-block;margin-left:16px\"><span>        body= json.dumps({\"inputText\": query_sentence}),</span></div></div><div><span class=\"ch-code-line-number\">_<!-- -->27</span><div style=\"display:inline-block;margin-left:16px\"><span>        modelId= \"amazon.titan-embed-text-v1\",</span></div></div><div><span class=\"ch-code-line-number\">_<!-- -->27</span><div style=\"display:inline-block;margin-left:16px\"><span>        accept = \"application/json\",</span></div></div><div><span class=\"ch-code-line-number\">_<!-- -->27</span><div style=\"display:inline-block;margin-left:16px\"><span>        contentType = \"application/json\"</span></div></div><div><span class=\"ch-code-line-number\">_<!-- -->27</span><div style=\"display:inline-block;margin-left:16px\"><span>    )</span></div></div><div><span class=\"ch-code-line-number\">_<!-- -->27</span><div style=\"display:inline-block;margin-left:16px\"><span></span></div></div><div><span class=\"ch-code-line-number\">_<!-- -->27</span><div style=\"display:inline-block;margin-left:16px\"><span>response_body = json.loads(response[\"body\"].read())</span></div></div><div><span class=\"ch-code-line-number\">_<!-- -->27</span><div style=\"display:inline-block;margin-left:16px\"><span></span></div></div><div><span class=\"ch-code-line-number\">_<!-- -->27</span><div style=\"display:inline-block;margin-left:16px\"><span>query_embedding = response_body.get(\"embedding\")</span></div></div><div><span class=\"ch-code-line-number\">_<!-- -->27</span><div style=\"display:inline-block;margin-left:16px\"><span></span></div></div><div><span class=\"ch-code-line-number\">_<!-- -->27</span><div style=\"display:inline-block;margin-left:16px\"><span># query the 'sentences' collection for the most similar sentences</span></div></div><div><span class=\"ch-code-line-number\">_<!-- -->27</span><div style=\"display:inline-block;margin-left:16px\"><span>results = sentences.query(</span></div></div><div><span class=\"ch-code-line-number\">_<!-- -->27</span><div style=\"display:inline-block;margin-left:16px\"><span>    data=query_embedding,</span></div></div><div><span class=\"ch-code-line-number\">_<!-- -->27</span><div style=\"display:inline-block;margin-left:16px\"><span>    limit=3,</span></div></div><div><span class=\"ch-code-line-number\">_<!-- -->27</span><div style=\"display:inline-block;margin-left:16px\"><span>    include_value = True</span></div></div><div><span class=\"ch-code-line-number\">_<!-- -->27</span><div style=\"display:inline-block;margin-left:16px\"><span>)</span></div></div><div><span class=\"ch-code-line-number\">_<!-- -->27</span><div style=\"display:inline-block;margin-left:16px\"><span></span></div></div><div><span class=\"ch-code-line-number\">_<!-- -->27</span><div style=\"display:inline-block;margin-left:16px\"><span># print the results</span></div></div><div><span class=\"ch-code-line-number\">_<!-- -->27</span><div style=\"display:inline-block;margin-left:16px\"><span>for result in results:</span></div></div><div><span class=\"ch-code-line-number\">_<!-- -->27</span><div style=\"display:inline-block;margin-left:16px\"><span>    print(result)</span></div></div><br></code></div></div>\n<p>This returns the most similar 3 records and their distance to the query vector.</p>\n<div class=\"ch-codeblock not-prose \" data-ch-theme=\"supabase\"><div class=\"ch-code-wrapper ch-code\" data-ch-measured=\"false\"><code class=\"ch-code-scroll-parent\"><br><div><span class=\"ch-code-line-number\">_<!-- -->10</span><div style=\"display:inline-block;margin-left:16px\"><span>('The quick brown fox jumps over the lazy dog.', 0.27600620558852)</span></div></div><div><span class=\"ch-code-line-number\">_<!-- -->10</span><div style=\"display:inline-block;margin-left:16px\"><span>('The cat sat on the mat.', 0.609986272479202)</span></div></div><div><span class=\"ch-code-line-number\">_<!-- -->10</span><div style=\"display:inline-block;margin-left:16px\"><span>('To be or not to be, that is the question.', 0.744849503688346)</span></div></div><br></code></div></div>\n<h2 id=\"resources\" class=\"group scroll-mt-24\">Resources<a href=\"#resources\" aria-hidden=\"true\" class=\"ml-2 opacity-0 group-hover:opacity-100 transition\"><span aria-hidden=\"true\">#</span></a></h2>\n<ul>\n<li><a href=\"https://aws.amazon.com/bedrock\">Amazon Bedrock</a></li>\n<li><a href=\"https://aws.amazon.com/bedrock/titan\">Amazon Titan</a></li>\n<li><a href=\"/docs/guides/ai/examples/semantic-image-search-amazon-titan\">Semantic Image Search with Amazon Titan</a></li>\n</ul></article></div></div></div><!--$--><div class=\"max-w-7xl px-5 mx-auto py-8 pt-0\"></div><!--/$--></div><div class=\"left-0 right-0 z-10 backdrop-blur-sm backdrop-filter bg-alternative/90 hidden h-0 lg:hidden\"></div></div></main></div></div></div></div></body></html>",
      "metadata": {
        "ogUrl": "https://supabase.com/docs/guides/ai/integrations/amazon-bedrock",
        "title": "Amazon Bedrock | Supabase Docs",
        "robots": "index, follow",
        "ogImage": "https://obuldanrptloktxcffvn.supabase.co/functions/v1/og-images?site=docs&type=ai&title=Amazon%20Bedrock&description=Learn%20how%20to%20integrate%20Supabase%20with%20Amazon%20Bedrock%2C%20a%20fully%20managed%20service%20of%20high-performing%20foundation%20models.",
        "ogTitle": "Amazon Bedrock | Supabase Docs",
        "language": "en",
        "sourceURL": "https://supabase.com/docs/guides/ai/integrations/amazon-bedrock",
        "description": "Learn how to integrate Supabase with Amazon Bedrock, a fully managed service of high-performing foundation models.",
        "modifiedTime": "2024-09-10T20:36:24.564Z",
        "ogDescription": "Learn how to integrate Supabase with Amazon Bedrock, a fully managed service of high-performing foundation models.",
        "publishedTime": "2024-09-10T20:36:24.564Z",
        "ogLocaleAlternate": [],
        "statusCode": 200
      }
    },
    {
      "markdown": "AI & Vectors\n\n# Google Colab\n\n## Use Google Colab to manage your Supabase Vector store.\n\n* * *\n\n[![](https://supabase.com/docs/img/ai/colab-badge.svg)](https://colab.research.google.com/github/supabase/supabase/blob/master/examples/ai/vector_hello_world.ipynb)\n\nGoogle Colab is a hosted Jupyter Notebook service. It provides free access to computing resources, including GPUs and TPUs, and is well-suited to machine learning, data science, and education. We can use Colab to manage collections using [Supabase Vecs](/docs/guides/ai/vecs-python-client).\n\nIn this tutorial we'll connect to a database running on the Supabase [platform](https://supabase.com/dashboard/). If you don't already have a database, you can create one here: [database.new](https://database.new).\n\n## Create a new notebook [\\#](\\#create-a-new-notebook)\n\nStart by visiting [colab.research.google.com](https://colab.research.google.com/). There you can create a new notebook.\n\n![Google Colab new notebook](https://supabase.com/docs/img/ai/google-colab/colab-new.png)\n\n## Install Vecs [\\#](\\#install-vecs)\n\nWe'll use the Supabase Vector client, [Vecs](/docs/guides/ai/vecs-python-client), to manage our collections.\n\nAt the top of the notebook add the notebook paste the following code and hit the \"execute\" button ( `ctrl+enter`):\n\n`\n_10\npip install vecs\n`\n\n![Install vecs](https://supabase.com/docs/img/ai/google-colab/install-vecs.png)\n\n## Connect to your database [\\#](\\#connect-to-your-database)\n\nFind the Postgres pooler connection string for your Supabase project in the [database settings](https://supabase.com/dashboard/project/_/settings/database) of the dashboard. Copy the \"URI\" format, which should look something like `postgres://postgres.xxxx:password@xxxx.pooler.supabase.com:6543/postgres`\n\nCreate a new code block below the install block ( `ctrl+m b`) and add the following code using the Postgres URI you copied above:\n\n`\n_10\nimport vecs\n_10\n_10\nDB_CONNECTION = \"postgres://postgres.xxxx:password@xxxx.pooler.supabase.com:6543/postgres\"\n_10\n_10\n# create vector store client\n_10\nvx = vecs.create_client(DB_CONNECTION)\n`\n\nExecute the code block ( `ctrl+enter`). If no errors were returned then your connection was successful.\n\n## Create a collection [\\#](\\#create-a-collection)\n\nNow we're going to create a new collection and insert some documents.\n\nCreate a new code block below the install block ( `ctrl+m b`). Add the following code to the code block and execute it ( `ctrl+enter`):\n\n`\n_16\ncollection = vx.get_or_create_collection(name=\"colab_collection\", dimension=3)\n_16\n_16\ncollection.upsert(\n_16\n    vectors=[\\\n_16\\\n        (\\\n_16\\\n         \"vec0\",           # the vector's identifier\\\n_16\\\n         [0.1, 0.2, 0.3],  # the vector. list or np.array\\\n_16\\\n         {\"year\": 1973}    # associated  metadata\\\n_16\\\n        ),\\\n_16\\\n        (\\\n_16\\\n         \"vec1\",\\\n_16\\\n         [0.7, 0.8, 0.9],\\\n_16\\\n         {\"year\": 2012}\\\n_16\\\n        )\\\n_16\\\n    ]\n_16\n)\n`\n\nThis will create a table inside your database within the `vecs` schema, called `colab_collection`. You can view the inserted items in the [Table Editor](https://supabase.com/dashboard/project/_/editor/), by selecting the `vecs` schema from the schema dropdown.\n\n![Colab documents](https://supabase.com/docs/img/ai/google-colab/colab-documents.png)\n\n## Query your documents [\\#](\\#query-your-documents)\n\nNow we can search for documents based on their similarity. Create a new code block and execute the following code:\n\n`\n_10\ncollection.query(\n_10\n    query_vector=[0.4,0.5,0.6],  # required\n_10\n    limit=5,                     # number of records to return\n_10\n    filters={},                  # metadata filters\n_10\n    measure=\"cosine_distance\",   # distance measure to use\n_10\n    include_value=False,         # should distance measure values be returned?\n_10\n    include_metadata=False,      # should record metadata be returned?\n_10\n)\n`\n\nYou will see that this returns two documents in an array `['vec1', 'vec0']`:\n\n![Colab results](https://supabase.com/docs/img/ai/google-colab/colab-results.png)\n\nIt also returns a warning:\n\n`\n_10\nQuery does not have a covering index for cosine_distance.\n`\n\nYou can lean more about creating indexes in the [Vecs documentation](https://supabase.github.io/vecs/api/#create-an-index).\n\n## Resources [\\#](\\#resources)\n\n- Vecs API: [supabase.github.io/vecs/api](https://supabase.github.io/vecs/api)",
      "html": "<!DOCTYPE html><html lang=\"en\" data-theme=\"light\" style=\"color-scheme: light;\"><body><div class=\"flex flex-col\"><div class=\"grow\"><div class=\"flex flex-col h-full w-full\"><div class=\"hidden lg:sticky w-full lg:flex top-0 left-0 right-0 z-50\"><!--$--><!--/$--></div><div class=\"flex flex-row h-full relative\"><main id=\"docs-content-container\" class=\"w-full transition-all ease-out relative lg:ml-0\"><div class=\"flex flex-col sticky top-0\"><div class=\"flex lg:hidden w-full top-0 left-0 right-0 z-50\"><!--$--><!--/$--></div><div class=\"sticky transition-all top-0 z-10 backdrop-blur backdrop-filter bg-background\"><div class=\"lg:hidden px-3.5 border-b z-10 transition-all ease-out top-0 flex items-center gap-1\"><button class=\"h-8 w-8 flex group items-center justify-center mr-1\"><div class=\"space-y-1 cursor-pointer relative w-4 h-[8px]\"><span class=\"transition-all ease-out block h-px bg-foreground-muted group-hover:bg-foreground w-4\"></span><span class=\"transition-all ease-out block h-px bg-foreground-muted group-hover:bg-foreground w-3 group-hover:w-4\"></span></div></button><span class=\"transition-all duration-200 text-foreground text-sm\">AI &amp; Vectors</span></div></div><div class=\"grow\"><div class=\"max-w-7xl px-5 mx-auto py-8 pb-0\"><div class=\"grid grid-cols-12 relative gap-4\"><div class=\"relative transition-all ease-out duration-100 col-span-12 md:col-span-9\"><article id=\"sb-docs-guide-main-article\" class=\"prose max-w-none\"><h1 class=\"mb-0\">Google Colab</h1><h2 class=\"mt-3 text-xl text-foreground-light\">Use Google Colab to manage your Supabase Vector store.</h2><hr class=\"not-prose border-t-0 border-b my-8\">\n<a class=\"w-64\" href=\"https://colab.research.google.com/github/supabase/supabase/blob/master/examples/ai/vector_hello_world.ipynb\"><img src=\"/docs/img/ai/colab-badge.svg\"></a>\n<p>Google Colab is a hosted Jupyter Notebook service. It provides free access to computing resources, including GPUs and TPUs, and is well-suited to machine learning, data science, and education. We can use Colab to manage collections using <a href=\"/docs/guides/ai/vecs-python-client\">Supabase Vecs</a>.</p>\n<p>In this tutorial we'll connect to a database running on the Supabase <a href=\"https://supabase.com/dashboard/\">platform</a>. If you don't already have a database, you can create one here: <a href=\"https://database.new\">database.new</a>.</p>\n<h2 id=\"create-a-new-notebook\" class=\"group scroll-mt-24\">Create a new notebook<a href=\"#create-a-new-notebook\" aria-hidden=\"true\" class=\"ml-2 opacity-0 group-hover:opacity-100 transition\"><span aria-hidden=\"true\">#</span></a></h2>\n<p>Start by visiting <a href=\"https://colab.research.google.com/\">colab.research.google.com</a>. There you can create a new notebook.</p>\n<p><img src=\"/docs/img/ai/google-colab/colab-new.png\" alt=\"Google Colab new notebook\"></p>\n<h2 id=\"install-vecs\" class=\"group scroll-mt-24\">Install Vecs<a href=\"#install-vecs\" aria-hidden=\"true\" class=\"ml-2 opacity-0 group-hover:opacity-100 transition\"><span aria-hidden=\"true\">#</span></a></h2>\n<p>We'll use the Supabase Vector client, <a href=\"/docs/guides/ai/vecs-python-client\">Vecs</a>, to manage our collections.</p>\n<p>At the top of the notebook add the notebook paste the following code and hit the \"execute\" button (<code>ctrl+enter</code>):</p>\n<div class=\"ch-codeblock not-prose \" data-ch-theme=\"supabase\"><div class=\"ch-code-wrapper ch-code\" data-ch-measured=\"false\"><code class=\"ch-code-scroll-parent\"><br><div><span class=\"ch-code-line-number\">_<!-- -->10</span><div style=\"display:inline-block;margin-left:16px\"><span>pip install vecs</span></div></div><br></code></div></div>\n<p><img src=\"/docs/img/ai/google-colab/install-vecs.png\" alt=\"Install vecs\"></p>\n<h2 id=\"connect-to-your-database\" class=\"group scroll-mt-24\">Connect to your database<a href=\"#connect-to-your-database\" aria-hidden=\"true\" class=\"ml-2 opacity-0 group-hover:opacity-100 transition\"><span aria-hidden=\"true\">#</span></a></h2>\n<p>Find the Postgres pooler connection string for your Supabase project in the <a href=\"https://supabase.com/dashboard/project/_/settings/database\">database settings</a> of the dashboard. Copy the \"URI\" format, which should look something like <code>postgres://postgres.xxxx:password@xxxx.pooler.supabase.com:6543/postgres</code></p>\n<p>Create a new code block below the install block (<code>ctrl+m b</code>) and add the following code using the Postgres URI you copied above:</p>\n<div class=\"ch-codeblock not-prose \" data-ch-theme=\"supabase\"><div class=\"ch-code-wrapper ch-code\" data-ch-measured=\"false\"><code class=\"ch-code-scroll-parent\"><br><div><span class=\"ch-code-line-number\">_<!-- -->10</span><div style=\"display:inline-block;margin-left:16px\"><span>import vecs</span></div></div><div><span class=\"ch-code-line-number\">_<!-- -->10</span><div style=\"display:inline-block;margin-left:16px\"><span></span></div></div><div><span class=\"ch-code-line-number\">_<!-- -->10</span><div style=\"display:inline-block;margin-left:16px\"><span>DB_CONNECTION = \"postgres://postgres.xxxx:password@xxxx.pooler.supabase.com:6543/postgres\"</span></div></div><div><span class=\"ch-code-line-number\">_<!-- -->10</span><div style=\"display:inline-block;margin-left:16px\"><span></span></div></div><div><span class=\"ch-code-line-number\">_<!-- -->10</span><div style=\"display:inline-block;margin-left:16px\"><span># create vector store client</span></div></div><div><span class=\"ch-code-line-number\">_<!-- -->10</span><div style=\"display:inline-block;margin-left:16px\"><span>vx = vecs.create_client(DB_CONNECTION)</span></div></div><br></code></div></div>\n<p>Execute the code block (<code>ctrl+enter</code>). If no errors were returned then your connection was successful.</p>\n<h2 id=\"create-a-collection\" class=\"group scroll-mt-24\">Create a collection<a href=\"#create-a-collection\" aria-hidden=\"true\" class=\"ml-2 opacity-0 group-hover:opacity-100 transition\"><span aria-hidden=\"true\">#</span></a></h2>\n<p>Now we're going to create a new collection and insert some documents.</p>\n<p>Create a new code block below the install block (<code>ctrl+m b</code>). Add the following code to the code block and execute it (<code>ctrl+enter</code>):</p>\n<div class=\"ch-codeblock not-prose \" data-ch-theme=\"supabase\"><div class=\"ch-code-wrapper ch-code\" data-ch-measured=\"false\"><code class=\"ch-code-scroll-parent\"><br><div><span class=\"ch-code-line-number\">_<!-- -->16</span><div style=\"display:inline-block;margin-left:16px\"><span>collection = vx.get_or_create_collection(name=\"colab_collection\", dimension=3)</span></div></div><div><span class=\"ch-code-line-number\">_<!-- -->16</span><div style=\"display:inline-block;margin-left:16px\"><span></span></div></div><div><span class=\"ch-code-line-number\">_<!-- -->16</span><div style=\"display:inline-block;margin-left:16px\"><span>collection.upsert(</span></div></div><div><span class=\"ch-code-line-number\">_<!-- -->16</span><div style=\"display:inline-block;margin-left:16px\"><span>    vectors=[</span></div></div><div><span class=\"ch-code-line-number\">_<!-- -->16</span><div style=\"display:inline-block;margin-left:16px\"><span>        (</span></div></div><div><span class=\"ch-code-line-number\">_<!-- -->16</span><div style=\"display:inline-block;margin-left:16px\"><span>         \"vec0\",           # the vector's identifier</span></div></div><div><span class=\"ch-code-line-number\">_<!-- -->16</span><div style=\"display:inline-block;margin-left:16px\"><span>         [0.1, 0.2, 0.3],  # the vector. list or np.array</span></div></div><div><span class=\"ch-code-line-number\">_<!-- -->16</span><div style=\"display:inline-block;margin-left:16px\"><span>         {\"year\": 1973}    # associated  metadata</span></div></div><div><span class=\"ch-code-line-number\">_<!-- -->16</span><div style=\"display:inline-block;margin-left:16px\"><span>        ),</span></div></div><div><span class=\"ch-code-line-number\">_<!-- -->16</span><div style=\"display:inline-block;margin-left:16px\"><span>        (</span></div></div><div><span class=\"ch-code-line-number\">_<!-- -->16</span><div style=\"display:inline-block;margin-left:16px\"><span>         \"vec1\",</span></div></div><div><span class=\"ch-code-line-number\">_<!-- -->16</span><div style=\"display:inline-block;margin-left:16px\"><span>         [0.7, 0.8, 0.9],</span></div></div><div><span class=\"ch-code-line-number\">_<!-- -->16</span><div style=\"display:inline-block;margin-left:16px\"><span>         {\"year\": 2012}</span></div></div><div><span class=\"ch-code-line-number\">_<!-- -->16</span><div style=\"display:inline-block;margin-left:16px\"><span>        )</span></div></div><div><span class=\"ch-code-line-number\">_<!-- -->16</span><div style=\"display:inline-block;margin-left:16px\"><span>    ]</span></div></div><div><span class=\"ch-code-line-number\">_<!-- -->16</span><div style=\"display:inline-block;margin-left:16px\"><span>)</span></div></div><br></code></div></div>\n<p>This will create a table inside your database within the <code>vecs</code> schema, called <code>colab_collection</code>. You can view the inserted items in the <a href=\"https://supabase.com/dashboard/project/_/editor/\">Table Editor</a>, by selecting the <code>vecs</code> schema from the schema dropdown.</p>\n<p><img src=\"/docs/img/ai/google-colab/colab-documents.png\" alt=\"Colab documents\"></p>\n<h2 id=\"query-your-documents\" class=\"group scroll-mt-24\">Query your documents<a href=\"#query-your-documents\" aria-hidden=\"true\" class=\"ml-2 opacity-0 group-hover:opacity-100 transition\"><span aria-hidden=\"true\">#</span></a></h2>\n<p>Now we can search for documents based on their similarity. Create a new code block and execute the following code:</p>\n<div class=\"ch-codeblock not-prose \" data-ch-theme=\"supabase\"><div class=\"ch-code-wrapper ch-code\" data-ch-measured=\"false\"><code class=\"ch-code-scroll-parent\"><br><div><span class=\"ch-code-line-number\">_<!-- -->10</span><div style=\"display:inline-block;margin-left:16px\"><span>collection.query(</span></div></div><div><span class=\"ch-code-line-number\">_<!-- -->10</span><div style=\"display:inline-block;margin-left:16px\"><span>    query_vector=[0.4,0.5,0.6],  # required</span></div></div><div><span class=\"ch-code-line-number\">_<!-- -->10</span><div style=\"display:inline-block;margin-left:16px\"><span>    limit=5,                     # number of records to return</span></div></div><div><span class=\"ch-code-line-number\">_<!-- -->10</span><div style=\"display:inline-block;margin-left:16px\"><span>    filters={},                  # metadata filters</span></div></div><div><span class=\"ch-code-line-number\">_<!-- -->10</span><div style=\"display:inline-block;margin-left:16px\"><span>    measure=\"cosine_distance\",   # distance measure to use</span></div></div><div><span class=\"ch-code-line-number\">_<!-- -->10</span><div style=\"display:inline-block;margin-left:16px\"><span>    include_value=False,         # should distance measure values be returned?</span></div></div><div><span class=\"ch-code-line-number\">_<!-- -->10</span><div style=\"display:inline-block;margin-left:16px\"><span>    include_metadata=False,      # should record metadata be returned?</span></div></div><div><span class=\"ch-code-line-number\">_<!-- -->10</span><div style=\"display:inline-block;margin-left:16px\"><span>)</span></div></div><br></code></div></div>\n<p>You will see that this returns two documents in an array <code>['vec1', 'vec0']</code>:</p>\n<p><img src=\"/docs/img/ai/google-colab/colab-results.png\" alt=\"Colab results\"></p>\n<p>It also returns a warning:</p>\n<div class=\"ch-codeblock not-prose \" data-ch-theme=\"supabase\"><div class=\"ch-code-wrapper ch-code\" data-ch-measured=\"false\"><code class=\"ch-code-scroll-parent\"><br><div><span class=\"ch-code-line-number\">_<!-- -->10</span><div style=\"display:inline-block;margin-left:16px\"><span>Query does not have a covering index for cosine_distance.</span></div></div><br></code></div></div>\n<p>You can lean more about creating indexes in the <a href=\"https://supabase.github.io/vecs/api/#create-an-index\">Vecs documentation</a>.</p>\n<h2 id=\"resources\" class=\"group scroll-mt-24\">Resources<a href=\"#resources\" aria-hidden=\"true\" class=\"ml-2 opacity-0 group-hover:opacity-100 transition\"><span aria-hidden=\"true\">#</span></a></h2>\n<ul>\n<li>Vecs API: <a href=\"https://supabase.github.io/vecs/api\">supabase.github.io/vecs/api</a></li>\n</ul></article></div></div></div><!--$--><div class=\"max-w-7xl px-5 mx-auto py-8 pt-0\"></div><!--/$--></div><div class=\"left-0 right-0 z-10 backdrop-blur-sm backdrop-filter bg-alternative/90 hidden h-0 lg:hidden\"></div></div></main></div></div></div></div></body></html>",
      "metadata": {
        "ogUrl": "https://supabase.com/docs/guides/ai/google-colab",
        "title": "Google Colab | Supabase Docs",
        "robots": "index, follow",
        "ogImage": "https://obuldanrptloktxcffvn.supabase.co/functions/v1/og-images?site=docs&type=ai&title=Google%20Colab&description=Use%20Google%20Colab%20to%20manage%20your%20Supabase%20Vector%20store.",
        "ogTitle": "Google Colab | Supabase Docs",
        "language": "en",
        "sourceURL": "https://supabase.com/docs/guides/ai/google-colab",
        "description": "Use Google Colab to manage your Supabase Vector store.",
        "modifiedTime": "2024-09-10T20:36:24.980Z",
        "ogDescription": "Use Google Colab to manage your Supabase Vector store.",
        "publishedTime": "2024-09-10T20:36:24.980Z",
        "ogLocaleAlternate": [],
        "statusCode": 200
      }
    },
    {
      "markdown": "AI & Vectors\n\n# Adding generative Q&A for your documentation\n\n## Learn how to build a ChatGPT-style doc search powered using our headless search toolkit.\n\n* * *\n\nSupabase provides a [Headless Search Toolkit](https://github.com/supabase/headless-vector-search) for adding \"Generative Q&A\" to your documentation. The toolkit is \"headless\", so that you can integrate it into your existing website and style it to match your website theme.\n\nYou can see how this works with the Supabase docs. Just hit `cmd+k` and \"ask\" for something like \"what are the features of supabase?\". You will see that the response is streamed back, using the information provided in the docs:\n\n![headless search](https://supabase.com/docs/img/ai/headless-search/headless.png)\n\n## Tech stack [\\#](\\#tech-stack)\n\n- Supabase: Database & Edge Functions.\n- OpenAI: Embeddings and completions.\n- GitHub Actions: for ingesting your markdown docs.\n\n## Toolkit [\\#](\\#toolkit)\n\nThis toolkit consists of 2 parts:\n\n- The [Headless Vector Search](https://github.com/supabase/headless-vector-search) template which you can deploy in your own organization.\n- A [GitHub Action](https://github.com/supabase/embeddings-generator) which will ingest your markdown files, convert them to embeddings, and store them in your database.\n\n## Usage [\\#](\\#usage)\n\nThere are 3 steps to build similarity search inside your documentation:\n\n1. Prepare your database.\n2. Ingest your documentation.\n3. Add a search interface.\n\n### Prepare your database [\\#](\\#prepare-your-database)\n\nTo prepare, create a [new Supabase project](https://database.new) and store the database and API credentials, which you can find in the project [settings](https://supabase.com/dashboard/project/_/settings).\n\nNow we can use the [Headless Vector Search](https://github.com/supabase/headless-vector-search#set-up) instructions to set up the database:\n\n1. Clone the repo to your local machine: `git clone git@github.com:supabase/headless-vector-search.git`\n2. Link the repo to your remote project: `supabase link --project-ref XXX`\n3. Apply the database migrations: `supabase db push`\n4. Set your OpenAI key as a secret: `supabase secrets set OPENAI_API_KEY=sk-xxx`\n5. Deploy the Edge Functions: `supabase functions deploy --no-verify-jwt`\n6. Expose `docs` schema via API in Supabase Dashboard [settings](https://supabase.com/dashboard/project/_/settings/api) \\> `API Settings` \\> `Exposed schemas`\n\n### Ingest your documentation [\\#](\\#ingest-your-documentation)\n\nNow we need to push your documentation into the database as embeddings. You can do this manually, but to make it easier we've created a [GitHub Action](https://github.com/marketplace/actions/supabase-embeddings-generator) which can update your database every time there is a Pull Request.\n\nIn your knowledge base repository, create a new action called `.github/workflows/generate_embeddings.yml` with the following content:\n\n`\n_17\nname: 'generate_embeddings'\n_17\non: # run on main branch changes\n_17\npush:\n_17\n    branches:\n_17\n      - main\n_17\n_17\njobs:\n_17\ngenerate:\n_17\n    runs-on: ubuntu-latest\n_17\n    steps:\n_17\n      - uses: actions/checkout@v3\n_17\n      - uses: supabase/embeddings-generator@v0.0.x # Update this to the latest version.\n_17\n        with:\n_17\n          supabase-url: 'https://your-project-ref.supabase.co' # Update this to your project URL.\n_17\n          supabase-service-role-key: ${{ secrets.SUPABASE_SERVICE_ROLE_KEY }}\n_17\n          openai-key: ${{ secrets.OPENAI_API_KEY }}\n_17\n          docs-root-path: 'docs' # the path to the root of your md(x) files\n`\n\nMake sure to choose the latest version, and set your `SUPABASE_SERVICE_ROLE_KEY` and `OPENAI_API_KEY` as repository secrets in your repo settings (settings > secrets > actions).\n\n### Add a search interface [\\#](\\#add-a-search-interface)\n\nNow inside your docs, you need to create a search interface. Because this is a headless interface, you can use it with any language. The only requirement is that you send the user query to the `query` Edge Function, which will stream an answer back from OpenAI. It might look something like this:\n\n``\n_31\nconst onSubmit = (e: Event) => {\n_31\ne.preventDefault()\n_31\nanswer.value = \"\"\n_31\nisLoading.value = true\n_31\n_31\nconst query = new URLSearchParams({ query: inputRef.current!.value })\n_31\nconst projectUrl = `https://your-project-ref.supabase.co/functions/v1`\n_31\nconst queryURL = `${projectURL}/${query}`\n_31\nconst eventSource = new EventSource(queryURL)\n_31\n_31\neventSource.addEventListener(\"error\", (err) => {\n_31\n    isLoading.value = false\n_31\n    console.error(err)\n_31\n})\n_31\n_31\neventSource.addEventListener(\"message\", (e: MessageEvent) => {\n_31\n    isLoading.value = false\n_31\n_31\n    if (e.data === \"[DONE]\") {\n_31\n      eventSource.close()\n_31\n      return\n_31\n    }\n_31\n_31\n    const completionResponse: CreateCompletionResponse = JSON.parse(e.data)\n_31\n    const text = completionResponse.choices[0].text\n_31\n_31\n    answer.value += text\n_31\n});\n_31\n_31\nisLoading.value = true\n_31\n}\n``\n\n## Resources [\\#](\\#resources)\n\n- Read about how we built [ChatGPT for the Supabase Docs](https://supabase.com/blog/chatgpt-supabase-docs).\n- Read the pgvector Docs for [Embeddings and vector similarity](/docs/guides/database/extensions/pgvector)\n- See how to build something like this from scratch [using Next.js](/docs/guides/ai/examples/nextjs-vector-search).",
      "html": "<!DOCTYPE html><html lang=\"en\" data-theme=\"light\" style=\"color-scheme: light;\"><body><div class=\"flex flex-col\"><div class=\"grow\"><div class=\"flex flex-col h-full w-full\"><div class=\"hidden lg:sticky w-full lg:flex top-0 left-0 right-0 z-50\"><!--$--><!--/$--></div><div class=\"flex flex-row h-full relative\"><main id=\"docs-content-container\" class=\"w-full transition-all ease-out relative lg:ml-0\"><div class=\"flex flex-col sticky top-0\"><div class=\"flex lg:hidden w-full top-0 left-0 right-0 z-50\"><!--$--><!--/$--></div><div class=\"sticky transition-all top-0 z-10 backdrop-blur backdrop-filter bg-background\"><div class=\"lg:hidden px-3.5 border-b z-10 transition-all ease-out top-0 flex items-center gap-1\"><button class=\"h-8 w-8 flex group items-center justify-center mr-1\"><div class=\"space-y-1 cursor-pointer relative w-4 h-[8px]\"><span class=\"transition-all ease-out block h-px bg-foreground-muted group-hover:bg-foreground w-4\"></span><span class=\"transition-all ease-out block h-px bg-foreground-muted group-hover:bg-foreground w-3 group-hover:w-4\"></span></div></button><span class=\"transition-all duration-200 text-foreground text-sm\">AI &amp; Vectors</span></div></div><div class=\"grow\"><div class=\"max-w-7xl px-5 mx-auto py-8 pb-0\"><div class=\"grid grid-cols-12 relative gap-4\"><div class=\"relative transition-all ease-out duration-100 col-span-12 md:col-span-9\"><article id=\"sb-docs-guide-main-article\" class=\"prose max-w-none\"><h1 class=\"mb-0\">Adding generative Q&amp;A for your documentation</h1><h2 class=\"mt-3 text-xl text-foreground-light\">Learn how to build a ChatGPT-style doc search powered using our headless search toolkit.</h2><hr class=\"not-prose border-t-0 border-b my-8\">\n<p>Supabase provides a <a href=\"https://github.com/supabase/headless-vector-search\">Headless Search Toolkit</a> for adding \"Generative Q&amp;A\" to your documentation. The toolkit is \"headless\", so that you can integrate it into your existing website and style it to match your website theme.</p>\n<p>You can see how this works with the Supabase docs. Just hit <code>cmd+k</code> and \"ask\" for something like \"what are the features of supabase?\". You will see that the response is streamed back, using the information provided in the docs:</p>\n<p><img src=\"/docs/img/ai/headless-search/headless.png\" alt=\"headless search\"></p>\n<h2 id=\"tech-stack\" class=\"group scroll-mt-24\">Tech stack<a href=\"#tech-stack\" aria-hidden=\"true\" class=\"ml-2 opacity-0 group-hover:opacity-100 transition\"><span aria-hidden=\"true\">#</span></a></h2>\n<ul>\n<li>Supabase: Database &amp; Edge Functions.</li>\n<li>OpenAI: Embeddings and completions.</li>\n<li>GitHub Actions: for ingesting your markdown docs.</li>\n</ul>\n<h2 id=\"toolkit\" class=\"group scroll-mt-24\">Toolkit<a href=\"#toolkit\" aria-hidden=\"true\" class=\"ml-2 opacity-0 group-hover:opacity-100 transition\"><span aria-hidden=\"true\">#</span></a></h2>\n<p>This toolkit consists of 2 parts:</p>\n<ul>\n<li>The <a href=\"https://github.com/supabase/headless-vector-search\">Headless Vector Search</a> template which you can deploy in your own organization.</li>\n<li>A <a href=\"https://github.com/supabase/embeddings-generator\">GitHub Action</a> which will ingest your markdown files, convert them to embeddings, and store them in your database.</li>\n</ul>\n<h2 id=\"usage\" class=\"group scroll-mt-24\">Usage<a href=\"#usage\" aria-hidden=\"true\" class=\"ml-2 opacity-0 group-hover:opacity-100 transition\"><span aria-hidden=\"true\">#</span></a></h2>\n<p>There are 3 steps to build similarity search inside your documentation:</p>\n<ol>\n<li>Prepare your database.</li>\n<li>Ingest your documentation.</li>\n<li>Add a search interface.</li>\n</ol>\n<h3 id=\"prepare-your-database\" class=\"group scroll-mt-24\">Prepare your database<a href=\"#prepare-your-database\" aria-hidden=\"true\" class=\"ml-2 opacity-0 group-hover:opacity-100 transition\"><span aria-hidden=\"true\">#</span></a></h3>\n<p>To prepare, create a <a href=\"https://database.new\">new Supabase project</a> and store the database and API credentials, which you can find in the project <a href=\"https://supabase.com/dashboard/project/_/settings\">settings</a>.</p>\n<p>Now we can use the <a href=\"https://github.com/supabase/headless-vector-search#set-up\">Headless Vector Search</a> instructions to set up the database:</p>\n<ol>\n<li>Clone the repo to your local machine: <code>git clone git@github.com:supabase/headless-vector-search.git</code></li>\n<li>Link the repo to your remote project: <code>supabase link --project-ref XXX</code></li>\n<li>Apply the database migrations: <code>supabase db push</code></li>\n<li>Set your OpenAI key as a secret: <code>supabase secrets set OPENAI_API_KEY=sk-xxx</code></li>\n<li>Deploy the Edge Functions: <code>supabase functions deploy --no-verify-jwt</code></li>\n<li>Expose <code>docs</code> schema via API in Supabase Dashboard <a href=\"https://supabase.com/dashboard/project/_/settings/api\">settings</a> &gt; <code>API Settings</code> &gt; <code>Exposed schemas</code></li>\n</ol>\n<h3 id=\"ingest-your-documentation\" class=\"group scroll-mt-24\">Ingest your documentation<a href=\"#ingest-your-documentation\" aria-hidden=\"true\" class=\"ml-2 opacity-0 group-hover:opacity-100 transition\"><span aria-hidden=\"true\">#</span></a></h3>\n<p>Now we need to push your documentation into the database as embeddings. You can do this manually, but to make it easier we've created a <a href=\"https://github.com/marketplace/actions/supabase-embeddings-generator\">GitHub Action</a> which can update your database every time there is a Pull Request.</p>\n<p>In your knowledge base repository, create a new action called <code>.github/workflows/generate_embeddings.yml</code> with the following content:</p>\n<div class=\"ch-codeblock not-prose \" data-ch-theme=\"supabase\"><div class=\"ch-code-wrapper ch-code\" data-ch-measured=\"false\"><code class=\"ch-code-scroll-parent\"><br><div><span class=\"ch-code-line-number\">_<!-- -->17</span><div style=\"display:inline-block;margin-left:16px\"><span>name: 'generate_embeddings'</span></div></div><div><span class=\"ch-code-line-number\">_<!-- -->17</span><div style=\"display:inline-block;margin-left:16px\"><span>on: # run on main branch changes</span></div></div><div><span class=\"ch-code-line-number\">_<!-- -->17</span><div style=\"display:inline-block;margin-left:16px\"><span>  push:</span></div></div><div><span class=\"ch-code-line-number\">_<!-- -->17</span><div style=\"display:inline-block;margin-left:16px\"><span>    branches:</span></div></div><div><span class=\"ch-code-line-number\">_<!-- -->17</span><div style=\"display:inline-block;margin-left:16px\"><span>      - main</span></div></div><div><span class=\"ch-code-line-number\">_<!-- -->17</span><div style=\"display:inline-block;margin-left:16px\"><span></span></div></div><div><span class=\"ch-code-line-number\">_<!-- -->17</span><div style=\"display:inline-block;margin-left:16px\"><span>jobs:</span></div></div><div><span class=\"ch-code-line-number\">_<!-- -->17</span><div style=\"display:inline-block;margin-left:16px\"><span>  generate:</span></div></div><div><span class=\"ch-code-line-number\">_<!-- -->17</span><div style=\"display:inline-block;margin-left:16px\"><span>    runs-on: ubuntu-latest</span></div></div><div><span class=\"ch-code-line-number\">_<!-- -->17</span><div style=\"display:inline-block;margin-left:16px\"><span>    steps:</span></div></div><div><span class=\"ch-code-line-number\">_<!-- -->17</span><div style=\"display:inline-block;margin-left:16px\"><span>      - uses: actions/checkout@v3</span></div></div><div><span class=\"ch-code-line-number\">_<!-- -->17</span><div style=\"display:inline-block;margin-left:16px\"><span>      - uses: supabase/embeddings-generator@v0.0.x # Update this to the latest version.</span></div></div><div><span class=\"ch-code-line-number\">_<!-- -->17</span><div style=\"display:inline-block;margin-left:16px\"><span>        with:</span></div></div><div><span class=\"ch-code-line-number\">_<!-- -->17</span><div style=\"display:inline-block;margin-left:16px\"><span>          supabase-url: 'https://your-project-ref.supabase.co' # Update this to your project URL.</span></div></div><div><span class=\"ch-code-line-number\">_<!-- -->17</span><div style=\"display:inline-block;margin-left:16px\"><span>          supabase-service-role-key: ${{ secrets.SUPABASE_SERVICE_ROLE_KEY }}</span></div></div><div><span class=\"ch-code-line-number\">_<!-- -->17</span><div style=\"display:inline-block;margin-left:16px\"><span>          openai-key: ${{ secrets.OPENAI_API_KEY }}</span></div></div><div><span class=\"ch-code-line-number\">_<!-- -->17</span><div style=\"display:inline-block;margin-left:16px\"><span>          docs-root-path: 'docs' # the path to the root of your md(x) files</span></div></div><br></code></div></div>\n<p>Make sure to choose the latest version, and set your <code>SUPABASE_SERVICE_ROLE_KEY</code> and <code>OPENAI_API_KEY</code> as repository secrets in your repo settings (settings &gt; secrets &gt; actions).</p>\n<h3 id=\"add-a-search-interface\" class=\"group scroll-mt-24\">Add a search interface<a href=\"#add-a-search-interface\" aria-hidden=\"true\" class=\"ml-2 opacity-0 group-hover:opacity-100 transition\"><span aria-hidden=\"true\">#</span></a></h3>\n<p>Now inside your docs, you need to create a search interface. Because this is a headless interface, you can use it with any language. The only requirement is that you send the user query to the <code>query</code> Edge Function, which will stream an answer back from OpenAI. It might look something like this:</p>\n<div class=\"ch-codeblock not-prose \" data-ch-theme=\"supabase\"><div class=\"ch-code-wrapper ch-code\" data-ch-measured=\"false\"><code class=\"ch-code-scroll-parent\"><br><div><span class=\"ch-code-line-number\">_<!-- -->31</span><div style=\"display:inline-block;margin-left:16px\"><span>const onSubmit = (e: Event) =&gt; {</span></div></div><div><span class=\"ch-code-line-number\">_<!-- -->31</span><div style=\"display:inline-block;margin-left:16px\"><span>  e.preventDefault()</span></div></div><div><span class=\"ch-code-line-number\">_<!-- -->31</span><div style=\"display:inline-block;margin-left:16px\"><span>  answer.value = \"\"</span></div></div><div><span class=\"ch-code-line-number\">_<!-- -->31</span><div style=\"display:inline-block;margin-left:16px\"><span>  isLoading.value = true</span></div></div><div><span class=\"ch-code-line-number\">_<!-- -->31</span><div style=\"display:inline-block;margin-left:16px\"><span></span></div></div><div><span class=\"ch-code-line-number\">_<!-- -->31</span><div style=\"display:inline-block;margin-left:16px\"><span>  const query = new URLSearchParams({ query: inputRef.current!.value })</span></div></div><div><span class=\"ch-code-line-number\">_<!-- -->31</span><div style=\"display:inline-block;margin-left:16px\"><span>  const projectUrl = `https://your-project-ref.supabase.co/functions/v1`</span></div></div><div><span class=\"ch-code-line-number\">_<!-- -->31</span><div style=\"display:inline-block;margin-left:16px\"><span>  const queryURL = `${projectURL}/${query}`</span></div></div><div><span class=\"ch-code-line-number\">_<!-- -->31</span><div style=\"display:inline-block;margin-left:16px\"><span>  const eventSource = new EventSource(queryURL)</span></div></div><div><span class=\"ch-code-line-number\">_<!-- -->31</span><div style=\"display:inline-block;margin-left:16px\"><span></span></div></div><div><span class=\"ch-code-line-number\">_<!-- -->31</span><div style=\"display:inline-block;margin-left:16px\"><span>  eventSource.addEventListener(\"error\", (err) =&gt; {</span></div></div><div><span class=\"ch-code-line-number\">_<!-- -->31</span><div style=\"display:inline-block;margin-left:16px\"><span>    isLoading.value = false</span></div></div><div><span class=\"ch-code-line-number\">_<!-- -->31</span><div style=\"display:inline-block;margin-left:16px\"><span>    console.error(err)</span></div></div><div><span class=\"ch-code-line-number\">_<!-- -->31</span><div style=\"display:inline-block;margin-left:16px\"><span>  })</span></div></div><div><span class=\"ch-code-line-number\">_<!-- -->31</span><div style=\"display:inline-block;margin-left:16px\"><span></span></div></div><div><span class=\"ch-code-line-number\">_<!-- -->31</span><div style=\"display:inline-block;margin-left:16px\"><span>  eventSource.addEventListener(\"message\", (e: MessageEvent) =&gt; {</span></div></div><div><span class=\"ch-code-line-number\">_<!-- -->31</span><div style=\"display:inline-block;margin-left:16px\"><span>    isLoading.value = false</span></div></div><div><span class=\"ch-code-line-number\">_<!-- -->31</span><div style=\"display:inline-block;margin-left:16px\"><span></span></div></div><div><span class=\"ch-code-line-number\">_<!-- -->31</span><div style=\"display:inline-block;margin-left:16px\"><span>    if (e.data === \"[DONE]\") {</span></div></div><div><span class=\"ch-code-line-number\">_<!-- -->31</span><div style=\"display:inline-block;margin-left:16px\"><span>      eventSource.close()</span></div></div><div><span class=\"ch-code-line-number\">_<!-- -->31</span><div style=\"display:inline-block;margin-left:16px\"><span>      return</span></div></div><div><span class=\"ch-code-line-number\">_<!-- -->31</span><div style=\"display:inline-block;margin-left:16px\"><span>    }</span></div></div><div><span class=\"ch-code-line-number\">_<!-- -->31</span><div style=\"display:inline-block;margin-left:16px\"><span></span></div></div><div><span class=\"ch-code-line-number\">_<!-- -->31</span><div style=\"display:inline-block;margin-left:16px\"><span>    const completionResponse: CreateCompletionResponse = JSON.parse(e.data)</span></div></div><div><span class=\"ch-code-line-number\">_<!-- -->31</span><div style=\"display:inline-block;margin-left:16px\"><span>    const text = completionResponse.choices[0].text</span></div></div><div><span class=\"ch-code-line-number\">_<!-- -->31</span><div style=\"display:inline-block;margin-left:16px\"><span></span></div></div><div><span class=\"ch-code-line-number\">_<!-- -->31</span><div style=\"display:inline-block;margin-left:16px\"><span>    answer.value += text</span></div></div><div><span class=\"ch-code-line-number\">_<!-- -->31</span><div style=\"display:inline-block;margin-left:16px\"><span>  });</span></div></div><div><span class=\"ch-code-line-number\">_<!-- -->31</span><div style=\"display:inline-block;margin-left:16px\"><span></span></div></div><div><span class=\"ch-code-line-number\">_<!-- -->31</span><div style=\"display:inline-block;margin-left:16px\"><span>  isLoading.value = true</span></div></div><div><span class=\"ch-code-line-number\">_<!-- -->31</span><div style=\"display:inline-block;margin-left:16px\"><span>}</span></div></div><br></code></div></div>\n<h2 id=\"resources\" class=\"group scroll-mt-24\">Resources<a href=\"#resources\" aria-hidden=\"true\" class=\"ml-2 opacity-0 group-hover:opacity-100 transition\"><span aria-hidden=\"true\">#</span></a></h2>\n<ul>\n<li>Read about how we built <a href=\"https://supabase.com/blog/chatgpt-supabase-docs\">ChatGPT for the Supabase Docs</a>.</li>\n<li>Read the pgvector Docs for <a href=\"/docs/guides/database/extensions/pgvector\">Embeddings and vector similarity</a></li>\n<li>See how to build something like this from scratch <a href=\"/docs/guides/ai/examples/nextjs-vector-search\">using Next.js</a>.</li>\n</ul></article></div></div></div><!--$--><div class=\"max-w-7xl px-5 mx-auto py-8 pt-0\"></div><!--/$--></div><div class=\"left-0 right-0 z-10 backdrop-blur-sm backdrop-filter bg-alternative/90 hidden h-0 lg:hidden\"></div></div></main></div></div></div></div></body></html>",
      "metadata": {
        "ogUrl": "https://supabase.com/docs/guides/ai/examples/headless-vector-search",
        "title": "Adding generative Q&A for your documentation | Supabase Docs",
        "robots": "index, follow",
        "ogImage": "https://obuldanrptloktxcffvn.supabase.co/functions/v1/og-images?site=docs&type=ai&title=Adding%20generative%20Q%26A%20for%20your%20documentation&description=undefined",
        "ogTitle": "Adding generative Q&A for your documentation | Supabase Docs",
        "language": "en",
        "sourceURL": "https://supabase.com/docs/guides/ai/examples/headless-vector-search",
        "description": "Learn how to build a ChatGPT-style doc search powered using our headless search toolkit.",
        "modifiedTime": "2024-09-10T20:36:24.980Z",
        "ogDescription": "Learn how to build a ChatGPT-style doc search powered using our headless search toolkit.",
        "publishedTime": "2024-09-10T20:36:24.980Z",
        "ogLocaleAlternate": [],
        "statusCode": 200
      }
    },
    {
      "markdown": "AI & Vectors\n\n# Learn how to integrate Supabase with LlamaIndex, a data framework for your LLM applications.\n\n## Learn how to integrate Supabase with LlamaIndex, a data framework for your LLM applications.\n\n* * *\n\nThis guide will walk you through a basic example using the LlamaIndex [SupabaseVectorStore](https://github.com/supabase/supabase/blob/master/examples/ai/llamaindex/llamaindex.ipynb).\n\n## Project setup [\\#](\\#project-setup)\n\nLet's create a new Postgres database. This is as simple as starting a new Project in Supabase:\n\n1. [Create a new project](https://database.new/) in the Supabase dashboard.\n2. Enter your project details. Remember to store your password somewhere safe.\n\nYour database will be available in less than a minute.\n\n**Finding your credentials:**\n\nYou can find your project credentials inside the project [settings](https://supabase.com/dashboard/project/_/settings/), including:\n\n- [Database credentials](https://supabase.com/dashboard/project/_/settings/database): connection strings and connection pooler details.\n- [API credentials](https://supabase.com/dashboard/project/_/settings/database): your serverless API URL and `anon` / `service_role` keys.\n\n## Launching a notebook [\\#](\\#launching-a-notebook)\n\nLaunch our [LlamaIndex](https://github.com/supabase/supabase/blob/master/examples/ai/llamaindex/llamaindex.ipynb) notebook in Colab:\n\n[![](https://supabase.com/docs/img/ai/colab-badge.svg)](https://colab.research.google.com/github/supabase/supabase/blob/master/examples/ai/llamaindex/llamaindex.ipynb)\n\nAt the top of the notebook, you'll see a button `Copy to Drive`. Click this button to copy the notebook to your Google Drive.\n\n## Fill in your OpenAI credentials [\\#](\\#fill-in-your-openai-credentials)\n\nInside the Notebook, add your `OPENAI_API_KEY` key. Find the cell which contains this code:\n\n`\n_10\nimport os\n_10\nos.environ['OPENAI_API_KEY'] = \"[your_openai_api_key]\"\n`\n\n## Connecting to your database [\\#](\\#connecting-to-your-database)\n\nInside the Notebook, find the cell which specifies the `DB_CONNECTION`. It will contain some code like this:\n\n`\n_10\nDB_CONNECTION = \"postgresql://<user>:<password>@<host>:<port>/<db_name>\"\n_10\n_10\n# create vector store client\n_10\nvx = vecs.create_client(DB_CONNECTION)\n`\n\nReplace the `DB_CONNECTION` with your own connection string for your database. You can find the Postgres connection string in the [Database Settings](https://supabase.com/dashboard/project/_/settings/database) of your Supabase project.\n\nSQLAlchemy requires the connection string to start with `postgresql://` (instead of `postgres://`). Don't forget to rename this after copying the string from the dashboard.\n\nYou must use the \"connection pooling\" string (domain ending in `*.pooler.supabase.com`) with Google Colab since Colab does not support IPv6.\n\n## Stepping through the notebook [\\#](\\#stepping-through-the-notebook)\n\nNow all that's left is to step through the notebook. You can do this by clicking the \"execute\" button ( `ctrl+enter`) at the top left of each code cell. The notebook guides you through the process of creating a collection, adding data to it, and querying it.\n\nYou can view the inserted items in the [Table Editor](https://supabase.com/dashboard/project/_/editor/), by selecting the `vecs` schema from the schema dropdown.\n\n![Colab documents](https://supabase.com/docs/img/ai/google-colab/colab-documents.png)\n\n## Resources [\\#](\\#resources)\n\n- Visit the LlamaIndex + SupabaseVectorStore [docs](https://gpt-index.readthedocs.io/en/latest/examples/vector_stores/SupabaseVectorIndexDemo.html)\n- Visit the official LlamaIndex [repo](https://github.com/jerryjliu/llama_index/)",
      "html": "<!DOCTYPE html><html lang=\"en\" data-theme=\"light\" style=\"color-scheme: light;\"><body><div class=\"flex flex-col\"><div class=\"grow\"><div class=\"flex flex-col h-full w-full\"><div class=\"hidden lg:sticky w-full lg:flex top-0 left-0 right-0 z-50\"><!--$--><!--/$--></div><div class=\"flex flex-row h-full relative\"><main id=\"docs-content-container\" class=\"w-full transition-all ease-out relative lg:ml-0\"><div class=\"flex flex-col sticky top-0\"><div class=\"flex lg:hidden w-full top-0 left-0 right-0 z-50\"><!--$--><!--/$--></div><div class=\"sticky transition-all top-0 z-10 backdrop-blur backdrop-filter bg-background\"><div class=\"lg:hidden px-3.5 border-b z-10 transition-all ease-out top-0 flex items-center gap-1\"><button class=\"h-8 w-8 flex group items-center justify-center mr-1\"><div class=\"space-y-1 cursor-pointer relative w-4 h-[8px]\"><span class=\"transition-all ease-out block h-px bg-foreground-muted group-hover:bg-foreground w-4\"></span><span class=\"transition-all ease-out block h-px bg-foreground-muted group-hover:bg-foreground w-3 group-hover:w-4\"></span></div></button><span class=\"transition-all duration-200 text-foreground text-sm\">AI &amp; Vectors</span></div></div><div class=\"grow\"><div class=\"max-w-7xl px-5 mx-auto py-8 pb-0\"><div class=\"grid grid-cols-12 relative gap-4\"><div class=\"relative transition-all ease-out duration-100 col-span-12 md:col-span-9\"><article id=\"sb-docs-guide-main-article\" class=\"prose max-w-none\"><h1 class=\"mb-0\">Learn how to integrate Supabase with LlamaIndex, a data framework for your LLM applications.</h1><h2 class=\"mt-3 text-xl text-foreground-light\">Learn how to integrate Supabase with LlamaIndex, a data framework for your LLM applications.</h2><hr class=\"not-prose border-t-0 border-b my-8\">\n<p>This guide will walk you through a basic example using the LlamaIndex <a href=\"https://github.com/supabase/supabase/blob/master/examples/ai/llamaindex/llamaindex.ipynb\">SupabaseVectorStore</a>.</p>\n<h2 id=\"project-setup\" class=\"group scroll-mt-24\">Project setup<a href=\"#project-setup\" aria-hidden=\"true\" class=\"ml-2 opacity-0 group-hover:opacity-100 transition\"><span aria-hidden=\"true\">#</span></a></h2>\n<p>Let's create a new Postgres database. This is as simple as starting a new Project in Supabase:</p>\n<ol>\n<li><a href=\"https://database.new/\">Create a new project</a> in the Supabase dashboard.</li>\n<li>Enter your project details. Remember to store your password somewhere safe.</li>\n</ol>\n<p>Your database will be available in less than a minute.</p>\n<p><strong>Finding your credentials:</strong></p>\n<p>You can find your project credentials inside the project <a href=\"https://supabase.com/dashboard/project/_/settings/\">settings</a>, including:</p>\n<ul>\n<li><a href=\"https://supabase.com/dashboard/project/_/settings/database\">Database credentials</a>: connection strings and connection pooler details.</li>\n<li><a href=\"https://supabase.com/dashboard/project/_/settings/database\">API credentials</a>: your serverless API URL and <code>anon</code> / <code>service_role</code> keys.</li>\n</ul>\n<h2 id=\"launching-a-notebook\" class=\"group scroll-mt-24\">Launching a notebook<a href=\"#launching-a-notebook\" aria-hidden=\"true\" class=\"ml-2 opacity-0 group-hover:opacity-100 transition\"><span aria-hidden=\"true\">#</span></a></h2>\n<p>Launch our <a href=\"https://github.com/supabase/supabase/blob/master/examples/ai/llamaindex/llamaindex.ipynb\">LlamaIndex</a> notebook in Colab:</p>\n<a class=\"w-64\" href=\"https://colab.research.google.com/github/supabase/supabase/blob/master/examples/ai/llamaindex/llamaindex.ipynb\"><img src=\"/docs/img/ai/colab-badge.svg\"></a>\n<p>At the top of the notebook, you'll see a button <code>Copy to Drive</code>. Click this button to copy the notebook to your Google Drive.</p>\n<h2 id=\"fill-in-your-openai-credentials\" class=\"group scroll-mt-24\">Fill in your OpenAI credentials<a href=\"#fill-in-your-openai-credentials\" aria-hidden=\"true\" class=\"ml-2 opacity-0 group-hover:opacity-100 transition\"><span aria-hidden=\"true\">#</span></a></h2>\n<p>Inside the Notebook, add your <code>OPENAI_API_KEY</code> key. Find the cell which contains this code:</p>\n<div class=\"ch-codeblock not-prose \" data-ch-theme=\"supabase\"><div class=\"ch-code-wrapper ch-code\" data-ch-measured=\"false\"><code class=\"ch-code-scroll-parent\"><br><div><span class=\"ch-code-line-number\">_<!-- -->10</span><div style=\"display:inline-block;margin-left:16px\"><span>import os</span></div></div><div><span class=\"ch-code-line-number\">_<!-- -->10</span><div style=\"display:inline-block;margin-left:16px\"><span>os.environ['OPENAI_API_KEY'] = \"[your_openai_api_key]\"</span></div></div><br></code></div></div>\n<h2 id=\"connecting-to-your-database\" class=\"group scroll-mt-24\">Connecting to your database<a href=\"#connecting-to-your-database\" aria-hidden=\"true\" class=\"ml-2 opacity-0 group-hover:opacity-100 transition\"><span aria-hidden=\"true\">#</span></a></h2>\n<p>Inside the Notebook, find the cell which specifies the <code>DB_CONNECTION</code>. It will contain some code like this:</p>\n<div class=\"ch-codeblock not-prose \" data-ch-theme=\"supabase\"><div class=\"ch-code-wrapper ch-code\" data-ch-measured=\"false\"><code class=\"ch-code-scroll-parent\"><br><div><span class=\"ch-code-line-number\">_<!-- -->10</span><div style=\"display:inline-block;margin-left:16px\"><span>DB_CONNECTION = \"postgresql://&lt;user&gt;:&lt;password&gt;@&lt;host&gt;:&lt;port&gt;/&lt;db_name&gt;\"</span></div></div><div><span class=\"ch-code-line-number\">_<!-- -->10</span><div style=\"display:inline-block;margin-left:16px\"><span></span></div></div><div><span class=\"ch-code-line-number\">_<!-- -->10</span><div style=\"display:inline-block;margin-left:16px\"><span># create vector store client</span></div></div><div><span class=\"ch-code-line-number\">_<!-- -->10</span><div style=\"display:inline-block;margin-left:16px\"><span>vx = vecs.create_client(DB_CONNECTION)</span></div></div><br></code></div></div>\n<p>Replace the <code>DB_CONNECTION</code> with your own connection string for your database. You can find the Postgres connection string in the <a href=\"https://supabase.com/dashboard/project/_/settings/database\">Database Settings</a> of your Supabase project.</p>\n<div role=\"alert\" class=\"relative w-full text-sm rounded-lg p-4 [&amp;>svg~*]:pl-10 [&amp;>svg+div]:translate-y-[-3px] [&amp;>svg]:absolute [&amp;>svg]:left-4 [&amp;>svg]:top-4 [&amp;>svg]:w-[23px] [&amp;>svg]:h-[23px] [&amp;>svg]:p-1 [&amp;>svg]:flex [&amp;>svg]:rounded text-foreground [&amp;>svg]:text-background [&amp;>svg]:bg-foreground mb-2 [&amp;_svg]:bg-foreground-muted [&amp;_svg]:text-background-muted bg-surface-200/25 border border-default\"><svg xmlns=\"http://www.w3.org/2000/svg\" viewBox=\"0 0 21 20\" class=\"w-6 h-6\" fill=\"currentColor\"><path fill-rule=\"evenodd\" clip-rule=\"evenodd\" d=\"M0.625 9.8252C0.625 4.44043 4.99023 0.0751953 10.375 0.0751953C15.7598 0.0751953 20.125 4.44043 20.125 9.8252C20.125 15.21 15.7598 19.5752 10.375 19.5752C4.99023 19.5752 0.625 15.21 0.625 9.8252ZM9.3584 4.38135C9.45117 4.28857 9.55518 4.20996 9.66699 4.14648C9.88086 4.02539 10.1245 3.96045 10.375 3.96045C10.5845 3.96045 10.7896 4.00586 10.9766 4.09229C11.1294 4.1626 11.2705 4.26025 11.3916 4.38135C11.6611 4.65088 11.8125 5.0166 11.8125 5.39795C11.8125 5.5249 11.7959 5.6499 11.7637 5.77002C11.6987 6.01172 11.5718 6.23438 11.3916 6.41455C11.1221 6.68408 10.7563 6.83545 10.375 6.83545C9.99365 6.83545 9.62793 6.68408 9.3584 6.41455C9.08887 6.14502 8.9375 5.7793 8.9375 5.39795C8.9375 5.29492 8.94873 5.19287 8.97021 5.09375C9.02783 4.82568 9.16162 4.57812 9.3584 4.38135ZM10.375 15.6899C10.0933 15.6899 9.82275 15.5781 9.62354 15.3789C9.42432 15.1797 9.3125 14.9092 9.3125 14.6274V9.31494C9.3125 9.0332 9.42432 8.7627 9.62354 8.56348C9.82275 8.36426 10.0933 8.25244 10.375 8.25244C10.6567 8.25244 10.9272 8.36426 11.1265 8.56348C11.3257 8.7627 11.4375 9.0332 11.4375 9.31494V14.6274C11.4375 14.7944 11.3979 14.9575 11.3242 15.104C11.2739 15.2046 11.2075 15.2979 11.1265 15.3789C10.9272 15.5781 10.6567 15.6899 10.375 15.6899Z\"></path></svg><div class=\"text mt [&amp;_p]:mb-1.5 [&amp;_p]:mt-0 mt-0.5 [&amp;_p:last-child]:mb-0\"><p>SQLAlchemy requires the connection string to start with <code>postgresql://</code> (instead of <code>postgres://</code>). Don't forget to rename this after copying the string from the dashboard.</p></div></div>\n<div role=\"alert\" class=\"relative w-full text-sm rounded-lg p-4 [&amp;>svg~*]:pl-10 [&amp;>svg+div]:translate-y-[-3px] [&amp;>svg]:absolute [&amp;>svg]:left-4 [&amp;>svg]:top-4 [&amp;>svg]:w-[23px] [&amp;>svg]:h-[23px] [&amp;>svg]:p-1 [&amp;>svg]:flex [&amp;>svg]:rounded text-foreground [&amp;>svg]:text-background [&amp;>svg]:bg-foreground mb-2 [&amp;_svg]:bg-foreground-muted [&amp;_svg]:text-background-muted bg-surface-200/25 border border-default\"><svg xmlns=\"http://www.w3.org/2000/svg\" viewBox=\"0 0 21 20\" class=\"w-6 h-6\" fill=\"currentColor\"><path fill-rule=\"evenodd\" clip-rule=\"evenodd\" d=\"M0.625 9.8252C0.625 4.44043 4.99023 0.0751953 10.375 0.0751953C15.7598 0.0751953 20.125 4.44043 20.125 9.8252C20.125 15.21 15.7598 19.5752 10.375 19.5752C4.99023 19.5752 0.625 15.21 0.625 9.8252ZM9.3584 4.38135C9.45117 4.28857 9.55518 4.20996 9.66699 4.14648C9.88086 4.02539 10.1245 3.96045 10.375 3.96045C10.5845 3.96045 10.7896 4.00586 10.9766 4.09229C11.1294 4.1626 11.2705 4.26025 11.3916 4.38135C11.6611 4.65088 11.8125 5.0166 11.8125 5.39795C11.8125 5.5249 11.7959 5.6499 11.7637 5.77002C11.6987 6.01172 11.5718 6.23438 11.3916 6.41455C11.1221 6.68408 10.7563 6.83545 10.375 6.83545C9.99365 6.83545 9.62793 6.68408 9.3584 6.41455C9.08887 6.14502 8.9375 5.7793 8.9375 5.39795C8.9375 5.29492 8.94873 5.19287 8.97021 5.09375C9.02783 4.82568 9.16162 4.57812 9.3584 4.38135ZM10.375 15.6899C10.0933 15.6899 9.82275 15.5781 9.62354 15.3789C9.42432 15.1797 9.3125 14.9092 9.3125 14.6274V9.31494C9.3125 9.0332 9.42432 8.7627 9.62354 8.56348C9.82275 8.36426 10.0933 8.25244 10.375 8.25244C10.6567 8.25244 10.9272 8.36426 11.1265 8.56348C11.3257 8.7627 11.4375 9.0332 11.4375 9.31494V14.6274C11.4375 14.7944 11.3979 14.9575 11.3242 15.104C11.2739 15.2046 11.2075 15.2979 11.1265 15.3789C10.9272 15.5781 10.6567 15.6899 10.375 15.6899Z\"></path></svg><div class=\"text mt [&amp;_p]:mb-1.5 [&amp;_p]:mt-0 mt-0.5 [&amp;_p:last-child]:mb-0\"><p>You must use the \"connection pooling\" string (domain ending in <code>*.pooler.supabase.com</code>) with Google Colab since Colab does not support IPv6.</p></div></div>\n<h2 id=\"stepping-through-the-notebook\" class=\"group scroll-mt-24\">Stepping through the notebook<a href=\"#stepping-through-the-notebook\" aria-hidden=\"true\" class=\"ml-2 opacity-0 group-hover:opacity-100 transition\"><span aria-hidden=\"true\">#</span></a></h2>\n<p>Now all that's left is to step through the notebook. You can do this by clicking the \"execute\" button (<code>ctrl+enter</code>) at the top left of each code cell. The notebook guides you through the process of creating a collection, adding data to it, and querying it.</p>\n<p>You can view the inserted items in the <a href=\"https://supabase.com/dashboard/project/_/editor/\">Table Editor</a>, by selecting the <code>vecs</code> schema from the schema dropdown.</p>\n<p><img src=\"/docs/img/ai/google-colab/colab-documents.png\" alt=\"Colab documents\"></p>\n<h2 id=\"resources\" class=\"group scroll-mt-24\">Resources<a href=\"#resources\" aria-hidden=\"true\" class=\"ml-2 opacity-0 group-hover:opacity-100 transition\"><span aria-hidden=\"true\">#</span></a></h2>\n<ul>\n<li>Visit the LlamaIndex + SupabaseVectorStore <a href=\"https://gpt-index.readthedocs.io/en/latest/examples/vector_stores/SupabaseVectorIndexDemo.html\">docs</a></li>\n<li>Visit the official LlamaIndex <a href=\"https://github.com/jerryjliu/llama_index/\">repo</a></li>\n</ul></article></div></div></div><!--$--><div class=\"max-w-7xl px-5 mx-auto py-8 pt-0\"></div><!--/$--></div><div class=\"left-0 right-0 z-10 backdrop-blur-sm backdrop-filter bg-alternative/90 hidden h-0 lg:hidden\"></div></div></main></div></div></div></div></body></html>",
      "metadata": {
        "ogUrl": "https://supabase.com/docs/guides/ai/integrations/llamaindex",
        "title": "Learn how to integrate Supabase with LlamaIndex, a data framework for your LLM applications. | Supabase Docs",
        "robots": "index, follow",
        "ogImage": "https://obuldanrptloktxcffvn.supabase.co/functions/v1/og-images?site=docs&type=ai&title=Learn%20how%20to%20integrate%20Supabase%20with%20LlamaIndex%2C%20a%20data%20framework%20for%20your%20LLM%20applications.&description=undefined",
        "ogTitle": "Learn how to integrate Supabase with LlamaIndex, a data framework for your LLM applications. | Supabase Docs",
        "language": "en",
        "sourceURL": "https://supabase.com/docs/guides/ai/integrations/llamaindex",
        "description": "Learn how to integrate Supabase with LlamaIndex, a data framework for your LLM applications.",
        "modifiedTime": "2024-09-10T20:36:24.980Z",
        "ogDescription": "Learn how to integrate Supabase with LlamaIndex, a data framework for your LLM applications.",
        "publishedTime": "2024-09-10T20:36:24.980Z",
        "ogLocaleAlternate": [],
        "statusCode": 200
      }
    },
    {
      "markdown": "AI & Vectors\n\n# Choosing your Compute Add-on\n\n## Choosing the right Compute Add-on for your vector workload.\n\n* * *\n\nYou have two options for scaling your vector workload:\n\n1. Increase the size of your database. This guide will help you choose the right size for your workload.\n2. Spread your workload across multiple databases. You can find more details about this approach in [Engineering for Scale](engineering-for-scale).\n\n## Dimensionality [\\#](\\#dimensionality)\n\nThe number of dimensions in your embeddings is the most important factor in choosing the right Compute Add-on. In general, the lower the dimensionality the better the performance. We've provided guidance for some of the more common embedding dimensions below. For each benchmark, we used [Vecs](https://github.com/supabase/vecs) to create a collection, upload the embeddings to a single table, and create both the `IVFFlat` and `HNSW` indexes for `inner-product` distance measure for the embedding column. We then ran a series of queries to measure the performance of different compute add-ons:\n\n## HNSW [\\#](\\#hnsw)\n\n### 384 dimensions [\\#](\\#hnsw-384-dimensions)\n\nThis benchmark uses the dbpedia-entities-openai-1M dataset containing 1,000,000 embeddings of text, regenerated for 384 dimension embeddings. Each embedding is generated using [gte-small](https://huggingface.co/Supabase/gte-small).\n\ngte-small-384\n\n| Compute Size | Vectors | m | ef\\_construction | ef\\_search | QPS | Latency Mean | Latency p95 | RAM Usage | RAM |\n| --- | --- | --- | --- | --- | --- | --- | --- | --- | --- |\n| Micro | 100,000 | 16 | 64 | 60 | 580 | 0.017 sec | 0.024 sec | 1.2 (Swap) | 1 GB |\n| Small | 250,000 | 24 | 64 | 60 | 440 | 0.022 sec | 0.033 sec | 2 GB | 2 GB |\n| Medium | 500,000 | 24 | 64 | 80 | 350 | 0.028 sec | 0.045 sec | 4 GB | 4 GB |\n| Large | 1,000,000 | 32 | 80 | 100 | 270 | 0.073 sec | 0.108 sec | 7 GB | 8 GB |\n| XL | 1,000,000 | 32 | 80 | 100 | 525 | 0.038 sec | 0.059 sec | 9 GB | 16 GB |\n| 2XL | 1,000,000 | 32 | 80 | 100 | 790 | 0.025 sec | 0.037 sec | 9 GB | 32 GB |\n| 4XL | 1,000,000 | 32 | 80 | 100 | 1650 | 0.015 sec | 0.018 sec | 11 GB | 64 GB |\n| 8XL | 1,000,000 | 32 | 80 | 100 | 2690 | 0.015 sec | 0.016 sec | 13 GB | 128 GB |\n| 12XL | 1,000,000 | 32 | 80 | 100 | 3900 | 0.014 sec | 0.016 sec | 13 GB | 192 GB |\n| 16XL | 1,000,000 | 32 | 80 | 100 | 4200 | 0.014 sec | 0.016 sec | 20 GB | 256 GB |\n\nAccuracy was 0.99 for benchmarks.\n\n### 960 dimensions [\\#](\\#hnsw-960-dimensions)\n\nThis benchmark uses the [gist-960](http://corpus-texmex.irisa.fr/) dataset, which contains 1,000,000 embeddings of images. Each embedding is 960 dimensions.\n\ngist-960\n\n| Compute Size | Vectors | m | ef\\_construction | ef\\_search | QPS | Latency Mean | Latency p95 | RAM Usage | RAM |\n| --- | --- | --- | --- | --- | --- | --- | --- | --- | --- |\n| Micro | 30,000 | 16 | 64 | 65 | 430 | 0.024 sec | 0.034 sec | 1.2 GB (Swap) | 1 GB |\n| Small | 100,000 | 32 | 80 | 60 | 260 | 0.040 sec | 0.054 sec | 2.2 GB (Swap) | 2 GB |\n| Medium | 250,000 | 32 | 80 | 90 | 120 | 0.083 sec | 0.106 sec | 4 GB | 4 GB |\n| Large | 500,000 | 32 | 80 | 120 | 160 | 0.063 sec | 0.087 sec | 7 GB | 8 GB |\n| XL | 1,000,000 | 32 | 80 | 200 | 200 | 0.049 sec | 0.072 sec | 13 GB | 16 GB |\n| 2XL | 1,000,000 | 32 | 80 | 200 | 340 | 0.025 sec | 0.029 sec | 17 GB | 32 GB |\n| 4XL | 1,000,000 | 32 | 80 | 200 | 630 | 0.031 sec | 0.050 sec | 18 GB | 64 GB |\n| 8XL | 1,000,000 | 32 | 80 | 200 | 1100 | 0.034 sec | 0.048 sec | 19 GB | 128 GB |\n| 12XL | 1,000,000 | 32 | 80 | 200 | 1420 | 0.041 sec | 0.095 sec | 21 GB | 192 GB |\n| 16XL | 1,000,000 | 32 | 80 | 200 | 1650 | 0.037 sec | 0.081 sec | 23 GB | 256 GB |\n\nAccuracy was 0.99 for benchmarks.\n\nQPS can also be improved by increasing [`m` and `ef_construction`](/docs/guides/ai/going-to-prod#hnsw-understanding-efconstruction--efsearch--and-m). This will allow you to use a smaller value for `ef_search` and increase QPS.\n\n### 1536 dimensions [\\#](\\#hnsw-1536-dimensions)\n\nThis benchmark uses the [dbpedia-entities-openai-1M](https://huggingface.co/datasets/KShivendu/dbpedia-entities-openai-1M) dataset, which contains 1,000,000 embeddings of text. And 224,482 embeddings from [Wikipedia articles](https://huggingface.co/datasets/Supabase/wikipedia-en-embeddings) for compute add-ons `large` and below. Each embedding is 1536 dimensions created with the [OpenAI Embeddings API](https://platform.openai.com/docs/guides/embeddings).\n\nOpenAI-1536\n\n| Compute Size | Vectors | m | ef\\_construction | ef\\_search | QPS | Latency Mean | Latency p95 | RAM Usage | RAM |\n| --- | --- | --- | --- | --- | --- | --- | --- | --- | --- |\n| Micro | 15,000 | 16 | 40 | 40 | 480 | 0.011 sec | 0.016 sec | 1.2 GB (Swap) | 1 GB |\n| Small | 50,000 | 32 | 64 | 100 | 175 | 0.031 sec | 0.051 sec | 2.2 GB (Swap) | 2 GB |\n| Medium | 100,000 | 32 | 64 | 100 | 240 | 0.083 sec | 0.126 sec | 4 GB | 4 GB |\n| Large | 224,482 | 32 | 64 | 100 | 280 | 0.017 sec | 0.028 sec | 8 GB | 8 GB |\n| XL | 500,000 | 24 | 56 | 100 | 360 | 0.055 sec | 0.135 sec | 13 GB | 16 GB |\n| 2XL | 1,000,000 | 24 | 56 | 250 | 560 | 0.036 sec | 0.058 sec | 32 GB | 32 GB |\n| 4XL | 1,000,000 | 24 | 56 | 250 | 950 | 0.021 sec | 0.033 sec | 39 GB | 64 GB |\n| 8XL | 1,000,000 | 24 | 56 | 250 | 1650 | 0.016 sec | 0.023 sec | 40 GB | 128 GB |\n| 12XL | 1,000,000 | 24 | 56 | 250 | 1900 | 0.015 sec | 0.021 sec | 38 GB | 192 GB |\n| 16XL | 1,000,000 | 24 | 56 | 250 | 2200 | 0.015 sec | 0.020 sec | 40 GB | 256 GB |\n\nAccuracy was 0.99 for benchmarks.\n\nQPS can also be improved by increasing [`m` and `ef_construction`](/docs/guides/ai/going-to-prod#hnsw-understanding-efconstruction--efsearch--and-m). This will allow you to use a smaller value for `ef_search` and increase QPS. For example, increasing `m` to 32 and `ef_construction` to 80 for 4XL will increase QPS to 1280.\n\nIt is possible to upload more vectors to a single table if Memory allows it (for example, 4XL plan and higher for OpenAI embeddings). But it will affect the performance of the queries: QPS will be lower, and latency will be higher. Scaling should be almost linear, but it is recommended to benchmark your workload to find the optimal number of vectors per table and per database instance.\n\n## IVFFlat [\\#](\\#ivfflat)\n\n### 384 dimensions [\\#](\\#ivfflat-384-dimensions)\n\nThis benchmark uses the dbpedia-entities-openai-1M dataset containing 1,000,000 embeddings of text, regenerated for 384 dimension embeddings. Each embedding is generated using [gte-small](https://huggingface.co/Supabase/gte-small).\n\ngte-small-384, accuracy=.98gte-small-384, accuracy=.99\n\n| Compute Size | Vectors | Lists | Probes | QPS | Latency Mean | Latency p95 | RAM Usage | RAM |\n| --- | --- | --- | --- | --- | --- | --- | --- | --- |\n| Micro | 100,000 | 500 | 50 | 205 | 0.048 sec | 0.066 sec | 1.2 GB (Swap) | 1 GB |\n| Small | 250,000 | 1000 | 60 | 160 | 0.062 sec | 0.079 sec | 2 GB | 2 GB |\n| Medium | 500,000 | 2000 | 80 | 120 | 0.082 sec | 0.104 sec | 3.2 GB | 4 GB |\n| Large | 1,000,000 | 5000 | 150 | 75 | 0.269 sec | 0.375 sec | 6.5 GB | 8 GB |\n| XL | 1,000,000 | 5000 | 150 | 150 | 0.131 sec | 0.178 sec | 9 GB | 16 GB |\n| 2XL | 1,000,000 | 5000 | 150 | 300 | 0.066 sec | 0.099 sec | 10 GB | 32 GB |\n| 4XL | 1,000,000 | 5000 | 150 | 570 | 0.035 sec | 0.046 sec | 10 GB | 64 GB |\n| 8XL | 1,000,000 | 5000 | 150 | 1400 | 0.023 sec | 0.028 sec | 12 GB | 128 GB |\n| 12XL | 1,000,000 | 5000 | 150 | 1550 | 0.030 sec | 0.039 sec | 12 GB | 192 GB |\n| 16XL | 1,000,000 | 5000 | 150 | 1800 | 0.030 sec | 0.039 sec | 16 GB | 256 GB |\n\n### 960 dimensions [\\#](\\#ivfflat-960-dimensions)\n\nThis benchmark uses the [gist-960](http://corpus-texmex.irisa.fr/) dataset, which contains 1,000,000 embeddings of images. Each embedding is 960 dimensions.\n\ngist-960, probes = 10\n\n| Compute Size | Vectors | Lists | QPS | Latency Mean | Latency p95 | RAM Usage | RAM |\n| --- | --- | --- | --- | --- | --- | --- | --- |\n| Micro | 30,000 | 30 | 75 | 0.065 sec | 0.088 sec | 1.1 GB (Swap) | 1 GB |\n| Small | 100,000 | 100 | 78 | 0.064 sec | 0.092 sec | 1.8 GB | 2 GB |\n| Medium | 250,000 | 250 | 58 | 0.085 sec | 0.129 sec | 3.2 GB | 4 GB |\n| Large | 500,000 | 500 | 55 | 0.088 sec | 0.140 sec | 5 GB | 8 GB |\n| XL | 1,000,000 | 1000 | 110 | 0.046 sec | 0.070 sec | 14 GB | 16 GB |\n| 2XL | 1,000,000 | 1000 | 235 | 0.083 sec | 0.136 sec | 10 GB | 32 GB |\n| 4XL | 1,000,000 | 1000 | 420 | 0.071 sec | 0.106 sec | 11 GB | 64 GB |\n| 8XL | 1,000,000 | 1000 | 815 | 0.072 sec | 0.106 sec | 13 GB | 128 GB |\n| 12XL | 1,000,000 | 1000 | 1150 | 0.052 sec | 0.078 sec | 15.5 GB | 192 GB |\n| 16XL | 1,000,000 | 1000 | 1345 | 0.072 sec | 0.106 sec | 17.5 GB | 256 GB |\n\n### 1536 dimensions [\\#](\\#ivfflat-1536-dimensions)\n\nThis benchmark uses the [dbpedia-entities-openai-1M](https://huggingface.co/datasets/KShivendu/dbpedia-entities-openai-1M) dataset, which contains 1,000,000 embeddings of text. Each embedding is 1536 dimensions created with the [OpenAI Embeddings API](https://platform.openai.com/docs/guides/embeddings).\n\nOpenAI-1536, probes = 10OpenAI-1536, probes = 40\n\n| Compute Size | Vectors | Lists | QPS | Latency Mean | Latency p95 | RAM Usage | RAM |\n| --- | --- | --- | --- | --- | --- | --- | --- |\n| Micro | 20,000 | 40 | 135 | 0.372 sec | 0.412 sec | 1.2 GB (Swap) | 1 GB |\n| Small | 50,000 | 100 | 140 | 0.357 sec | 0.398 sec | 1.8 GB | 2 GB |\n| Medium | 100,000 | 200 | 130 | 0.383 sec | 0.446 sec | 3.7 GB | 4 GB |\n| Large | 250,000 | 500 | 130 | 0.378 sec | 0.434 sec | 7 GB | 8 GB |\n| XL | 500,000 | 1000 | 235 | 0.213 sec | 0.271 sec | 13.5 GB | 16 GB |\n| 2XL | 1,000,000 | 2000 | 380 | 0.133 sec | 0.236 sec | 30 GB | 32 GB |\n| 4XL | 1,000,000 | 2000 | 720 | 0.068 sec | 0.120 sec | 35 GB | 64 GB |\n| 8XL | 1,000,000 | 2000 | 1250 | 0.039 sec | 0.066 sec | 38 GB | 128 GB |\n| 12XL | 1,000,000 | 2000 | 1600 | 0.030 sec | 0.052 sec | 41 GB | 192 GB |\n| 16XL | 1,000,000 | 2000 | 1790 | 0.029 sec | 0.051 sec | 45 GB | 256 GB |\n\nFor 1,000,000 vectors 10 probes results to accuracy of 0.91. And for 500,000 vectors and below 10 probes results to accuracy in the range of 0.95 - 0.99. To increase accuracy, you need to increase the number of probes.\n\nIt is possible to upload more vectors to a single table if Memory allows it (for example, 4XL plan and higher for OpenAI embeddings). But it will affect the performance of the queries: QPS will be lower, and latency will be higher. Scaling should be almost linear, but it is recommended to benchmark your workload to find the optimal number of vectors per table and per database instance.\n\n## Performance tips [\\#](\\#performance-tips)\n\nThere are various ways to improve your pgvector performance. Here are some tips:\n\n### Pre-warming your database [\\#](\\#pre-warming-your-database)\n\nIt's useful to execute a few thousand \u201cwarm-up\u201d queries before going into production. This helps help with RAM utilization. This can also help to determine that you've selected the right compute size for your workload.\n\n### Finetune index parameters [\\#](\\#finetune-index-parameters)\n\nYou can increase the Requests per Second by increasing `m` and `ef_construction` or `lists`. This also has an important caveat: building the index takes longer with higher values for these parameters.\n\nHNSWIVFFlat\n\nCheck out more tips and the complete step-by-step guide in [Going to Production for AI applications](going-to-prod).\n\n## Benchmark methodology [\\#](\\#benchmark-methodology)\n\nWe follow techniques outlined in the [ANN Benchmarks](https://github.com/erikbern/ann-benchmarks) methodology. A Python test runner is responsible for uploading the data, creating the index, and running the queries. The pgvector engine is implemented using [vecs](https://github.com/supabase/vecs), a Python client for pgvector.\n\nEach test is run for a minimum of 30-40 minutes. They include a series of experiments executed at different concurrency levels to measure the engine's performance under different load types. The results are then averaged.\n\nAs a general recommendation, we suggest using a concurrency level of 5 or more for most workloads and 30 or more for high-load workloads.",
      "html": "<!DOCTYPE html><html lang=\"en\" data-theme=\"light\" style=\"color-scheme: light;\"><body><div class=\"flex flex-col\"><div class=\"grow\"><div class=\"flex flex-col h-full w-full\"><div class=\"hidden lg:sticky w-full lg:flex top-0 left-0 right-0 z-50\"><!--$--><!--/$--></div><div class=\"flex flex-row h-full relative\"><main id=\"docs-content-container\" class=\"w-full transition-all ease-out relative lg:ml-0\"><div class=\"flex flex-col sticky top-0\"><div class=\"flex lg:hidden w-full top-0 left-0 right-0 z-50\"><!--$--><!--/$--></div><div class=\"sticky transition-all top-0 z-10 backdrop-blur backdrop-filter bg-background\"><div class=\"lg:hidden px-3.5 border-b z-10 transition-all ease-out top-0 flex items-center gap-1\"><button class=\"h-8 w-8 flex group items-center justify-center mr-1\"><div class=\"space-y-1 cursor-pointer relative w-4 h-[8px]\"><span class=\"transition-all ease-out block h-px bg-foreground-muted group-hover:bg-foreground w-4\"></span><span class=\"transition-all ease-out block h-px bg-foreground-muted group-hover:bg-foreground w-3 group-hover:w-4\"></span></div></button><span class=\"transition-all duration-200 text-foreground text-sm\">AI &amp; Vectors</span></div></div><div class=\"grow\"><div class=\"max-w-7xl px-5 mx-auto py-8 pb-0\"><div class=\"grid grid-cols-12 relative gap-4\"><div class=\"relative transition-all ease-out duration-100 col-span-12 md:col-span-9\"><article id=\"sb-docs-guide-main-article\" class=\"prose max-w-none\"><h1 class=\"mb-0\">Choosing your Compute Add-on</h1><h2 class=\"mt-3 text-xl text-foreground-light\">Choosing the right Compute Add-on for your vector workload.</h2><hr class=\"not-prose border-t-0 border-b my-8\"><p>You have two options for scaling your vector workload:</p>\n<ol>\n<li>Increase the size of your database. This guide will help you choose the right size for your workload.</li>\n<li>Spread your workload across multiple databases. You can find more details about this approach in <a href=\"engineering-for-scale\">Engineering for Scale</a>.</li>\n</ol>\n<h2 id=\"dimensionality\" class=\"group scroll-mt-24\">Dimensionality<a href=\"#dimensionality\" aria-hidden=\"true\" class=\"ml-2 opacity-0 group-hover:opacity-100 transition\"><span aria-hidden=\"true\">#</span></a></h2>\n<p>The number of dimensions in your embeddings is the most important factor in choosing the right Compute Add-on. In general, the lower the dimensionality the better the performance. We've provided guidance for some of the more common embedding dimensions below. For each benchmark, we used <a href=\"https://github.com/supabase/vecs\">Vecs</a> to create a collection, upload the embeddings to a single table, and create both the <code>IVFFlat</code> and <code>HNSW</code> indexes for <code>inner-product</code> distance measure for the embedding column. We then ran a series of queries to measure the performance of different compute add-ons:</p>\n<h2 id=\"hnsw\" class=\"group scroll-mt-24\">HNSW<a href=\"#hnsw\" aria-hidden=\"true\" class=\"ml-2 opacity-0 group-hover:opacity-100 transition\"><span aria-hidden=\"true\">#</span></a></h2>\n<h3 id=\"hnsw-384-dimensions\" class=\"group scroll-mt-24\">384 dimensions <a href=\"#hnsw-384-dimensions\" aria-hidden=\"true\" class=\"ml-2 opacity-0 group-hover:opacity-100 transition\"><span aria-hidden=\"true\">#</span></a></h3>\n<p>This benchmark uses the dbpedia-entities-openai-1M dataset containing 1,000,000 embeddings of text, regenerated for 384 dimension embeddings. Each embedding is generated using <a href=\"https://huggingface.co/Supabase/gte-small\">gte-small</a>.</p>\n<div dir=\"ltr\" data-orientation=\"horizontal\" class=\"w-full justify-between space-y-4 \"><div role=\"tablist\" aria-orientation=\"horizontal\" class=\" flex items-center border-b border-secondary  overflow-auto whitespace-nowrap no-scrollbar mask-fadeout-right flex-wrap\" tabindex=\"-1\" data-orientation=\"horizontal\" style=\"outline:none\"><button type=\"button\" role=\"tab\" aria-selected=\"true\" aria-controls=\"radix-:Rhu9jtsn7qb6ra:-content-gte384\" data-state=\"active\" id=\"radix-:Rhu9jtsn7qb6ra:-trigger-gte384\" class=\" relative cursor-pointer text-foreground-lighter flex items-center space-x-2 text-center transition focus:outline-none focus-visible:ring focus-visible:ring-foreground-muted focus-visible:border-foreground-muted  text-sm leading-4 px-3 py-2  !text-foreground border-b-2 border-foreground \" tabindex=\"-1\" data-orientation=\"horizontal\" data-radix-collection-item=\"\"><span>gte-small-384</span></button></div><div data-state=\"active\" data-orientation=\"horizontal\" role=\"tabpanel\" aria-labelledby=\"radix-:Rhu9jtsn7qb6ra:-trigger-gte384\" id=\"radix-:Rhu9jtsn7qb6ra:-content-gte384\" tabindex=\"0\" class=\"focus:outline-none transition-height \" style=\"animation-duration:0s\"><table><thead><tr><th>Compute Size</th><th>Vectors</th><th>m</th><th>ef_construction</th><th>ef_search</th><th>QPS</th><th>Latency Mean</th><th>Latency p95</th><th>RAM Usage</th><th>RAM</th></tr></thead><tbody><tr><td>Micro</td><td>100,000</td><td>16</td><td>64</td><td>60</td><td>580</td><td>0.017 sec</td><td>0.024 sec</td><td>1.2 (Swap)</td><td>1 GB</td></tr><tr><td>Small</td><td>250,000</td><td>24</td><td>64</td><td>60</td><td>440</td><td>0.022 sec</td><td>0.033 sec</td><td>2 GB</td><td>2 GB</td></tr><tr><td>Medium</td><td>500,000</td><td>24</td><td>64</td><td>80</td><td>350</td><td>0.028 sec</td><td>0.045 sec</td><td>4 GB</td><td>4 GB</td></tr><tr><td>Large</td><td>1,000,000</td><td>32</td><td>80</td><td>100</td><td>270</td><td>0.073 sec</td><td>0.108 sec</td><td>7 GB</td><td>8 GB</td></tr><tr><td>XL</td><td>1,000,000</td><td>32</td><td>80</td><td>100</td><td>525</td><td>0.038 sec</td><td>0.059 sec</td><td>9 GB</td><td>16 GB</td></tr><tr><td>2XL</td><td>1,000,000</td><td>32</td><td>80</td><td>100</td><td>790</td><td>0.025 sec</td><td>0.037 sec</td><td>9 GB</td><td>32 GB</td></tr><tr><td>4XL</td><td>1,000,000</td><td>32</td><td>80</td><td>100</td><td>1650</td><td>0.015 sec</td><td>0.018 sec</td><td>11 GB</td><td>64 GB</td></tr><tr><td>8XL</td><td>1,000,000</td><td>32</td><td>80</td><td>100</td><td>2690</td><td>0.015 sec</td><td>0.016 sec</td><td>13 GB</td><td>128 GB</td></tr><tr><td>12XL</td><td>1,000,000</td><td>32</td><td>80</td><td>100</td><td>3900</td><td>0.014 sec</td><td>0.016 sec</td><td>13 GB</td><td>192 GB</td></tr><tr><td>16XL</td><td>1,000,000</td><td>32</td><td>80</td><td>100</td><td>4200</td><td>0.014 sec</td><td>0.016 sec</td><td>20 GB</td><td>256 GB</td></tr></tbody></table><p>Accuracy was 0.99 for benchmarks.</p></div></div>\n<h3 id=\"hnsw-960-dimensions\" class=\"group scroll-mt-24\">960 dimensions <a href=\"#hnsw-960-dimensions\" aria-hidden=\"true\" class=\"ml-2 opacity-0 group-hover:opacity-100 transition\"><span aria-hidden=\"true\">#</span></a></h3>\n<p>This benchmark uses the <a href=\"http://corpus-texmex.irisa.fr/\">gist-960</a> dataset, which contains 1,000,000 embeddings of images. Each embedding is 960 dimensions.</p>\n<div dir=\"ltr\" data-orientation=\"horizontal\" class=\"w-full justify-between space-y-4 \"><div role=\"tablist\" aria-orientation=\"horizontal\" class=\" flex items-center border-b border-secondary  overflow-auto whitespace-nowrap no-scrollbar mask-fadeout-right flex-wrap\" tabindex=\"-1\" data-orientation=\"horizontal\" style=\"outline:none\"><button type=\"button\" role=\"tab\" aria-selected=\"true\" aria-controls=\"radix-:Rim9jtsn7qb6ra:-content-gist960\" data-state=\"active\" id=\"radix-:Rim9jtsn7qb6ra:-trigger-gist960\" class=\" relative cursor-pointer text-foreground-lighter flex items-center space-x-2 text-center transition focus:outline-none focus-visible:ring focus-visible:ring-foreground-muted focus-visible:border-foreground-muted  text-sm leading-4 px-3 py-2  !text-foreground border-b-2 border-foreground \" tabindex=\"-1\" data-orientation=\"horizontal\" data-radix-collection-item=\"\"><span>gist-960</span></button></div><div data-state=\"active\" data-orientation=\"horizontal\" role=\"tabpanel\" aria-labelledby=\"radix-:Rim9jtsn7qb6ra:-trigger-gist960\" id=\"radix-:Rim9jtsn7qb6ra:-content-gist960\" tabindex=\"0\" class=\"focus:outline-none transition-height \" style=\"animation-duration:0s\"><table><thead><tr><th>Compute Size</th><th>Vectors</th><th>m</th><th>ef_construction</th><th>ef_search</th><th>QPS</th><th>Latency Mean</th><th>Latency p95</th><th>RAM Usage</th><th>RAM</th></tr></thead><tbody><tr><td>Micro</td><td>30,000</td><td>16</td><td>64</td><td>65</td><td>430</td><td>0.024 sec</td><td>0.034 sec</td><td>1.2 GB (Swap)</td><td>1 GB</td></tr><tr><td>Small</td><td>100,000</td><td>32</td><td>80</td><td>60</td><td>260</td><td>0.040 sec</td><td>0.054 sec</td><td>2.2 GB (Swap)</td><td>2 GB</td></tr><tr><td>Medium</td><td>250,000</td><td>32</td><td>80</td><td>90</td><td>120</td><td>0.083 sec</td><td>0.106 sec</td><td>4 GB</td><td>4 GB</td></tr><tr><td>Large</td><td>500,000</td><td>32</td><td>80</td><td>120</td><td>160</td><td>0.063 sec</td><td>0.087 sec</td><td>7 GB</td><td>8 GB</td></tr><tr><td>XL</td><td>1,000,000</td><td>32</td><td>80</td><td>200</td><td>200</td><td>0.049 sec</td><td>0.072 sec</td><td>13 GB</td><td>16 GB</td></tr><tr><td>2XL</td><td>1,000,000</td><td>32</td><td>80</td><td>200</td><td>340</td><td>0.025 sec</td><td>0.029 sec</td><td>17 GB</td><td>32 GB</td></tr><tr><td>4XL</td><td>1,000,000</td><td>32</td><td>80</td><td>200</td><td>630</td><td>0.031 sec</td><td>0.050 sec</td><td>18 GB</td><td>64 GB</td></tr><tr><td>8XL</td><td>1,000,000</td><td>32</td><td>80</td><td>200</td><td>1100</td><td>0.034 sec</td><td>0.048 sec</td><td>19 GB</td><td>128 GB</td></tr><tr><td>12XL</td><td>1,000,000</td><td>32</td><td>80</td><td>200</td><td>1420</td><td>0.041 sec</td><td>0.095 sec</td><td>21 GB</td><td>192 GB</td></tr><tr><td>16XL</td><td>1,000,000</td><td>32</td><td>80</td><td>200</td><td>1650</td><td>0.037 sec</td><td>0.081 sec</td><td>23 GB</td><td>256 GB</td></tr></tbody></table><p>Accuracy was 0.99 for benchmarks.</p><p>QPS can also be improved by increasing <a href=\"/docs/guides/ai/going-to-prod#hnsw-understanding-efconstruction--efsearch--and-m\"><code>m</code> and <code>ef_construction</code></a>. This will allow you to use a smaller value for <code>ef_search</code> and increase QPS.</p></div></div>\n<h3 id=\"hnsw-1536-dimensions\" class=\"group scroll-mt-24\">1536 dimensions <a href=\"#hnsw-1536-dimensions\" aria-hidden=\"true\" class=\"ml-2 opacity-0 group-hover:opacity-100 transition\"><span aria-hidden=\"true\">#</span></a></h3>\n<p>This benchmark uses the <a href=\"https://huggingface.co/datasets/KShivendu/dbpedia-entities-openai-1M\">dbpedia-entities-openai-1M</a> dataset, which contains 1,000,000 embeddings of text. And 224,482 embeddings from <a href=\"https://huggingface.co/datasets/Supabase/wikipedia-en-embeddings\">Wikipedia articles</a> for compute add-ons <code>large</code> and below. Each embedding is 1536 dimensions created with the <a href=\"https://platform.openai.com/docs/guides/embeddings\">OpenAI Embeddings API</a>.</p>\n<div dir=\"ltr\" data-orientation=\"horizontal\" class=\"w-full justify-between space-y-4 \"><div role=\"tablist\" aria-orientation=\"horizontal\" class=\" flex items-center border-b border-secondary  overflow-auto whitespace-nowrap no-scrollbar mask-fadeout-right flex-wrap\" tabindex=\"-1\" data-orientation=\"horizontal\" style=\"outline:none\"><button type=\"button\" role=\"tab\" aria-selected=\"true\" aria-controls=\"radix-:Rje9jtsn7qb6ra:-content-openai1536\" data-state=\"active\" id=\"radix-:Rje9jtsn7qb6ra:-trigger-openai1536\" class=\" relative cursor-pointer text-foreground-lighter flex items-center space-x-2 text-center transition focus:outline-none focus-visible:ring focus-visible:ring-foreground-muted focus-visible:border-foreground-muted  text-sm leading-4 px-3 py-2  !text-foreground border-b-2 border-foreground \" tabindex=\"-1\" data-orientation=\"horizontal\" data-radix-collection-item=\"\"><span>OpenAI-1536</span></button></div><div data-state=\"active\" data-orientation=\"horizontal\" role=\"tabpanel\" aria-labelledby=\"radix-:Rje9jtsn7qb6ra:-trigger-openai1536\" id=\"radix-:Rje9jtsn7qb6ra:-content-openai1536\" tabindex=\"0\" class=\"focus:outline-none transition-height \" style=\"animation-duration:0s\"><table><thead><tr><th>Compute Size</th><th>Vectors</th><th>m</th><th>ef_construction</th><th>ef_search</th><th>QPS</th><th>Latency Mean</th><th>Latency p95</th><th>RAM Usage</th><th>RAM</th></tr></thead><tbody><tr><td>Micro</td><td>15,000</td><td>16</td><td>40</td><td>40</td><td>480</td><td>0.011 sec</td><td>0.016 sec</td><td>1.2 GB (Swap)</td><td>1 GB</td></tr><tr><td>Small</td><td>50,000</td><td>32</td><td>64</td><td>100</td><td>175</td><td>0.031 sec</td><td>0.051 sec</td><td>2.2 GB (Swap)</td><td>2 GB</td></tr><tr><td>Medium</td><td>100,000</td><td>32</td><td>64</td><td>100</td><td>240</td><td>0.083 sec</td><td>0.126 sec</td><td>4 GB</td><td>4 GB</td></tr><tr><td>Large</td><td>224,482</td><td>32</td><td>64</td><td>100</td><td>280</td><td>0.017 sec</td><td>0.028 sec</td><td>8 GB</td><td>8 GB</td></tr><tr><td>XL</td><td>500,000</td><td>24</td><td>56</td><td>100</td><td>360</td><td>0.055 sec</td><td>0.135 sec</td><td>13 GB</td><td>16 GB</td></tr><tr><td>2XL</td><td>1,000,000</td><td>24</td><td>56</td><td>250</td><td>560</td><td>0.036 sec</td><td>0.058 sec</td><td>32 GB</td><td>32 GB</td></tr><tr><td>4XL</td><td>1,000,000</td><td>24</td><td>56</td><td>250</td><td>950</td><td>0.021 sec</td><td>0.033 sec</td><td>39 GB</td><td>64 GB</td></tr><tr><td>8XL</td><td>1,000,000</td><td>24</td><td>56</td><td>250</td><td>1650</td><td>0.016 sec</td><td>0.023 sec</td><td>40 GB</td><td>128 GB</td></tr><tr><td>12XL</td><td>1,000,000</td><td>24</td><td>56</td><td>250</td><td>1900</td><td>0.015 sec</td><td>0.021 sec</td><td>38 GB</td><td>192 GB</td></tr><tr><td>16XL</td><td>1,000,000</td><td>24</td><td>56</td><td>250</td><td>2200</td><td>0.015 sec</td><td>0.020 sec</td><td>40 GB</td><td>256 GB</td></tr></tbody></table><p>Accuracy was 0.99 for benchmarks.</p><p>QPS can also be improved by increasing <a href=\"/docs/guides/ai/going-to-prod#hnsw-understanding-efconstruction--efsearch--and-m\"><code>m</code> and <code>ef_construction</code></a>. This will allow you to use a smaller value for <code>ef_search</code> and increase QPS. For example, increasing <code>m</code> to 32 and <code>ef_construction</code> to 80 for 4XL will increase QPS to 1280.</p></div></div>\n<div role=\"alert\" class=\"relative w-full text-sm rounded-lg p-4 [&amp;>svg~*]:pl-10 [&amp;>svg+div]:translate-y-[-3px] [&amp;>svg]:absolute [&amp;>svg]:left-4 [&amp;>svg]:top-4 [&amp;>svg]:w-[23px] [&amp;>svg]:h-[23px] [&amp;>svg]:p-1 [&amp;>svg]:flex [&amp;>svg]:rounded text-foreground [&amp;>svg]:text-background [&amp;>svg]:bg-foreground mb-2 [&amp;_svg]:bg-foreground-muted [&amp;_svg]:text-background-muted bg-surface-200/25 border border-default\"><svg xmlns=\"http://www.w3.org/2000/svg\" viewBox=\"0 0 21 20\" class=\"w-6 h-6\" fill=\"currentColor\"><path fill-rule=\"evenodd\" clip-rule=\"evenodd\" d=\"M0.625 9.8252C0.625 4.44043 4.99023 0.0751953 10.375 0.0751953C15.7598 0.0751953 20.125 4.44043 20.125 9.8252C20.125 15.21 15.7598 19.5752 10.375 19.5752C4.99023 19.5752 0.625 15.21 0.625 9.8252ZM9.3584 4.38135C9.45117 4.28857 9.55518 4.20996 9.66699 4.14648C9.88086 4.02539 10.1245 3.96045 10.375 3.96045C10.5845 3.96045 10.7896 4.00586 10.9766 4.09229C11.1294 4.1626 11.2705 4.26025 11.3916 4.38135C11.6611 4.65088 11.8125 5.0166 11.8125 5.39795C11.8125 5.5249 11.7959 5.6499 11.7637 5.77002C11.6987 6.01172 11.5718 6.23438 11.3916 6.41455C11.1221 6.68408 10.7563 6.83545 10.375 6.83545C9.99365 6.83545 9.62793 6.68408 9.3584 6.41455C9.08887 6.14502 8.9375 5.7793 8.9375 5.39795C8.9375 5.29492 8.94873 5.19287 8.97021 5.09375C9.02783 4.82568 9.16162 4.57812 9.3584 4.38135ZM10.375 15.6899C10.0933 15.6899 9.82275 15.5781 9.62354 15.3789C9.42432 15.1797 9.3125 14.9092 9.3125 14.6274V9.31494C9.3125 9.0332 9.42432 8.7627 9.62354 8.56348C9.82275 8.36426 10.0933 8.25244 10.375 8.25244C10.6567 8.25244 10.9272 8.36426 11.1265 8.56348C11.3257 8.7627 11.4375 9.0332 11.4375 9.31494V14.6274C11.4375 14.7944 11.3979 14.9575 11.3242 15.104C11.2739 15.2046 11.2075 15.2979 11.1265 15.3789C10.9272 15.5781 10.6567 15.6899 10.375 15.6899Z\"></path></svg><div class=\"text mt [&amp;_p]:mb-1.5 [&amp;_p]:mt-0 mt-0.5 [&amp;_p:last-child]:mb-0\"><p>It is possible to upload more vectors to a single table if Memory allows it (for example, 4XL plan and higher for OpenAI embeddings). But it will affect the performance of the queries: QPS will be lower, and latency will be higher. Scaling should be almost linear, but it is recommended to benchmark your workload to find the optimal number of vectors per table and per database instance.</p></div></div>\n<!-- -->\n<h2 id=\"ivfflat\" class=\"group scroll-mt-24\">IVFFlat<a href=\"#ivfflat\" aria-hidden=\"true\" class=\"ml-2 opacity-0 group-hover:opacity-100 transition\"><span aria-hidden=\"true\">#</span></a></h2>\n<h3 id=\"ivfflat-384-dimensions\" class=\"group scroll-mt-24\">384 dimensions <a href=\"#ivfflat-384-dimensions\" aria-hidden=\"true\" class=\"ml-2 opacity-0 group-hover:opacity-100 transition\"><span aria-hidden=\"true\">#</span></a></h3>\n<p>This benchmark uses the dbpedia-entities-openai-1M dataset containing 1,000,000 embeddings of text, regenerated for 384 dimension embeddings. Each embedding is generated using <a href=\"https://huggingface.co/Supabase/gte-small\">gte-small</a>.</p>\n<div dir=\"ltr\" data-orientation=\"horizontal\" class=\"w-full justify-between space-y-4 \"><div role=\"tablist\" aria-orientation=\"horizontal\" class=\" flex items-center border-b border-secondary  overflow-auto whitespace-nowrap no-scrollbar mask-fadeout-right flex-wrap\" tabindex=\"-1\" data-orientation=\"horizontal\" style=\"outline:none\"><button type=\"button\" role=\"tab\" aria-selected=\"true\" aria-controls=\"radix-:Rku9jtsn7qb6ra:-content-gte384_98\" data-state=\"active\" id=\"radix-:Rku9jtsn7qb6ra:-trigger-gte384_98\" class=\" relative cursor-pointer text-foreground-lighter flex items-center space-x-2 text-center transition focus:outline-none focus-visible:ring focus-visible:ring-foreground-muted focus-visible:border-foreground-muted  text-sm leading-4 px-3 py-2  !text-foreground border-b-2 border-foreground \" tabindex=\"-1\" data-orientation=\"horizontal\" data-radix-collection-item=\"\"><span>gte-small-384, accuracy=.98</span></button><button type=\"button\" role=\"tab\" aria-selected=\"false\" aria-controls=\"radix-:Rku9jtsn7qb6ra:-content-gte384_99\" data-state=\"inactive\" id=\"radix-:Rku9jtsn7qb6ra:-trigger-gte384_99\" class=\" relative cursor-pointer text-foreground-lighter flex items-center space-x-2 text-center transition focus:outline-none focus-visible:ring focus-visible:ring-foreground-muted focus-visible:border-foreground-muted  text-sm leading-4 px-3 py-2  hover:text-foreground \" tabindex=\"-1\" data-orientation=\"horizontal\" data-radix-collection-item=\"\"><span>gte-small-384, accuracy=.99</span></button></div><div data-state=\"active\" data-orientation=\"horizontal\" role=\"tabpanel\" aria-labelledby=\"radix-:Rku9jtsn7qb6ra:-trigger-gte384_98\" id=\"radix-:Rku9jtsn7qb6ra:-content-gte384_98\" tabindex=\"0\" class=\"focus:outline-none transition-height \" style=\"animation-duration:0s\"><table><thead><tr><th>Compute Size</th><th>Vectors</th><th>Lists</th><th>Probes</th><th>QPS</th><th>Latency Mean</th><th>Latency p95</th><th>RAM Usage</th><th>RAM</th></tr></thead><tbody><tr><td>Micro</td><td>100,000</td><td>500</td><td>50</td><td>205</td><td>0.048 sec</td><td>0.066 sec</td><td>1.2 GB (Swap)</td><td>1 GB</td></tr><tr><td>Small</td><td>250,000</td><td>1000</td><td>60</td><td>160</td><td>0.062 sec</td><td>0.079 sec</td><td>2 GB</td><td>2 GB</td></tr><tr><td>Medium</td><td>500,000</td><td>2000</td><td>80</td><td>120</td><td>0.082 sec</td><td>0.104 sec</td><td>3.2 GB</td><td>4 GB</td></tr><tr><td>Large</td><td>1,000,000</td><td>5000</td><td>150</td><td>75</td><td>0.269 sec</td><td>0.375 sec</td><td>6.5 GB</td><td>8 GB</td></tr><tr><td>XL</td><td>1,000,000</td><td>5000</td><td>150</td><td>150</td><td>0.131 sec</td><td>0.178 sec</td><td>9 GB</td><td>16 GB</td></tr><tr><td>2XL</td><td>1,000,000</td><td>5000</td><td>150</td><td>300</td><td>0.066 sec</td><td>0.099 sec</td><td>10 GB</td><td>32 GB</td></tr><tr><td>4XL</td><td>1,000,000</td><td>5000</td><td>150</td><td>570</td><td>0.035 sec</td><td>0.046 sec</td><td>10 GB</td><td>64 GB</td></tr><tr><td>8XL</td><td>1,000,000</td><td>5000</td><td>150</td><td>1400</td><td>0.023 sec</td><td>0.028 sec</td><td>12 GB</td><td>128 GB</td></tr><tr><td>12XL</td><td>1,000,000</td><td>5000</td><td>150</td><td>1550</td><td>0.030 sec</td><td>0.039 sec</td><td>12 GB</td><td>192 GB</td></tr><tr><td>16XL</td><td>1,000,000</td><td>5000</td><td>150</td><td>1800</td><td>0.030 sec</td><td>0.039 sec</td><td>16 GB</td><td>256 GB</td></tr></tbody></table></div><div data-state=\"inactive\" data-orientation=\"horizontal\" role=\"tabpanel\" aria-labelledby=\"radix-:Rku9jtsn7qb6ra:-trigger-gte384_99\" hidden=\"\" id=\"radix-:Rku9jtsn7qb6ra:-content-gte384_99\" tabindex=\"0\" class=\"focus:outline-none transition-height \"></div></div>\n<h3 id=\"ivfflat-960-dimensions\" class=\"group scroll-mt-24\">960 dimensions <a href=\"#ivfflat-960-dimensions\" aria-hidden=\"true\" class=\"ml-2 opacity-0 group-hover:opacity-100 transition\"><span aria-hidden=\"true\">#</span></a></h3>\n<p>This benchmark uses the <a href=\"http://corpus-texmex.irisa.fr/\">gist-960</a> dataset, which contains 1,000,000 embeddings of images. Each embedding is 960 dimensions.</p>\n<div dir=\"ltr\" data-orientation=\"horizontal\" class=\"w-full justify-between space-y-4 \"><div role=\"tablist\" aria-orientation=\"horizontal\" class=\" flex items-center border-b border-secondary  overflow-auto whitespace-nowrap no-scrollbar mask-fadeout-right flex-wrap\" tabindex=\"-1\" data-orientation=\"horizontal\" style=\"outline:none\"><button type=\"button\" role=\"tab\" aria-selected=\"true\" aria-controls=\"radix-:Rlm9jtsn7qb6ra:-content-gist960\" data-state=\"active\" id=\"radix-:Rlm9jtsn7qb6ra:-trigger-gist960\" class=\" relative cursor-pointer text-foreground-lighter flex items-center space-x-2 text-center transition focus:outline-none focus-visible:ring focus-visible:ring-foreground-muted focus-visible:border-foreground-muted  text-sm leading-4 px-3 py-2  !text-foreground border-b-2 border-foreground \" tabindex=\"-1\" data-orientation=\"horizontal\" data-radix-collection-item=\"\"><span>gist-960, probes = 10</span></button></div><div data-state=\"active\" data-orientation=\"horizontal\" role=\"tabpanel\" aria-labelledby=\"radix-:Rlm9jtsn7qb6ra:-trigger-gist960\" id=\"radix-:Rlm9jtsn7qb6ra:-content-gist960\" tabindex=\"0\" class=\"focus:outline-none transition-height \" style=\"animation-duration:0s\"><table><thead><tr><th>Compute Size</th><th>Vectors</th><th>Lists</th><th>QPS</th><th>Latency Mean</th><th>Latency p95</th><th>RAM Usage</th><th>RAM</th></tr></thead><tbody><tr><td>Micro</td><td>30,000</td><td>30</td><td>75</td><td>0.065 sec</td><td>0.088 sec</td><td>1.1 GB (Swap)</td><td>1 GB</td></tr><tr><td>Small</td><td>100,000</td><td>100</td><td>78</td><td>0.064 sec</td><td>0.092 sec</td><td>1.8 GB</td><td>2 GB</td></tr><tr><td>Medium</td><td>250,000</td><td>250</td><td>58</td><td>0.085 sec</td><td>0.129 sec</td><td>3.2 GB</td><td>4 GB</td></tr><tr><td>Large</td><td>500,000</td><td>500</td><td>55</td><td>0.088 sec</td><td>0.140 sec</td><td>5 GB</td><td>8 GB</td></tr><tr><td>XL</td><td>1,000,000</td><td>1000</td><td>110</td><td>0.046 sec</td><td>0.070 sec</td><td>14 GB</td><td>16 GB</td></tr><tr><td>2XL</td><td>1,000,000</td><td>1000</td><td>235</td><td>0.083 sec</td><td>0.136 sec</td><td>10 GB</td><td>32 GB</td></tr><tr><td>4XL</td><td>1,000,000</td><td>1000</td><td>420</td><td>0.071 sec</td><td>0.106 sec</td><td>11 GB</td><td>64 GB</td></tr><tr><td>8XL</td><td>1,000,000</td><td>1000</td><td>815</td><td>0.072 sec</td><td>0.106 sec</td><td>13 GB</td><td>128 GB</td></tr><tr><td>12XL</td><td>1,000,000</td><td>1000</td><td>1150</td><td>0.052 sec</td><td>0.078 sec</td><td>15.5 GB</td><td>192 GB</td></tr><tr><td>16XL</td><td>1,000,000</td><td>1000</td><td>1345</td><td>0.072 sec</td><td>0.106 sec</td><td>17.5 GB</td><td>256 GB</td></tr></tbody></table></div></div>\n<h3 id=\"ivfflat-1536-dimensions\" class=\"group scroll-mt-24\">1536 dimensions <a href=\"#ivfflat-1536-dimensions\" aria-hidden=\"true\" class=\"ml-2 opacity-0 group-hover:opacity-100 transition\"><span aria-hidden=\"true\">#</span></a></h3>\n<p>This benchmark uses the <a href=\"https://huggingface.co/datasets/KShivendu/dbpedia-entities-openai-1M\">dbpedia-entities-openai-1M</a> dataset, which contains 1,000,000 embeddings of text. Each embedding is 1536 dimensions created with the <a href=\"https://platform.openai.com/docs/guides/embeddings\">OpenAI Embeddings API</a>.</p>\n<div dir=\"ltr\" data-orientation=\"horizontal\" class=\"w-full justify-between space-y-4 \"><div role=\"tablist\" aria-orientation=\"horizontal\" class=\" flex items-center border-b border-secondary  overflow-auto whitespace-nowrap no-scrollbar mask-fadeout-right flex-wrap\" tabindex=\"-1\" data-orientation=\"horizontal\" style=\"outline:none\"><button type=\"button\" role=\"tab\" aria-selected=\"true\" aria-controls=\"radix-:Rme9jtsn7qb6ra:-content-dbpedia1536\" data-state=\"active\" id=\"radix-:Rme9jtsn7qb6ra:-trigger-dbpedia1536\" class=\" relative cursor-pointer text-foreground-lighter flex items-center space-x-2 text-center transition focus:outline-none focus-visible:ring focus-visible:ring-foreground-muted focus-visible:border-foreground-muted  text-sm leading-4 px-3 py-2  !text-foreground border-b-2 border-foreground \" tabindex=\"-1\" data-orientation=\"horizontal\" data-radix-collection-item=\"\"><span>OpenAI-1536, probes = 10</span></button><button type=\"button\" role=\"tab\" aria-selected=\"false\" aria-controls=\"radix-:Rme9jtsn7qb6ra:-content-dbpedia1536_40\" data-state=\"inactive\" id=\"radix-:Rme9jtsn7qb6ra:-trigger-dbpedia1536_40\" class=\" relative cursor-pointer text-foreground-lighter flex items-center space-x-2 text-center transition focus:outline-none focus-visible:ring focus-visible:ring-foreground-muted focus-visible:border-foreground-muted  text-sm leading-4 px-3 py-2  hover:text-foreground \" tabindex=\"-1\" data-orientation=\"horizontal\" data-radix-collection-item=\"\"><span>OpenAI-1536, probes = 40</span></button></div><div data-state=\"active\" data-orientation=\"horizontal\" role=\"tabpanel\" aria-labelledby=\"radix-:Rme9jtsn7qb6ra:-trigger-dbpedia1536\" id=\"radix-:Rme9jtsn7qb6ra:-content-dbpedia1536\" tabindex=\"0\" class=\"focus:outline-none transition-height \" style=\"animation-duration:0s\"><table><thead><tr><th>Compute Size</th><th>Vectors</th><th>Lists</th><th>QPS</th><th>Latency Mean</th><th>Latency p95</th><th>RAM Usage</th><th>RAM</th></tr></thead><tbody><tr><td>Micro</td><td>20,000</td><td>40</td><td>135</td><td>0.372 sec</td><td>0.412 sec</td><td>1.2 GB (Swap)</td><td>1 GB</td></tr><tr><td>Small</td><td>50,000</td><td>100</td><td>140</td><td>0.357 sec</td><td>0.398 sec</td><td>1.8 GB</td><td>2 GB</td></tr><tr><td>Medium</td><td>100,000</td><td>200</td><td>130</td><td>0.383 sec</td><td>0.446 sec</td><td>3.7 GB</td><td>4 GB</td></tr><tr><td>Large</td><td>250,000</td><td>500</td><td>130</td><td>0.378 sec</td><td>0.434 sec</td><td>7 GB</td><td>8 GB</td></tr><tr><td>XL</td><td>500,000</td><td>1000</td><td>235</td><td>0.213 sec</td><td>0.271 sec</td><td>13.5 GB</td><td>16 GB</td></tr><tr><td>2XL</td><td>1,000,000</td><td>2000</td><td>380</td><td>0.133 sec</td><td>0.236 sec</td><td>30 GB</td><td>32 GB</td></tr><tr><td>4XL</td><td>1,000,000</td><td>2000</td><td>720</td><td>0.068 sec</td><td>0.120 sec</td><td>35 GB</td><td>64 GB</td></tr><tr><td>8XL</td><td>1,000,000</td><td>2000</td><td>1250</td><td>0.039 sec</td><td>0.066 sec</td><td>38 GB</td><td>128 GB</td></tr><tr><td>12XL</td><td>1,000,000</td><td>2000</td><td>1600</td><td>0.030 sec</td><td>0.052 sec</td><td>41 GB</td><td>192 GB</td></tr><tr><td>16XL</td><td>1,000,000</td><td>2000</td><td>1790</td><td>0.029 sec</td><td>0.051 sec</td><td>45 GB</td><td>256 GB</td></tr></tbody></table><p>For 1,000,000 vectors 10 probes results to accuracy of 0.91. And for 500,000 vectors and below 10 probes results to accuracy in the range of 0.95 - 0.99. To increase accuracy, you need to increase the number of probes.</p></div><div data-state=\"inactive\" data-orientation=\"horizontal\" role=\"tabpanel\" aria-labelledby=\"radix-:Rme9jtsn7qb6ra:-trigger-dbpedia1536_40\" hidden=\"\" id=\"radix-:Rme9jtsn7qb6ra:-content-dbpedia1536_40\" tabindex=\"0\" class=\"focus:outline-none transition-height \"></div></div>\n<!-- -->\n<div role=\"alert\" class=\"relative w-full text-sm rounded-lg p-4 [&amp;>svg~*]:pl-10 [&amp;>svg+div]:translate-y-[-3px] [&amp;>svg]:absolute [&amp;>svg]:left-4 [&amp;>svg]:top-4 [&amp;>svg]:w-[23px] [&amp;>svg]:h-[23px] [&amp;>svg]:p-1 [&amp;>svg]:flex [&amp;>svg]:rounded text-foreground [&amp;>svg]:text-background [&amp;>svg]:bg-foreground mb-2 [&amp;_svg]:bg-foreground-muted [&amp;_svg]:text-background-muted bg-surface-200/25 border border-default\"><svg xmlns=\"http://www.w3.org/2000/svg\" viewBox=\"0 0 21 20\" class=\"w-6 h-6\" fill=\"currentColor\"><path fill-rule=\"evenodd\" clip-rule=\"evenodd\" d=\"M0.625 9.8252C0.625 4.44043 4.99023 0.0751953 10.375 0.0751953C15.7598 0.0751953 20.125 4.44043 20.125 9.8252C20.125 15.21 15.7598 19.5752 10.375 19.5752C4.99023 19.5752 0.625 15.21 0.625 9.8252ZM9.3584 4.38135C9.45117 4.28857 9.55518 4.20996 9.66699 4.14648C9.88086 4.02539 10.1245 3.96045 10.375 3.96045C10.5845 3.96045 10.7896 4.00586 10.9766 4.09229C11.1294 4.1626 11.2705 4.26025 11.3916 4.38135C11.6611 4.65088 11.8125 5.0166 11.8125 5.39795C11.8125 5.5249 11.7959 5.6499 11.7637 5.77002C11.6987 6.01172 11.5718 6.23438 11.3916 6.41455C11.1221 6.68408 10.7563 6.83545 10.375 6.83545C9.99365 6.83545 9.62793 6.68408 9.3584 6.41455C9.08887 6.14502 8.9375 5.7793 8.9375 5.39795C8.9375 5.29492 8.94873 5.19287 8.97021 5.09375C9.02783 4.82568 9.16162 4.57812 9.3584 4.38135ZM10.375 15.6899C10.0933 15.6899 9.82275 15.5781 9.62354 15.3789C9.42432 15.1797 9.3125 14.9092 9.3125 14.6274V9.31494C9.3125 9.0332 9.42432 8.7627 9.62354 8.56348C9.82275 8.36426 10.0933 8.25244 10.375 8.25244C10.6567 8.25244 10.9272 8.36426 11.1265 8.56348C11.3257 8.7627 11.4375 9.0332 11.4375 9.31494V14.6274C11.4375 14.7944 11.3979 14.9575 11.3242 15.104C11.2739 15.2046 11.2075 15.2979 11.1265 15.3789C10.9272 15.5781 10.6567 15.6899 10.375 15.6899Z\"></path></svg><div class=\"text mt [&amp;_p]:mb-1.5 [&amp;_p]:mt-0 mt-0.5 [&amp;_p:last-child]:mb-0\"><p>It is possible to upload more vectors to a single table if Memory allows it (for example, 4XL plan and higher for OpenAI embeddings). But it will affect the performance of the queries: QPS will be lower, and latency will be higher. Scaling should be almost linear, but it is recommended to benchmark your workload to find the optimal number of vectors per table and per database instance.</p></div></div>\n<h2 id=\"performance-tips\" class=\"group scroll-mt-24\">Performance tips<a href=\"#performance-tips\" aria-hidden=\"true\" class=\"ml-2 opacity-0 group-hover:opacity-100 transition\"><span aria-hidden=\"true\">#</span></a></h2>\n<p>There are various ways to improve your pgvector performance. Here are some tips:</p>\n<h3 id=\"pre-warming-your-database\" class=\"group scroll-mt-24\">Pre-warming your database<a href=\"#pre-warming-your-database\" aria-hidden=\"true\" class=\"ml-2 opacity-0 group-hover:opacity-100 transition\"><span aria-hidden=\"true\">#</span></a></h3>\n<p>It's useful to execute a few thousand \u201cwarm-up\u201d queries before going into production. This helps help with RAM utilization. This can also help to determine that you've selected the right compute size for your workload.</p>\n<h3 id=\"finetune-index-parameters\" class=\"group scroll-mt-24\">Finetune index parameters<a href=\"#finetune-index-parameters\" aria-hidden=\"true\" class=\"ml-2 opacity-0 group-hover:opacity-100 transition\"><span aria-hidden=\"true\">#</span></a></h3>\n<p>You can increase the Requests per Second by increasing <code>m</code> and <code>ef_construction</code> or <code>lists</code>. This also has an important caveat: building the index takes longer with higher values for these parameters.</p>\n<div dir=\"ltr\" data-orientation=\"horizontal\" class=\"w-full justify-between space-y-4 \"><div role=\"tablist\" aria-orientation=\"horizontal\" class=\" flex items-center border-b border-secondary  overflow-auto whitespace-nowrap no-scrollbar mask-fadeout-right flex-wrap\" tabindex=\"-1\" data-orientation=\"horizontal\" style=\"outline:none\"><button type=\"button\" role=\"tab\" aria-selected=\"true\" aria-controls=\"radix-:Rom9jtsn7qb6ra:-content-hnsw\" data-state=\"active\" id=\"radix-:Rom9jtsn7qb6ra:-trigger-hnsw\" class=\" relative cursor-pointer text-foreground-lighter flex items-center space-x-2 text-center transition focus:outline-none focus-visible:ring focus-visible:ring-foreground-muted focus-visible:border-foreground-muted  text-sm leading-4 px-3 py-2  !text-foreground border-b-2 border-foreground \" tabindex=\"-1\" data-orientation=\"horizontal\" data-radix-collection-item=\"\"><span>HNSW</span></button><button type=\"button\" role=\"tab\" aria-selected=\"false\" aria-controls=\"radix-:Rom9jtsn7qb6ra:-content-ivfflat\" data-state=\"inactive\" id=\"radix-:Rom9jtsn7qb6ra:-trigger-ivfflat\" class=\" relative cursor-pointer text-foreground-lighter flex items-center space-x-2 text-center transition focus:outline-none focus-visible:ring focus-visible:ring-foreground-muted focus-visible:border-foreground-muted  text-sm leading-4 px-3 py-2  hover:text-foreground \" tabindex=\"-1\" data-orientation=\"horizontal\" data-radix-collection-item=\"\"><span>IVFFlat</span></button></div><div data-state=\"active\" data-orientation=\"horizontal\" role=\"tabpanel\" aria-labelledby=\"radix-:Rom9jtsn7qb6ra:-trigger-hnsw\" id=\"radix-:Rom9jtsn7qb6ra:-content-hnsw\" tabindex=\"0\" class=\"focus:outline-none transition-height \" style=\"animation-duration:0s\"></div><div data-state=\"inactive\" data-orientation=\"horizontal\" role=\"tabpanel\" aria-labelledby=\"radix-:Rom9jtsn7qb6ra:-trigger-ivfflat\" hidden=\"\" id=\"radix-:Rom9jtsn7qb6ra:-content-ivfflat\" tabindex=\"0\" class=\"focus:outline-none transition-height \"></div></div>\n<p>Check out more tips and the complete step-by-step guide in <a href=\"going-to-prod\">Going to Production for AI applications</a>.</p>\n<h2 id=\"benchmark-methodology\" class=\"group scroll-mt-24\">Benchmark methodology<a href=\"#benchmark-methodology\" aria-hidden=\"true\" class=\"ml-2 opacity-0 group-hover:opacity-100 transition\"><span aria-hidden=\"true\">#</span></a></h2>\n<p>We follow techniques outlined in the <a href=\"https://github.com/erikbern/ann-benchmarks\">ANN Benchmarks</a> methodology. A Python test runner is responsible for uploading the data, creating the index, and running the queries. The pgvector engine is implemented using <a href=\"https://github.com/supabase/vecs\">vecs</a>, a Python client for pgvector.</p>\n<!-- -->\n<p>Each test is run for a minimum of 30-40 minutes. They include a series of experiments executed at different concurrency levels to measure the engine's performance under different load types. The results are then averaged.</p>\n<p>As a general recommendation, we suggest using a concurrency level of 5 or more for most workloads and 30 or more for high-load workloads.</p></article></div></div></div><!--$--><div class=\"max-w-7xl px-5 mx-auto py-8 pt-0\"></div><!--/$--></div><div class=\"left-0 right-0 z-10 backdrop-blur-sm backdrop-filter bg-alternative/90 hidden h-0 lg:hidden\"></div></div></main></div></div></div></div></body></html>",
      "metadata": {
        "ogUrl": "https://supabase.com/docs/guides/ai/choosing-compute-addon",
        "title": "Choosing your Compute Add-on | Supabase Docs",
        "robots": "index, follow",
        "ogImage": "https://obuldanrptloktxcffvn.supabase.co/functions/v1/og-images?site=docs&type=ai&title=Choosing%20your%20Compute%20Add-on&description=Choosing%20the%20right%20Compute%20Add-on%20for%20your%20vector%20workload.",
        "ogTitle": "Choosing your Compute Add-on | Supabase Docs",
        "language": "en",
        "sourceURL": "https://supabase.com/docs/guides/ai/choosing-compute-addon",
        "description": "Choosing the right Compute Add-on for your vector workload.",
        "modifiedTime": "2024-09-10T20:36:25.434Z",
        "ogDescription": "Choosing the right Compute Add-on for your vector workload.",
        "publishedTime": "2024-09-10T20:36:25.434Z",
        "ogLocaleAlternate": [],
        "statusCode": 200
      }
    },
    {
      "markdown": "AI & Vectors\n\n# Python client\n\n## Manage unstructured vector stores in PostgreSQL.\n\n* * *\n\nSupabase provides a Python client called [`vecs`](https://github.com/supabase/vecs) for managing unstructured vector stores. This client provides a set of useful tools for creating and querying collections in PostgreSQL using the [pgvector](/docs/guides/database/extensions/pgvector) extension.\n\n## Quick start [\\#](\\#quick-start)\n\nLet's see how Vecs works using a local database. Make sure you have the Supabase CLI [installed](/docs/guides/cli#installation) on your machine.\n\n### Initialize your project [\\#](\\#initialize-your-project)\n\nStart a local Postgres instance in any folder using the `init` and `start` commands. Make sure you have Docker running!\n\n`\n_10\n# Initialize your project\n_10\nsupabase init\n_10\n_10\n# Start Postgres\n_10\nsupabase start\n`\n\n### Create a collection [\\#](\\#create-a-collection)\n\nInside a Python shell, run the following commands to create a new collection called \"docs\", with 3 dimensions.\n\n`\n_10\nimport vecs\n_10\n_10\n# create vector store client\n_10\nvx = vecs.create_client(\"postgresql://postgres:postgres@localhost:54322/postgres\")\n_10\n_10\n# create a collection of vectors with 3 dimensions\n_10\ndocs = vx.get_or_create_collection(name=\"docs\", dimension=3)\n`\n\n### Add embeddings [\\#](\\#add-embeddings)\n\nNow we can insert some embeddings into our \"docs\" collection using the `upsert()` command:\n\n`\n_13\nimport vecs\n_13\n_13\n# create vector store client\n_13\ndocs = vecs.get_or_create_collection(name=\"docs\", dimension=3)\n_13\n_13\n# a collection of vectors with 3 dimensions\n_13\nvectors=[\\\n_13\\\n(\"vec0\", [0.1, 0.2, 0.3], {\"year\": 1973}),\\\n_13\\\n(\"vec1\", [0.7, 0.8, 0.9], {\"year\": 2012})\\\n_13\\\n]\n_13\n_13\n# insert our vectors\n_13\ndocs.upsert(vectors=vectors)\n`\n\n### Query the collection [\\#](\\#query-the-collection)\n\nYou can now query the collection to retrieve a relevant match:\n\n`\n_10\nimport vecs\n_10\n_10\ndocs = vecs.get_or_create_collection(name=\"docs\", dimension=3)\n_10\n_10\n# query the collection filtering metadata for \"year\" = 2012\n_10\ndocs.query(\n_10\n    data=[0.4,0.5,0.6],      # required\n_10\n    limit=1,                         # number of records to return\n_10\n    filters={\"year\": {\"$eq\": 2012}}, # metadata filters\n_10\n)\n`\n\n## Deep dive [\\#](\\#deep-dive)\n\nFor a more in-depth guide on `vecs` collections, see [API](/docs/guides/ai/python/api).\n\n## Resources [\\#](\\#resources)\n\n- Official Vecs Documentation: [https://supabase.github.io/vecs/api](https://supabase.github.io/vecs/api)\n- Source Code: [https://github.com/supabase/vecs](https://github.com/supabase/vecs)",
      "html": "<!DOCTYPE html><html lang=\"en\" data-theme=\"light\" style=\"color-scheme: light;\"><body><div class=\"flex flex-col\"><div class=\"grow\"><div class=\"flex flex-col h-full w-full\"><div class=\"hidden lg:sticky w-full lg:flex top-0 left-0 right-0 z-50\"><!--$--><!--/$--></div><div class=\"flex flex-row h-full relative\"><main id=\"docs-content-container\" class=\"w-full transition-all ease-out relative lg:ml-0\"><div class=\"flex flex-col sticky top-0\"><div class=\"flex lg:hidden w-full top-0 left-0 right-0 z-50\"><!--$--><!--/$--></div><div class=\"sticky transition-all top-0 z-10 backdrop-blur backdrop-filter bg-background\"><div class=\"lg:hidden px-3.5 border-b z-10 transition-all ease-out top-0 flex items-center gap-1\"><button class=\"h-8 w-8 flex group items-center justify-center mr-1\"><div class=\"space-y-1 cursor-pointer relative w-4 h-[8px]\"><span class=\"transition-all ease-out block h-px bg-foreground-muted group-hover:bg-foreground w-4\"></span><span class=\"transition-all ease-out block h-px bg-foreground-muted group-hover:bg-foreground w-3 group-hover:w-4\"></span></div></button><span class=\"transition-all duration-200 text-foreground text-sm\">AI &amp; Vectors</span></div></div><div class=\"grow\"><div class=\"max-w-7xl px-5 mx-auto py-8 pb-0\"><div class=\"grid grid-cols-12 relative gap-4\"><div class=\"relative transition-all ease-out duration-100 col-span-12 md:col-span-9\"><article id=\"sb-docs-guide-main-article\" class=\"prose max-w-none\"><h1 class=\"mb-0\">Python client</h1><h2 class=\"mt-3 text-xl text-foreground-light\">Manage unstructured vector stores in PostgreSQL.</h2><hr class=\"not-prose border-t-0 border-b my-8\">\n<p>Supabase provides a Python client called <a href=\"https://github.com/supabase/vecs\"><code>vecs</code></a> for managing unstructured vector stores. This client provides a set of useful tools for creating and querying collections in PostgreSQL using the <a href=\"/docs/guides/database/extensions/pgvector\">pgvector</a> extension.</p>\n<h2 id=\"quick-start\" class=\"group scroll-mt-24\">Quick start<a href=\"#quick-start\" aria-hidden=\"true\" class=\"ml-2 opacity-0 group-hover:opacity-100 transition\"><span aria-hidden=\"true\">#</span></a></h2>\n<p>Let's see how Vecs works using a local database. Make sure you have the Supabase CLI <a href=\"/docs/guides/cli#installation\">installed</a> on your machine.</p>\n<h3 id=\"initialize-your-project\" class=\"group scroll-mt-24\">Initialize your project<a href=\"#initialize-your-project\" aria-hidden=\"true\" class=\"ml-2 opacity-0 group-hover:opacity-100 transition\"><span aria-hidden=\"true\">#</span></a></h3>\n<p>Start a local Postgres instance in any folder using the <code>init</code> and <code>start</code> commands. Make sure you have Docker running!</p>\n<div class=\"ch-codeblock not-prose \" data-ch-theme=\"supabase\"><div class=\"ch-code-wrapper ch-code\" data-ch-measured=\"false\"><code class=\"ch-code-scroll-parent\"><br><div><span class=\"ch-code-line-number\">_<!-- -->10</span><div style=\"display:inline-block;margin-left:16px\"><span># Initialize your project</span></div></div><div><span class=\"ch-code-line-number\">_<!-- -->10</span><div style=\"display:inline-block;margin-left:16px\"><span>supabase init</span></div></div><div><span class=\"ch-code-line-number\">_<!-- -->10</span><div style=\"display:inline-block;margin-left:16px\"><span></span></div></div><div><span class=\"ch-code-line-number\">_<!-- -->10</span><div style=\"display:inline-block;margin-left:16px\"><span># Start Postgres</span></div></div><div><span class=\"ch-code-line-number\">_<!-- -->10</span><div style=\"display:inline-block;margin-left:16px\"><span>supabase start</span></div></div><br></code></div></div>\n<h3 id=\"create-a-collection\" class=\"group scroll-mt-24\">Create a collection<a href=\"#create-a-collection\" aria-hidden=\"true\" class=\"ml-2 opacity-0 group-hover:opacity-100 transition\"><span aria-hidden=\"true\">#</span></a></h3>\n<p>Inside a Python shell, run the following commands to create a new collection called \"docs\", with 3 dimensions.</p>\n<div class=\"ch-codeblock not-prose \" data-ch-theme=\"supabase\"><div class=\"ch-code-wrapper ch-code\" data-ch-measured=\"false\"><code class=\"ch-code-scroll-parent\"><br><div><span class=\"ch-code-line-number\">_<!-- -->10</span><div style=\"display:inline-block;margin-left:16px\"><span>import vecs</span></div></div><div><span class=\"ch-code-line-number\">_<!-- -->10</span><div style=\"display:inline-block;margin-left:16px\"><span></span></div></div><div><span class=\"ch-code-line-number\">_<!-- -->10</span><div style=\"display:inline-block;margin-left:16px\"><span># create vector store client</span></div></div><div><span class=\"ch-code-line-number\">_<!-- -->10</span><div style=\"display:inline-block;margin-left:16px\"><span>vx = vecs.create_client(\"postgresql://postgres:postgres@localhost:54322/postgres\")</span></div></div><div><span class=\"ch-code-line-number\">_<!-- -->10</span><div style=\"display:inline-block;margin-left:16px\"><span></span></div></div><div><span class=\"ch-code-line-number\">_<!-- -->10</span><div style=\"display:inline-block;margin-left:16px\"><span># create a collection of vectors with 3 dimensions</span></div></div><div><span class=\"ch-code-line-number\">_<!-- -->10</span><div style=\"display:inline-block;margin-left:16px\"><span>docs = vx.get_or_create_collection(name=\"docs\", dimension=3)</span></div></div><br></code></div></div>\n<h3 id=\"add-embeddings\" class=\"group scroll-mt-24\">Add embeddings<a href=\"#add-embeddings\" aria-hidden=\"true\" class=\"ml-2 opacity-0 group-hover:opacity-100 transition\"><span aria-hidden=\"true\">#</span></a></h3>\n<p>Now we can insert some embeddings into our \"docs\" collection using the <code>upsert()</code> command:</p>\n<div class=\"ch-codeblock not-prose \" data-ch-theme=\"supabase\"><div class=\"ch-code-wrapper ch-code\" data-ch-measured=\"false\"><code class=\"ch-code-scroll-parent\"><br><div><span class=\"ch-code-line-number\">_<!-- -->13</span><div style=\"display:inline-block;margin-left:16px\"><span>import vecs</span></div></div><div><span class=\"ch-code-line-number\">_<!-- -->13</span><div style=\"display:inline-block;margin-left:16px\"><span></span></div></div><div><span class=\"ch-code-line-number\">_<!-- -->13</span><div style=\"display:inline-block;margin-left:16px\"><span># create vector store client</span></div></div><div><span class=\"ch-code-line-number\">_<!-- -->13</span><div style=\"display:inline-block;margin-left:16px\"><span>docs = vecs.get_or_create_collection(name=\"docs\", dimension=3)</span></div></div><div><span class=\"ch-code-line-number\">_<!-- -->13</span><div style=\"display:inline-block;margin-left:16px\"><span></span></div></div><div><span class=\"ch-code-line-number\">_<!-- -->13</span><div style=\"display:inline-block;margin-left:16px\"><span># a collection of vectors with 3 dimensions</span></div></div><div><span class=\"ch-code-line-number\">_<!-- -->13</span><div style=\"display:inline-block;margin-left:16px\"><span>vectors=[</span></div></div><div><span class=\"ch-code-line-number\">_<!-- -->13</span><div style=\"display:inline-block;margin-left:16px\"><span>  (\"vec0\", [0.1, 0.2, 0.3], {\"year\": 1973}),</span></div></div><div><span class=\"ch-code-line-number\">_<!-- -->13</span><div style=\"display:inline-block;margin-left:16px\"><span>  (\"vec1\", [0.7, 0.8, 0.9], {\"year\": 2012})</span></div></div><div><span class=\"ch-code-line-number\">_<!-- -->13</span><div style=\"display:inline-block;margin-left:16px\"><span>]</span></div></div><div><span class=\"ch-code-line-number\">_<!-- -->13</span><div style=\"display:inline-block;margin-left:16px\"><span></span></div></div><div><span class=\"ch-code-line-number\">_<!-- -->13</span><div style=\"display:inline-block;margin-left:16px\"><span># insert our vectors</span></div></div><div><span class=\"ch-code-line-number\">_<!-- -->13</span><div style=\"display:inline-block;margin-left:16px\"><span>docs.upsert(vectors=vectors)</span></div></div><br></code></div></div>\n<h3 id=\"query-the-collection\" class=\"group scroll-mt-24\">Query the collection<a href=\"#query-the-collection\" aria-hidden=\"true\" class=\"ml-2 opacity-0 group-hover:opacity-100 transition\"><span aria-hidden=\"true\">#</span></a></h3>\n<p>You can now query the collection to retrieve a relevant match:</p>\n<div class=\"ch-codeblock not-prose \" data-ch-theme=\"supabase\"><div class=\"ch-code-wrapper ch-code\" data-ch-measured=\"false\"><code class=\"ch-code-scroll-parent\"><br><div><span class=\"ch-code-line-number\">_<!-- -->10</span><div style=\"display:inline-block;margin-left:16px\"><span>import vecs</span></div></div><div><span class=\"ch-code-line-number\">_<!-- -->10</span><div style=\"display:inline-block;margin-left:16px\"><span></span></div></div><div><span class=\"ch-code-line-number\">_<!-- -->10</span><div style=\"display:inline-block;margin-left:16px\"><span>docs = vecs.get_or_create_collection(name=\"docs\", dimension=3)</span></div></div><div><span class=\"ch-code-line-number\">_<!-- -->10</span><div style=\"display:inline-block;margin-left:16px\"><span></span></div></div><div><span class=\"ch-code-line-number\">_<!-- -->10</span><div style=\"display:inline-block;margin-left:16px\"><span># query the collection filtering metadata for \"year\" = 2012</span></div></div><div><span class=\"ch-code-line-number\">_<!-- -->10</span><div style=\"display:inline-block;margin-left:16px\"><span>docs.query(</span></div></div><div><span class=\"ch-code-line-number\">_<!-- -->10</span><div style=\"display:inline-block;margin-left:16px\"><span>    data=[0.4,0.5,0.6],      # required</span></div></div><div><span class=\"ch-code-line-number\">_<!-- -->10</span><div style=\"display:inline-block;margin-left:16px\"><span>    limit=1,                         # number of records to return</span></div></div><div><span class=\"ch-code-line-number\">_<!-- -->10</span><div style=\"display:inline-block;margin-left:16px\"><span>    filters={\"year\": {\"$eq\": 2012}}, # metadata filters</span></div></div><div><span class=\"ch-code-line-number\">_<!-- -->10</span><div style=\"display:inline-block;margin-left:16px\"><span>)</span></div></div><br></code></div></div>\n<h2 id=\"deep-dive\" class=\"group scroll-mt-24\">Deep dive<a href=\"#deep-dive\" aria-hidden=\"true\" class=\"ml-2 opacity-0 group-hover:opacity-100 transition\"><span aria-hidden=\"true\">#</span></a></h2>\n<p>For a more in-depth guide on <code>vecs</code> collections, see <a href=\"/docs/guides/ai/python/api\">API</a>.</p>\n<h2 id=\"resources\" class=\"group scroll-mt-24\">Resources<a href=\"#resources\" aria-hidden=\"true\" class=\"ml-2 opacity-0 group-hover:opacity-100 transition\"><span aria-hidden=\"true\">#</span></a></h2>\n<ul>\n<li>Official Vecs Documentation: <a href=\"https://supabase.github.io/vecs/api\">https://supabase.github.io/vecs/api</a></li>\n<li>Source Code: <a href=\"https://github.com/supabase/vecs\">https://github.com/supabase/vecs</a></li>\n</ul></article></div></div></div><!--$--><div class=\"max-w-7xl px-5 mx-auto py-8 pt-0\"></div><!--/$--></div><div class=\"left-0 right-0 z-10 backdrop-blur-sm backdrop-filter bg-alternative/90 hidden h-0 lg:hidden\"></div></div></main></div></div></div></div></body></html>",
      "metadata": {
        "ogUrl": "https://supabase.com/docs/guides/ai/vecs-python-client",
        "title": "Python client | Supabase Docs",
        "robots": "index, follow",
        "ogImage": "https://obuldanrptloktxcffvn.supabase.co/functions/v1/og-images?site=docs&type=ai&title=Python%20client&description=undefined",
        "ogTitle": "Python client | Supabase Docs",
        "language": "en",
        "sourceURL": "https://supabase.com/docs/guides/ai/vecs-python-client",
        "description": "Manage unstructured vector stores in PostgreSQL.",
        "modifiedTime": "2024-09-10T20:36:25.434Z",
        "ogDescription": "Manage unstructured vector stores in PostgreSQL.",
        "publishedTime": "2024-09-10T20:36:25.434Z",
        "ogLocaleAlternate": [],
        "statusCode": 200
      }
    },
    {
      "markdown": "AI & Vectors\n\n# Face similarity search\n\n## Identify the celebrities who look most similar to you using Supabase Vecs.\n\n* * *\n\nThis guide will walk you through a [\"Face Similarity Search\"](https://github.com/supabase/supabase/blob/master/examples/ai/face_similarity.ipynb) example using Colab and Supabase Vecs. You will be able to identify the celebrities who look most similar to you (or any other person). You will:\n\n1. Launch a Postgres database that uses pgvector to store embeddings\n2. Launch a notebook that connects to your database\n3. Load the \" `ashraq/tmdb-people-image`\" celebrity dataset\n4. Use the `face_recognition` model to create an embedding for every celebrity photo.\n5. Search for similar faces inside the dataset.\n\n## Project setup [\\#](\\#project-setup)\n\nLet's create a new Postgres database. This is as simple as starting a new Project in Supabase:\n\n1. [Create a new project](https://database.new/) in the Supabase dashboard.\n2. Enter your project details. Remember to store your password somewhere safe.\n\nYour database will be available in less than a minute.\n\n**Finding your credentials:**\n\nYou can find your project credentials inside the project [settings](https://supabase.com/dashboard/project/_/settings/), including:\n\n- [Database credentials](https://supabase.com/dashboard/project/_/settings/database): connection strings and connection pooler details.\n- [API credentials](https://supabase.com/dashboard/project/_/settings/database): your serverless API URL and `anon` / `service_role` keys.\n\n## Launching a notebook [\\#](\\#launching-a-notebook)\n\nLaunch our [`semantic_text_deduplication`](https://github.com/supabase/supabase/blob/master/examples/ai/face_similarity.ipynb) notebook in Colab:\n\n[![](https://supabase.com/docs/img/ai/colab-badge.svg)](https://colab.research.google.com/github/supabase/supabase/blob/master/examples/ai/face_similarity.ipynb)\n\nAt the top of the notebook, you'll see a button `Copy to Drive`. Click this button to copy the notebook to your Google Drive.\n\n## Connecting to your database [\\#](\\#connecting-to-your-database)\n\nInside the Notebook, find the cell which specifies the `DB_CONNECTION`. It will contain some code like this:\n\n`\n_10\nimport vecs\n_10\n_10\nDB_CONNECTION = \"postgresql://<user>:<password>@<host>:<port>/<db_name>\"\n_10\n_10\n# create vector store client\n_10\nvx = vecs.create_client(DB_CONNECTION)\n`\n\nReplace the `DB_CONNECTION` with your own connection string for your database. You can find the Postgres connection string in the [Database Settings](https://supabase.com/dashboard/project/_/settings/database) of your Supabase project.\n\nSQLAlchemy requires the connection string to start with `postgresql://` (instead of `postgres://`). Don't forget to rename this after copying the string from the dashboard.\n\nYou must use the \"connection pooling\" string (domain ending in `*.pooler.supabase.com`) with Google Colab since Colab does not support IPv6.\n\n## Stepping through the notebook [\\#](\\#stepping-through-the-notebook)\n\nNow all that's left is to step through the notebook. You can do this by clicking the \"execute\" button ( `ctrl+enter`) at the top left of each code cell. The notebook guides you through the process of creating a collection, adding data to it, and querying it.\n\nYou can view the inserted items in the [Table Editor](https://supabase.com/dashboard/project/_/editor/), by selecting the `vecs` schema from the schema dropdown.\n\n![Colab documents](https://supabase.com/docs/img/ai/google-colab/colab-documents.png)\n\n## Next steps [\\#](\\#next-steps)\n\nYou can now start building your own applications with Vecs. Check our [examples](/docs/guides/ai#examples) for ideas.",
      "html": "<!DOCTYPE html><html lang=\"en\" data-theme=\"light\" style=\"color-scheme: light;\"><body><div class=\"flex flex-col\"><div class=\"grow\"><div class=\"flex flex-col h-full w-full\"><div class=\"hidden lg:sticky w-full lg:flex top-0 left-0 right-0 z-50\"><!--$--><!--/$--></div><div class=\"flex flex-row h-full relative\"><main id=\"docs-content-container\" class=\"w-full transition-all ease-out relative lg:ml-0\"><div class=\"flex flex-col sticky top-0\"><div class=\"flex lg:hidden w-full top-0 left-0 right-0 z-50\"><!--$--><!--/$--></div><div class=\"sticky transition-all top-0 z-10 backdrop-blur backdrop-filter bg-background\"><div class=\"lg:hidden px-3.5 border-b z-10 transition-all ease-out top-0 flex items-center gap-1\"><button class=\"h-8 w-8 flex group items-center justify-center mr-1\"><div class=\"space-y-1 cursor-pointer relative w-4 h-[8px]\"><span class=\"transition-all ease-out block h-px bg-foreground-muted group-hover:bg-foreground w-4\"></span><span class=\"transition-all ease-out block h-px bg-foreground-muted group-hover:bg-foreground w-3 group-hover:w-4\"></span></div></button><span class=\"transition-all duration-200 text-foreground text-sm\">AI &amp; Vectors</span></div></div><div class=\"grow\"><div class=\"max-w-7xl px-5 mx-auto py-8 pb-0\"><div class=\"grid grid-cols-12 relative gap-4\"><div class=\"relative transition-all ease-out duration-100 col-span-12 md:col-span-9\"><article id=\"sb-docs-guide-main-article\" class=\"prose max-w-none\"><h1 class=\"mb-0\">Face similarity search</h1><h2 class=\"mt-3 text-xl text-foreground-light\">Identify the celebrities who look most similar to you using Supabase Vecs.</h2><hr class=\"not-prose border-t-0 border-b my-8\">\n<p>This guide will walk you through a <a href=\"https://github.com/supabase/supabase/blob/master/examples/ai/face_similarity.ipynb\">\"Face Similarity Search\"</a> example using Colab and Supabase Vecs. You will be able to identify the celebrities who look most similar to you (or any other person). You will:</p>\n<ol>\n<li>Launch a Postgres database that uses pgvector to store embeddings</li>\n<li>Launch a notebook that connects to your database</li>\n<li>Load the \"<code>ashraq/tmdb-people-image</code>\" celebrity dataset</li>\n<li>Use the <code>face_recognition</code> model to create an embedding for every celebrity photo.</li>\n<li>Search for similar faces inside the dataset.</li>\n</ol>\n<h2 id=\"project-setup\" class=\"group scroll-mt-24\">Project setup<a href=\"#project-setup\" aria-hidden=\"true\" class=\"ml-2 opacity-0 group-hover:opacity-100 transition\"><span aria-hidden=\"true\">#</span></a></h2>\n<p>Let's create a new Postgres database. This is as simple as starting a new Project in Supabase:</p>\n<ol>\n<li><a href=\"https://database.new/\">Create a new project</a> in the Supabase dashboard.</li>\n<li>Enter your project details. Remember to store your password somewhere safe.</li>\n</ol>\n<p>Your database will be available in less than a minute.</p>\n<p><strong>Finding your credentials:</strong></p>\n<p>You can find your project credentials inside the project <a href=\"https://supabase.com/dashboard/project/_/settings/\">settings</a>, including:</p>\n<ul>\n<li><a href=\"https://supabase.com/dashboard/project/_/settings/database\">Database credentials</a>: connection strings and connection pooler details.</li>\n<li><a href=\"https://supabase.com/dashboard/project/_/settings/database\">API credentials</a>: your serverless API URL and <code>anon</code> / <code>service_role</code> keys.</li>\n</ul>\n<h2 id=\"launching-a-notebook\" class=\"group scroll-mt-24\">Launching a notebook<a href=\"#launching-a-notebook\" aria-hidden=\"true\" class=\"ml-2 opacity-0 group-hover:opacity-100 transition\"><span aria-hidden=\"true\">#</span></a></h2>\n<p>Launch our <a href=\"https://github.com/supabase/supabase/blob/master/examples/ai/face_similarity.ipynb\"><code>semantic_text_deduplication</code></a> notebook in Colab:</p>\n<a class=\"w-64\" href=\"https://colab.research.google.com/github/supabase/supabase/blob/master/examples/ai/face_similarity.ipynb\"><img src=\"/docs/img/ai/colab-badge.svg\"></a>\n<p>At the top of the notebook, you'll see a button <code>Copy to Drive</code>. Click this button to copy the notebook to your Google Drive.</p>\n<h2 id=\"connecting-to-your-database\" class=\"group scroll-mt-24\">Connecting to your database<a href=\"#connecting-to-your-database\" aria-hidden=\"true\" class=\"ml-2 opacity-0 group-hover:opacity-100 transition\"><span aria-hidden=\"true\">#</span></a></h2>\n<p>Inside the Notebook, find the cell which specifies the <code>DB_CONNECTION</code>. It will contain some code like this:</p>\n<div class=\"ch-codeblock not-prose \" data-ch-theme=\"supabase\"><div class=\"ch-code-wrapper ch-code\" data-ch-measured=\"false\"><code class=\"ch-code-scroll-parent\"><br><div><span class=\"ch-code-line-number\">_<!-- -->10</span><div style=\"display:inline-block;margin-left:16px\"><span>import vecs</span></div></div><div><span class=\"ch-code-line-number\">_<!-- -->10</span><div style=\"display:inline-block;margin-left:16px\"><span></span></div></div><div><span class=\"ch-code-line-number\">_<!-- -->10</span><div style=\"display:inline-block;margin-left:16px\"><span>DB_CONNECTION = \"postgresql://&lt;user&gt;:&lt;password&gt;@&lt;host&gt;:&lt;port&gt;/&lt;db_name&gt;\"</span></div></div><div><span class=\"ch-code-line-number\">_<!-- -->10</span><div style=\"display:inline-block;margin-left:16px\"><span></span></div></div><div><span class=\"ch-code-line-number\">_<!-- -->10</span><div style=\"display:inline-block;margin-left:16px\"><span># create vector store client</span></div></div><div><span class=\"ch-code-line-number\">_<!-- -->10</span><div style=\"display:inline-block;margin-left:16px\"><span>vx = vecs.create_client(DB_CONNECTION)</span></div></div><br></code></div></div>\n<p>Replace the <code>DB_CONNECTION</code> with your own connection string for your database. You can find the Postgres connection string in the <a href=\"https://supabase.com/dashboard/project/_/settings/database\">Database Settings</a> of your Supabase project.</p>\n<div role=\"alert\" class=\"relative w-full text-sm rounded-lg p-4 [&amp;>svg~*]:pl-10 [&amp;>svg+div]:translate-y-[-3px] [&amp;>svg]:absolute [&amp;>svg]:left-4 [&amp;>svg]:top-4 [&amp;>svg]:w-[23px] [&amp;>svg]:h-[23px] [&amp;>svg]:p-1 [&amp;>svg]:flex [&amp;>svg]:rounded text-foreground [&amp;>svg]:text-background [&amp;>svg]:bg-foreground mb-2 [&amp;_svg]:bg-foreground-muted [&amp;_svg]:text-background-muted bg-surface-200/25 border border-default\"><svg xmlns=\"http://www.w3.org/2000/svg\" viewBox=\"0 0 21 20\" class=\"w-6 h-6\" fill=\"currentColor\"><path fill-rule=\"evenodd\" clip-rule=\"evenodd\" d=\"M0.625 9.8252C0.625 4.44043 4.99023 0.0751953 10.375 0.0751953C15.7598 0.0751953 20.125 4.44043 20.125 9.8252C20.125 15.21 15.7598 19.5752 10.375 19.5752C4.99023 19.5752 0.625 15.21 0.625 9.8252ZM9.3584 4.38135C9.45117 4.28857 9.55518 4.20996 9.66699 4.14648C9.88086 4.02539 10.1245 3.96045 10.375 3.96045C10.5845 3.96045 10.7896 4.00586 10.9766 4.09229C11.1294 4.1626 11.2705 4.26025 11.3916 4.38135C11.6611 4.65088 11.8125 5.0166 11.8125 5.39795C11.8125 5.5249 11.7959 5.6499 11.7637 5.77002C11.6987 6.01172 11.5718 6.23438 11.3916 6.41455C11.1221 6.68408 10.7563 6.83545 10.375 6.83545C9.99365 6.83545 9.62793 6.68408 9.3584 6.41455C9.08887 6.14502 8.9375 5.7793 8.9375 5.39795C8.9375 5.29492 8.94873 5.19287 8.97021 5.09375C9.02783 4.82568 9.16162 4.57812 9.3584 4.38135ZM10.375 15.6899C10.0933 15.6899 9.82275 15.5781 9.62354 15.3789C9.42432 15.1797 9.3125 14.9092 9.3125 14.6274V9.31494C9.3125 9.0332 9.42432 8.7627 9.62354 8.56348C9.82275 8.36426 10.0933 8.25244 10.375 8.25244C10.6567 8.25244 10.9272 8.36426 11.1265 8.56348C11.3257 8.7627 11.4375 9.0332 11.4375 9.31494V14.6274C11.4375 14.7944 11.3979 14.9575 11.3242 15.104C11.2739 15.2046 11.2075 15.2979 11.1265 15.3789C10.9272 15.5781 10.6567 15.6899 10.375 15.6899Z\"></path></svg><div class=\"text mt [&amp;_p]:mb-1.5 [&amp;_p]:mt-0 mt-0.5 [&amp;_p:last-child]:mb-0\"><p>SQLAlchemy requires the connection string to start with <code>postgresql://</code> (instead of <code>postgres://</code>). Don't forget to rename this after copying the string from the dashboard.</p></div></div>\n<div role=\"alert\" class=\"relative w-full text-sm rounded-lg p-4 [&amp;>svg~*]:pl-10 [&amp;>svg+div]:translate-y-[-3px] [&amp;>svg]:absolute [&amp;>svg]:left-4 [&amp;>svg]:top-4 [&amp;>svg]:w-[23px] [&amp;>svg]:h-[23px] [&amp;>svg]:p-1 [&amp;>svg]:flex [&amp;>svg]:rounded text-foreground [&amp;>svg]:text-background [&amp;>svg]:bg-foreground mb-2 [&amp;_svg]:bg-foreground-muted [&amp;_svg]:text-background-muted bg-surface-200/25 border border-default\"><svg xmlns=\"http://www.w3.org/2000/svg\" viewBox=\"0 0 21 20\" class=\"w-6 h-6\" fill=\"currentColor\"><path fill-rule=\"evenodd\" clip-rule=\"evenodd\" d=\"M0.625 9.8252C0.625 4.44043 4.99023 0.0751953 10.375 0.0751953C15.7598 0.0751953 20.125 4.44043 20.125 9.8252C20.125 15.21 15.7598 19.5752 10.375 19.5752C4.99023 19.5752 0.625 15.21 0.625 9.8252ZM9.3584 4.38135C9.45117 4.28857 9.55518 4.20996 9.66699 4.14648C9.88086 4.02539 10.1245 3.96045 10.375 3.96045C10.5845 3.96045 10.7896 4.00586 10.9766 4.09229C11.1294 4.1626 11.2705 4.26025 11.3916 4.38135C11.6611 4.65088 11.8125 5.0166 11.8125 5.39795C11.8125 5.5249 11.7959 5.6499 11.7637 5.77002C11.6987 6.01172 11.5718 6.23438 11.3916 6.41455C11.1221 6.68408 10.7563 6.83545 10.375 6.83545C9.99365 6.83545 9.62793 6.68408 9.3584 6.41455C9.08887 6.14502 8.9375 5.7793 8.9375 5.39795C8.9375 5.29492 8.94873 5.19287 8.97021 5.09375C9.02783 4.82568 9.16162 4.57812 9.3584 4.38135ZM10.375 15.6899C10.0933 15.6899 9.82275 15.5781 9.62354 15.3789C9.42432 15.1797 9.3125 14.9092 9.3125 14.6274V9.31494C9.3125 9.0332 9.42432 8.7627 9.62354 8.56348C9.82275 8.36426 10.0933 8.25244 10.375 8.25244C10.6567 8.25244 10.9272 8.36426 11.1265 8.56348C11.3257 8.7627 11.4375 9.0332 11.4375 9.31494V14.6274C11.4375 14.7944 11.3979 14.9575 11.3242 15.104C11.2739 15.2046 11.2075 15.2979 11.1265 15.3789C10.9272 15.5781 10.6567 15.6899 10.375 15.6899Z\"></path></svg><div class=\"text mt [&amp;_p]:mb-1.5 [&amp;_p]:mt-0 mt-0.5 [&amp;_p:last-child]:mb-0\"><p>You must use the \"connection pooling\" string (domain ending in <code>*.pooler.supabase.com</code>) with Google Colab since Colab does not support IPv6.</p></div></div>\n<h2 id=\"stepping-through-the-notebook\" class=\"group scroll-mt-24\">Stepping through the notebook<a href=\"#stepping-through-the-notebook\" aria-hidden=\"true\" class=\"ml-2 opacity-0 group-hover:opacity-100 transition\"><span aria-hidden=\"true\">#</span></a></h2>\n<p>Now all that's left is to step through the notebook. You can do this by clicking the \"execute\" button (<code>ctrl+enter</code>) at the top left of each code cell. The notebook guides you through the process of creating a collection, adding data to it, and querying it.</p>\n<p>You can view the inserted items in the <a href=\"https://supabase.com/dashboard/project/_/editor/\">Table Editor</a>, by selecting the <code>vecs</code> schema from the schema dropdown.</p>\n<p><img src=\"/docs/img/ai/google-colab/colab-documents.png\" alt=\"Colab documents\"></p>\n<h2 id=\"next-steps\" class=\"group scroll-mt-24\">Next steps<a href=\"#next-steps\" aria-hidden=\"true\" class=\"ml-2 opacity-0 group-hover:opacity-100 transition\"><span aria-hidden=\"true\">#</span></a></h2>\n<p>You can now start building your own applications with Vecs. Check our <a href=\"/docs/guides/ai#examples\">examples</a> for ideas.</p></article></div></div></div><!--$--><div class=\"max-w-7xl px-5 mx-auto py-8 pt-0\"></div><!--/$--></div><div class=\"left-0 right-0 z-10 backdrop-blur-sm backdrop-filter bg-alternative/90 hidden h-0 lg:hidden\"></div></div></main></div></div></div></div></body></html>",
      "metadata": {
        "ogUrl": "https://supabase.com/docs/guides/ai/quickstarts/face-similarity",
        "title": "Face similarity search | Supabase Docs",
        "robots": "index, follow",
        "ogImage": "https://obuldanrptloktxcffvn.supabase.co/functions/v1/og-images?site=docs&type=ai&title=Face%20similarity%20search&description=undefined",
        "ogTitle": "Face similarity search | Supabase Docs",
        "language": "en",
        "sourceURL": "https://supabase.com/docs/guides/ai/quickstarts/face-similarity",
        "description": "Identify the celebrities who look most similar to you using Supabase Vecs.",
        "modifiedTime": "2024-09-10T20:36:25.434Z",
        "ogDescription": "Identify the celebrities who look most similar to you using Supabase Vecs.",
        "publishedTime": "2024-09-10T20:36:25.434Z",
        "ogLocaleAlternate": [],
        "statusCode": 200
      }
    },
    {
      "markdown": "AI & Vectors\n\n# Image Search with OpenAI CLIP\n\n## Implement image search with the OpenAI CLIP Model and Supabase Vector.\n\n* * *\n\nThe [OpenAI CLIP Model](https://github.com/openai/CLIP) was trained on a variety of (image, text)-pairs. You can use the CLIP model for:\n\n- Text-to-Image / Image-To-Text / Image-to-Image / Text-to-Text Search\n- You can fine-tune it on your own image and text data with the regular SentenceTransformers training code.\n\n[SentenceTransformers](https://www.sbert.net/examples/applications/image-search/README.html) provides models that allow you to embed images and text into the same vector space. You can use this to find similar images as well as to implement image search.\n\nYou can find the full application code as a Python Poetry project on [GitHub](https://github.com/supabase/supabase/tree/master/examples/ai/image_search#image-search-with-supabase-vector).\n\n## Create a new Python project with Poetry [\\#](\\#create-a-new-python-project-with-poetry)\n\n[Poetry](https://python-poetry.org/) provides packaging and dependency management for Python. If you haven't already, install poetry via pip:\n\n`\n_10\npip install poetry\n`\n\nThen initialize a new project:\n\n`\n_10\npoetry new image-search\n`\n\n## Setup Supabase project [\\#](\\#setup-supabase-project)\n\nIf you haven't already, [install the Supabase CLI](/docs/guides/cli), then initialize Supabase in the root of your newly created poetry project:\n\n`\n_10\nsupabase init\n`\n\nNext, start your local Supabase stack:\n\n`\n_10\nsupabase start\n`\n\nThis will start up the Supabase stack locally and print out a bunch of environment details, including your local `DB URL`. Make a note of that for later user.\n\n## Install the dependencies [\\#](\\#install-the-dependencies)\n\nWe will need to add the following dependencies to our project:\n\n- [`vecs`](https://github.com/supabase/vecs#vecs): Supabase Vector Python Client.\n- [`sentence-transformers`](https://huggingface.co/sentence-transformers/clip-ViT-B-32): a framework for sentence, text and image embeddings (used with OpenAI CLIP model)\n- [`matplotlib`](https://matplotlib.org/): for displaying our image result\n\n`\n_10\npoetry add vecs sentence-transformers matplotlib\n`\n\n## Import the necessary dependencies [\\#](\\#import-the-necessary-dependencies)\n\nAt the top of your main python script, import the dependencies and store your `DB URL` from above in a variable:\n\n`\n_10\nfrom PIL import Image\n_10\nfrom sentence_transformers import SentenceTransformer\n_10\nimport vecs\n_10\nfrom matplotlib import pyplot as plt\n_10\nfrom matplotlib import image as mpimg\n_10\n_10\nDB_CONNECTION = \"postgresql://postgres:postgres@localhost:54322/postgres\"\n`\n\n## Create embeddings for your images [\\#](\\#create-embeddings-for-your-images)\n\nIn the root of your project, create a new folder called `images` and add some images. You can use the images from the example project on [GitHub](https://github.com/supabase/supabase/tree/master/examples/ai/image_search/images) or you can find license free images on [unsplash](https://unsplash.com).\n\nNext, create a `seed` method, which will create a new Supabase Vector Collection, generate embeddings for your images, and upsert the embeddings into your database:\n\n`\n_43\ndef seed():\n_43\n    # create vector store client\n_43\n    vx = vecs.create_client(DB_CONNECTION)\n_43\n_43\n    # create a collection of vectors with 3 dimensions\n_43\n    images = vx.get_or_create_collection(name=\"image_vectors\", dimension=512)\n_43\n_43\n    # Load CLIP model\n_43\n    model = SentenceTransformer('clip-ViT-B-32')\n_43\n_43\n    # Encode an image:\n_43\n    img_emb1 = model.encode(Image.open('./images/one.jpg'))\n_43\n    img_emb2 = model.encode(Image.open('./images/two.jpg'))\n_43\n    img_emb3 = model.encode(Image.open('./images/three.jpg'))\n_43\n    img_emb4 = model.encode(Image.open('./images/four.jpg'))\n_43\n_43\n    # add records to the *images* collection\n_43\n    images.upsert(\n_43\n        records=[\\\n_43\\\n            (\\\n_43\\\n                \"one.jpg\",        # the vector's identifier\\\n_43\\\n                img_emb1,          # the vector. list or np.array\\\n_43\\\n                {\"type\": \"jpg\"}   # associated  metadata\\\n_43\\\n            ), (\\\n_43\\\n                \"two.jpg\",\\\n_43\\\n                img_emb2,\\\n_43\\\n                {\"type\": \"jpg\"}\\\n_43\\\n            ), (\\\n_43\\\n                \"three.jpg\",\\\n_43\\\n                img_emb3,\\\n_43\\\n                {\"type\": \"jpg\"}\\\n_43\\\n            ), (\\\n_43\\\n                \"four.jpg\",\\\n_43\\\n                img_emb4,\\\n_43\\\n                {\"type\": \"jpg\"}\\\n_43\\\n            )\\\n_43\\\n        ]\n_43\n    )\n_43\n    print(\"Inserted images\")\n_43\n_43\n    # index the collection for fast search performance\n_43\n    images.create_index()\n_43\n    print(\"Created index\")\n`\n\nAdd this method as a script in your `pyproject.toml` file:\n\n`\n_10\n[tool.poetry.scripts]\n_10\nseed = \"image_search.main:seed\"\n_10\nsearch = \"image_search.main:search\"\n`\n\nAfter activating the virtual environtment with `poetry shell` you can now run your seed script via `poetry run seed`. You can inspect the generated embeddings in your local database by visiting the local Supabase dashboard at [localhost:54323](http://localhost:54323/project/default/editor), selecting the `vecs` schema, and the `image_vectors` database.\n\n## Perform an image search from a text query [\\#](\\#perform-an-image-search-from-a-text-query)\n\nWith Supabase Vector we can easily query our embeddings. We can use either an image as search input or alternative we can generate an embedding from a string input and use that as the query input:\n\n`\n_23\ndef search():\n_23\n    # create vector store client\n_23\n    vx = vecs.create_client(DB_CONNECTION)\n_23\n    images = vx.get_or_create_collection(name=\"image_vectors\", dimension=512)\n_23\n_23\n    # Load CLIP model\n_23\n    model = SentenceTransformer('clip-ViT-B-32')\n_23\n    # Encode text query\n_23\n    query_string = \"a bike in front of a red brick wall\"\n_23\n    text_emb = model.encode(query_string)\n_23\n_23\n    # query the collection filtering metadata for \"type\" = \"jpg\"\n_23\n    results = images.query(\n_23\n        data=text_emb,                      # required\n_23\n        limit=1,                            # number of records to return\n_23\n        filters={\"type\": {\"$eq\": \"jpg\"}},   # metadata filters\n_23\n    )\n_23\n    result = results[0]\n_23\n    print(result)\n_23\n    plt.title(result)\n_23\n    image = mpimg.imread('./images/' + result)\n_23\n    plt.imshow(image)\n_23\n    plt.show()\n`\n\nBy limiting the query to one result, we can show the most relevant image to the user. Finally we use `matplotlib` to show the image result to the user.\n\nThat's it, go ahead and test it out by running `poetry run search` and you will be presented with an image of a \"bike in front of a red brick wall\".\n\n## Conclusion [\\#](\\#conclusion)\n\nWith just a couple of lines of Python you are able to implement image search as well as reverse image search using OpenAI's CLIP model and Supabase Vector.",
      "html": "<!DOCTYPE html><html lang=\"en\" data-theme=\"light\" style=\"color-scheme: light;\"><body><div class=\"flex flex-col\"><div class=\"grow\"><div class=\"flex flex-col h-full w-full\"><div class=\"hidden lg:sticky w-full lg:flex top-0 left-0 right-0 z-50\"><!--$--><!--/$--></div><div class=\"flex flex-row h-full relative\"><main id=\"docs-content-container\" class=\"w-full transition-all ease-out relative lg:ml-0\"><div class=\"flex flex-col sticky top-0\"><div class=\"flex lg:hidden w-full top-0 left-0 right-0 z-50\"><!--$--><!--/$--></div><div class=\"sticky transition-all top-0 z-10 backdrop-blur backdrop-filter bg-background\"><div class=\"lg:hidden px-3.5 border-b z-10 transition-all ease-out top-0 flex items-center gap-1\"><button class=\"h-8 w-8 flex group items-center justify-center mr-1\"><div class=\"space-y-1 cursor-pointer relative w-4 h-[8px]\"><span class=\"transition-all ease-out block h-px bg-foreground-muted group-hover:bg-foreground w-4\"></span><span class=\"transition-all ease-out block h-px bg-foreground-muted group-hover:bg-foreground w-3 group-hover:w-4\"></span></div></button><span class=\"transition-all duration-200 text-foreground text-sm\">AI &amp; Vectors</span></div></div><div class=\"grow\"><div class=\"max-w-7xl px-5 mx-auto py-8 pb-0\"><div class=\"grid grid-cols-12 relative gap-4\"><div class=\"relative transition-all ease-out duration-100 col-span-12 md:col-span-9\"><article id=\"sb-docs-guide-main-article\" class=\"prose max-w-none\"><h1 class=\"mb-0\">Image Search with OpenAI CLIP</h1><h2 class=\"mt-3 text-xl text-foreground-light\">Implement image search with the OpenAI CLIP Model and Supabase Vector.</h2><hr class=\"not-prose border-t-0 border-b my-8\">\n<p>The <a href=\"https://github.com/openai/CLIP\">OpenAI CLIP Model</a> was trained on a variety of (image, text)-pairs. You can use the CLIP model for:</p>\n<ul>\n<li>Text-to-Image / Image-To-Text / Image-to-Image / Text-to-Text Search</li>\n<li>You can fine-tune it on your own image and text data with the regular SentenceTransformers training code.</li>\n</ul>\n<p><a href=\"https://www.sbert.net/examples/applications/image-search/README.html\">SentenceTransformers</a> provides models that allow you to embed images and text into the same vector space. You can use this to find similar images as well as to implement image search.</p>\n<p>You can find the full application code as a Python Poetry project on <a href=\"https://github.com/supabase/supabase/tree/master/examples/ai/image_search#image-search-with-supabase-vector\">GitHub</a>.</p>\n<h2 id=\"create-a-new-python-project-with-poetry\" class=\"group scroll-mt-24\">Create a new Python project with Poetry<a href=\"#create-a-new-python-project-with-poetry\" aria-hidden=\"true\" class=\"ml-2 opacity-0 group-hover:opacity-100 transition\"><span aria-hidden=\"true\">#</span></a></h2>\n<p><a href=\"https://python-poetry.org/\">Poetry</a> provides packaging and dependency management for Python. If you haven't already, install poetry via pip:</p>\n<div class=\"ch-codeblock not-prose \" data-ch-theme=\"supabase\"><div class=\"ch-code-wrapper ch-code\" data-ch-measured=\"false\"><code class=\"ch-code-scroll-parent\"><br><div><span class=\"ch-code-line-number\">_<!-- -->10</span><div style=\"display:inline-block;margin-left:16px\"><span>pip install poetry</span></div></div><br></code></div></div>\n<p>Then initialize a new project:</p>\n<div class=\"ch-codeblock not-prose \" data-ch-theme=\"supabase\"><div class=\"ch-code-wrapper ch-code\" data-ch-measured=\"false\"><code class=\"ch-code-scroll-parent\"><br><div><span class=\"ch-code-line-number\">_<!-- -->10</span><div style=\"display:inline-block;margin-left:16px\"><span>poetry new image-search</span></div></div><br></code></div></div>\n<h2 id=\"setup-supabase-project\" class=\"group scroll-mt-24\">Setup Supabase project<a href=\"#setup-supabase-project\" aria-hidden=\"true\" class=\"ml-2 opacity-0 group-hover:opacity-100 transition\"><span aria-hidden=\"true\">#</span></a></h2>\n<p>If you haven't already, <a href=\"/docs/guides/cli\">install the Supabase CLI</a>, then initialize Supabase in the root of your newly created poetry project:</p>\n<div class=\"ch-codeblock not-prose \" data-ch-theme=\"supabase\"><div class=\"ch-code-wrapper ch-code\" data-ch-measured=\"false\"><code class=\"ch-code-scroll-parent\"><br><div><span class=\"ch-code-line-number\">_<!-- -->10</span><div style=\"display:inline-block;margin-left:16px\"><span>supabase init</span></div></div><br></code></div></div>\n<p>Next, start your local Supabase stack:</p>\n<div class=\"ch-codeblock not-prose \" data-ch-theme=\"supabase\"><div class=\"ch-code-wrapper ch-code\" data-ch-measured=\"false\"><code class=\"ch-code-scroll-parent\"><br><div><span class=\"ch-code-line-number\">_<!-- -->10</span><div style=\"display:inline-block;margin-left:16px\"><span>supabase start</span></div></div><br></code></div></div>\n<p>This will start up the Supabase stack locally and print out a bunch of environment details, including your local <code>DB URL</code>. Make a note of that for later user.</p>\n<h2 id=\"install-the-dependencies\" class=\"group scroll-mt-24\">Install the dependencies<a href=\"#install-the-dependencies\" aria-hidden=\"true\" class=\"ml-2 opacity-0 group-hover:opacity-100 transition\"><span aria-hidden=\"true\">#</span></a></h2>\n<p>We will need to add the following dependencies to our project:</p>\n<ul>\n<li><a href=\"https://github.com/supabase/vecs#vecs\"><code>vecs</code></a>: Supabase Vector Python Client.</li>\n<li><a href=\"https://huggingface.co/sentence-transformers/clip-ViT-B-32\"><code>sentence-transformers</code></a>: a framework for sentence, text and image embeddings (used with OpenAI CLIP model)</li>\n<li><a href=\"https://matplotlib.org/\"><code>matplotlib</code></a>: for displaying our image result</li>\n</ul>\n<div class=\"ch-codeblock not-prose \" data-ch-theme=\"supabase\"><div class=\"ch-code-wrapper ch-code\" data-ch-measured=\"false\"><code class=\"ch-code-scroll-parent\"><br><div><span class=\"ch-code-line-number\">_<!-- -->10</span><div style=\"display:inline-block;margin-left:16px\"><span>poetry add vecs sentence-transformers matplotlib</span></div></div><br></code></div></div>\n<h2 id=\"import-the-necessary-dependencies\" class=\"group scroll-mt-24\">Import the necessary dependencies<a href=\"#import-the-necessary-dependencies\" aria-hidden=\"true\" class=\"ml-2 opacity-0 group-hover:opacity-100 transition\"><span aria-hidden=\"true\">#</span></a></h2>\n<p>At the top of your main python script, import the dependencies and store your <code>DB URL</code> from above in a variable:</p>\n<div class=\"ch-codeblock not-prose \" data-ch-theme=\"supabase\"><div class=\"ch-code-wrapper ch-code\" data-ch-measured=\"false\"><code class=\"ch-code-scroll-parent\"><br><div><span class=\"ch-code-line-number\">_<!-- -->10</span><div style=\"display:inline-block;margin-left:16px\"><span>from PIL import Image</span></div></div><div><span class=\"ch-code-line-number\">_<!-- -->10</span><div style=\"display:inline-block;margin-left:16px\"><span>from sentence_transformers import SentenceTransformer</span></div></div><div><span class=\"ch-code-line-number\">_<!-- -->10</span><div style=\"display:inline-block;margin-left:16px\"><span>import vecs</span></div></div><div><span class=\"ch-code-line-number\">_<!-- -->10</span><div style=\"display:inline-block;margin-left:16px\"><span>from matplotlib import pyplot as plt</span></div></div><div><span class=\"ch-code-line-number\">_<!-- -->10</span><div style=\"display:inline-block;margin-left:16px\"><span>from matplotlib import image as mpimg</span></div></div><div><span class=\"ch-code-line-number\">_<!-- -->10</span><div style=\"display:inline-block;margin-left:16px\"><span></span></div></div><div><span class=\"ch-code-line-number\">_<!-- -->10</span><div style=\"display:inline-block;margin-left:16px\"><span>DB_CONNECTION = \"postgresql://postgres:postgres@localhost:54322/postgres\"</span></div></div><br></code></div></div>\n<h2 id=\"create-embeddings-for-your-images\" class=\"group scroll-mt-24\">Create embeddings for your images<a href=\"#create-embeddings-for-your-images\" aria-hidden=\"true\" class=\"ml-2 opacity-0 group-hover:opacity-100 transition\"><span aria-hidden=\"true\">#</span></a></h2>\n<p>In the root of your project, create a new folder called <code>images</code> and add some images. You can use the images from the example project on <a href=\"https://github.com/supabase/supabase/tree/master/examples/ai/image_search/images\">GitHub</a> or you can find license free images on <a href=\"https://unsplash.com\">unsplash</a>.</p>\n<p>Next, create a <code>seed</code> method, which will create a new Supabase Vector Collection, generate embeddings for your images, and upsert the embeddings into your database:</p>\n<div class=\"ch-codeblock not-prose \" data-ch-theme=\"supabase\"><div class=\"ch-code-wrapper ch-code\" data-ch-measured=\"false\"><code class=\"ch-code-scroll-parent\"><br><div><span class=\"ch-code-line-number\">_<!-- -->43</span><div style=\"display:inline-block;margin-left:16px\"><span>def seed():</span></div></div><div><span class=\"ch-code-line-number\">_<!-- -->43</span><div style=\"display:inline-block;margin-left:16px\"><span>    # create vector store client</span></div></div><div><span class=\"ch-code-line-number\">_<!-- -->43</span><div style=\"display:inline-block;margin-left:16px\"><span>    vx = vecs.create_client(DB_CONNECTION)</span></div></div><div><span class=\"ch-code-line-number\">_<!-- -->43</span><div style=\"display:inline-block;margin-left:16px\"><span></span></div></div><div><span class=\"ch-code-line-number\">_<!-- -->43</span><div style=\"display:inline-block;margin-left:16px\"><span>    # create a collection of vectors with 3 dimensions</span></div></div><div><span class=\"ch-code-line-number\">_<!-- -->43</span><div style=\"display:inline-block;margin-left:16px\"><span>    images = vx.get_or_create_collection(name=\"image_vectors\", dimension=512)</span></div></div><div><span class=\"ch-code-line-number\">_<!-- -->43</span><div style=\"display:inline-block;margin-left:16px\"><span></span></div></div><div><span class=\"ch-code-line-number\">_<!-- -->43</span><div style=\"display:inline-block;margin-left:16px\"><span>    # Load CLIP model</span></div></div><div><span class=\"ch-code-line-number\">_<!-- -->43</span><div style=\"display:inline-block;margin-left:16px\"><span>    model = SentenceTransformer('clip-ViT-B-32')</span></div></div><div><span class=\"ch-code-line-number\">_<!-- -->43</span><div style=\"display:inline-block;margin-left:16px\"><span></span></div></div><div><span class=\"ch-code-line-number\">_<!-- -->43</span><div style=\"display:inline-block;margin-left:16px\"><span>    # Encode an image:</span></div></div><div><span class=\"ch-code-line-number\">_<!-- -->43</span><div style=\"display:inline-block;margin-left:16px\"><span>    img_emb1 = model.encode(Image.open('./images/one.jpg'))</span></div></div><div><span class=\"ch-code-line-number\">_<!-- -->43</span><div style=\"display:inline-block;margin-left:16px\"><span>    img_emb2 = model.encode(Image.open('./images/two.jpg'))</span></div></div><div><span class=\"ch-code-line-number\">_<!-- -->43</span><div style=\"display:inline-block;margin-left:16px\"><span>    img_emb3 = model.encode(Image.open('./images/three.jpg'))</span></div></div><div><span class=\"ch-code-line-number\">_<!-- -->43</span><div style=\"display:inline-block;margin-left:16px\"><span>    img_emb4 = model.encode(Image.open('./images/four.jpg'))</span></div></div><div><span class=\"ch-code-line-number\">_<!-- -->43</span><div style=\"display:inline-block;margin-left:16px\"><span></span></div></div><div><span class=\"ch-code-line-number\">_<!-- -->43</span><div style=\"display:inline-block;margin-left:16px\"><span>    # add records to the *images* collection</span></div></div><div><span class=\"ch-code-line-number\">_<!-- -->43</span><div style=\"display:inline-block;margin-left:16px\"><span>    images.upsert(</span></div></div><div><span class=\"ch-code-line-number\">_<!-- -->43</span><div style=\"display:inline-block;margin-left:16px\"><span>        records=[</span></div></div><div><span class=\"ch-code-line-number\">_<!-- -->43</span><div style=\"display:inline-block;margin-left:16px\"><span>            (</span></div></div><div><span class=\"ch-code-line-number\">_<!-- -->43</span><div style=\"display:inline-block;margin-left:16px\"><span>                \"one.jpg\",        # the vector's identifier</span></div></div><div><span class=\"ch-code-line-number\">_<!-- -->43</span><div style=\"display:inline-block;margin-left:16px\"><span>                img_emb1,          # the vector. list or np.array</span></div></div><div><span class=\"ch-code-line-number\">_<!-- -->43</span><div style=\"display:inline-block;margin-left:16px\"><span>                {\"type\": \"jpg\"}   # associated  metadata</span></div></div><div><span class=\"ch-code-line-number\">_<!-- -->43</span><div style=\"display:inline-block;margin-left:16px\"><span>            ), (</span></div></div><div><span class=\"ch-code-line-number\">_<!-- -->43</span><div style=\"display:inline-block;margin-left:16px\"><span>                \"two.jpg\",</span></div></div><div><span class=\"ch-code-line-number\">_<!-- -->43</span><div style=\"display:inline-block;margin-left:16px\"><span>                img_emb2,</span></div></div><div><span class=\"ch-code-line-number\">_<!-- -->43</span><div style=\"display:inline-block;margin-left:16px\"><span>                {\"type\": \"jpg\"}</span></div></div><div><span class=\"ch-code-line-number\">_<!-- -->43</span><div style=\"display:inline-block;margin-left:16px\"><span>            ), (</span></div></div><div><span class=\"ch-code-line-number\">_<!-- -->43</span><div style=\"display:inline-block;margin-left:16px\"><span>                \"three.jpg\",</span></div></div><div><span class=\"ch-code-line-number\">_<!-- -->43</span><div style=\"display:inline-block;margin-left:16px\"><span>                img_emb3,</span></div></div><div><span class=\"ch-code-line-number\">_<!-- -->43</span><div style=\"display:inline-block;margin-left:16px\"><span>                {\"type\": \"jpg\"}</span></div></div><div><span class=\"ch-code-line-number\">_<!-- -->43</span><div style=\"display:inline-block;margin-left:16px\"><span>            ), (</span></div></div><div><span class=\"ch-code-line-number\">_<!-- -->43</span><div style=\"display:inline-block;margin-left:16px\"><span>                \"four.jpg\",</span></div></div><div><span class=\"ch-code-line-number\">_<!-- -->43</span><div style=\"display:inline-block;margin-left:16px\"><span>                img_emb4,</span></div></div><div><span class=\"ch-code-line-number\">_<!-- -->43</span><div style=\"display:inline-block;margin-left:16px\"><span>                {\"type\": \"jpg\"}</span></div></div><div><span class=\"ch-code-line-number\">_<!-- -->43</span><div style=\"display:inline-block;margin-left:16px\"><span>            )</span></div></div><div><span class=\"ch-code-line-number\">_<!-- -->43</span><div style=\"display:inline-block;margin-left:16px\"><span>        ]</span></div></div><div><span class=\"ch-code-line-number\">_<!-- -->43</span><div style=\"display:inline-block;margin-left:16px\"><span>    )</span></div></div><div><span class=\"ch-code-line-number\">_<!-- -->43</span><div style=\"display:inline-block;margin-left:16px\"><span>    print(\"Inserted images\")</span></div></div><div><span class=\"ch-code-line-number\">_<!-- -->43</span><div style=\"display:inline-block;margin-left:16px\"><span></span></div></div><div><span class=\"ch-code-line-number\">_<!-- -->43</span><div style=\"display:inline-block;margin-left:16px\"><span>    # index the collection for fast search performance</span></div></div><div><span class=\"ch-code-line-number\">_<!-- -->43</span><div style=\"display:inline-block;margin-left:16px\"><span>    images.create_index()</span></div></div><div><span class=\"ch-code-line-number\">_<!-- -->43</span><div style=\"display:inline-block;margin-left:16px\"><span>    print(\"Created index\")</span></div></div><br></code></div></div>\n<p>Add this method as a script in your <code>pyproject.toml</code> file:</p>\n<div class=\"ch-codeblock not-prose \" data-ch-theme=\"supabase\"><div class=\"ch-code-wrapper ch-code\" data-ch-measured=\"false\"><code class=\"ch-code-scroll-parent\"><br><div><span class=\"ch-code-line-number\">_<!-- -->10</span><div style=\"display:inline-block;margin-left:16px\"><span>[tool.poetry.scripts]</span></div></div><div><span class=\"ch-code-line-number\">_<!-- -->10</span><div style=\"display:inline-block;margin-left:16px\"><span>seed = \"image_search.main:seed\"</span></div></div><div><span class=\"ch-code-line-number\">_<!-- -->10</span><div style=\"display:inline-block;margin-left:16px\"><span>search = \"image_search.main:search\"</span></div></div><br></code></div></div>\n<p>After activating the virtual environtment with <code>poetry shell</code> you can now run your seed script via <code>poetry run seed</code>. You can inspect the generated embeddings in your local database by visiting the local Supabase dashboard at <a href=\"http://localhost:54323/project/default/editor\">localhost:54323</a>, selecting the <code>vecs</code> schema, and the <code>image_vectors</code> database.</p>\n<h2 id=\"perform-an-image-search-from-a-text-query\" class=\"group scroll-mt-24\">Perform an image search from a text query<a href=\"#perform-an-image-search-from-a-text-query\" aria-hidden=\"true\" class=\"ml-2 opacity-0 group-hover:opacity-100 transition\"><span aria-hidden=\"true\">#</span></a></h2>\n<p>With Supabase Vector we can easily query our embeddings. We can use either an image as search input or alternative we can generate an embedding from a string input and use that as the query input:</p>\n<div class=\"ch-codeblock not-prose \" data-ch-theme=\"supabase\"><div class=\"ch-code-wrapper ch-code\" data-ch-measured=\"false\"><code class=\"ch-code-scroll-parent\"><br><div><span class=\"ch-code-line-number\">_<!-- -->23</span><div style=\"display:inline-block;margin-left:16px\"><span>def search():</span></div></div><div><span class=\"ch-code-line-number\">_<!-- -->23</span><div style=\"display:inline-block;margin-left:16px\"><span>    # create vector store client</span></div></div><div><span class=\"ch-code-line-number\">_<!-- -->23</span><div style=\"display:inline-block;margin-left:16px\"><span>    vx = vecs.create_client(DB_CONNECTION)</span></div></div><div><span class=\"ch-code-line-number\">_<!-- -->23</span><div style=\"display:inline-block;margin-left:16px\"><span>    images = vx.get_or_create_collection(name=\"image_vectors\", dimension=512)</span></div></div><div><span class=\"ch-code-line-number\">_<!-- -->23</span><div style=\"display:inline-block;margin-left:16px\"><span></span></div></div><div><span class=\"ch-code-line-number\">_<!-- -->23</span><div style=\"display:inline-block;margin-left:16px\"><span>    # Load CLIP model</span></div></div><div><span class=\"ch-code-line-number\">_<!-- -->23</span><div style=\"display:inline-block;margin-left:16px\"><span>    model = SentenceTransformer('clip-ViT-B-32')</span></div></div><div><span class=\"ch-code-line-number\">_<!-- -->23</span><div style=\"display:inline-block;margin-left:16px\"><span>    # Encode text query</span></div></div><div><span class=\"ch-code-line-number\">_<!-- -->23</span><div style=\"display:inline-block;margin-left:16px\"><span>    query_string = \"a bike in front of a red brick wall\"</span></div></div><div><span class=\"ch-code-line-number\">_<!-- -->23</span><div style=\"display:inline-block;margin-left:16px\"><span>    text_emb = model.encode(query_string)</span></div></div><div><span class=\"ch-code-line-number\">_<!-- -->23</span><div style=\"display:inline-block;margin-left:16px\"><span></span></div></div><div><span class=\"ch-code-line-number\">_<!-- -->23</span><div style=\"display:inline-block;margin-left:16px\"><span>    # query the collection filtering metadata for \"type\" = \"jpg\"</span></div></div><div><span class=\"ch-code-line-number\">_<!-- -->23</span><div style=\"display:inline-block;margin-left:16px\"><span>    results = images.query(</span></div></div><div><span class=\"ch-code-line-number\">_<!-- -->23</span><div style=\"display:inline-block;margin-left:16px\"><span>        data=text_emb,                      # required</span></div></div><div><span class=\"ch-code-line-number\">_<!-- -->23</span><div style=\"display:inline-block;margin-left:16px\"><span>        limit=1,                            # number of records to return</span></div></div><div><span class=\"ch-code-line-number\">_<!-- -->23</span><div style=\"display:inline-block;margin-left:16px\"><span>        filters={\"type\": {\"$eq\": \"jpg\"}},   # metadata filters</span></div></div><div><span class=\"ch-code-line-number\">_<!-- -->23</span><div style=\"display:inline-block;margin-left:16px\"><span>    )</span></div></div><div><span class=\"ch-code-line-number\">_<!-- -->23</span><div style=\"display:inline-block;margin-left:16px\"><span>    result = results[0]</span></div></div><div><span class=\"ch-code-line-number\">_<!-- -->23</span><div style=\"display:inline-block;margin-left:16px\"><span>    print(result)</span></div></div><div><span class=\"ch-code-line-number\">_<!-- -->23</span><div style=\"display:inline-block;margin-left:16px\"><span>    plt.title(result)</span></div></div><div><span class=\"ch-code-line-number\">_<!-- -->23</span><div style=\"display:inline-block;margin-left:16px\"><span>    image = mpimg.imread('./images/' + result)</span></div></div><div><span class=\"ch-code-line-number\">_<!-- -->23</span><div style=\"display:inline-block;margin-left:16px\"><span>    plt.imshow(image)</span></div></div><div><span class=\"ch-code-line-number\">_<!-- -->23</span><div style=\"display:inline-block;margin-left:16px\"><span>    plt.show()</span></div></div><br></code></div></div>\n<p>By limiting the query to one result, we can show the most relevant image to the user. Finally we use <code>matplotlib</code> to show the image result to the user.</p>\n<p>That's it, go ahead and test it out by running <code>poetry run search</code> and you will be presented with an image of a \"bike in front of a red brick wall\".</p>\n<h2 id=\"conclusion\" class=\"group scroll-mt-24\">Conclusion<a href=\"#conclusion\" aria-hidden=\"true\" class=\"ml-2 opacity-0 group-hover:opacity-100 transition\"><span aria-hidden=\"true\">#</span></a></h2>\n<p>With just a couple of lines of Python you are able to implement image search as well as reverse image search using OpenAI's CLIP model and Supabase Vector.</p></article></div></div></div><!--$--><div class=\"max-w-7xl px-5 mx-auto py-8 pt-0\"></div><!--/$--></div><div class=\"left-0 right-0 z-10 backdrop-blur-sm backdrop-filter bg-alternative/90 hidden h-0 lg:hidden\"></div></div></main></div></div></div></div></body></html>",
      "metadata": {
        "ogUrl": "https://supabase.com/docs/guides/ai/examples/image-search-openai-clip",
        "title": "Image Search with OpenAI CLIP | Supabase Docs",
        "robots": "index, follow",
        "ogImage": "https://obuldanrptloktxcffvn.supabase.co/functions/v1/og-images?site=docs&type=ai&title=Image%20Search%20with%20OpenAI%20CLIP&description=Implement%20image%20search%20with%20the%20OpenAI%20CLIP%20Model%20and%20Supabase%20Vector.",
        "ogTitle": "Image Search with OpenAI CLIP | Supabase Docs",
        "language": "en",
        "sourceURL": "https://supabase.com/docs/guides/ai/examples/image-search-openai-clip",
        "description": "Implement image search with the OpenAI CLIP Model and Supabase Vector.",
        "modifiedTime": "2024-09-10T20:36:24.564Z",
        "ogDescription": "Implement image search with the OpenAI CLIP Model and Supabase Vector.",
        "publishedTime": "2024-09-10T20:36:24.564Z",
        "ogLocaleAlternate": [],
        "statusCode": 200
      }
    },
    {
      "markdown": "AI & Vectors\n\n# Collections\n\n* * *\n\n# Collections\n\nA collection is an group of vector records.\nRecords can be [added to or updated in](https://supabase.github.io/vecs/../api.md#upserting-vectors) a collection.\nCollections can be [queried](https://supabase.github.io/vecs/../api.md#query) at any time, but should be [indexed](https://supabase.github.io/vecs/../api.md#create-an-index) for scalable query performance.\n\nEach vector record has the form:\n\n`\n_10\nRecord (\n_10\n    id: String\n_10\n    vec: Numeric[]\n_10\n    metadata: JSON\n_10\n)\n`\n\nFor example:\n\n`\n_10\n(\"vec1\", [0.1, 0.2, 0.3], {\"year\": 1990})\n`\n\nUnderneath every `vecs` collection is a Postgres table\n\n`\n_10\ncreate table <collection_name> (\n_10\n    id string primary key,\n_10\n    vec vector(<dimension>),\n_10\n    metadata jsonb\n_10\n)\n`\n\nwhere rows in the table map 1:1 with vecs vector records.\n\nIt is safe to select collection tables from outside the vecs client but issuing DDL is not recommended.",
      "html": "<!DOCTYPE html><html lang=\"en\" data-theme=\"light\" style=\"color-scheme: light;\"><body><div class=\"flex flex-col\"><div class=\"grow\"><div class=\"flex flex-col h-full w-full\"><div class=\"hidden lg:sticky w-full lg:flex top-0 left-0 right-0 z-50\"><!--$--><!--/$--></div><div class=\"flex flex-row h-full relative\"><main id=\"docs-content-container\" class=\"w-full transition-all ease-out relative lg:ml-0\"><div class=\"flex flex-col sticky top-0\"><div class=\"flex lg:hidden w-full top-0 left-0 right-0 z-50\"><!--$--><!--/$--></div><div class=\"sticky transition-all top-0 z-10 backdrop-blur backdrop-filter bg-background\"><div class=\"lg:hidden px-3.5 border-b z-10 transition-all ease-out top-0 flex items-center gap-1\"><button class=\"h-8 w-8 flex group items-center justify-center mr-1\"><div class=\"space-y-1 cursor-pointer relative w-4 h-[8px]\"><span class=\"transition-all ease-out block h-px bg-foreground-muted group-hover:bg-foreground w-4\"></span><span class=\"transition-all ease-out block h-px bg-foreground-muted group-hover:bg-foreground w-3 group-hover:w-4\"></span></div></button><span class=\"transition-all duration-200 text-foreground text-sm\">AI &amp; Vectors</span></div></div><div class=\"grow\"><div class=\"max-w-7xl px-5 mx-auto py-8 pb-0\"><div class=\"grid grid-cols-12 relative gap-4\"><div class=\"relative transition-all ease-out duration-100 col-span-12 md:col-span-9\"><article id=\"sb-docs-guide-main-article\" class=\"prose max-w-none\"><h1 class=\"mb-0\">Collections</h1><hr class=\"not-prose border-t-0 border-b my-8\">\n<h1 id=\"collections\">Collections</h1>\n<p>A collection is an group of vector records.\nRecords can be <a href=\"https://supabase.github.io/vecs/../api.md#upserting-vectors\">added to or updated in</a> a collection.\nCollections can be <a href=\"https://supabase.github.io/vecs/../api.md#query\">queried</a> at any time, but should be <a href=\"https://supabase.github.io/vecs/../api.md#create-an-index\">indexed</a> for scalable query performance.</p>\n<p>Each vector record has the form:</p>\n<div class=\"ch-codeblock not-prose \" data-ch-theme=\"supabase\"><div class=\"ch-code-wrapper ch-code\" data-ch-measured=\"false\"><code class=\"ch-code-scroll-parent\"><br><div><span class=\"ch-code-line-number\">_<!-- -->10</span><div style=\"display:inline-block;margin-left:16px\"><span>Record (</span></div></div><div><span class=\"ch-code-line-number\">_<!-- -->10</span><div style=\"display:inline-block;margin-left:16px\"><span>    id: String</span></div></div><div><span class=\"ch-code-line-number\">_<!-- -->10</span><div style=\"display:inline-block;margin-left:16px\"><span>    vec: Numeric[]</span></div></div><div><span class=\"ch-code-line-number\">_<!-- -->10</span><div style=\"display:inline-block;margin-left:16px\"><span>    metadata: JSON</span></div></div><div><span class=\"ch-code-line-number\">_<!-- -->10</span><div style=\"display:inline-block;margin-left:16px\"><span>)</span></div></div><br></code></div></div>\n<p>For example:</p>\n<div class=\"ch-codeblock not-prose \" data-ch-theme=\"supabase\"><div class=\"ch-code-wrapper ch-code\" data-ch-measured=\"false\"><code class=\"ch-code-scroll-parent\"><br><div><span class=\"ch-code-line-number\">_<!-- -->10</span><div style=\"display:inline-block;margin-left:16px\"><span>(\"vec1\", [0.1, 0.2, 0.3], {\"year\": 1990})</span></div></div><br></code></div></div>\n<p>Underneath every <code>vecs</code> collection is a Postgres table</p>\n<div class=\"ch-codeblock not-prose \" data-ch-theme=\"supabase\"><div class=\"ch-code-wrapper ch-code\" data-ch-measured=\"false\"><code class=\"ch-code-scroll-parent\"><br><div><span class=\"ch-code-line-number\">_<!-- -->10</span><div style=\"display:inline-block;margin-left:16px\"><span>create table &lt;collection_name&gt; (</span></div></div><div><span class=\"ch-code-line-number\">_<!-- -->10</span><div style=\"display:inline-block;margin-left:16px\"><span>    id string primary key,</span></div></div><div><span class=\"ch-code-line-number\">_<!-- -->10</span><div style=\"display:inline-block;margin-left:16px\"><span>    vec vector(&lt;dimension&gt;),</span></div></div><div><span class=\"ch-code-line-number\">_<!-- -->10</span><div style=\"display:inline-block;margin-left:16px\"><span>    metadata jsonb</span></div></div><div><span class=\"ch-code-line-number\">_<!-- -->10</span><div style=\"display:inline-block;margin-left:16px\"><span>)</span></div></div><br></code></div></div>\n<p>where rows in the table map 1:1 with vecs vector records.</p>\n<p>It is safe to select collection tables from outside the vecs client but issuing DDL is not recommended.</p></article></div></div></div><!--$--><div class=\"max-w-7xl px-5 mx-auto py-8 pt-0\"></div><!--/$--></div><div class=\"left-0 right-0 z-10 backdrop-blur-sm backdrop-filter bg-alternative/90 hidden h-0 lg:hidden\"></div></div></main></div></div></div></div></body></html>",
      "metadata": {
        "ogUrl": "https://supabase.com/docs/guides/ai/python/collections",
        "title": "Collections | Supabase Docs",
        "robots": "index, follow",
        "ogImage": "https://obuldanrptloktxcffvn.supabase.co/functions/v1/og-images?site=docs&type=ai&title=Collections&description=undefined",
        "ogTitle": "Collections | Supabase Docs",
        "language": "en",
        "sourceURL": "https://supabase.com/docs/guides/ai/python/collections",
        "modifiedTime": "2024-09-10T20:36:25.434Z",
        "publishedTime": "2024-09-10T20:36:25.434Z",
        "ogLocaleAlternate": [],
        "statusCode": 200
      }
    },
    {
      "markdown": "AI & Vectors\n\n# Vector indexes\n\n* * *\n\nOnce your vector table starts to grow, you will likely want to add an index to speed up queries. Without indexes, you'll be performing a sequential scan which can be a resource-intensive operation when you have many records.\n\n## Choosing an index [\\#](\\#choosing-an-index)\n\nToday `pgvector` supports two types of indexes:\n\n- [HNSW](/docs/guides/ai/vector-indexes/hnsw-indexes)\n- [IVFFlat](/docs/guides/ai/vector-indexes/ivf-indexes)\n\nIn general we recommend using [HNSW](/docs/guides/ai/vector-indexes/hnsw-indexes) because of its [performance](https://supabase.com/blog/increase-performance-pgvector-hnsw#hnsw-performance-1536-dimensions) and [robustness against changing data](/docs/guides/ai/vector-indexes/hnsw-indexes#when-should-you-create-hnsw-indexes).\n\n## Distance operators [\\#](\\#distance-operators)\n\nIndexes can be used to improve performance of nearest neighbor search using various distance measures. `pgvector` includes 3 distance operators:\n\n| Operator | Description | [**Operator class**](https://www.postgresql.org/docs/current/sql-createopclass.html) |\n| --- | --- | --- |\n| `<->` | Euclidean distance | `vector_l2_ops` |\n| `<#>` | negative inner product | `vector_ip_ops` |\n| `<=>` | cosine distance | `vector_cosine_ops` |\n\nCurrently vectors with up to 2,000 dimensions can be indexed.\n\n## Resources [\\#](\\#resources)\n\nRead more about indexing on `pgvector`'s [GitHub page](https://github.com/pgvector/pgvector#indexing).",
      "html": "<!DOCTYPE html><html lang=\"en\" data-theme=\"light\" style=\"color-scheme: light;\"><body><div class=\"flex flex-col\"><div class=\"grow\"><div class=\"flex flex-col h-full w-full\"><div class=\"hidden lg:sticky w-full lg:flex top-0 left-0 right-0 z-50\"><!--$--><!--/$--></div><div class=\"flex flex-row h-full relative\"><main id=\"docs-content-container\" class=\"w-full transition-all ease-out relative lg:ml-0\"><div class=\"flex flex-col sticky top-0\"><div class=\"flex lg:hidden w-full top-0 left-0 right-0 z-50\"><!--$--><!--/$--></div><div class=\"sticky transition-all top-0 z-10 backdrop-blur backdrop-filter bg-background\"><div class=\"lg:hidden px-3.5 border-b z-10 transition-all ease-out top-0 flex items-center gap-1\"><button class=\"h-8 w-8 flex group items-center justify-center mr-1\"><div class=\"space-y-1 cursor-pointer relative w-4 h-[8px]\"><span class=\"transition-all ease-out block h-px bg-foreground-muted group-hover:bg-foreground w-4\"></span><span class=\"transition-all ease-out block h-px bg-foreground-muted group-hover:bg-foreground w-3 group-hover:w-4\"></span></div></button><span class=\"transition-all duration-200 text-foreground text-sm\">AI &amp; Vectors</span></div></div><div class=\"grow\"><div class=\"max-w-7xl px-5 mx-auto py-8 pb-0\"><div class=\"grid grid-cols-12 relative gap-4\"><div class=\"relative transition-all ease-out duration-100 col-span-12 md:col-span-9\"><article id=\"sb-docs-guide-main-article\" class=\"prose max-w-none\"><h1 class=\"mb-0\">Vector indexes</h1><hr class=\"not-prose border-t-0 border-b my-8\"><p>Once your vector table starts to grow, you will likely want to add an index to speed up queries. Without indexes, you'll be performing a sequential scan which can be a resource-intensive operation when you have many records.</p>\n<h2 id=\"choosing-an-index\" class=\"group scroll-mt-24\">Choosing an index<a href=\"#choosing-an-index\" aria-hidden=\"true\" class=\"ml-2 opacity-0 group-hover:opacity-100 transition\"><span aria-hidden=\"true\">#</span></a></h2>\n<p>Today <code>pgvector</code> supports two types of indexes:</p>\n<ul>\n<li><a href=\"/docs/guides/ai/vector-indexes/hnsw-indexes\">HNSW</a></li>\n<li><a href=\"/docs/guides/ai/vector-indexes/ivf-indexes\">IVFFlat</a></li>\n</ul>\n<p>In general we recommend using <a href=\"/docs/guides/ai/vector-indexes/hnsw-indexes\">HNSW</a> because of its <a href=\"https://supabase.com/blog/increase-performance-pgvector-hnsw#hnsw-performance-1536-dimensions\">performance</a> and <a href=\"/docs/guides/ai/vector-indexes/hnsw-indexes#when-should-you-create-hnsw-indexes\">robustness against changing data</a>.</p>\n<h2 id=\"distance-operators\" class=\"group scroll-mt-24\">Distance operators<a href=\"#distance-operators\" aria-hidden=\"true\" class=\"ml-2 opacity-0 group-hover:opacity-100 transition\"><span aria-hidden=\"true\">#</span></a></h2>\n<p>Indexes can be used to improve performance of nearest neighbor search using various distance measures. <code>pgvector</code> includes 3 distance operators:</p>\n<table><thead><tr><th>Operator</th><th>Description</th><th><a href=\"https://www.postgresql.org/docs/current/sql-createopclass.html\"><strong>Operator class</strong></a></th></tr></thead><tbody><tr><td><code>&lt;-&gt;</code></td><td>Euclidean distance</td><td><code>vector_l2_ops</code></td></tr><tr><td><code>&lt;#&gt;</code></td><td>negative inner product</td><td><code>vector_ip_ops</code></td></tr><tr><td><code>&lt;=&gt;</code></td><td>cosine distance</td><td><code>vector_cosine_ops</code></td></tr></tbody></table>\n<p>Currently vectors with up to 2,000 dimensions can be indexed.</p>\n<h2 id=\"resources\" class=\"group scroll-mt-24\">Resources<a href=\"#resources\" aria-hidden=\"true\" class=\"ml-2 opacity-0 group-hover:opacity-100 transition\"><span aria-hidden=\"true\">#</span></a></h2>\n<p>Read more about indexing on <code>pgvector</code>'s <a href=\"https://github.com/pgvector/pgvector#indexing\">GitHub page</a>.</p></article></div></div></div><!--$--><div class=\"max-w-7xl px-5 mx-auto py-8 pt-0\"></div><!--/$--></div><div class=\"left-0 right-0 z-10 backdrop-blur-sm backdrop-filter bg-alternative/90 hidden h-0 lg:hidden\"></div></div></main></div></div></div></div></body></html>",
      "metadata": {
        "ogUrl": "https://supabase.com/docs/guides/ai/vector-indexes",
        "title": "Vector indexes | Supabase Docs",
        "robots": "index, follow",
        "ogImage": "https://obuldanrptloktxcffvn.supabase.co/functions/v1/og-images?site=docs&type=ai&title=Vector%20indexes&description=Understanding%20vector%20indexes",
        "ogTitle": "Vector indexes | Supabase Docs",
        "language": "en",
        "sourceURL": "https://supabase.com/docs/guides/ai/vector-indexes",
        "description": "Understanding vector indexes",
        "modifiedTime": "2024-09-10T20:36:24.980Z",
        "ogDescription": "Understanding vector indexes",
        "publishedTime": "2024-09-10T20:36:24.980Z",
        "ogLocaleAlternate": [],
        "statusCode": 200
      }
    },
    {
      "markdown": "AI & Vectors\n\n# Vector columns\n\n* * *\n\nSupabase offers a number of different ways to store and query vectors within Postgres. The SQL included in this guide is applicable for clients in all programming languages. If you are a Python user see your [Python client options](/docs/guides/ai/python-clients) after reading the `Learn` section.\n\nVectors in Supabase are enabled via [pgvector](https://github.com/pgvector/pgvector/), a PostgreSQL extension for storing and querying vectors in Postgres. It can be used to store [embeddings](/docs/guides/ai/concepts#what-are-embeddings).\n\n## Usage [\\#](\\#usage)\n\n### Enable the extension [\\#](\\#enable-the-extension)\n\nDashboardSQL\n\n1. Go to the [Database](https://supabase.com/dashboard/project/_/database/tables) page in the Dashboard.\n2. Click on **Extensions** in the sidebar.\n3. Search for \"vector\" and enable the extension.\n\n### Create a table to store vectors [\\#](\\#create-a-table-to-store-vectors)\n\nAfter enabling the `vector` extension, you will get access to a new data type called `vector`. The size of the vector (indicated in parenthesis) represents the number of dimensions stored in that vector.\n\n`\n_10\ncreate table documents (\n_10\nid serial primary key,\n_10\ntitle text not null,\n_10\nbody text not null,\n_10\nembedding vector(384)\n_10\n);\n`\n\nIn the above SQL snippet, we create a `documents` table with a column called `embedding` (note this is just a regular Postgres column - you can name it whatever you like). We give the `embedding` column a `vector` data type with 384 dimensions. Change this to the number of dimensions produced by your embedding model. For example, if you are [generating embeddings](/docs/guides/ai/quickstarts/generate-text-embeddings) using the open source [`gte-small`](https://huggingface.co/Supabase/gte-small) model, you would set this number to 384 since that model produces 384 dimensions.\n\nIn general, embeddings with fewer dimensions perform best. See our [analysis on fewer dimensions in pgvector](https://supabase.com/blog/fewer-dimensions-are-better-pgvector).\n\n### Storing a vector / embedding [\\#](\\#storing-a-vector--embedding)\n\nIn this example we'll generate a vector using Transformers.js, then store it in the database using the Supabase JavaScript client.\n\n`\n_21\nimport { pipeline } from '@xenova/transformers'\n_21\nconst generateEmbedding = await pipeline('feature-extraction', 'Supabase/gte-small')\n_21\n_21\nconst title = 'First post!'\n_21\nconst body = 'Hello world!'\n_21\n_21\n// Generate a vector using Transformers.js\n_21\nconst output = await generateEmbedding(body, {\n_21\npooling: 'mean',\n_21\nnormalize: true,\n_21\n})\n_21\n_21\n// Extract the embedding output\n_21\nconst embedding = Array.from(output.data)\n_21\n_21\n// Store the vector in Postgres\n_21\nconst { data, error } = await supabase.from('documents').insert({\n_21\ntitle,\n_21\nbody,\n_21\nembedding,\n_21\n})\n`\n\nThis example uses the JavaScript Supabase client, but you can modify it to work with any [supported language library](/docs#client-libraries).\n\n### Querying a vector / embedding [\\#](\\#querying-a-vector--embedding)\n\nSimilarity search is the most common use case for vectors. `pgvector` support 3 new operators for computing distance:\n\n| Operator | Description |\n| --- | --- |\n| `<->` | Euclidean distance |\n| `<#>` | negative inner product |\n| `<=>` | cosine distance |\n\nChoosing the right operator depends on your needs. Dot product tends to be the fastest if your vectors are normalized. For more information on how embeddings work and how they relate to each other, see [What are Embeddings?](/docs/guides/ai/concepts#what-are-embeddings).\n\nSupabase client libraries like `supabase-js` connect to your Postgres instance via [PostgREST](/docs/guides/getting-started/architecture#postgrest-api). PostgREST does not currently support `pgvector` similarity operators, so we'll need to wrap our query in a Postgres function and call it via the `rpc()` method:\n\n`\n_23\ncreate or replace function match_documents (\n_23\nquery_embedding vector(384),\n_23\nmatch_threshold float,\n_23\nmatch_count int\n_23\n)\n_23\nreturns table (\n_23\nid bigint,\n_23\ntitle text,\n_23\nbody text,\n_23\nsimilarity float\n_23\n)\n_23\nlanguage sql stable\n_23\nas $$\n_23\nselect\n_23\n    documents.id,\n_23\n    documents.title,\n_23\n    documents.body,\n_23\n    1 - (documents.embedding <=> query_embedding) as similarity\n_23\nfrom documents\n_23\nwhere 1 - (documents.embedding <=> query_embedding) > match_threshold\n_23\norder by (documents.embedding <=> query_embedding) asc\n_23\nlimit match_count;\n_23\n$$;\n`\n\nThis function takes a `query_embedding` argument and compares it to all other embeddings in the `documents` table. Each comparison returns a similarity score. If the similarity is greater than the `match_threshold` argument, it is returned. The number of rows returned is limited by the `match_count` argument.\n\nFeel free to modify this method to fit the needs of your application. The `match_threshold` ensures that only documents that have a minimum similarity to the `query_embedding` are returned. Without this, you may end up returning documents that subjectively don't match. This value will vary for each application - you will need to perform your own testing to determine the threshold that makes sense for your app.\n\nIf you index your vector column, ensure that the `order by` sorts by the distance function directly (rather than sorting by the calculated `similarity` column, which may lead to the index being ignored and poor performance).\n\nTo execute the function from your client library, call `rpc()` with the name of your Postgres function:\n\n`\n_10\nconst { data: documents } = await supabaseClient.rpc('match_documents', {\n_10\nquery_embedding: embedding, // Pass the embedding you want to compare\n_10\nmatch_threshold: 0.78, // Choose an appropriate threshold for your data\n_10\nmatch_count: 10, // Choose the number of matches\n_10\n})\n`\n\nIn this example `embedding` would be another embedding you wish to compare against your table of pre-generated embedding documents. For example if you were building a search engine, every time the user submits their query you would first generate an embedding on the search query itself, then pass it into the above `rpc()` function to match.\n\nBe sure to use embeddings produced from the same embedding model when calculating distance. Comparing embeddings from two different models will produce no meaningful result.\n\nVectors and embeddings can be used for much more than search. Learn more about embeddings at [What are Embeddings?](/docs/guides/ai/concepts#what-are-embeddings).\n\n### Indexes [\\#](\\#indexes)\n\nOnce your vector table starts to grow, you will likely want to add an index to speed up queries. See [Vector indexes](/docs/guides/ai/vector-indexes) to learn how vector indexes work and how to create them.",
      "html": "<!DOCTYPE html><html lang=\"en\" data-theme=\"light\" style=\"color-scheme: light;\"><body><div class=\"flex flex-col\"><div class=\"grow\"><div class=\"flex flex-col h-full w-full\"><div class=\"hidden lg:sticky w-full lg:flex top-0 left-0 right-0 z-50\"><!--$--><!--/$--></div><div class=\"flex flex-row h-full relative\"><main id=\"docs-content-container\" class=\"w-full transition-all ease-out relative lg:ml-0\"><div class=\"flex flex-col sticky top-0\"><div class=\"flex lg:hidden w-full top-0 left-0 right-0 z-50\"><!--$--><!--/$--></div><div class=\"sticky transition-all top-0 z-10 backdrop-blur backdrop-filter bg-background\"><div class=\"lg:hidden px-3.5 border-b z-10 transition-all ease-out top-0 flex items-center gap-1\"><button class=\"h-8 w-8 flex group items-center justify-center mr-1\"><div class=\"space-y-1 cursor-pointer relative w-4 h-[8px]\"><span class=\"transition-all ease-out block h-px bg-foreground-muted group-hover:bg-foreground w-4\"></span><span class=\"transition-all ease-out block h-px bg-foreground-muted group-hover:bg-foreground w-3 group-hover:w-4\"></span></div></button><span class=\"transition-all duration-200 text-foreground text-sm\">AI &amp; Vectors</span></div></div><div class=\"grow\"><div class=\"max-w-7xl px-5 mx-auto py-8 pb-0\"><div class=\"grid grid-cols-12 relative gap-4\"><div class=\"relative transition-all ease-out duration-100 col-span-12 md:col-span-9\"><article id=\"sb-docs-guide-main-article\" class=\"prose max-w-none\"><h1 class=\"mb-0\">Vector columns</h1><hr class=\"not-prose border-t-0 border-b my-8\">\n<p>Supabase offers a number of different ways to store and query vectors within Postgres. The SQL included in this guide is applicable for clients in all programming languages. If you are a Python user see your <a href=\"/docs/guides/ai/python-clients\">Python client options</a> after reading the <code>Learn</code> section.</p>\n<p>Vectors in Supabase are enabled via <a href=\"https://github.com/pgvector/pgvector/\">pgvector</a>, a PostgreSQL extension for storing and querying vectors in Postgres. It can be used to store <a href=\"/docs/guides/ai/concepts#what-are-embeddings\">embeddings</a>.</p>\n<h2 id=\"usage\" class=\"group scroll-mt-24\">Usage<a href=\"#usage\" aria-hidden=\"true\" class=\"ml-2 opacity-0 group-hover:opacity-100 transition\"><span aria-hidden=\"true\">#</span></a></h2>\n<h3 id=\"enable-the-extension\" class=\"group scroll-mt-24\">Enable the extension<a href=\"#enable-the-extension\" aria-hidden=\"true\" class=\"ml-2 opacity-0 group-hover:opacity-100 transition\"><span aria-hidden=\"true\">#</span></a></h3>\n<div dir=\"ltr\" data-orientation=\"horizontal\" class=\"w-full justify-between space-y-4 \"><div role=\"tablist\" aria-orientation=\"horizontal\" class=\" flex items-center border-b border-secondary  overflow-auto whitespace-nowrap no-scrollbar mask-fadeout-right flex-wrap\" tabindex=\"-1\" data-orientation=\"horizontal\" style=\"outline:none\"><button type=\"button\" role=\"tab\" aria-selected=\"true\" aria-controls=\"radix-:R9e9jtsn7qb6ra:-content-dashboard\" data-state=\"active\" id=\"radix-:R9e9jtsn7qb6ra:-trigger-dashboard\" class=\" relative cursor-pointer text-foreground-lighter flex items-center space-x-2 text-center transition focus:outline-none focus-visible:ring focus-visible:ring-foreground-muted focus-visible:border-foreground-muted  text-sm leading-4 px-3 py-2  !text-foreground border-b-2 border-foreground \" tabindex=\"-1\" data-orientation=\"horizontal\" data-radix-collection-item=\"\"><span>Dashboard</span></button><button type=\"button\" role=\"tab\" aria-selected=\"false\" aria-controls=\"radix-:R9e9jtsn7qb6ra:-content-sql\" data-state=\"inactive\" id=\"radix-:R9e9jtsn7qb6ra:-trigger-sql\" class=\" relative cursor-pointer text-foreground-lighter flex items-center space-x-2 text-center transition focus:outline-none focus-visible:ring focus-visible:ring-foreground-muted focus-visible:border-foreground-muted  text-sm leading-4 px-3 py-2  hover:text-foreground \" tabindex=\"-1\" data-orientation=\"horizontal\" data-radix-collection-item=\"\"><span>SQL</span></button></div><div data-state=\"active\" data-orientation=\"horizontal\" role=\"tabpanel\" aria-labelledby=\"radix-:R9e9jtsn7qb6ra:-trigger-dashboard\" id=\"radix-:R9e9jtsn7qb6ra:-content-dashboard\" tabindex=\"0\" class=\"focus:outline-none transition-height \" style=\"animation-duration:0s\"><ol>\n<li>Go to the <a href=\"https://supabase.com/dashboard/project/_/database/tables\">Database</a> page in the Dashboard.</li>\n<li>Click on <strong>Extensions</strong> in the sidebar.</li>\n<li>Search for \"vector\" and enable the extension.</li>\n</ol></div><div data-state=\"inactive\" data-orientation=\"horizontal\" role=\"tabpanel\" aria-labelledby=\"radix-:R9e9jtsn7qb6ra:-trigger-sql\" hidden=\"\" id=\"radix-:R9e9jtsn7qb6ra:-content-sql\" tabindex=\"0\" class=\"focus:outline-none transition-height \"></div></div>\n<h3 id=\"create-a-table-to-store-vectors\" class=\"group scroll-mt-24\">Create a table to store vectors<a href=\"#create-a-table-to-store-vectors\" aria-hidden=\"true\" class=\"ml-2 opacity-0 group-hover:opacity-100 transition\"><span aria-hidden=\"true\">#</span></a></h3>\n<p>After enabling the <code>vector</code> extension, you will get access to a new data type called <code>vector</code>. The size of the vector (indicated in parenthesis) represents the number of dimensions stored in that vector.</p>\n<div class=\"ch-codeblock not-prose \" data-ch-theme=\"supabase\"><div class=\"ch-code-wrapper ch-code\" data-ch-measured=\"false\"><code class=\"ch-code-scroll-parent\"><br><div><span class=\"ch-code-line-number\">_<!-- -->10</span><div style=\"display:inline-block;margin-left:16px\"><span>create table documents (</span></div></div><div><span class=\"ch-code-line-number\">_<!-- -->10</span><div style=\"display:inline-block;margin-left:16px\"><span>  id serial primary key,</span></div></div><div><span class=\"ch-code-line-number\">_<!-- -->10</span><div style=\"display:inline-block;margin-left:16px\"><span>  title text not null,</span></div></div><div><span class=\"ch-code-line-number\">_<!-- -->10</span><div style=\"display:inline-block;margin-left:16px\"><span>  body text not null,</span></div></div><div><span class=\"ch-code-line-number\">_<!-- -->10</span><div style=\"display:inline-block;margin-left:16px\"><span>  embedding vector(384)</span></div></div><div><span class=\"ch-code-line-number\">_<!-- -->10</span><div style=\"display:inline-block;margin-left:16px\"><span>);</span></div></div><br></code></div></div>\n<p>In the above SQL snippet, we create a <code>documents</code> table with a column called <code>embedding</code> (note this is just a regular Postgres column - you can name it whatever you like). We give the <code>embedding</code> column a <code>vector</code> data type with 384 dimensions. Change this to the number of dimensions produced by your embedding model. For example, if you are <a href=\"/docs/guides/ai/quickstarts/generate-text-embeddings\">generating embeddings</a> using the open source <a href=\"https://huggingface.co/Supabase/gte-small\"><code>gte-small</code></a> model, you would set this number to 384 since that model produces 384 dimensions.</p>\n<div role=\"alert\" class=\"relative w-full text-sm rounded-lg p-4 [&amp;>svg~*]:pl-10 [&amp;>svg+div]:translate-y-[-3px] [&amp;>svg]:absolute [&amp;>svg]:left-4 [&amp;>svg]:top-4 [&amp;>svg]:w-[23px] [&amp;>svg]:h-[23px] [&amp;>svg]:p-1 [&amp;>svg]:flex [&amp;>svg]:rounded text-foreground [&amp;>svg]:text-background [&amp;>svg]:bg-foreground mb-2 [&amp;_svg]:bg-foreground-muted [&amp;_svg]:text-background-muted bg-surface-200/25 border border-default\"><svg xmlns=\"http://www.w3.org/2000/svg\" viewBox=\"0 0 21 20\" class=\"w-6 h-6\" fill=\"currentColor\"><path fill-rule=\"evenodd\" clip-rule=\"evenodd\" d=\"M0.625 9.8252C0.625 4.44043 4.99023 0.0751953 10.375 0.0751953C15.7598 0.0751953 20.125 4.44043 20.125 9.8252C20.125 15.21 15.7598 19.5752 10.375 19.5752C4.99023 19.5752 0.625 15.21 0.625 9.8252ZM9.3584 4.38135C9.45117 4.28857 9.55518 4.20996 9.66699 4.14648C9.88086 4.02539 10.1245 3.96045 10.375 3.96045C10.5845 3.96045 10.7896 4.00586 10.9766 4.09229C11.1294 4.1626 11.2705 4.26025 11.3916 4.38135C11.6611 4.65088 11.8125 5.0166 11.8125 5.39795C11.8125 5.5249 11.7959 5.6499 11.7637 5.77002C11.6987 6.01172 11.5718 6.23438 11.3916 6.41455C11.1221 6.68408 10.7563 6.83545 10.375 6.83545C9.99365 6.83545 9.62793 6.68408 9.3584 6.41455C9.08887 6.14502 8.9375 5.7793 8.9375 5.39795C8.9375 5.29492 8.94873 5.19287 8.97021 5.09375C9.02783 4.82568 9.16162 4.57812 9.3584 4.38135ZM10.375 15.6899C10.0933 15.6899 9.82275 15.5781 9.62354 15.3789C9.42432 15.1797 9.3125 14.9092 9.3125 14.6274V9.31494C9.3125 9.0332 9.42432 8.7627 9.62354 8.56348C9.82275 8.36426 10.0933 8.25244 10.375 8.25244C10.6567 8.25244 10.9272 8.36426 11.1265 8.56348C11.3257 8.7627 11.4375 9.0332 11.4375 9.31494V14.6274C11.4375 14.7944 11.3979 14.9575 11.3242 15.104C11.2739 15.2046 11.2075 15.2979 11.1265 15.3789C10.9272 15.5781 10.6567 15.6899 10.375 15.6899Z\"></path></svg><div class=\"text mt [&amp;_p]:mb-1.5 [&amp;_p]:mt-0 mt-0.5 [&amp;_p:last-child]:mb-0\"><p>In general, embeddings with fewer dimensions perform best. See our <a href=\"https://supabase.com/blog/fewer-dimensions-are-better-pgvector\">analysis on fewer dimensions in pgvector</a>.</p></div></div>\n<h3 id=\"storing-a-vector--embedding\" class=\"group scroll-mt-24\">Storing a vector / embedding<a href=\"#storing-a-vector--embedding\" aria-hidden=\"true\" class=\"ml-2 opacity-0 group-hover:opacity-100 transition\"><span aria-hidden=\"true\">#</span></a></h3>\n<p>In this example we'll generate a vector using Transformers.js, then store it in the database using the Supabase JavaScript client.</p>\n<div class=\"ch-codeblock not-prose \" data-ch-theme=\"supabase\"><div class=\"ch-code-wrapper ch-code\" data-ch-measured=\"false\"><code class=\"ch-code-scroll-parent\"><br><div><span class=\"ch-code-line-number\">_<!-- -->21</span><div style=\"display:inline-block;margin-left:16px\"><span>import { pipeline } from '@xenova/transformers'</span></div></div><div><span class=\"ch-code-line-number\">_<!-- -->21</span><div style=\"display:inline-block;margin-left:16px\"><span>const generateEmbedding = await pipeline('feature-extraction', 'Supabase/gte-small')</span></div></div><div><span class=\"ch-code-line-number\">_<!-- -->21</span><div style=\"display:inline-block;margin-left:16px\"><span></span></div></div><div><span class=\"ch-code-line-number\">_<!-- -->21</span><div style=\"display:inline-block;margin-left:16px\"><span>const title = 'First post!'</span></div></div><div><span class=\"ch-code-line-number\">_<!-- -->21</span><div style=\"display:inline-block;margin-left:16px\"><span>const body = 'Hello world!'</span></div></div><div><span class=\"ch-code-line-number\">_<!-- -->21</span><div style=\"display:inline-block;margin-left:16px\"><span></span></div></div><div><span class=\"ch-code-line-number\">_<!-- -->21</span><div style=\"display:inline-block;margin-left:16px\"><span>// Generate a vector using Transformers.js</span></div></div><div><span class=\"ch-code-line-number\">_<!-- -->21</span><div style=\"display:inline-block;margin-left:16px\"><span>const output = await generateEmbedding(body, {</span></div></div><div><span class=\"ch-code-line-number\">_<!-- -->21</span><div style=\"display:inline-block;margin-left:16px\"><span>  pooling: 'mean',</span></div></div><div><span class=\"ch-code-line-number\">_<!-- -->21</span><div style=\"display:inline-block;margin-left:16px\"><span>  normalize: true,</span></div></div><div><span class=\"ch-code-line-number\">_<!-- -->21</span><div style=\"display:inline-block;margin-left:16px\"><span>})</span></div></div><div><span class=\"ch-code-line-number\">_<!-- -->21</span><div style=\"display:inline-block;margin-left:16px\"><span></span></div></div><div><span class=\"ch-code-line-number\">_<!-- -->21</span><div style=\"display:inline-block;margin-left:16px\"><span>// Extract the embedding output</span></div></div><div><span class=\"ch-code-line-number\">_<!-- -->21</span><div style=\"display:inline-block;margin-left:16px\"><span>const embedding = Array.from(output.data)</span></div></div><div><span class=\"ch-code-line-number\">_<!-- -->21</span><div style=\"display:inline-block;margin-left:16px\"><span></span></div></div><div><span class=\"ch-code-line-number\">_<!-- -->21</span><div style=\"display:inline-block;margin-left:16px\"><span>// Store the vector in Postgres</span></div></div><div><span class=\"ch-code-line-number\">_<!-- -->21</span><div style=\"display:inline-block;margin-left:16px\"><span>const { data, error } = await supabase.from('documents').insert({</span></div></div><div><span class=\"ch-code-line-number\">_<!-- -->21</span><div style=\"display:inline-block;margin-left:16px\"><span>  title,</span></div></div><div><span class=\"ch-code-line-number\">_<!-- -->21</span><div style=\"display:inline-block;margin-left:16px\"><span>  body,</span></div></div><div><span class=\"ch-code-line-number\">_<!-- -->21</span><div style=\"display:inline-block;margin-left:16px\"><span>  embedding,</span></div></div><div><span class=\"ch-code-line-number\">_<!-- -->21</span><div style=\"display:inline-block;margin-left:16px\"><span>})</span></div></div><br></code></div></div>\n<p>This example uses the JavaScript Supabase client, but you can modify it to work with any <a href=\"/docs#client-libraries\">supported language library</a>.</p>\n<h3 id=\"querying-a-vector--embedding\" class=\"group scroll-mt-24\">Querying a vector / embedding<a href=\"#querying-a-vector--embedding\" aria-hidden=\"true\" class=\"ml-2 opacity-0 group-hover:opacity-100 transition\"><span aria-hidden=\"true\">#</span></a></h3>\n<p>Similarity search is the most common use case for vectors. <code>pgvector</code> support 3 new operators for computing distance:</p>\n<table><thead><tr><th>Operator</th><th>Description</th></tr></thead><tbody><tr><td><code>&lt;-&gt;</code></td><td>Euclidean distance</td></tr><tr><td><code>&lt;#&gt;</code></td><td>negative inner product</td></tr><tr><td><code>&lt;=&gt;</code></td><td>cosine distance</td></tr></tbody></table>\n<p>Choosing the right operator depends on your needs. Dot product tends to be the fastest if your vectors are normalized. For more information on how embeddings work and how they relate to each other, see <a href=\"/docs/guides/ai/concepts#what-are-embeddings\">What are Embeddings?</a>.</p>\n<p>Supabase client libraries like <code>supabase-js</code> connect to your Postgres instance via <a href=\"/docs/guides/getting-started/architecture#postgrest-api\">PostgREST</a>. PostgREST does not currently support <code>pgvector</code> similarity operators, so we'll need to wrap our query in a Postgres function and call it via the <code>rpc()</code> method:</p>\n<div class=\"ch-codeblock not-prose \" data-ch-theme=\"supabase\"><div class=\"ch-code-wrapper ch-code\" data-ch-measured=\"false\"><code class=\"ch-code-scroll-parent\"><br><div><span class=\"ch-code-line-number\">_<!-- -->23</span><div style=\"display:inline-block;margin-left:16px\"><span>create or replace function match_documents (</span></div></div><div><span class=\"ch-code-line-number\">_<!-- -->23</span><div style=\"display:inline-block;margin-left:16px\"><span>  query_embedding vector(384),</span></div></div><div><span class=\"ch-code-line-number\">_<!-- -->23</span><div style=\"display:inline-block;margin-left:16px\"><span>  match_threshold float,</span></div></div><div><span class=\"ch-code-line-number\">_<!-- -->23</span><div style=\"display:inline-block;margin-left:16px\"><span>  match_count int</span></div></div><div><span class=\"ch-code-line-number\">_<!-- -->23</span><div style=\"display:inline-block;margin-left:16px\"><span>)</span></div></div><div><span class=\"ch-code-line-number\">_<!-- -->23</span><div style=\"display:inline-block;margin-left:16px\"><span>returns table (</span></div></div><div><span class=\"ch-code-line-number\">_<!-- -->23</span><div style=\"display:inline-block;margin-left:16px\"><span>  id bigint,</span></div></div><div><span class=\"ch-code-line-number\">_<!-- -->23</span><div style=\"display:inline-block;margin-left:16px\"><span>  title text,</span></div></div><div><span class=\"ch-code-line-number\">_<!-- -->23</span><div style=\"display:inline-block;margin-left:16px\"><span>  body text,</span></div></div><div><span class=\"ch-code-line-number\">_<!-- -->23</span><div style=\"display:inline-block;margin-left:16px\"><span>  similarity float</span></div></div><div><span class=\"ch-code-line-number\">_<!-- -->23</span><div style=\"display:inline-block;margin-left:16px\"><span>)</span></div></div><div><span class=\"ch-code-line-number\">_<!-- -->23</span><div style=\"display:inline-block;margin-left:16px\"><span>language sql stable</span></div></div><div><span class=\"ch-code-line-number\">_<!-- -->23</span><div style=\"display:inline-block;margin-left:16px\"><span>as $$</span></div></div><div><span class=\"ch-code-line-number\">_<!-- -->23</span><div style=\"display:inline-block;margin-left:16px\"><span>  select</span></div></div><div><span class=\"ch-code-line-number\">_<!-- -->23</span><div style=\"display:inline-block;margin-left:16px\"><span>    documents.id,</span></div></div><div><span class=\"ch-code-line-number\">_<!-- -->23</span><div style=\"display:inline-block;margin-left:16px\"><span>    documents.title,</span></div></div><div><span class=\"ch-code-line-number\">_<!-- -->23</span><div style=\"display:inline-block;margin-left:16px\"><span>    documents.body,</span></div></div><div><span class=\"ch-code-line-number\">_<!-- -->23</span><div style=\"display:inline-block;margin-left:16px\"><span>    1 - (documents.embedding &lt;=&gt; query_embedding) as similarity</span></div></div><div><span class=\"ch-code-line-number\">_<!-- -->23</span><div style=\"display:inline-block;margin-left:16px\"><span>  from documents</span></div></div><div><span class=\"ch-code-line-number\">_<!-- -->23</span><div style=\"display:inline-block;margin-left:16px\"><span>  where 1 - (documents.embedding &lt;=&gt; query_embedding) &gt; match_threshold</span></div></div><div><span class=\"ch-code-line-number\">_<!-- -->23</span><div style=\"display:inline-block;margin-left:16px\"><span>  order by (documents.embedding &lt;=&gt; query_embedding) asc</span></div></div><div><span class=\"ch-code-line-number\">_<!-- -->23</span><div style=\"display:inline-block;margin-left:16px\"><span>  limit match_count;</span></div></div><div><span class=\"ch-code-line-number\">_<!-- -->23</span><div style=\"display:inline-block;margin-left:16px\"><span>$$;</span></div></div><br></code></div></div>\n<p>This function takes a <code>query_embedding</code> argument and compares it to all other embeddings in the <code>documents</code> table. Each comparison returns a similarity score. If the similarity is greater than the <code>match_threshold</code> argument, it is returned. The number of rows returned is limited by the <code>match_count</code> argument.</p>\n<p>Feel free to modify this method to fit the needs of your application. The <code>match_threshold</code> ensures that only documents that have a minimum similarity to the <code>query_embedding</code> are returned. Without this, you may end up returning documents that subjectively don't match. This value will vary for each application - you will need to perform your own testing to determine the threshold that makes sense for your app.</p>\n<p>If you index your vector column, ensure that the <code>order by</code> sorts by the distance function directly (rather than sorting by the calculated <code>similarity</code> column, which may lead to the index being ignored and poor performance).</p>\n<p>To execute the function from your client library, call <code>rpc()</code> with the name of your Postgres function:</p>\n<div class=\"ch-codeblock not-prose \" data-ch-theme=\"supabase\"><div class=\"ch-code-wrapper ch-code\" data-ch-measured=\"false\"><code class=\"ch-code-scroll-parent\"><br><div><span class=\"ch-code-line-number\">_<!-- -->10</span><div style=\"display:inline-block;margin-left:16px\"><span>const { data: documents } = await supabaseClient.rpc('match_documents', {</span></div></div><div><span class=\"ch-code-line-number\">_<!-- -->10</span><div style=\"display:inline-block;margin-left:16px\"><span>  query_embedding: embedding, // Pass the embedding you want to compare</span></div></div><div><span class=\"ch-code-line-number\">_<!-- -->10</span><div style=\"display:inline-block;margin-left:16px\"><span>  match_threshold: 0.78, // Choose an appropriate threshold for your data</span></div></div><div><span class=\"ch-code-line-number\">_<!-- -->10</span><div style=\"display:inline-block;margin-left:16px\"><span>  match_count: 10, // Choose the number of matches</span></div></div><div><span class=\"ch-code-line-number\">_<!-- -->10</span><div style=\"display:inline-block;margin-left:16px\"><span>})</span></div></div><br></code></div></div>\n<p>In this example <code>embedding</code> would be another embedding you wish to compare against your table of pre-generated embedding documents. For example if you were building a search engine, every time the user submits their query you would first generate an embedding on the search query itself, then pass it into the above <code>rpc()</code> function to match.</p>\n<div role=\"alert\" class=\"relative w-full text-sm rounded-lg p-4 [&amp;>svg~*]:pl-10 [&amp;>svg+div]:translate-y-[-3px] [&amp;>svg]:absolute [&amp;>svg]:left-4 [&amp;>svg]:top-4 [&amp;>svg]:w-[23px] [&amp;>svg]:h-[23px] [&amp;>svg]:p-1 [&amp;>svg]:flex [&amp;>svg]:rounded text-foreground [&amp;>svg]:text-background [&amp;>svg]:bg-foreground mb-2 [&amp;_svg]:bg-foreground-muted [&amp;_svg]:text-background-muted bg-surface-200/25 border border-default\"><svg xmlns=\"http://www.w3.org/2000/svg\" viewBox=\"0 0 21 20\" class=\"w-6 h-6\" fill=\"currentColor\"><path fill-rule=\"evenodd\" clip-rule=\"evenodd\" d=\"M0.625 9.8252C0.625 4.44043 4.99023 0.0751953 10.375 0.0751953C15.7598 0.0751953 20.125 4.44043 20.125 9.8252C20.125 15.21 15.7598 19.5752 10.375 19.5752C4.99023 19.5752 0.625 15.21 0.625 9.8252ZM9.3584 4.38135C9.45117 4.28857 9.55518 4.20996 9.66699 4.14648C9.88086 4.02539 10.1245 3.96045 10.375 3.96045C10.5845 3.96045 10.7896 4.00586 10.9766 4.09229C11.1294 4.1626 11.2705 4.26025 11.3916 4.38135C11.6611 4.65088 11.8125 5.0166 11.8125 5.39795C11.8125 5.5249 11.7959 5.6499 11.7637 5.77002C11.6987 6.01172 11.5718 6.23438 11.3916 6.41455C11.1221 6.68408 10.7563 6.83545 10.375 6.83545C9.99365 6.83545 9.62793 6.68408 9.3584 6.41455C9.08887 6.14502 8.9375 5.7793 8.9375 5.39795C8.9375 5.29492 8.94873 5.19287 8.97021 5.09375C9.02783 4.82568 9.16162 4.57812 9.3584 4.38135ZM10.375 15.6899C10.0933 15.6899 9.82275 15.5781 9.62354 15.3789C9.42432 15.1797 9.3125 14.9092 9.3125 14.6274V9.31494C9.3125 9.0332 9.42432 8.7627 9.62354 8.56348C9.82275 8.36426 10.0933 8.25244 10.375 8.25244C10.6567 8.25244 10.9272 8.36426 11.1265 8.56348C11.3257 8.7627 11.4375 9.0332 11.4375 9.31494V14.6274C11.4375 14.7944 11.3979 14.9575 11.3242 15.104C11.2739 15.2046 11.2075 15.2979 11.1265 15.3789C10.9272 15.5781 10.6567 15.6899 10.375 15.6899Z\"></path></svg><div class=\"text mt [&amp;_p]:mb-1.5 [&amp;_p]:mt-0 mt-0.5 [&amp;_p:last-child]:mb-0\"><p>Be sure to use embeddings produced from the same embedding model when calculating distance. Comparing embeddings from two different models will produce no meaningful result.</p></div></div>\n<p>Vectors and embeddings can be used for much more than search. Learn more about embeddings at <a href=\"/docs/guides/ai/concepts#what-are-embeddings\">What are Embeddings?</a>.</p>\n<h3 id=\"indexes\" class=\"group scroll-mt-24\">Indexes<a href=\"#indexes\" aria-hidden=\"true\" class=\"ml-2 opacity-0 group-hover:opacity-100 transition\"><span aria-hidden=\"true\">#</span></a></h3>\n<p>Once your vector table starts to grow, you will likely want to add an index to speed up queries. See <a href=\"/docs/guides/ai/vector-indexes\">Vector indexes</a> to learn how vector indexes work and how to create them.</p></article></div></div></div><!--$--><div class=\"max-w-7xl px-5 mx-auto py-8 pt-0\"></div><!--/$--></div><div class=\"left-0 right-0 z-10 backdrop-blur-sm backdrop-filter bg-alternative/90 hidden h-0 lg:hidden\"></div></div></main></div></div></div></div></body></html>",
      "metadata": {
        "ogUrl": "https://supabase.com/docs/guides/ai/vector-columns",
        "title": "Vector columns | Supabase Docs",
        "robots": "index, follow",
        "ogImage": "https://obuldanrptloktxcffvn.supabase.co/functions/v1/og-images?site=docs&type=ai&title=Vector%20columns&description=Learn%20how%20to%20use%20vectors%20within%20your%20own%20Postgres%20tables",
        "ogTitle": "Vector columns | Supabase Docs",
        "language": "en",
        "sourceURL": "https://supabase.com/docs/guides/ai/vector-columns",
        "description": "Learn how to use vectors within your own Postgres tables",
        "modifiedTime": "2024-09-10T20:36:24.564Z",
        "ogDescription": "Learn how to use vectors within your own Postgres tables",
        "publishedTime": "2024-09-10T20:36:24.564Z",
        "ogLocaleAlternate": [],
        "statusCode": 200
      }
    },
    {
      "markdown": "AI & Vectors\n\n# Semantic Text Deduplication\n\n## Finding duplicate movie reviews with Supabase Vecs.\n\n* * *\n\nThis guide will walk you through a [\"Semantic Text Deduplication\"](https://github.com/supabase/supabase/blob/master/examples/ai/semantic_text_deduplication.ipynb) example using Colab and Supabase Vecs. You'll learn how to find similar movie reviews using embeddings, and remove any that seem like duplicates. You will:\n\n1. Launch a Postgres database that uses pgvector to store embeddings\n2. Launch a notebook that connects to your database\n3. Load the IMDB dataset\n4. Use the `sentence-transformers/all-MiniLM-L6-v2` model to create an embedding representing the semantic meaning of each review.\n5. Search for all duplicates.\n\n## Project setup [\\#](\\#project-setup)\n\nLet's create a new Postgres database. This is as simple as starting a new Project in Supabase:\n\n1. [Create a new project](https://database.new/) in the Supabase dashboard.\n2. Enter your project details. Remember to store your password somewhere safe.\n\nYour database will be available in less than a minute.\n\n**Finding your credentials:**\n\nYou can find your project credentials inside the project [settings](https://supabase.com/dashboard/project/_/settings/), including:\n\n- [Database credentials](https://supabase.com/dashboard/project/_/settings/database): connection strings and connection pooler details.\n- [API credentials](https://supabase.com/dashboard/project/_/settings/database): your serverless API URL and `anon` / `service_role` keys.\n\n## Launching a notebook [\\#](\\#launching-a-notebook)\n\nLaunch our [`semantic_text_deduplication`](https://github.com/supabase/supabase/blob/master/examples/ai/semantic_text_deduplication.ipynb) notebook in Colab:\n\n[![](https://supabase.com/docs/img/ai/colab-badge.svg)](https://colab.research.google.com/github/supabase/supabase/blob/master/examples/ai/semantic_text_deduplication.ipynb)\n\nAt the top of the notebook, you'll see a button `Copy to Drive`. Click this button to copy the notebook to your Google Drive.\n\n## Connecting to your database [\\#](\\#connecting-to-your-database)\n\nInside the Notebook, find the cell which specifies the `DB_CONNECTION`. It will contain some code like this:\n\n`\n_10\nimport vecs\n_10\n_10\nDB_CONNECTION = \"postgresql://<user>:<password>@<host>:<port>/<db_name>\"\n_10\n_10\n# create vector store client\n_10\nvx = vecs.create_client(DB_CONNECTION)\n`\n\nReplace the `DB_CONNECTION` with your own connection string for your database. You can find the Postgres connection string in the [Database Settings](https://supabase.com/dashboard/project/_/settings/database) of your Supabase project.\n\nSQLAlchemy requires the connection string to start with `postgresql://` (instead of `postgres://`). Don't forget to rename this after copying the string from the dashboard.\n\nYou must use the \"connection pooling\" string (domain ending in `*.pooler.supabase.com`) with Google Colab since Colab does not support IPv6.\n\n## Stepping through the notebook [\\#](\\#stepping-through-the-notebook)\n\nNow all that's left is to step through the notebook. You can do this by clicking the \"execute\" button ( `ctrl+enter`) at the top left of each code cell. The notebook guides you through the process of creating a collection, adding data to it, and querying it.\n\nYou can view the inserted items in the [Table Editor](https://supabase.com/dashboard/project/_/editor/), by selecting the `vecs` schema from the schema dropdown.\n\n![Colab documents](https://supabase.com/docs/img/ai/google-colab/colab-documents.png)\n\n## Deployment [\\#](\\#deployment)\n\nIf you have your own infrastructure for deploying Python apps, you can continue to use `vecs` as described in this guide.\n\nAlternatively if you would like to quickly deploy using Supabase, check out our guide on using the [Hugging Face Inference API](/docs/guides/ai/hugging-face) in Edge Functions using TypeScript.\n\n## Next steps [\\#](\\#next-steps)\n\nYou can now start building your own applications with Vecs. Check our [examples](/docs/guides/ai#examples) for ideas.",
      "html": "<!DOCTYPE html><html lang=\"en\" data-theme=\"light\" style=\"color-scheme: light;\"><body><div class=\"flex flex-col\"><div class=\"grow\"><div class=\"flex flex-col h-full w-full\"><div class=\"hidden lg:sticky w-full lg:flex top-0 left-0 right-0 z-50\"><!--$--><!--/$--></div><div class=\"flex flex-row h-full relative\"><main id=\"docs-content-container\" class=\"w-full transition-all ease-out relative lg:ml-0\"><div class=\"flex flex-col sticky top-0\"><div class=\"flex lg:hidden w-full top-0 left-0 right-0 z-50\"><!--$--><!--/$--></div><div class=\"sticky transition-all top-0 z-10 backdrop-blur backdrop-filter bg-background\"><div class=\"lg:hidden px-3.5 border-b z-10 transition-all ease-out top-0 flex items-center gap-1\"><button class=\"h-8 w-8 flex group items-center justify-center mr-1\"><div class=\"space-y-1 cursor-pointer relative w-4 h-[8px]\"><span class=\"transition-all ease-out block h-px bg-foreground-muted group-hover:bg-foreground w-4\"></span><span class=\"transition-all ease-out block h-px bg-foreground-muted group-hover:bg-foreground w-3 group-hover:w-4\"></span></div></button><span class=\"transition-all duration-200 text-foreground text-sm\">AI &amp; Vectors</span></div></div><div class=\"grow\"><div class=\"max-w-7xl px-5 mx-auto py-8 pb-0\"><div class=\"grid grid-cols-12 relative gap-4\"><div class=\"relative transition-all ease-out duration-100 col-span-12 md:col-span-9\"><article id=\"sb-docs-guide-main-article\" class=\"prose max-w-none\"><h1 class=\"mb-0\">Semantic Text Deduplication</h1><h2 class=\"mt-3 text-xl text-foreground-light\">Finding duplicate movie reviews with Supabase Vecs.</h2><hr class=\"not-prose border-t-0 border-b my-8\">\n<p>This guide will walk you through a <a href=\"https://github.com/supabase/supabase/blob/master/examples/ai/semantic_text_deduplication.ipynb\">\"Semantic Text Deduplication\"</a> example using Colab and Supabase Vecs. You'll learn how to find similar movie reviews using embeddings, and remove any that seem like duplicates. You will:</p>\n<ol>\n<li>Launch a Postgres database that uses pgvector to store embeddings</li>\n<li>Launch a notebook that connects to your database</li>\n<li>Load the IMDB dataset</li>\n<li>Use the <code>sentence-transformers/all-MiniLM-L6-v2</code> model to create an embedding representing the semantic meaning of each review.</li>\n<li>Search for all duplicates.</li>\n</ol>\n<h2 id=\"project-setup\" class=\"group scroll-mt-24\">Project setup<a href=\"#project-setup\" aria-hidden=\"true\" class=\"ml-2 opacity-0 group-hover:opacity-100 transition\"><span aria-hidden=\"true\">#</span></a></h2>\n<p>Let's create a new Postgres database. This is as simple as starting a new Project in Supabase:</p>\n<ol>\n<li><a href=\"https://database.new/\">Create a new project</a> in the Supabase dashboard.</li>\n<li>Enter your project details. Remember to store your password somewhere safe.</li>\n</ol>\n<p>Your database will be available in less than a minute.</p>\n<p><strong>Finding your credentials:</strong></p>\n<p>You can find your project credentials inside the project <a href=\"https://supabase.com/dashboard/project/_/settings/\">settings</a>, including:</p>\n<ul>\n<li><a href=\"https://supabase.com/dashboard/project/_/settings/database\">Database credentials</a>: connection strings and connection pooler details.</li>\n<li><a href=\"https://supabase.com/dashboard/project/_/settings/database\">API credentials</a>: your serverless API URL and <code>anon</code> / <code>service_role</code> keys.</li>\n</ul>\n<h2 id=\"launching-a-notebook\" class=\"group scroll-mt-24\">Launching a notebook<a href=\"#launching-a-notebook\" aria-hidden=\"true\" class=\"ml-2 opacity-0 group-hover:opacity-100 transition\"><span aria-hidden=\"true\">#</span></a></h2>\n<p>Launch our <a href=\"https://github.com/supabase/supabase/blob/master/examples/ai/semantic_text_deduplication.ipynb\"><code>semantic_text_deduplication</code></a> notebook in Colab:</p>\n<a class=\"w-64\" href=\"https://colab.research.google.com/github/supabase/supabase/blob/master/examples/ai/semantic_text_deduplication.ipynb\"><img src=\"/docs/img/ai/colab-badge.svg\"></a>\n<p>At the top of the notebook, you'll see a button <code>Copy to Drive</code>. Click this button to copy the notebook to your Google Drive.</p>\n<h2 id=\"connecting-to-your-database\" class=\"group scroll-mt-24\">Connecting to your database<a href=\"#connecting-to-your-database\" aria-hidden=\"true\" class=\"ml-2 opacity-0 group-hover:opacity-100 transition\"><span aria-hidden=\"true\">#</span></a></h2>\n<p>Inside the Notebook, find the cell which specifies the <code>DB_CONNECTION</code>. It will contain some code like this:</p>\n<div class=\"ch-codeblock not-prose \" data-ch-theme=\"supabase\"><div class=\"ch-code-wrapper ch-code\" data-ch-measured=\"false\"><code class=\"ch-code-scroll-parent\"><br><div><span class=\"ch-code-line-number\">_<!-- -->10</span><div style=\"display:inline-block;margin-left:16px\"><span>import vecs</span></div></div><div><span class=\"ch-code-line-number\">_<!-- -->10</span><div style=\"display:inline-block;margin-left:16px\"><span></span></div></div><div><span class=\"ch-code-line-number\">_<!-- -->10</span><div style=\"display:inline-block;margin-left:16px\"><span>DB_CONNECTION = \"postgresql://&lt;user&gt;:&lt;password&gt;@&lt;host&gt;:&lt;port&gt;/&lt;db_name&gt;\"</span></div></div><div><span class=\"ch-code-line-number\">_<!-- -->10</span><div style=\"display:inline-block;margin-left:16px\"><span></span></div></div><div><span class=\"ch-code-line-number\">_<!-- -->10</span><div style=\"display:inline-block;margin-left:16px\"><span># create vector store client</span></div></div><div><span class=\"ch-code-line-number\">_<!-- -->10</span><div style=\"display:inline-block;margin-left:16px\"><span>vx = vecs.create_client(DB_CONNECTION)</span></div></div><br></code></div></div>\n<p>Replace the <code>DB_CONNECTION</code> with your own connection string for your database. You can find the Postgres connection string in the <a href=\"https://supabase.com/dashboard/project/_/settings/database\">Database Settings</a> of your Supabase project.</p>\n<div role=\"alert\" class=\"relative w-full text-sm rounded-lg p-4 [&amp;>svg~*]:pl-10 [&amp;>svg+div]:translate-y-[-3px] [&amp;>svg]:absolute [&amp;>svg]:left-4 [&amp;>svg]:top-4 [&amp;>svg]:w-[23px] [&amp;>svg]:h-[23px] [&amp;>svg]:p-1 [&amp;>svg]:flex [&amp;>svg]:rounded text-foreground [&amp;>svg]:text-background [&amp;>svg]:bg-foreground mb-2 [&amp;_svg]:bg-foreground-muted [&amp;_svg]:text-background-muted bg-surface-200/25 border border-default\"><svg xmlns=\"http://www.w3.org/2000/svg\" viewBox=\"0 0 21 20\" class=\"w-6 h-6\" fill=\"currentColor\"><path fill-rule=\"evenodd\" clip-rule=\"evenodd\" d=\"M0.625 9.8252C0.625 4.44043 4.99023 0.0751953 10.375 0.0751953C15.7598 0.0751953 20.125 4.44043 20.125 9.8252C20.125 15.21 15.7598 19.5752 10.375 19.5752C4.99023 19.5752 0.625 15.21 0.625 9.8252ZM9.3584 4.38135C9.45117 4.28857 9.55518 4.20996 9.66699 4.14648C9.88086 4.02539 10.1245 3.96045 10.375 3.96045C10.5845 3.96045 10.7896 4.00586 10.9766 4.09229C11.1294 4.1626 11.2705 4.26025 11.3916 4.38135C11.6611 4.65088 11.8125 5.0166 11.8125 5.39795C11.8125 5.5249 11.7959 5.6499 11.7637 5.77002C11.6987 6.01172 11.5718 6.23438 11.3916 6.41455C11.1221 6.68408 10.7563 6.83545 10.375 6.83545C9.99365 6.83545 9.62793 6.68408 9.3584 6.41455C9.08887 6.14502 8.9375 5.7793 8.9375 5.39795C8.9375 5.29492 8.94873 5.19287 8.97021 5.09375C9.02783 4.82568 9.16162 4.57812 9.3584 4.38135ZM10.375 15.6899C10.0933 15.6899 9.82275 15.5781 9.62354 15.3789C9.42432 15.1797 9.3125 14.9092 9.3125 14.6274V9.31494C9.3125 9.0332 9.42432 8.7627 9.62354 8.56348C9.82275 8.36426 10.0933 8.25244 10.375 8.25244C10.6567 8.25244 10.9272 8.36426 11.1265 8.56348C11.3257 8.7627 11.4375 9.0332 11.4375 9.31494V14.6274C11.4375 14.7944 11.3979 14.9575 11.3242 15.104C11.2739 15.2046 11.2075 15.2979 11.1265 15.3789C10.9272 15.5781 10.6567 15.6899 10.375 15.6899Z\"></path></svg><div class=\"text mt [&amp;_p]:mb-1.5 [&amp;_p]:mt-0 mt-0.5 [&amp;_p:last-child]:mb-0\"><p>SQLAlchemy requires the connection string to start with <code>postgresql://</code> (instead of <code>postgres://</code>). Don't forget to rename this after copying the string from the dashboard.</p></div></div>\n<div role=\"alert\" class=\"relative w-full text-sm rounded-lg p-4 [&amp;>svg~*]:pl-10 [&amp;>svg+div]:translate-y-[-3px] [&amp;>svg]:absolute [&amp;>svg]:left-4 [&amp;>svg]:top-4 [&amp;>svg]:w-[23px] [&amp;>svg]:h-[23px] [&amp;>svg]:p-1 [&amp;>svg]:flex [&amp;>svg]:rounded text-foreground [&amp;>svg]:text-background [&amp;>svg]:bg-foreground mb-2 [&amp;_svg]:bg-foreground-muted [&amp;_svg]:text-background-muted bg-surface-200/25 border border-default\"><svg xmlns=\"http://www.w3.org/2000/svg\" viewBox=\"0 0 21 20\" class=\"w-6 h-6\" fill=\"currentColor\"><path fill-rule=\"evenodd\" clip-rule=\"evenodd\" d=\"M0.625 9.8252C0.625 4.44043 4.99023 0.0751953 10.375 0.0751953C15.7598 0.0751953 20.125 4.44043 20.125 9.8252C20.125 15.21 15.7598 19.5752 10.375 19.5752C4.99023 19.5752 0.625 15.21 0.625 9.8252ZM9.3584 4.38135C9.45117 4.28857 9.55518 4.20996 9.66699 4.14648C9.88086 4.02539 10.1245 3.96045 10.375 3.96045C10.5845 3.96045 10.7896 4.00586 10.9766 4.09229C11.1294 4.1626 11.2705 4.26025 11.3916 4.38135C11.6611 4.65088 11.8125 5.0166 11.8125 5.39795C11.8125 5.5249 11.7959 5.6499 11.7637 5.77002C11.6987 6.01172 11.5718 6.23438 11.3916 6.41455C11.1221 6.68408 10.7563 6.83545 10.375 6.83545C9.99365 6.83545 9.62793 6.68408 9.3584 6.41455C9.08887 6.14502 8.9375 5.7793 8.9375 5.39795C8.9375 5.29492 8.94873 5.19287 8.97021 5.09375C9.02783 4.82568 9.16162 4.57812 9.3584 4.38135ZM10.375 15.6899C10.0933 15.6899 9.82275 15.5781 9.62354 15.3789C9.42432 15.1797 9.3125 14.9092 9.3125 14.6274V9.31494C9.3125 9.0332 9.42432 8.7627 9.62354 8.56348C9.82275 8.36426 10.0933 8.25244 10.375 8.25244C10.6567 8.25244 10.9272 8.36426 11.1265 8.56348C11.3257 8.7627 11.4375 9.0332 11.4375 9.31494V14.6274C11.4375 14.7944 11.3979 14.9575 11.3242 15.104C11.2739 15.2046 11.2075 15.2979 11.1265 15.3789C10.9272 15.5781 10.6567 15.6899 10.375 15.6899Z\"></path></svg><div class=\"text mt [&amp;_p]:mb-1.5 [&amp;_p]:mt-0 mt-0.5 [&amp;_p:last-child]:mb-0\"><p>You must use the \"connection pooling\" string (domain ending in <code>*.pooler.supabase.com</code>) with Google Colab since Colab does not support IPv6.</p></div></div>\n<h2 id=\"stepping-through-the-notebook\" class=\"group scroll-mt-24\">Stepping through the notebook<a href=\"#stepping-through-the-notebook\" aria-hidden=\"true\" class=\"ml-2 opacity-0 group-hover:opacity-100 transition\"><span aria-hidden=\"true\">#</span></a></h2>\n<p>Now all that's left is to step through the notebook. You can do this by clicking the \"execute\" button (<code>ctrl+enter</code>) at the top left of each code cell. The notebook guides you through the process of creating a collection, adding data to it, and querying it.</p>\n<p>You can view the inserted items in the <a href=\"https://supabase.com/dashboard/project/_/editor/\">Table Editor</a>, by selecting the <code>vecs</code> schema from the schema dropdown.</p>\n<p><img src=\"/docs/img/ai/google-colab/colab-documents.png\" alt=\"Colab documents\"></p>\n<h2 id=\"deployment\" class=\"group scroll-mt-24\">Deployment<a href=\"#deployment\" aria-hidden=\"true\" class=\"ml-2 opacity-0 group-hover:opacity-100 transition\"><span aria-hidden=\"true\">#</span></a></h2>\n<p>If you have your own infrastructure for deploying Python apps, you can continue to use <code>vecs</code> as described in this guide.</p>\n<p>Alternatively if you would like to quickly deploy using Supabase, check out our guide on using the <a href=\"/docs/guides/ai/hugging-face\">Hugging Face Inference API</a> in Edge Functions using TypeScript.</p>\n<h2 id=\"next-steps\" class=\"group scroll-mt-24\">Next steps<a href=\"#next-steps\" aria-hidden=\"true\" class=\"ml-2 opacity-0 group-hover:opacity-100 transition\"><span aria-hidden=\"true\">#</span></a></h2>\n<p>You can now start building your own applications with Vecs. Check our <a href=\"/docs/guides/ai#examples\">examples</a> for ideas.</p></article></div></div></div><!--$--><div class=\"max-w-7xl px-5 mx-auto py-8 pt-0\"></div><!--/$--></div><div class=\"left-0 right-0 z-10 backdrop-blur-sm backdrop-filter bg-alternative/90 hidden h-0 lg:hidden\"></div></div></main></div></div></div></div></body></html>",
      "metadata": {
        "ogUrl": "https://supabase.com/docs/guides/ai/quickstarts/text-deduplication",
        "title": "Semantic Text Deduplication | Supabase Docs",
        "robots": "index, follow",
        "ogImage": "https://obuldanrptloktxcffvn.supabase.co/functions/v1/og-images?site=docs&type=ai&title=Semantic%20Text%20Deduplication&description=undefined",
        "ogTitle": "Semantic Text Deduplication | Supabase Docs",
        "language": "en",
        "sourceURL": "https://supabase.com/docs/guides/ai/quickstarts/text-deduplication",
        "description": "Finding duplicate movie reviews with Supabase Vecs.",
        "modifiedTime": "2024-09-10T20:36:25.434Z",
        "ogDescription": "Finding duplicate movie reviews with Supabase Vecs.",
        "publishedTime": "2024-09-10T20:36:25.434Z",
        "ogLocaleAlternate": [],
        "statusCode": 200
      }
    },
    {
      "markdown": "AI & Vectors\n\n# Generate Embeddings\n\n## Generate text embeddings using Edge Functions.\n\n* * *\n\nThis guide will walk you through how to generate high quality text embeddings in [Edge Functions](/docs/guides/functions) using its built-in AI inference API, so no external API is required.\n\n## Build the Edge Function [\\#](\\#build-the-edge-function)\n\nLet's build an Edge Function that will accept an input string and generate an embedding for it. Edge Functions are server-side TypeScript HTTP endpoints that run on-demand closest to your users.\n\n1\n\n### Set up Supabase locally\n\nMake sure you have the latest version of the [Supabase CLI installed](/docs/guides/cli/getting-started).\n\nInitialize Supabase in the root directory of your app and start your local stack.\n\n`\n_10\nsupabase init\n_10\nsupabase start\n`\n\n2\n\n### Create Edge Function\n\nCreate an Edge Function that we will use to generate embeddings. We'll call this `embed` (you can name this anything you like).\n\nThis will create a new TypeScript file called `index.ts` under `./supabase/functions/embed`.\n\n`\n_10\nsupabase functions new embed\n`\n\n3\n\n### Setup Inference Session\n\nLet's create a new inference session to be used in the lifetime of this function. Multiple requests can use the same inference session.\n\nCurrently, only the `gte-small` ( [https://huggingface.co/Supabase/gte-small](https://huggingface.co/Supabase/gte-small)) text embedding model is supported in Supabase's Edge Runtime.\n\n./supabase/functions/embed/index.ts\n\n`\n_10\nconst session = new Supabase.ai.Session('gte-small');\n`\n\n4\n\n### Implement request handler\n\nModify our request handler to accept an `input` string from the POST request JSON body.\n\nThen generate the embedding by calling `session.run(input)`.\n\n./supabase/functions/embed/index.ts\n\n`\n_16\nDeno.serve(async (req) => {\n_16\n// Extract input string from JSON body\n_16\nconst { input } = await req.json();\n_16\n_16\n// Generate the embedding from the user input\n_16\nconst embedding = await session.run(input, {\n_16\n    mean_pool: true,\n_16\n    normalize: true,\n_16\n});\n_16\n_16\n// Return the embedding\n_16\nreturn new Response(\n_16\n    JSON.stringify({ embedding }),\n_16\n    { headers: { 'Content-Type': 'application/json' } }\n_16\n);\n_16\n});\n`\n\nNote the two options we pass to `session.run()`:\n\n- `mean_pool`: The first option sets `pooling` to `mean`. Pooling referes to how token-level embedding representations are compressed into a single sentence embedding that reflects the meaning of the entire sentence. Average pooling is the most common type of pooling for sentence embeddings.\n- `normalize`: The second option tells to normalize the embedding vector so that it can be used with distance measures like dot product. A normalized vector means its length (magnitude) is 1 - also referred to as a unit vector. A vector is normalized by dividing each element by the vector's length (magnitude), which maintains its direction but changes its length to 1.\n\n5\n\n### Test it!\n\nTo test the Edge Function, first start a local functions server.\n\n`\n_10\nsupabase functions serve\n`\n\nThen in a new shell, create an HTTP request using cURL and pass in your input in the JSON body.\n\n`\n_10\ncurl --request POST 'http://localhost:54321/functions/v1/embed' \\\n_10\n  --header 'Authorization: Bearer ANON_KEY' \\\n_10\n  --header 'Content-Type: application/json' \\\n_10\n  --data '{ \"input\": \"hello world\" }'\n`\n\nBe sure to replace `ANON_KEY` with your project's anonymous key. You can get this key by running `supabase status`.\n\n## Next steps [\\#](\\#next-steps)\n\n- Learn more about [embedding concepts](/docs/guides/ai/concepts)\n- [Store your embeddings](/docs/guides/ai/vector-columns) in a database",
      "html": "<!DOCTYPE html><html lang=\"en\" data-theme=\"light\" style=\"color-scheme: light;\"><body><div class=\"flex flex-col\"><div class=\"grow\"><div class=\"flex flex-col h-full w-full\"><div class=\"hidden lg:sticky w-full lg:flex top-0 left-0 right-0 z-50\"><!--$--><!--/$--></div><div class=\"flex flex-row h-full relative\"><main id=\"docs-content-container\" class=\"w-full transition-all ease-out relative lg:ml-0\"><div class=\"flex flex-col sticky top-0\"><div class=\"flex lg:hidden w-full top-0 left-0 right-0 z-50\"><!--$--><!--/$--></div><div class=\"sticky transition-all top-0 z-10 backdrop-blur backdrop-filter bg-background\"><div class=\"lg:hidden px-3.5 border-b z-10 transition-all ease-out top-0 flex items-center gap-1\"><button class=\"h-8 w-8 flex group items-center justify-center mr-1\"><div class=\"space-y-1 cursor-pointer relative w-4 h-[8px]\"><span class=\"transition-all ease-out block h-px bg-foreground-muted group-hover:bg-foreground w-4\"></span><span class=\"transition-all ease-out block h-px bg-foreground-muted group-hover:bg-foreground w-3 group-hover:w-4\"></span></div></button><span class=\"transition-all duration-200 text-foreground text-sm\">AI &amp; Vectors</span></div></div><div class=\"grow\"><div class=\"max-w-7xl px-5 mx-auto py-8 pb-0\"><div class=\"grid grid-cols-12 relative gap-4\"><div class=\"relative transition-all ease-out duration-100 col-span-12 md:col-span-9\"><article id=\"sb-docs-guide-main-article\" class=\"prose max-w-none\"><h1 class=\"mb-0\">Generate Embeddings</h1><h2 class=\"mt-3 text-xl text-foreground-light\">Generate text embeddings using Edge Functions.</h2><hr class=\"not-prose border-t-0 border-b my-8\">\n<p>This guide will walk you through how to generate high quality text embeddings in <a href=\"/docs/guides/functions\">Edge Functions</a> using its built-in AI inference API, so no external API is required.</p>\n<h2 id=\"build-the-edge-function\" class=\"group scroll-mt-24\">Build the Edge Function<a href=\"#build-the-edge-function\" aria-hidden=\"true\" class=\"ml-2 opacity-0 group-hover:opacity-100 transition\"><span aria-hidden=\"true\">#</span></a></h2>\n<p>Let's build an Edge Function that will accept an input string and generate an embedding for it. Edge Functions are server-side TypeScript HTTP endpoints that run on-demand closest to your users.</p>\n<div class=\"py-8\"><div class=\"relative pb-8 group\"><div class=\" absolute w-px left-[11px] pt-1 h-full \"><div class=\" absolute w-full h-full py-1 bg-border-control group-last:bg-transparent \"></div></div><div class=\" absolute left-0 flex gap-3 items-center not-prose \"><div class=\"flex items-center gap-6\"><div class=\"border bg-surface-100 border-control flex items-center justify-center rounded-full w-6 h-6 text-xs text-foreground font-normal font-mono dropshadow-sm \">1</div></div></div><div class=\"grid grid-cols-1 lg:grid-cols-12 lg:gap-10 lg:ml-12\"><div class=\"col-span-5 ml-12 lg:ml-0\"><h3 class=\"mt-0 text-foreground text-base\">Set up Supabase locally</h3><p>Make sure you have the latest version of the <a href=\"/docs/guides/cli/getting-started\">Supabase CLI installed</a>.</p><p>Initialize Supabase in the root directory of your app and start your local stack.</p></div><div class=\"col-span-7 not-prose\"><div class=\"ch-codeblock not-prose \" data-ch-theme=\"supabase\"><div class=\"ch-code-wrapper ch-code\" data-ch-measured=\"false\"><code class=\"ch-code-scroll-parent\"><br><div><span class=\"ch-code-line-number\">_<!-- -->10</span><div style=\"display:inline-block;margin-left:16px\"><span>supabase init</span></div></div><div><span class=\"ch-code-line-number\">_<!-- -->10</span><div style=\"display:inline-block;margin-left:16px\"><span>supabase start</span></div></div><br></code></div></div></div></div></div><div class=\"relative pb-8 group\"><div class=\" absolute w-px left-[11px] pt-1 h-full \"><div class=\" absolute w-full h-full py-1 bg-border-control group-last:bg-transparent \"></div></div><div class=\" absolute left-0 flex gap-3 items-center not-prose \"><div class=\"flex items-center gap-6\"><div class=\"border bg-surface-100 border-control flex items-center justify-center rounded-full w-6 h-6 text-xs text-foreground font-normal font-mono dropshadow-sm \">2</div></div></div><div class=\"grid grid-cols-1 lg:grid-cols-12 lg:gap-10 lg:ml-12\"><div class=\"col-span-5 ml-12 lg:ml-0\"><h3 class=\"mt-0 text-foreground text-base\">Create Edge Function</h3><p>Create an Edge Function that we will use to generate embeddings. We'll call this <code>embed</code> (you can name this anything you like).</p><p>This will create a new TypeScript file called <code>index.ts</code> under <code>./supabase/functions/embed</code>.</p></div><div class=\"col-span-7 not-prose\"><div class=\"ch-codeblock not-prose \" data-ch-theme=\"supabase\"><div class=\"ch-code-wrapper ch-code\" data-ch-measured=\"false\"><code class=\"ch-code-scroll-parent\"><br><div><span class=\"ch-code-line-number\">_<!-- -->10</span><div style=\"display:inline-block;margin-left:16px\"><span>supabase functions new embed</span></div></div><br></code></div></div></div></div></div><div class=\"relative pb-8 group\"><div class=\" absolute w-px left-[11px] pt-1 h-full \"><div class=\" absolute w-full h-full py-1 bg-border-control group-last:bg-transparent \"></div></div><div class=\" absolute left-0 flex gap-3 items-center not-prose \"><div class=\"flex items-center gap-6\"><div class=\"border bg-surface-100 border-control flex items-center justify-center rounded-full w-6 h-6 text-xs text-foreground font-normal font-mono dropshadow-sm \">3</div></div></div><div class=\"grid grid-cols-1 lg:grid-cols-12 lg:gap-10 lg:ml-12\"><div class=\"col-span-12 ml-12 lg:ml-0\"><h3 class=\"mt-0 text-foreground text-base\">Setup Inference Session</h3><p>Let's create a new inference session to be used in the lifetime of this function. Multiple requests can use the same inference session.</p><p>Currently, only the <code>gte-small</code> (<a href=\"https://huggingface.co/Supabase/gte-small\">https://huggingface.co/Supabase/gte-small</a>) text embedding model is supported in Supabase's Edge Runtime.</p></div><div class=\"col-span-7 not-prose\"><div class=\"ch-codegroup not-prose \" data-ch-theme=\"supabase\"><div class=\"ch-editor-frame\"><div class=\"ch-frame-title-bar\"><div class=\"ch-frame-buttons\"><div class=\"ch-frame-button ch-frame-button-left\"></div><div class=\"ch-frame-button-space\"></div><div class=\"ch-frame-button ch-frame-button-middle\"></div><div class=\"ch-frame-button-space\"></div><div class=\"ch-frame-button ch-frame-button-right\"></div></div><div title=\"./supabase/functions/embed/index.ts\" data-ch-tab=\"north\" data-active=\"true\" class=\"ch-editor-tab\"><div><span style=\"opacity:0.5\">./supabase/functions/embed/</span>index.ts</div></div><div style=\"flex:1;min-width:0.8em\"></div><button type=\"button\" title=\"Copy code\" class=\"ch-editor-button\"><svg fill=\"none\" stroke=\"currentColor\" viewBox=\"0 0 24 24\" xmlns=\"http://www.w3.org/2000/svg\"><path stroke-linecap=\"round\" stroke-linejoin=\"round\" stroke-width=\"1.6px\" d=\"M8 16H6a2 2 0 01-2-2V6a2 2 0 012-2h8a2 2 0 012 2v2m-6 12h8a2 2 0 002-2v-8a2 2 0 00-2-2h-8a2 2 0 00-2 2v8a2 2 0 002 2z\"></path></svg></button></div><div data-ch-panel=\"north\" style=\"flex-grow:1;overflow:hidden\"><div style=\"height:100%\" class=\"ch-code-wrapper \" data-ch-measured=\"false\"><code class=\"ch-code-scroll-parent\"><br><div><span class=\"ch-code-line-number\">_<!-- -->10</span><div style=\"display:inline-block;margin-left:16px\"><span>const session = new Supabase.ai.Session('gte-small');</span></div></div><br></code></div></div></div></div></div></div></div><div class=\"relative pb-8 group\"><div class=\" absolute w-px left-[11px] pt-1 h-full \"><div class=\" absolute w-full h-full py-1 bg-border-control group-last:bg-transparent \"></div></div><div class=\" absolute left-0 flex gap-3 items-center not-prose \"><div class=\"flex items-center gap-6\"><div class=\"border bg-surface-100 border-control flex items-center justify-center rounded-full w-6 h-6 text-xs text-foreground font-normal font-mono dropshadow-sm \">4</div></div></div><div class=\"grid grid-cols-1 lg:grid-cols-12 lg:gap-10 lg:ml-12\"><div class=\"col-span-5 ml-12 lg:ml-0\"><h3 class=\"mt-0 text-foreground text-base\">Implement request handler</h3><p>Modify our request handler to accept an <code>input</code> string from the POST request JSON body.</p><p>Then generate the embedding by calling <code>session.run(input)</code>.</p></div><div class=\"col-span-7 not-prose\"><div class=\"ch-codegroup not-prose \" data-ch-theme=\"supabase\"><div class=\"ch-editor-frame\"><div class=\"ch-frame-title-bar\"><div class=\"ch-frame-buttons\"><div class=\"ch-frame-button ch-frame-button-left\"></div><div class=\"ch-frame-button-space\"></div><div class=\"ch-frame-button ch-frame-button-middle\"></div><div class=\"ch-frame-button-space\"></div><div class=\"ch-frame-button ch-frame-button-right\"></div></div><div title=\"./supabase/functions/embed/index.ts\" data-ch-tab=\"north\" data-active=\"true\" class=\"ch-editor-tab\"><div><span style=\"opacity:0.5\">./supabase/functions/embed/</span>index.ts</div></div><div style=\"flex:1;min-width:0.8em\"></div><button type=\"button\" title=\"Copy code\" class=\"ch-editor-button\"><svg fill=\"none\" stroke=\"currentColor\" viewBox=\"0 0 24 24\" xmlns=\"http://www.w3.org/2000/svg\"><path stroke-linecap=\"round\" stroke-linejoin=\"round\" stroke-width=\"1.6px\" d=\"M8 16H6a2 2 0 01-2-2V6a2 2 0 012-2h8a2 2 0 012 2v2m-6 12h8a2 2 0 002-2v-8a2 2 0 00-2-2h-8a2 2 0 00-2 2v8a2 2 0 002 2z\"></path></svg></button></div><div data-ch-panel=\"north\" style=\"flex-grow:1;overflow:hidden\"><div style=\"height:100%\" class=\"ch-code-wrapper \" data-ch-measured=\"false\"><code class=\"ch-code-scroll-parent\"><br><div><span class=\"ch-code-line-number\">_<!-- -->16</span><div style=\"display:inline-block;margin-left:16px\"><span>Deno.serve(async (req) =&gt; {</span></div></div><div><span class=\"ch-code-line-number\">_<!-- -->16</span><div style=\"display:inline-block;margin-left:16px\"><span>  // Extract input string from JSON body</span></div></div><div><span class=\"ch-code-line-number\">_<!-- -->16</span><div style=\"display:inline-block;margin-left:16px\"><span>  const { input } = await req.json();</span></div></div><div><span class=\"ch-code-line-number\">_<!-- -->16</span><div style=\"display:inline-block;margin-left:16px\"><span></span></div></div><div><span class=\"ch-code-line-number\">_<!-- -->16</span><div style=\"display:inline-block;margin-left:16px\"><span>  // Generate the embedding from the user input</span></div></div><div><span class=\"ch-code-line-number\">_<!-- -->16</span><div style=\"display:inline-block;margin-left:16px\"><span>  const embedding = await session.run(input, {</span></div></div><div><span class=\"ch-code-line-number\">_<!-- -->16</span><div style=\"display:inline-block;margin-left:16px\"><span>    mean_pool: true,</span></div></div><div><span class=\"ch-code-line-number\">_<!-- -->16</span><div style=\"display:inline-block;margin-left:16px\"><span>    normalize: true,</span></div></div><div><span class=\"ch-code-line-number\">_<!-- -->16</span><div style=\"display:inline-block;margin-left:16px\"><span>  });</span></div></div><div><span class=\"ch-code-line-number\">_<!-- -->16</span><div style=\"display:inline-block;margin-left:16px\"><span></span></div></div><div><span class=\"ch-code-line-number\">_<!-- -->16</span><div style=\"display:inline-block;margin-left:16px\"><span>  // Return the embedding</span></div></div><div><span class=\"ch-code-line-number\">_<!-- -->16</span><div style=\"display:inline-block;margin-left:16px\"><span>  return new Response(</span></div></div><div><span class=\"ch-code-line-number\">_<!-- -->16</span><div style=\"display:inline-block;margin-left:16px\"><span>    JSON.stringify({ embedding }),</span></div></div><div><span class=\"ch-code-line-number\">_<!-- -->16</span><div style=\"display:inline-block;margin-left:16px\"><span>    { headers: { 'Content-Type': 'application/json' } }</span></div></div><div><span class=\"ch-code-line-number\">_<!-- -->16</span><div style=\"display:inline-block;margin-left:16px\"><span>  );</span></div></div><div><span class=\"ch-code-line-number\">_<!-- -->16</span><div style=\"display:inline-block;margin-left:16px\"><span>});</span></div></div><br></code></div></div></div></div></div><div class=\"col-span-12 ml-12 lg:ml-0\"><h3 class=\"mt-0 text-foreground text-base\"></h3><p>Note the two options we pass to <code>session.run()</code>:</p><ul>\n<li><code>mean_pool</code>: The first option sets <code>pooling</code> to <code>mean</code>. Pooling referes to how token-level embedding representations are compressed into a single sentence embedding that reflects the meaning of the entire sentence. Average pooling is the most common type of pooling for sentence embeddings.</li>\n<li><code>normalize</code>: The second option tells to normalize the embedding vector so that it can be used with distance measures like dot product. A normalized vector means its length (magnitude) is 1 - also referred to as a unit vector. A vector is normalized by dividing each element by the vector's length (magnitude), which maintains its direction but changes its length to 1.</li>\n</ul></div></div></div><div class=\"relative pb-8 group\"><div class=\" absolute w-px left-[11px] pt-1 h-full \"><div class=\" absolute w-full h-full py-1 bg-border-control group-last:bg-transparent \"></div></div><div class=\" absolute left-0 flex gap-3 items-center not-prose \"><div class=\"flex items-center gap-6\"><div class=\"border bg-surface-100 border-control flex items-center justify-center rounded-full w-6 h-6 text-xs text-foreground font-normal font-mono dropshadow-sm \">5</div></div></div><div class=\"grid grid-cols-1 lg:grid-cols-12 lg:gap-10 lg:ml-12\"><div class=\"col-span-5 ml-12 lg:ml-0\"><h3 class=\"mt-0 text-foreground text-base\">Test it!</h3><p>To test the Edge Function, first start a local functions server.</p></div><div class=\"col-span-7 not-prose\"><div class=\"ch-codeblock not-prose \" data-ch-theme=\"supabase\"><div class=\"ch-code-wrapper ch-code\" data-ch-measured=\"false\"><code class=\"ch-code-scroll-parent\"><br><div><span class=\"ch-code-line-number\">_<!-- -->10</span><div style=\"display:inline-block;margin-left:16px\"><span>supabase functions serve</span></div></div><br></code></div></div></div><div class=\"col-span-12 ml-12 lg:ml-0\"><h3 class=\"mt-0 text-foreground text-base\"></h3><p>Then in a new shell, create an HTTP request using cURL and pass in your input in the JSON body.</p><div class=\"ch-codeblock not-prose \" data-ch-theme=\"supabase\"><div class=\"ch-code-wrapper ch-code\" data-ch-measured=\"false\"><code class=\"ch-code-scroll-parent\"><br><div><span class=\"ch-code-line-number\">_<!-- -->10</span><div style=\"display:inline-block;margin-left:16px\"><span>curl --request POST 'http://localhost:54321/functions/v1/embed' \\</span></div></div><div><span class=\"ch-code-line-number\">_<!-- -->10</span><div style=\"display:inline-block;margin-left:16px\"><span>  --header 'Authorization: Bearer ANON_KEY' \\</span></div></div><div><span class=\"ch-code-line-number\">_<!-- -->10</span><div style=\"display:inline-block;margin-left:16px\"><span>  --header 'Content-Type: application/json' \\</span></div></div><div><span class=\"ch-code-line-number\">_<!-- -->10</span><div style=\"display:inline-block;margin-left:16px\"><span>  --data '{ \"input\": \"hello world\" }'</span></div></div><br></code></div></div><p>Be sure to replace <code>ANON_KEY</code> with your project's anonymous key. You can get this key by running <code>supabase status</code>.</p></div></div></div></div>\n<h2 id=\"next-steps\" class=\"group scroll-mt-24\">Next steps<a href=\"#next-steps\" aria-hidden=\"true\" class=\"ml-2 opacity-0 group-hover:opacity-100 transition\"><span aria-hidden=\"true\">#</span></a></h2>\n<ul>\n<li>Learn more about <a href=\"/docs/guides/ai/concepts\">embedding concepts</a></li>\n<li><a href=\"/docs/guides/ai/vector-columns\">Store your embeddings</a> in a database</li>\n</ul></article></div></div></div><!--$--><div class=\"max-w-7xl px-5 mx-auto py-8 pt-0\"></div><!--/$--></div><div class=\"left-0 right-0 z-10 backdrop-blur-sm backdrop-filter bg-alternative/90 hidden h-0 lg:hidden\"></div></div></main></div></div></div></div></body></html>",
      "metadata": {
        "ogUrl": "https://supabase.com/docs/guides/ai/quickstarts/generate-text-embeddings",
        "title": "Generate Embeddings | Supabase Docs",
        "robots": "index, follow",
        "ogImage": "https://obuldanrptloktxcffvn.supabase.co/functions/v1/og-images?site=docs&type=ai&title=Generate%20Embeddings&description=undefined",
        "ogTitle": "Generate Embeddings | Supabase Docs",
        "language": "en",
        "sourceURL": "https://supabase.com/docs/guides/ai/quickstarts/generate-text-embeddings",
        "description": "Generate text embeddings using Edge Functions.",
        "modifiedTime": "2024-09-10T20:36:24.564Z",
        "ogDescription": "Generate text embeddings using Edge Functions.",
        "publishedTime": "2024-09-10T20:36:24.564Z",
        "ogLocaleAlternate": [],
        "statusCode": 200
      }
    },
    {
      "markdown": "AI & Vectors\n\n# Structured and Unstructured\n\n## Supabase is flexible enough to associate structured and unstructured metadata with embeddings.\n\n* * *\n\nMost vector stores treat metadata associated with embeddings like NoSQL, unstructured data. Supabase is flexible enough to store unstructured and structured metadata.\n\n## Structured [\\#](\\#structured)\n\n`\n_11\ncreate table docs (\n_11\nid uuid primary key,\n_11\nembedding vector(3),\n_11\ncontent text,\n_11\nurl string\n_11\n);\n_11\n_11\ninsert into docs\n_11\n(id, embedding, content, url)\n_11\nvalues\n_11\n('79409372-7556-4ccc-ab8f-5786a6cfa4f7', array[0.1, 0.2, 0.3], 'Hello world', '/hello-world');\n`\n\nNotice that we've associated two pieces of metadata, `content` and `url`, with the embedding. Those fields can be filtered, constrained, indexed, and generally operated on using the full power of SQL. Structured metadata fits naturally with a traditional Supabase application, and can be managed via database [migrations](/docs/guides/getting-started/local-development#database-migrations).\n\n## Unstructured [\\#](\\#unstructured)\n\n`\n_14\ncreate table docs (\n_14\nid uuid primary key,\n_14\nembedding vector(3),\n_14\nmeta jsonb\n_14\n);\n_14\n_14\ninsert into docs\n_14\n(id, embedding, meta)\n_14\nvalues\n_14\n(\n_14\n    '79409372-7556-4ccc-ab8f-5786a6cfa4f7',\n_14\n    array[0.1, 0.2, 0.3],\n_14\n    '{\"content\": \"Hello world\", \"url\": \"/hello-world\"}'\n_14\n);\n`\n\nAn unstructured approach does not specify the metadata fields that are expected. It stores all metadata in a flexible `json`/ `jsonb` column. The tradeoff is that the querying/filtering capabilities of a schemaless data type are less flexible than when each field has a dedicated column. It also pushes the burden of metadata data integrity onto application code, which is more error prone than enforcing constraints in the database.\n\nThe unstructured approach is recommended:\n\n- for ephemeral/interactive workloads e.g. data science or scientific research\n- when metadata fields are user-defined or unknown\n- during rapid prototyping\n\nClient libraries like python's [vecs](https://github.com/supabase/vecs) use this structure. For example, running:\n\n`\n_10\n#!/usr/bin/env python3\n_10\nimport vecs\n_10\n_10\ndocs = vx.get_or_create_collection(name=\"docs\", dimension=1536)\n_10\n_10\ndocs.upsert(vectors=[\\\n_10\\\n('79409372-7556-4ccc-ab8f-5786a6cfa4f7', [100, 200, 300], { url: '/hello-world' })\\\n_10\\\n])\n`\n\nautomatically creates the unstructured SQL table during the call to `get_or_create_collection`.\n\nNote that when working with client libraries that emit SQL DDL, like `create table ...`, you should add that SQL to your migrations when moving to production to maintain a single source of truth for your database's schema.\n\n## Hybrid [\\#](\\#hybrid)\n\nThe structured metadata style is recommended when the fields being tracked are known in advance. If you have a combination of known and unknown metadata fields, you can accommodate the unknown fields by adding a `json`/ `jsonb` column to the table. In that situation, known fields should continue to use dedicated columns for best query performance and throughput.\n\n`\n_18\ncreate table docs (\n_18\nid uuid primary key,\n_18\nembedding vector(3),\n_18\ncontent text,\n_18\nurl string,\n_18\nmeta jsonb\n_18\n);\n_18\n_18\ninsert into docs\n_18\n(id, embedding, content, url, meta)\n_18\nvalues\n_18\n(\n_18\n    '79409372-7556-4ccc-ab8f-5786a6cfa4f7',\n_18\n    array[0.1, 0.2, 0.3],\n_18\n    'Hello world',\n_18\n    '/hello-world',\n_18\n    '{\"key\": \"value\"}'\n_18\n);\n`\n\n## Choosing the right model [\\#](\\#choosing-the-right-model)\n\nBoth approaches create a table where you can store your embeddings and some metadata. You should choose the best approach for your use-case. In summary:\n\n- Structured metadata is best when fields are known in advance or query patterns are predictable e.g. a production Supabase application\n- Unstructured metadata is best when fields are unknown/user-defined or when working with data interactively e.g. exploratory research\n\nBoth approaches are valid, and the one you should choose depends on your use-case.",
      "html": "<!DOCTYPE html><html lang=\"en\" data-theme=\"light\" style=\"color-scheme: light;\"><body><div class=\"flex flex-col\"><div class=\"grow\"><div class=\"flex flex-col h-full w-full\"><div class=\"hidden lg:sticky w-full lg:flex top-0 left-0 right-0 z-50\"><!--$--><!--/$--></div><div class=\"flex flex-row h-full relative\"><main id=\"docs-content-container\" class=\"w-full transition-all ease-out relative lg:ml-0\"><div class=\"flex flex-col sticky top-0\"><div class=\"flex lg:hidden w-full top-0 left-0 right-0 z-50\"><!--$--><!--/$--></div><div class=\"sticky transition-all top-0 z-10 backdrop-blur backdrop-filter bg-background\"><div class=\"lg:hidden px-3.5 border-b z-10 transition-all ease-out top-0 flex items-center gap-1\"><button class=\"h-8 w-8 flex group items-center justify-center mr-1\"><div class=\"space-y-1 cursor-pointer relative w-4 h-[8px]\"><span class=\"transition-all ease-out block h-px bg-foreground-muted group-hover:bg-foreground w-4\"></span><span class=\"transition-all ease-out block h-px bg-foreground-muted group-hover:bg-foreground w-3 group-hover:w-4\"></span></div></button><span class=\"transition-all duration-200 text-foreground text-sm\">AI &amp; Vectors</span></div></div><div class=\"grow\"><div class=\"max-w-7xl px-5 mx-auto py-8 pb-0\"><div class=\"grid grid-cols-12 relative gap-4\"><div class=\"relative transition-all ease-out duration-100 col-span-12 md:col-span-9\"><article id=\"sb-docs-guide-main-article\" class=\"prose max-w-none\"><h1 class=\"mb-0\">Structured and Unstructured</h1><h2 class=\"mt-3 text-xl text-foreground-light\">Supabase is flexible enough to associate structured and unstructured metadata with embeddings.</h2><hr class=\"not-prose border-t-0 border-b my-8\">\n<p>Most vector stores treat metadata associated with embeddings like NoSQL, unstructured data. Supabase is flexible enough to store unstructured and structured metadata.</p>\n<h2 id=\"structured\" class=\"group scroll-mt-24\">Structured<a href=\"#structured\" aria-hidden=\"true\" class=\"ml-2 opacity-0 group-hover:opacity-100 transition\"><span aria-hidden=\"true\">#</span></a></h2>\n<div class=\"ch-codeblock not-prose \" data-ch-theme=\"supabase\"><div class=\"ch-code-wrapper ch-code\" data-ch-measured=\"false\"><code class=\"ch-code-scroll-parent\"><br><div><span class=\"ch-code-line-number\">_<!-- -->11</span><div style=\"display:inline-block;margin-left:16px\"><span>create table docs (</span></div></div><div><span class=\"ch-code-line-number\">_<!-- -->11</span><div style=\"display:inline-block;margin-left:16px\"><span>  id uuid primary key,</span></div></div><div><span class=\"ch-code-line-number\">_<!-- -->11</span><div style=\"display:inline-block;margin-left:16px\"><span>  embedding vector(3),</span></div></div><div><span class=\"ch-code-line-number\">_<!-- -->11</span><div style=\"display:inline-block;margin-left:16px\"><span>  content text,</span></div></div><div><span class=\"ch-code-line-number\">_<!-- -->11</span><div style=\"display:inline-block;margin-left:16px\"><span>  url string</span></div></div><div><span class=\"ch-code-line-number\">_<!-- -->11</span><div style=\"display:inline-block;margin-left:16px\"><span>);</span></div></div><div><span class=\"ch-code-line-number\">_<!-- -->11</span><div style=\"display:inline-block;margin-left:16px\"><span></span></div></div><div><span class=\"ch-code-line-number\">_<!-- -->11</span><div style=\"display:inline-block;margin-left:16px\"><span>insert into docs</span></div></div><div><span class=\"ch-code-line-number\">_<!-- -->11</span><div style=\"display:inline-block;margin-left:16px\"><span>  (id, embedding, content, url)</span></div></div><div><span class=\"ch-code-line-number\">_<!-- -->11</span><div style=\"display:inline-block;margin-left:16px\"><span>values</span></div></div><div><span class=\"ch-code-line-number\">_<!-- -->11</span><div style=\"display:inline-block;margin-left:16px\"><span>  ('79409372-7556-4ccc-ab8f-5786a6cfa4f7', array[0.1, 0.2, 0.3], 'Hello world', '/hello-world');</span></div></div><br></code></div></div>\n<p>Notice that we've associated two pieces of metadata, <code>content</code> and <code>url</code>, with the embedding. Those fields can be filtered, constrained, indexed, and generally operated on using the full power of SQL. Structured metadata fits naturally with a traditional Supabase application, and can be managed via database <a href=\"/docs/guides/getting-started/local-development#database-migrations\">migrations</a>.</p>\n<h2 id=\"unstructured\" class=\"group scroll-mt-24\">Unstructured<a href=\"#unstructured\" aria-hidden=\"true\" class=\"ml-2 opacity-0 group-hover:opacity-100 transition\"><span aria-hidden=\"true\">#</span></a></h2>\n<div class=\"ch-codeblock not-prose \" data-ch-theme=\"supabase\"><div class=\"ch-code-wrapper ch-code\" data-ch-measured=\"false\"><code class=\"ch-code-scroll-parent\"><br><div><span class=\"ch-code-line-number\">_<!-- -->14</span><div style=\"display:inline-block;margin-left:16px\"><span>create table docs (</span></div></div><div><span class=\"ch-code-line-number\">_<!-- -->14</span><div style=\"display:inline-block;margin-left:16px\"><span>  id uuid primary key,</span></div></div><div><span class=\"ch-code-line-number\">_<!-- -->14</span><div style=\"display:inline-block;margin-left:16px\"><span>  embedding vector(3),</span></div></div><div><span class=\"ch-code-line-number\">_<!-- -->14</span><div style=\"display:inline-block;margin-left:16px\"><span>  meta jsonb</span></div></div><div><span class=\"ch-code-line-number\">_<!-- -->14</span><div style=\"display:inline-block;margin-left:16px\"><span>);</span></div></div><div><span class=\"ch-code-line-number\">_<!-- -->14</span><div style=\"display:inline-block;margin-left:16px\"><span></span></div></div><div><span class=\"ch-code-line-number\">_<!-- -->14</span><div style=\"display:inline-block;margin-left:16px\"><span>insert into docs</span></div></div><div><span class=\"ch-code-line-number\">_<!-- -->14</span><div style=\"display:inline-block;margin-left:16px\"><span>  (id, embedding, meta)</span></div></div><div><span class=\"ch-code-line-number\">_<!-- -->14</span><div style=\"display:inline-block;margin-left:16px\"><span>values</span></div></div><div><span class=\"ch-code-line-number\">_<!-- -->14</span><div style=\"display:inline-block;margin-left:16px\"><span>  (</span></div></div><div><span class=\"ch-code-line-number\">_<!-- -->14</span><div style=\"display:inline-block;margin-left:16px\"><span>    '79409372-7556-4ccc-ab8f-5786a6cfa4f7',</span></div></div><div><span class=\"ch-code-line-number\">_<!-- -->14</span><div style=\"display:inline-block;margin-left:16px\"><span>    array[0.1, 0.2, 0.3],</span></div></div><div><span class=\"ch-code-line-number\">_<!-- -->14</span><div style=\"display:inline-block;margin-left:16px\"><span>    '{\"content\": \"Hello world\", \"url\": \"/hello-world\"}'</span></div></div><div><span class=\"ch-code-line-number\">_<!-- -->14</span><div style=\"display:inline-block;margin-left:16px\"><span>  );</span></div></div><br></code></div></div>\n<p>An unstructured approach does not specify the metadata fields that are expected. It stores all metadata in a flexible <code>json</code>/<code>jsonb</code> column. The tradeoff is that the querying/filtering capabilities of a schemaless data type are less flexible than when each field has a dedicated column. It also pushes the burden of metadata data integrity onto application code, which is more error prone than enforcing constraints in the database.</p>\n<p>The unstructured approach is recommended:</p>\n<ul>\n<li>for ephemeral/interactive workloads e.g. data science or scientific research</li>\n<li>when metadata fields are user-defined or unknown</li>\n<li>during rapid prototyping</li>\n</ul>\n<p>Client libraries like python's <a href=\"https://github.com/supabase/vecs\">vecs</a> use this structure. For example, running:</p>\n<div class=\"ch-codeblock not-prose \" data-ch-theme=\"supabase\"><div class=\"ch-code-wrapper ch-code\" data-ch-measured=\"false\"><code class=\"ch-code-scroll-parent\"><br><div><span class=\"ch-code-line-number\">_<!-- -->10</span><div style=\"display:inline-block;margin-left:16px\"><span>#!/usr/bin/env python3</span></div></div><div><span class=\"ch-code-line-number\">_<!-- -->10</span><div style=\"display:inline-block;margin-left:16px\"><span>import vecs</span></div></div><div><span class=\"ch-code-line-number\">_<!-- -->10</span><div style=\"display:inline-block;margin-left:16px\"><span></span></div></div><div><span class=\"ch-code-line-number\">_<!-- -->10</span><div style=\"display:inline-block;margin-left:16px\"><span>docs = vx.get_or_create_collection(name=\"docs\", dimension=1536)</span></div></div><div><span class=\"ch-code-line-number\">_<!-- -->10</span><div style=\"display:inline-block;margin-left:16px\"><span></span></div></div><div><span class=\"ch-code-line-number\">_<!-- -->10</span><div style=\"display:inline-block;margin-left:16px\"><span>docs.upsert(vectors=[</span></div></div><div><span class=\"ch-code-line-number\">_<!-- -->10</span><div style=\"display:inline-block;margin-left:16px\"><span>  ('79409372-7556-4ccc-ab8f-5786a6cfa4f7', [100, 200, 300], { url: '/hello-world' })</span></div></div><div><span class=\"ch-code-line-number\">_<!-- -->10</span><div style=\"display:inline-block;margin-left:16px\"><span>])</span></div></div><br></code></div></div>\n<p>automatically creates the unstructured SQL table during the call to <code>get_or_create_collection</code>.</p>\n<p>Note that when working with client libraries that emit SQL DDL, like <code>create table ...</code>, you should add that SQL to your migrations when moving to production to maintain a single source of truth for your database's schema.</p>\n<h2 id=\"hybrid\" class=\"group scroll-mt-24\">Hybrid<a href=\"#hybrid\" aria-hidden=\"true\" class=\"ml-2 opacity-0 group-hover:opacity-100 transition\"><span aria-hidden=\"true\">#</span></a></h2>\n<p>The structured metadata style is recommended when the fields being tracked are known in advance. If you have a combination of known and unknown metadata fields, you can accommodate the unknown fields by adding a <code>json</code>/<code>jsonb</code> column to the table. In that situation, known fields should continue to use dedicated columns for best query performance and throughput.</p>\n<div class=\"ch-codeblock not-prose \" data-ch-theme=\"supabase\"><div class=\"ch-code-wrapper ch-code\" data-ch-measured=\"false\"><code class=\"ch-code-scroll-parent\"><br><div><span class=\"ch-code-line-number\">_<!-- -->18</span><div style=\"display:inline-block;margin-left:16px\"><span>create table docs (</span></div></div><div><span class=\"ch-code-line-number\">_<!-- -->18</span><div style=\"display:inline-block;margin-left:16px\"><span>  id uuid primary key,</span></div></div><div><span class=\"ch-code-line-number\">_<!-- -->18</span><div style=\"display:inline-block;margin-left:16px\"><span>  embedding vector(3),</span></div></div><div><span class=\"ch-code-line-number\">_<!-- -->18</span><div style=\"display:inline-block;margin-left:16px\"><span>  content text,</span></div></div><div><span class=\"ch-code-line-number\">_<!-- -->18</span><div style=\"display:inline-block;margin-left:16px\"><span>  url string,</span></div></div><div><span class=\"ch-code-line-number\">_<!-- -->18</span><div style=\"display:inline-block;margin-left:16px\"><span>  meta jsonb</span></div></div><div><span class=\"ch-code-line-number\">_<!-- -->18</span><div style=\"display:inline-block;margin-left:16px\"><span>);</span></div></div><div><span class=\"ch-code-line-number\">_<!-- -->18</span><div style=\"display:inline-block;margin-left:16px\"><span></span></div></div><div><span class=\"ch-code-line-number\">_<!-- -->18</span><div style=\"display:inline-block;margin-left:16px\"><span>insert into docs</span></div></div><div><span class=\"ch-code-line-number\">_<!-- -->18</span><div style=\"display:inline-block;margin-left:16px\"><span>  (id, embedding, content, url, meta)</span></div></div><div><span class=\"ch-code-line-number\">_<!-- -->18</span><div style=\"display:inline-block;margin-left:16px\"><span>values</span></div></div><div><span class=\"ch-code-line-number\">_<!-- -->18</span><div style=\"display:inline-block;margin-left:16px\"><span>  (</span></div></div><div><span class=\"ch-code-line-number\">_<!-- -->18</span><div style=\"display:inline-block;margin-left:16px\"><span>    '79409372-7556-4ccc-ab8f-5786a6cfa4f7',</span></div></div><div><span class=\"ch-code-line-number\">_<!-- -->18</span><div style=\"display:inline-block;margin-left:16px\"><span>    array[0.1, 0.2, 0.3],</span></div></div><div><span class=\"ch-code-line-number\">_<!-- -->18</span><div style=\"display:inline-block;margin-left:16px\"><span>    'Hello world',</span></div></div><div><span class=\"ch-code-line-number\">_<!-- -->18</span><div style=\"display:inline-block;margin-left:16px\"><span>    '/hello-world',</span></div></div><div><span class=\"ch-code-line-number\">_<!-- -->18</span><div style=\"display:inline-block;margin-left:16px\"><span>    '{\"key\": \"value\"}'</span></div></div><div><span class=\"ch-code-line-number\">_<!-- -->18</span><div style=\"display:inline-block;margin-left:16px\"><span>  );</span></div></div><br></code></div></div>\n<h2 id=\"choosing-the-right-model\" class=\"group scroll-mt-24\">Choosing the right model<a href=\"#choosing-the-right-model\" aria-hidden=\"true\" class=\"ml-2 opacity-0 group-hover:opacity-100 transition\"><span aria-hidden=\"true\">#</span></a></h2>\n<p>Both approaches create a table where you can store your embeddings and some metadata. You should choose the best approach for your use-case. In summary:</p>\n<ul>\n<li>Structured metadata is best when fields are known in advance or query patterns are predictable e.g. a production Supabase application</li>\n<li>Unstructured metadata is best when fields are unknown/user-defined or when working with data interactively e.g. exploratory research</li>\n</ul>\n<p>Both approaches are valid, and the one you should choose depends on your use-case.</p></article></div></div></div><!--$--><div class=\"max-w-7xl px-5 mx-auto py-8 pt-0\"></div><!--/$--></div><div class=\"left-0 right-0 z-10 backdrop-blur-sm backdrop-filter bg-alternative/90 hidden h-0 lg:hidden\"></div></div></main></div></div></div></div></body></html>",
      "metadata": {
        "ogUrl": "https://supabase.com/docs/guides/ai/structured-unstructured",
        "title": "Structured and Unstructured | Supabase Docs",
        "robots": "index, follow",
        "ogImage": "https://obuldanrptloktxcffvn.supabase.co/functions/v1/og-images?site=docs&type=ai&title=Structured%20and%20Unstructured&description=Supabase%20is%20flexible%20enough%20to%20associate%20structured%20and%20unstructured%20metadata%20with%20embeddings.",
        "ogTitle": "Structured and Unstructured | Supabase Docs",
        "language": "en",
        "sourceURL": "https://supabase.com/docs/guides/ai/structured-unstructured",
        "description": "Supabase is flexible enough to associate structured and unstructured metadata with embeddings.",
        "modifiedTime": "2024-09-10T20:36:24.564Z",
        "ogDescription": "Supabase is flexible enough to associate structured and unstructured metadata with embeddings.",
        "publishedTime": "2024-09-10T20:36:24.564Z",
        "ogLocaleAlternate": [],
        "statusCode": 200
      }
    },
    {
      "markdown": "AI & Vectors\n\n# Creating and managing collections\n\n## Connecting to your database with Colab.\n\n* * *\n\nThis guide will walk you through a basic [\"Hello World\"](https://github.com/supabase/supabase/blob/master/examples/ai/vector_hello_world.ipynb) example using Colab and Supabase Vecs. You'll learn how to:\n\n1. Launch a Postgres database that uses pgvector to store embeddings\n2. Launch a notebook that connects to your database\n3. Create a vector collection\n4. Add data to the collection\n5. Query the collection\n\n## Project setup [\\#](\\#project-setup)\n\nLet's create a new Postgres database. This is as simple as starting a new Project in Supabase:\n\n1. [Create a new project](https://database.new/) in the Supabase dashboard.\n2. Enter your project details. Remember to store your password somewhere safe.\n\nYour database will be available in less than a minute.\n\n**Finding your credentials:**\n\nYou can find your project credentials inside the project [settings](https://supabase.com/dashboard/project/_/settings/), including:\n\n- [Database credentials](https://supabase.com/dashboard/project/_/settings/database): connection strings and connection pooler details.\n- [API credentials](https://supabase.com/dashboard/project/_/settings/database): your serverless API URL and `anon` / `service_role` keys.\n\n## Launching a notebook [\\#](\\#launching-a-notebook)\n\nLaunch our [`vector_hello_world`](https://github.com/supabase/supabase/blob/master/examples/ai/vector_hello_world.ipynb) notebook in Colab:\n\n[![](https://supabase.com/docs/img/ai/colab-badge.svg)](https://colab.research.google.com/github/supabase/supabase/blob/master/examples/ai/vector_hello_world.ipynb)\n\nAt the top of the notebook, you'll see a button `Copy to Drive`. Click this button to copy the notebook to your Google Drive.\n\n## Connecting to your database [\\#](\\#connecting-to-your-database)\n\nInside the Notebook, find the cell which specifies the `DB_CONNECTION`. It will contain some code like this:\n\n`\n_10\nimport vecs\n_10\n_10\nDB_CONNECTION = \"postgresql://<user>:<password>@<host>:<port>/<db_name>\"\n_10\n_10\n# create vector store client\n_10\nvx = vecs.create_client(DB_CONNECTION)\n`\n\nReplace the `DB_CONNECTION` with your own connection string for your database. You can find the Postgres connection string in the [Database Settings](https://supabase.com/dashboard/project/_/settings/database) of your Supabase project.\n\nSQLAlchemy requires the connection string to start with `postgresql://` (instead of `postgres://`). Don't forget to rename this after copying the string from the dashboard.\n\nYou must use the \"connection pooling\" string (domain ending in `*.pooler.supabase.com`) with Google Colab since Colab does not support IPv6.\n\n## Stepping through the notebook [\\#](\\#stepping-through-the-notebook)\n\nNow all that's left is to step through the notebook. You can do this by clicking the \"execute\" button ( `ctrl+enter`) at the top left of each code cell. The notebook guides you through the process of creating a collection, adding data to it, and querying it.\n\nYou can view the inserted items in the [Table Editor](https://supabase.com/dashboard/project/_/editor/), by selecting the `vecs` schema from the schema dropdown.\n\n![Colab documents](https://supabase.com/docs/img/ai/google-colab/colab-documents.png)\n\n## Next steps [\\#](\\#next-steps)\n\nYou can now start building your own applications with Vecs. Check our [examples](/docs/guides/ai#examples) for ideas.",
      "html": "<!DOCTYPE html><html lang=\"en\" data-theme=\"light\" style=\"color-scheme: light;\"><body><div class=\"flex flex-col\"><div class=\"grow\"><div class=\"flex flex-col h-full w-full\"><div class=\"hidden lg:sticky w-full lg:flex top-0 left-0 right-0 z-50\"><!--$--><!--/$--></div><div class=\"flex flex-row h-full relative\"><main id=\"docs-content-container\" class=\"w-full transition-all ease-out relative lg:ml-0\"><div class=\"flex flex-col sticky top-0\"><div class=\"flex lg:hidden w-full top-0 left-0 right-0 z-50\"><!--$--><!--/$--></div><div class=\"sticky transition-all top-0 z-10 backdrop-blur backdrop-filter bg-background\"><div class=\"lg:hidden px-3.5 border-b z-10 transition-all ease-out top-0 flex items-center gap-1\"><button class=\"h-8 w-8 flex group items-center justify-center mr-1\"><div class=\"space-y-1 cursor-pointer relative w-4 h-[8px]\"><span class=\"transition-all ease-out block h-px bg-foreground-muted group-hover:bg-foreground w-4\"></span><span class=\"transition-all ease-out block h-px bg-foreground-muted group-hover:bg-foreground w-3 group-hover:w-4\"></span></div></button><span class=\"transition-all duration-200 text-foreground text-sm\">AI &amp; Vectors</span></div></div><div class=\"grow\"><div class=\"max-w-7xl px-5 mx-auto py-8 pb-0\"><div class=\"grid grid-cols-12 relative gap-4\"><div class=\"relative transition-all ease-out duration-100 col-span-12 md:col-span-9\"><article id=\"sb-docs-guide-main-article\" class=\"prose max-w-none\"><h1 class=\"mb-0\">Creating and managing collections</h1><h2 class=\"mt-3 text-xl text-foreground-light\">Connecting to your database with Colab.</h2><hr class=\"not-prose border-t-0 border-b my-8\">\n<p>This guide will walk you through a basic <a href=\"https://github.com/supabase/supabase/blob/master/examples/ai/vector_hello_world.ipynb\">\"Hello World\"</a> example using Colab and Supabase Vecs. You'll learn how to:</p>\n<ol>\n<li>Launch a Postgres database that uses pgvector to store embeddings</li>\n<li>Launch a notebook that connects to your database</li>\n<li>Create a vector collection</li>\n<li>Add data to the collection</li>\n<li>Query the collection</li>\n</ol>\n<h2 id=\"project-setup\" class=\"group scroll-mt-24\">Project setup<a href=\"#project-setup\" aria-hidden=\"true\" class=\"ml-2 opacity-0 group-hover:opacity-100 transition\"><span aria-hidden=\"true\">#</span></a></h2>\n<p>Let's create a new Postgres database. This is as simple as starting a new Project in Supabase:</p>\n<ol>\n<li><a href=\"https://database.new/\">Create a new project</a> in the Supabase dashboard.</li>\n<li>Enter your project details. Remember to store your password somewhere safe.</li>\n</ol>\n<p>Your database will be available in less than a minute.</p>\n<p><strong>Finding your credentials:</strong></p>\n<p>You can find your project credentials inside the project <a href=\"https://supabase.com/dashboard/project/_/settings/\">settings</a>, including:</p>\n<ul>\n<li><a href=\"https://supabase.com/dashboard/project/_/settings/database\">Database credentials</a>: connection strings and connection pooler details.</li>\n<li><a href=\"https://supabase.com/dashboard/project/_/settings/database\">API credentials</a>: your serverless API URL and <code>anon</code> / <code>service_role</code> keys.</li>\n</ul>\n<h2 id=\"launching-a-notebook\" class=\"group scroll-mt-24\">Launching a notebook<a href=\"#launching-a-notebook\" aria-hidden=\"true\" class=\"ml-2 opacity-0 group-hover:opacity-100 transition\"><span aria-hidden=\"true\">#</span></a></h2>\n<p>Launch our <a href=\"https://github.com/supabase/supabase/blob/master/examples/ai/vector_hello_world.ipynb\"><code>vector_hello_world</code></a> notebook in Colab:</p>\n<a class=\"w-64\" href=\"https://colab.research.google.com/github/supabase/supabase/blob/master/examples/ai/vector_hello_world.ipynb\"><img src=\"/docs/img/ai/colab-badge.svg\"></a>\n<p>At the top of the notebook, you'll see a button <code>Copy to Drive</code>. Click this button to copy the notebook to your Google Drive.</p>\n<h2 id=\"connecting-to-your-database\" class=\"group scroll-mt-24\">Connecting to your database<a href=\"#connecting-to-your-database\" aria-hidden=\"true\" class=\"ml-2 opacity-0 group-hover:opacity-100 transition\"><span aria-hidden=\"true\">#</span></a></h2>\n<p>Inside the Notebook, find the cell which specifies the <code>DB_CONNECTION</code>. It will contain some code like this:</p>\n<div class=\"ch-codeblock not-prose \" data-ch-theme=\"supabase\"><div class=\"ch-code-wrapper ch-code\" data-ch-measured=\"false\"><code class=\"ch-code-scroll-parent\"><br><div><span class=\"ch-code-line-number\">_<!-- -->10</span><div style=\"display:inline-block;margin-left:16px\"><span>import vecs</span></div></div><div><span class=\"ch-code-line-number\">_<!-- -->10</span><div style=\"display:inline-block;margin-left:16px\"><span></span></div></div><div><span class=\"ch-code-line-number\">_<!-- -->10</span><div style=\"display:inline-block;margin-left:16px\"><span>DB_CONNECTION = \"postgresql://&lt;user&gt;:&lt;password&gt;@&lt;host&gt;:&lt;port&gt;/&lt;db_name&gt;\"</span></div></div><div><span class=\"ch-code-line-number\">_<!-- -->10</span><div style=\"display:inline-block;margin-left:16px\"><span></span></div></div><div><span class=\"ch-code-line-number\">_<!-- -->10</span><div style=\"display:inline-block;margin-left:16px\"><span># create vector store client</span></div></div><div><span class=\"ch-code-line-number\">_<!-- -->10</span><div style=\"display:inline-block;margin-left:16px\"><span>vx = vecs.create_client(DB_CONNECTION)</span></div></div><br></code></div></div>\n<p>Replace the <code>DB_CONNECTION</code> with your own connection string for your database. You can find the Postgres connection string in the <a href=\"https://supabase.com/dashboard/project/_/settings/database\">Database Settings</a> of your Supabase project.</p>\n<div role=\"alert\" class=\"relative w-full text-sm rounded-lg p-4 [&amp;>svg~*]:pl-10 [&amp;>svg+div]:translate-y-[-3px] [&amp;>svg]:absolute [&amp;>svg]:left-4 [&amp;>svg]:top-4 [&amp;>svg]:w-[23px] [&amp;>svg]:h-[23px] [&amp;>svg]:p-1 [&amp;>svg]:flex [&amp;>svg]:rounded text-foreground [&amp;>svg]:text-background [&amp;>svg]:bg-foreground mb-2 [&amp;_svg]:bg-foreground-muted [&amp;_svg]:text-background-muted bg-surface-200/25 border border-default\"><svg xmlns=\"http://www.w3.org/2000/svg\" viewBox=\"0 0 21 20\" class=\"w-6 h-6\" fill=\"currentColor\"><path fill-rule=\"evenodd\" clip-rule=\"evenodd\" d=\"M0.625 9.8252C0.625 4.44043 4.99023 0.0751953 10.375 0.0751953C15.7598 0.0751953 20.125 4.44043 20.125 9.8252C20.125 15.21 15.7598 19.5752 10.375 19.5752C4.99023 19.5752 0.625 15.21 0.625 9.8252ZM9.3584 4.38135C9.45117 4.28857 9.55518 4.20996 9.66699 4.14648C9.88086 4.02539 10.1245 3.96045 10.375 3.96045C10.5845 3.96045 10.7896 4.00586 10.9766 4.09229C11.1294 4.1626 11.2705 4.26025 11.3916 4.38135C11.6611 4.65088 11.8125 5.0166 11.8125 5.39795C11.8125 5.5249 11.7959 5.6499 11.7637 5.77002C11.6987 6.01172 11.5718 6.23438 11.3916 6.41455C11.1221 6.68408 10.7563 6.83545 10.375 6.83545C9.99365 6.83545 9.62793 6.68408 9.3584 6.41455C9.08887 6.14502 8.9375 5.7793 8.9375 5.39795C8.9375 5.29492 8.94873 5.19287 8.97021 5.09375C9.02783 4.82568 9.16162 4.57812 9.3584 4.38135ZM10.375 15.6899C10.0933 15.6899 9.82275 15.5781 9.62354 15.3789C9.42432 15.1797 9.3125 14.9092 9.3125 14.6274V9.31494C9.3125 9.0332 9.42432 8.7627 9.62354 8.56348C9.82275 8.36426 10.0933 8.25244 10.375 8.25244C10.6567 8.25244 10.9272 8.36426 11.1265 8.56348C11.3257 8.7627 11.4375 9.0332 11.4375 9.31494V14.6274C11.4375 14.7944 11.3979 14.9575 11.3242 15.104C11.2739 15.2046 11.2075 15.2979 11.1265 15.3789C10.9272 15.5781 10.6567 15.6899 10.375 15.6899Z\"></path></svg><div class=\"text mt [&amp;_p]:mb-1.5 [&amp;_p]:mt-0 mt-0.5 [&amp;_p:last-child]:mb-0\"><p>SQLAlchemy requires the connection string to start with <code>postgresql://</code> (instead of <code>postgres://</code>). Don't forget to rename this after copying the string from the dashboard.</p></div></div>\n<div role=\"alert\" class=\"relative w-full text-sm rounded-lg p-4 [&amp;>svg~*]:pl-10 [&amp;>svg+div]:translate-y-[-3px] [&amp;>svg]:absolute [&amp;>svg]:left-4 [&amp;>svg]:top-4 [&amp;>svg]:w-[23px] [&amp;>svg]:h-[23px] [&amp;>svg]:p-1 [&amp;>svg]:flex [&amp;>svg]:rounded text-foreground [&amp;>svg]:text-background [&amp;>svg]:bg-foreground mb-2 [&amp;_svg]:bg-foreground-muted [&amp;_svg]:text-background-muted bg-surface-200/25 border border-default\"><svg xmlns=\"http://www.w3.org/2000/svg\" viewBox=\"0 0 21 20\" class=\"w-6 h-6\" fill=\"currentColor\"><path fill-rule=\"evenodd\" clip-rule=\"evenodd\" d=\"M0.625 9.8252C0.625 4.44043 4.99023 0.0751953 10.375 0.0751953C15.7598 0.0751953 20.125 4.44043 20.125 9.8252C20.125 15.21 15.7598 19.5752 10.375 19.5752C4.99023 19.5752 0.625 15.21 0.625 9.8252ZM9.3584 4.38135C9.45117 4.28857 9.55518 4.20996 9.66699 4.14648C9.88086 4.02539 10.1245 3.96045 10.375 3.96045C10.5845 3.96045 10.7896 4.00586 10.9766 4.09229C11.1294 4.1626 11.2705 4.26025 11.3916 4.38135C11.6611 4.65088 11.8125 5.0166 11.8125 5.39795C11.8125 5.5249 11.7959 5.6499 11.7637 5.77002C11.6987 6.01172 11.5718 6.23438 11.3916 6.41455C11.1221 6.68408 10.7563 6.83545 10.375 6.83545C9.99365 6.83545 9.62793 6.68408 9.3584 6.41455C9.08887 6.14502 8.9375 5.7793 8.9375 5.39795C8.9375 5.29492 8.94873 5.19287 8.97021 5.09375C9.02783 4.82568 9.16162 4.57812 9.3584 4.38135ZM10.375 15.6899C10.0933 15.6899 9.82275 15.5781 9.62354 15.3789C9.42432 15.1797 9.3125 14.9092 9.3125 14.6274V9.31494C9.3125 9.0332 9.42432 8.7627 9.62354 8.56348C9.82275 8.36426 10.0933 8.25244 10.375 8.25244C10.6567 8.25244 10.9272 8.36426 11.1265 8.56348C11.3257 8.7627 11.4375 9.0332 11.4375 9.31494V14.6274C11.4375 14.7944 11.3979 14.9575 11.3242 15.104C11.2739 15.2046 11.2075 15.2979 11.1265 15.3789C10.9272 15.5781 10.6567 15.6899 10.375 15.6899Z\"></path></svg><div class=\"text mt [&amp;_p]:mb-1.5 [&amp;_p]:mt-0 mt-0.5 [&amp;_p:last-child]:mb-0\"><p>You must use the \"connection pooling\" string (domain ending in <code>*.pooler.supabase.com</code>) with Google Colab since Colab does not support IPv6.</p></div></div>\n<h2 id=\"stepping-through-the-notebook\" class=\"group scroll-mt-24\">Stepping through the notebook<a href=\"#stepping-through-the-notebook\" aria-hidden=\"true\" class=\"ml-2 opacity-0 group-hover:opacity-100 transition\"><span aria-hidden=\"true\">#</span></a></h2>\n<p>Now all that's left is to step through the notebook. You can do this by clicking the \"execute\" button (<code>ctrl+enter</code>) at the top left of each code cell. The notebook guides you through the process of creating a collection, adding data to it, and querying it.</p>\n<p>You can view the inserted items in the <a href=\"https://supabase.com/dashboard/project/_/editor/\">Table Editor</a>, by selecting the <code>vecs</code> schema from the schema dropdown.</p>\n<p><img src=\"/docs/img/ai/google-colab/colab-documents.png\" alt=\"Colab documents\"></p>\n<h2 id=\"next-steps\" class=\"group scroll-mt-24\">Next steps<a href=\"#next-steps\" aria-hidden=\"true\" class=\"ml-2 opacity-0 group-hover:opacity-100 transition\"><span aria-hidden=\"true\">#</span></a></h2>\n<p>You can now start building your own applications with Vecs. Check our <a href=\"/docs/guides/ai#examples\">examples</a> for ideas.</p></article></div></div></div><!--$--><div class=\"max-w-7xl px-5 mx-auto py-8 pt-0\"></div><!--/$--></div><div class=\"left-0 right-0 z-10 backdrop-blur-sm backdrop-filter bg-alternative/90 hidden h-0 lg:hidden\"></div></div></main></div></div></div></div></body></html>",
      "metadata": {
        "ogUrl": "https://supabase.com/docs/guides/ai/quickstarts/hello-world",
        "title": "Creating and managing collections | Supabase Docs",
        "robots": "index, follow",
        "ogImage": "https://obuldanrptloktxcffvn.supabase.co/functions/v1/og-images?site=docs&type=ai&title=Creating%20and%20managing%20collections&description=undefined",
        "ogTitle": "Creating and managing collections | Supabase Docs",
        "language": "en",
        "sourceURL": "https://supabase.com/docs/guides/ai/quickstarts/hello-world",
        "description": "Connecting to your database with Colab.",
        "modifiedTime": "2024-09-10T20:36:24.980Z",
        "ogDescription": "Connecting to your database with Colab.",
        "publishedTime": "2024-09-10T20:36:24.980Z",
        "ogLocaleAlternate": [],
        "statusCode": 200
      }
    },
    {
      "markdown": "AI & Vectors\n\n# Keyword search\n\n## Learn how to search by words or phrases.\n\n* * *\n\nKeyword search involves locating documents or records that contain specific words or phrases, primarily based on the exact match between the search terms and the text within the data. It differs from [semantic search](/docs/guides/ai/semantic-search), which interprets the meaning behind the query to provide results that are contextually related, even if the exact words aren't present in the text. Semantic search considers synonyms, intent, and natural language nuances to provide a more nuanced approach to information retrieval.\n\nIn Postgres, keyword search is implemented using [full-text search](/docs/guides/database/full-text-search). It supports indexing and text analysis for data retrieval, focusing on records that match the search criteria. Postgres' full-text search extends beyond simple keyword matching to address linguistic nuances, making it effective for applications that require precise text queries.\n\n## Why would I want to use keyword search? [\\#](\\#why-would-i-want-to-use-keyword-search)\n\nKeyword search is particularly useful in scenarios where precision and specificity matter. It's more effective than semantic search when users are looking for information using exact terminology or specific identifiers. It ensures that results directly contain those terms, reducing the chance of retrieving irrelevant information that might be semantically related but not what the user seeks.\n\nFor example in technical or academic research databases, researchers often search for specific studies, compounds, or concepts identified by certain terms or codes. Searching for a specific chemical compound using its exact molecular formula or a unique identifier will yield more focused and relevant results compared to a semantic search, which could return a wide range of documents discussing the compound in different contexts. Keyword search ensures documents that explicitly mention the exact term are found, allowing users to access the precise data they need efficiently.\n\nIt's also possible to combine keyword search with semantic search to get the best of both worlds. See [Hybrid search](/docs/guides/ai/hybrid-search) for more details.\n\n## Using full-text search [\\#](\\#using-full-text-search)\n\nFor an in-depth guide to Postgres' full-text search, including how to store, index, and query records, see [Full text search](/docs/guides/database/full-text-search).\n\n## See also [\\#](\\#see-also)\n\n- [Semantic search](/docs/guides/ai/semantic-search)\n- [Hybrid search](/docs/guides/ai/hybrid-search)",
      "html": "<!DOCTYPE html><html lang=\"en\" data-theme=\"light\" style=\"color-scheme: light;\"><body><div class=\"flex flex-col\"><div class=\"grow\"><div class=\"flex flex-col h-full w-full\"><div class=\"hidden lg:sticky w-full lg:flex top-0 left-0 right-0 z-50\"><!--$--><!--/$--></div><div class=\"flex flex-row h-full relative\"><main id=\"docs-content-container\" class=\"w-full transition-all ease-out relative lg:ml-0\"><div class=\"flex flex-col sticky top-0\"><div class=\"flex lg:hidden w-full top-0 left-0 right-0 z-50\"><!--$--><!--/$--></div><div class=\"sticky transition-all top-0 z-10 backdrop-blur backdrop-filter bg-background\"><div class=\"lg:hidden px-3.5 border-b z-10 transition-all ease-out top-0 flex items-center gap-1\"><button class=\"h-8 w-8 flex group items-center justify-center mr-1\"><div class=\"space-y-1 cursor-pointer relative w-4 h-[8px]\"><span class=\"transition-all ease-out block h-px bg-foreground-muted group-hover:bg-foreground w-4\"></span><span class=\"transition-all ease-out block h-px bg-foreground-muted group-hover:bg-foreground w-3 group-hover:w-4\"></span></div></button><span class=\"transition-all duration-200 text-foreground text-sm\">AI &amp; Vectors</span></div></div><div class=\"grow\"><div class=\"max-w-7xl px-5 mx-auto py-8 pb-0\"><div class=\"grid grid-cols-12 relative gap-4\"><div class=\"relative transition-all ease-out duration-100 col-span-12 md:col-span-9\"><article id=\"sb-docs-guide-main-article\" class=\"prose max-w-none\"><h1 class=\"mb-0\">Keyword search</h1><h2 class=\"mt-3 text-xl text-foreground-light\">Learn how to search by words or phrases.</h2><hr class=\"not-prose border-t-0 border-b my-8\"><p>Keyword search involves locating documents or records that contain specific words or phrases, primarily based on the exact match between the search terms and the text within the data. It differs from <a href=\"/docs/guides/ai/semantic-search\">semantic search</a>, which interprets the meaning behind the query to provide results that are contextually related, even if the exact words aren't present in the text. Semantic search considers synonyms, intent, and natural language nuances to provide a more nuanced approach to information retrieval.</p>\n<p>In Postgres, keyword search is implemented using <a href=\"/docs/guides/database/full-text-search\">full-text search</a>. It supports indexing and text analysis for data retrieval, focusing on records that match the search criteria. Postgres' full-text search extends beyond simple keyword matching to address linguistic nuances, making it effective for applications that require precise text queries.</p>\n<h2 id=\"why-would-i-want-to-use-keyword-search\" class=\"group scroll-mt-24\">Why would I want to use keyword search?<a href=\"#why-would-i-want-to-use-keyword-search\" aria-hidden=\"true\" class=\"ml-2 opacity-0 group-hover:opacity-100 transition\"><span aria-hidden=\"true\">#</span></a></h2>\n<p>Keyword search is particularly useful in scenarios where precision and specificity matter. It's more effective than semantic search when users are looking for information using exact terminology or specific identifiers. It ensures that results directly contain those terms, reducing the chance of retrieving irrelevant information that might be semantically related but not what the user seeks.</p>\n<p>For example in technical or academic research databases, researchers often search for specific studies, compounds, or concepts identified by certain terms or codes. Searching for a specific chemical compound using its exact molecular formula or a unique identifier will yield more focused and relevant results compared to a semantic search, which could return a wide range of documents discussing the compound in different contexts. Keyword search ensures documents that explicitly mention the exact term are found, allowing users to access the precise data they need efficiently.</p>\n<p>It's also possible to combine keyword search with semantic search to get the best of both worlds. See <a href=\"/docs/guides/ai/hybrid-search\">Hybrid search</a> for more details.</p>\n<h2 id=\"using-full-text-search\" class=\"group scroll-mt-24\">Using full-text search<a href=\"#using-full-text-search\" aria-hidden=\"true\" class=\"ml-2 opacity-0 group-hover:opacity-100 transition\"><span aria-hidden=\"true\">#</span></a></h2>\n<p>For an in-depth guide to Postgres' full-text search, including how to store, index, and query records, see <a href=\"/docs/guides/database/full-text-search\">Full text search</a>.</p>\n<h2 id=\"see-also\" class=\"group scroll-mt-24\">See also<a href=\"#see-also\" aria-hidden=\"true\" class=\"ml-2 opacity-0 group-hover:opacity-100 transition\"><span aria-hidden=\"true\">#</span></a></h2>\n<ul>\n<li><a href=\"/docs/guides/ai/semantic-search\">Semantic search</a></li>\n<li><a href=\"/docs/guides/ai/hybrid-search\">Hybrid search</a></li>\n</ul></article></div></div></div><!--$--><div class=\"max-w-7xl px-5 mx-auto py-8 pt-0\"></div><!--/$--></div><div class=\"left-0 right-0 z-10 backdrop-blur-sm backdrop-filter bg-alternative/90 hidden h-0 lg:hidden\"></div></div></main></div></div></div></div></body></html>",
      "metadata": {
        "ogUrl": "https://supabase.com/docs/guides/ai/keyword-search",
        "title": "Keyword search | Supabase Docs",
        "robots": "index, follow",
        "ogImage": "https://obuldanrptloktxcffvn.supabase.co/functions/v1/og-images?site=docs&type=ai&title=Keyword%20search&description=Learn%20how%20to%20search%20by%20words%20or%20phrases.",
        "ogTitle": "Keyword search | Supabase Docs",
        "language": "en",
        "sourceURL": "https://supabase.com/docs/guides/ai/keyword-search",
        "description": "Learn how to search by words or phrases.",
        "modifiedTime": "2024-09-10T20:36:24.980Z",
        "ogDescription": "Learn how to search by words or phrases.",
        "publishedTime": "2024-09-10T20:36:24.980Z",
        "ogLocaleAlternate": [],
        "statusCode": 200
      }
    },
    {
      "markdown": "AI & Vectors\n\n# Engineering for Scale\n\n## Building an enterprise-grade vector architecture.\n\n* * *\n\nContent sources for vectors can be extremely large. As you grow you should run your Vector workloads across several secondary databases (sometimes called \"pods\"), which allows each collection to scale independently.\n\n## Simple workloads [\\#](\\#simple-workloads)\n\nFor small workloads, it's typical to store your data in a single database.\n\nIf you've used [Vecs](/docs/guides/ai/vecs-python-client) to create 3 different collections, you can expose collections to your web or mobile application using [views](/docs/guides/database/tables#views):\n\nFor example, with 3 collections, called `docs`, `posts`, and `images`, we could expose the \"docs\" inside the public schema like this:\n\n`\n_10\ncreate view public.docs as\n_10\nselect\n_10\nid,\n_10\nembedding,\n_10\nmetadata, # Expose the metadata as JSON\n_10\n(metadata->>'url')::text as url # Extract the URL as a string\n_10\nfrom vector\n`\n\nYou can then use any of the client libraries to access your collections within your applications:\n\n`\n_10\nconst { data, error } = await supabase\n_10\n.from('docs')\n_10\n.select('id, embedding, metadata')\n_10\n.eq('url', '/hello-world')\n`\n\n## Enterprise workloads [\\#](\\#enterprise-workloads)\n\nAs you move into production, we recommend splitting your collections into separate projects. This is because it allows your vector stores to scale independently of your production data. Vectors typically grow faster than operational data, and they have different resource requirements. Running them on separate databases removes the single-point-of-failure.\n\nYou can use as many secondary databases as you need to manage your collections. With this architecture, you have 2 options for accessing collections within your application:\n\n1. Query the collections directly using Vecs.\n2. Access the collections from your Primary database through a Wrapper.\n\nYou can use both of these in tandem to suit your use-case. We recommend option `1` wherever possible, as it offers the most scalability.\n\n### Query collections using Vecs [\\#](\\#query-collections-using-vecs)\n\nVecs provides methods for querying collections, either using a [cosine similarity function](https://supabase.github.io/vecs/api/#basic) or with [metadata filtering](https://supabase.github.io/vecs/api/#metadata-filtering).\n\n`\n_10\n# cosine similarity\n_10\ndocs.query(query_vector=[0.4,0.5,0.6], limit=5)\n_10\n_10\n# metadata filtering\n_10\ndocs.query(\n_10\n    query_vector=[0.4,0.5,0.6],\n_10\n    limit=5,\n_10\n    filters={\"year\": {\"$eq\": 2012}}, # metadata filters\n_10\n)\n`\n\n### Accessing external collections using Wrappers [\\#](\\#accessing-external-collections-using-wrappers)\n\nSupabase supports [Foreign Data Wrappers](/blog/postgres-foreign-data-wrappers-rust). Wrappers allow you to connect two databases together so that you can query them over the network.\n\nThis involves 2 steps: connecting to your remote database from the primary and creating a Foreign Table.\n\n#### Connecting your remote database [\\#](\\#connecting-your-remote-database)\n\nInside your Primary database we need to provide the credentials to access the secondary database:\n\n`\n_10\ncreate extension postgres_fdw;\n_10\n_10\ncreate server docs_server\n_10\nforeign data wrapper postgres_fdw\n_10\noptions (host 'db.xxx.supabase.co', port '5432', dbname 'postgres');\n_10\n_10\ncreate user mapping for docs_user\n_10\nserver docs_server\n_10\noptions (user 'postgres', password 'password');\n`\n\n#### Create a foreign table [\\#](\\#create-a-foreign-table)\n\nWe can now create a foreign table to access the data in our secondary project.\n\n`\n_10\ncreate foreign table docs (\n_10\nid text not null,\n_10\nembedding vector(384),\n_10\nmetadata jsonb,\n_10\nurl text\n_10\n)\n_10\nserver docs_server\n_10\noptions (schema_name 'public', table_name 'docs');\n`\n\nThis looks very similar to our View example above, and you can continue to use the client libraries to access your collections through the foreign table:\n\n`\n_10\nconst { data, error } = await supabase\n_10\n.from('docs')\n_10\n.select('id, embedding, metadata')\n_10\n.eq('url', '/hello-world')\n`\n\n### Enterprise architecture [\\#](\\#enterprise-architecture)\n\nThis diagram provides an example architecture that allows you to access the collections either with our client libraries or using Vecs. You can add as many secondary databases as you need (in this example we only show one):",
      "html": "<!DOCTYPE html><html lang=\"en\" data-theme=\"light\" style=\"color-scheme: light;\"><body><div class=\"flex flex-col\"><div class=\"grow\"><div class=\"flex flex-col h-full w-full\"><div class=\"hidden lg:sticky w-full lg:flex top-0 left-0 right-0 z-50\"><!--$--><!--/$--></div><div class=\"flex flex-row h-full relative\"><main id=\"docs-content-container\" class=\"w-full transition-all ease-out relative lg:ml-0\"><div class=\"flex flex-col sticky top-0\"><div class=\"flex lg:hidden w-full top-0 left-0 right-0 z-50\"><!--$--><!--/$--></div><div class=\"sticky transition-all top-0 z-10 backdrop-blur backdrop-filter bg-background\"><div class=\"lg:hidden px-3.5 border-b z-10 transition-all ease-out top-0 flex items-center gap-1\"><button class=\"h-8 w-8 flex group items-center justify-center mr-1\"><div class=\"space-y-1 cursor-pointer relative w-4 h-[8px]\"><span class=\"transition-all ease-out block h-px bg-foreground-muted group-hover:bg-foreground w-4\"></span><span class=\"transition-all ease-out block h-px bg-foreground-muted group-hover:bg-foreground w-3 group-hover:w-4\"></span></div></button><span class=\"transition-all duration-200 text-foreground text-sm\">AI &amp; Vectors</span></div></div><div class=\"grow\"><div class=\"max-w-7xl px-5 mx-auto py-8 pb-0\"><div class=\"grid grid-cols-12 relative gap-4\"><div class=\"relative transition-all ease-out duration-100 col-span-12 md:col-span-9\"><article id=\"sb-docs-guide-main-article\" class=\"prose max-w-none\"><h1 class=\"mb-0\">Engineering for Scale</h1><h2 class=\"mt-3 text-xl text-foreground-light\">Building an enterprise-grade vector architecture.</h2><hr class=\"not-prose border-t-0 border-b my-8\">\n<p>Content sources for vectors can be extremely large. As you grow you should run your Vector workloads across several secondary databases (sometimes called \"pods\"), which allows each collection to scale independently.</p>\n<h2 id=\"simple-workloads\" class=\"group scroll-mt-24\">Simple workloads<a href=\"#simple-workloads\" aria-hidden=\"true\" class=\"ml-2 opacity-0 group-hover:opacity-100 transition\"><span aria-hidden=\"true\">#</span></a></h2>\n<p>For small workloads, it's typical to store your data in a single database.</p>\n<p>If you've used <a href=\"/docs/guides/ai/vecs-python-client\">Vecs</a> to create 3 different collections, you can expose collections to your web or mobile application using <a href=\"/docs/guides/database/tables#views\">views</a>:</p>\n<!-- -->\n<p>For example, with 3 collections, called <code>docs</code>, <code>posts</code>, and <code>images</code>, we could expose the \"docs\" inside the public schema like this:</p>\n<div class=\"ch-codeblock not-prose \" data-ch-theme=\"supabase\"><div class=\"ch-code-wrapper ch-code\" data-ch-measured=\"false\"><code class=\"ch-code-scroll-parent\"><br><div><span class=\"ch-code-line-number\">_<!-- -->10</span><div style=\"display:inline-block;margin-left:16px\"><span>create view public.docs as</span></div></div><div><span class=\"ch-code-line-number\">_<!-- -->10</span><div style=\"display:inline-block;margin-left:16px\"><span>select</span></div></div><div><span class=\"ch-code-line-number\">_<!-- -->10</span><div style=\"display:inline-block;margin-left:16px\"><span>  id,</span></div></div><div><span class=\"ch-code-line-number\">_<!-- -->10</span><div style=\"display:inline-block;margin-left:16px\"><span>  embedding,</span></div></div><div><span class=\"ch-code-line-number\">_<!-- -->10</span><div style=\"display:inline-block;margin-left:16px\"><span>  metadata, # Expose the metadata as JSON</span></div></div><div><span class=\"ch-code-line-number\">_<!-- -->10</span><div style=\"display:inline-block;margin-left:16px\"><span>  (metadata-&gt;&gt;'url')::text as url # Extract the URL as a string</span></div></div><div><span class=\"ch-code-line-number\">_<!-- -->10</span><div style=\"display:inline-block;margin-left:16px\"><span>from vector</span></div></div><br></code></div></div>\n<p>You can then use any of the client libraries to access your collections within your applications:</p>\n<!-- -->\n<div class=\"ch-codeblock not-prose \" data-ch-theme=\"supabase\"><div class=\"ch-code-wrapper ch-code\" data-ch-measured=\"false\"><code class=\"ch-code-scroll-parent\"><br><div><span class=\"ch-code-line-number\">_<!-- -->10</span><div style=\"display:inline-block;margin-left:16px\"><span>const { data, error } = await supabase</span></div></div><div><span class=\"ch-code-line-number\">_<!-- -->10</span><div style=\"display:inline-block;margin-left:16px\"><span>  .from('docs')</span></div></div><div><span class=\"ch-code-line-number\">_<!-- -->10</span><div style=\"display:inline-block;margin-left:16px\"><span>  .select('id, embedding, metadata')</span></div></div><div><span class=\"ch-code-line-number\">_<!-- -->10</span><div style=\"display:inline-block;margin-left:16px\"><span>  .eq('url', '/hello-world')</span></div></div><br></code></div></div>\n<h2 id=\"enterprise-workloads\" class=\"group scroll-mt-24\">Enterprise workloads<a href=\"#enterprise-workloads\" aria-hidden=\"true\" class=\"ml-2 opacity-0 group-hover:opacity-100 transition\"><span aria-hidden=\"true\">#</span></a></h2>\n<p>As you move into production, we recommend splitting your collections into separate projects. This is because it allows your vector stores to scale independently of your production data. Vectors typically grow faster than operational data, and they have different resource requirements. Running them on separate databases removes the single-point-of-failure.</p>\n<!-- -->\n<p>You can use as many secondary databases as you need to manage your collections. With this architecture, you have 2 options for accessing collections within your application:</p>\n<ol>\n<li>Query the collections directly using Vecs.</li>\n<li>Access the collections from your Primary database through a Wrapper.</li>\n</ol>\n<p>You can use both of these in tandem to suit your use-case. We recommend option <code>1</code> wherever possible, as it offers the most scalability.</p>\n<h3 id=\"query-collections-using-vecs\" class=\"group scroll-mt-24\">Query collections using Vecs<a href=\"#query-collections-using-vecs\" aria-hidden=\"true\" class=\"ml-2 opacity-0 group-hover:opacity-100 transition\"><span aria-hidden=\"true\">#</span></a></h3>\n<p>Vecs provides methods for querying collections, either using a <a href=\"https://supabase.github.io/vecs/api/#basic\">cosine similarity function</a> or with <a href=\"https://supabase.github.io/vecs/api/#metadata-filtering\">metadata filtering</a>.</p>\n<div class=\"ch-codeblock not-prose \" data-ch-theme=\"supabase\"><div class=\"ch-code-wrapper ch-code\" data-ch-measured=\"false\"><code class=\"ch-code-scroll-parent\"><br><div><span class=\"ch-code-line-number\">_<!-- -->10</span><div style=\"display:inline-block;margin-left:16px\"><span># cosine similarity</span></div></div><div><span class=\"ch-code-line-number\">_<!-- -->10</span><div style=\"display:inline-block;margin-left:16px\"><span>docs.query(query_vector=[0.4,0.5,0.6], limit=5)</span></div></div><div><span class=\"ch-code-line-number\">_<!-- -->10</span><div style=\"display:inline-block;margin-left:16px\"><span></span></div></div><div><span class=\"ch-code-line-number\">_<!-- -->10</span><div style=\"display:inline-block;margin-left:16px\"><span># metadata filtering</span></div></div><div><span class=\"ch-code-line-number\">_<!-- -->10</span><div style=\"display:inline-block;margin-left:16px\"><span>docs.query(</span></div></div><div><span class=\"ch-code-line-number\">_<!-- -->10</span><div style=\"display:inline-block;margin-left:16px\"><span>    query_vector=[0.4,0.5,0.6],</span></div></div><div><span class=\"ch-code-line-number\">_<!-- -->10</span><div style=\"display:inline-block;margin-left:16px\"><span>    limit=5,</span></div></div><div><span class=\"ch-code-line-number\">_<!-- -->10</span><div style=\"display:inline-block;margin-left:16px\"><span>    filters={\"year\": {\"$eq\": 2012}}, # metadata filters</span></div></div><div><span class=\"ch-code-line-number\">_<!-- -->10</span><div style=\"display:inline-block;margin-left:16px\"><span>)</span></div></div><br></code></div></div>\n<h3 id=\"accessing-external-collections-using-wrappers\" class=\"group scroll-mt-24\">Accessing external collections using Wrappers<a href=\"#accessing-external-collections-using-wrappers\" aria-hidden=\"true\" class=\"ml-2 opacity-0 group-hover:opacity-100 transition\"><span aria-hidden=\"true\">#</span></a></h3>\n<p>Supabase supports <a href=\"/blog/postgres-foreign-data-wrappers-rust\">Foreign Data Wrappers</a>. Wrappers allow you to connect two databases together so that you can query them over the network.</p>\n<p>This involves 2 steps: connecting to your remote database from the primary and creating a Foreign Table.</p>\n<h4 id=\"connecting-your-remote-database\" class=\"group scroll-mt-24\">Connecting your remote database<a href=\"#connecting-your-remote-database\" aria-hidden=\"true\" class=\"ml-2 opacity-0 group-hover:opacity-100 transition\"><span aria-hidden=\"true\">#</span></a></h4>\n<p>Inside your Primary database we need to provide the credentials to access the secondary database:</p>\n<div class=\"ch-codeblock not-prose \" data-ch-theme=\"supabase\"><div class=\"ch-code-wrapper ch-code\" data-ch-measured=\"false\"><code class=\"ch-code-scroll-parent\"><br><div><span class=\"ch-code-line-number\">_<!-- -->10</span><div style=\"display:inline-block;margin-left:16px\"><span>create extension postgres_fdw;</span></div></div><div><span class=\"ch-code-line-number\">_<!-- -->10</span><div style=\"display:inline-block;margin-left:16px\"><span></span></div></div><div><span class=\"ch-code-line-number\">_<!-- -->10</span><div style=\"display:inline-block;margin-left:16px\"><span>create server docs_server</span></div></div><div><span class=\"ch-code-line-number\">_<!-- -->10</span><div style=\"display:inline-block;margin-left:16px\"><span>foreign data wrapper postgres_fdw</span></div></div><div><span class=\"ch-code-line-number\">_<!-- -->10</span><div style=\"display:inline-block;margin-left:16px\"><span>options (host 'db.xxx.supabase.co', port '5432', dbname 'postgres');</span></div></div><div><span class=\"ch-code-line-number\">_<!-- -->10</span><div style=\"display:inline-block;margin-left:16px\"><span></span></div></div><div><span class=\"ch-code-line-number\">_<!-- -->10</span><div style=\"display:inline-block;margin-left:16px\"><span>create user mapping for docs_user</span></div></div><div><span class=\"ch-code-line-number\">_<!-- -->10</span><div style=\"display:inline-block;margin-left:16px\"><span>server docs_server</span></div></div><div><span class=\"ch-code-line-number\">_<!-- -->10</span><div style=\"display:inline-block;margin-left:16px\"><span>options (user 'postgres', password 'password');</span></div></div><br></code></div></div>\n<h4 id=\"create-a-foreign-table\" class=\"group scroll-mt-24\">Create a foreign table<a href=\"#create-a-foreign-table\" aria-hidden=\"true\" class=\"ml-2 opacity-0 group-hover:opacity-100 transition\"><span aria-hidden=\"true\">#</span></a></h4>\n<p>We can now create a foreign table to access the data in our secondary project.</p>\n<div class=\"ch-codeblock not-prose \" data-ch-theme=\"supabase\"><div class=\"ch-code-wrapper ch-code\" data-ch-measured=\"false\"><code class=\"ch-code-scroll-parent\"><br><div><span class=\"ch-code-line-number\">_<!-- -->10</span><div style=\"display:inline-block;margin-left:16px\"><span>create foreign table docs (</span></div></div><div><span class=\"ch-code-line-number\">_<!-- -->10</span><div style=\"display:inline-block;margin-left:16px\"><span>  id text not null,</span></div></div><div><span class=\"ch-code-line-number\">_<!-- -->10</span><div style=\"display:inline-block;margin-left:16px\"><span>  embedding vector(384),</span></div></div><div><span class=\"ch-code-line-number\">_<!-- -->10</span><div style=\"display:inline-block;margin-left:16px\"><span>  metadata jsonb,</span></div></div><div><span class=\"ch-code-line-number\">_<!-- -->10</span><div style=\"display:inline-block;margin-left:16px\"><span>  url text</span></div></div><div><span class=\"ch-code-line-number\">_<!-- -->10</span><div style=\"display:inline-block;margin-left:16px\"><span>)</span></div></div><div><span class=\"ch-code-line-number\">_<!-- -->10</span><div style=\"display:inline-block;margin-left:16px\"><span>server docs_server</span></div></div><div><span class=\"ch-code-line-number\">_<!-- -->10</span><div style=\"display:inline-block;margin-left:16px\"><span>options (schema_name 'public', table_name 'docs');</span></div></div><br></code></div></div>\n<p>This looks very similar to our View example above, and you can continue to use the client libraries to access your collections through the foreign table:</p>\n<!-- -->\n<div class=\"ch-codeblock not-prose \" data-ch-theme=\"supabase\"><div class=\"ch-code-wrapper ch-code\" data-ch-measured=\"false\"><code class=\"ch-code-scroll-parent\"><br><div><span class=\"ch-code-line-number\">_<!-- -->10</span><div style=\"display:inline-block;margin-left:16px\"><span>const { data, error } = await supabase</span></div></div><div><span class=\"ch-code-line-number\">_<!-- -->10</span><div style=\"display:inline-block;margin-left:16px\"><span>  .from('docs')</span></div></div><div><span class=\"ch-code-line-number\">_<!-- -->10</span><div style=\"display:inline-block;margin-left:16px\"><span>  .select('id, embedding, metadata')</span></div></div><div><span class=\"ch-code-line-number\">_<!-- -->10</span><div style=\"display:inline-block;margin-left:16px\"><span>  .eq('url', '/hello-world')</span></div></div><br></code></div></div>\n<h3 id=\"enterprise-architecture\" class=\"group scroll-mt-24\">Enterprise architecture<a href=\"#enterprise-architecture\" aria-hidden=\"true\" class=\"ml-2 opacity-0 group-hover:opacity-100 transition\"><span aria-hidden=\"true\">#</span></a></h3>\n<p>This diagram provides an example architecture that allows you to access the collections either with our client libraries or using Vecs. You can add as many secondary databases as you need (in this example we only show one):</p>\n<!-- --></article></div></div></div><!--$--><div class=\"max-w-7xl px-5 mx-auto py-8 pt-0\"></div><!--/$--></div><div class=\"left-0 right-0 z-10 backdrop-blur-sm backdrop-filter bg-alternative/90 hidden h-0 lg:hidden\"></div></div></main></div></div></div></div></body></html>",
      "metadata": {
        "ogUrl": "https://supabase.com/docs/guides/ai/engineering-for-scale",
        "title": "Engineering for Scale | Supabase Docs",
        "robots": "index, follow",
        "ogImage": "https://obuldanrptloktxcffvn.supabase.co/functions/v1/og-images?site=docs&type=ai&title=Engineering%20for%20Scale&description=Building%20an%20enterprise-grade%20vector%20architecture",
        "ogTitle": "Engineering for Scale | Supabase Docs",
        "language": "en",
        "sourceURL": "https://supabase.com/docs/guides/ai/engineering-for-scale",
        "description": "Building an enterprise-grade vector architecture",
        "modifiedTime": "2024-09-10T20:36:24.980Z",
        "ogDescription": "Building an enterprise-grade vector architecture",
        "publishedTime": "2024-09-10T20:36:24.980Z",
        "ogLocaleAlternate": [],
        "statusCode": 200
      }
    },
    {
      "markdown": "AI & Vectors\n\n# Concepts\n\n* * *\n\nEmbeddings are core to many AI and vector applications. This guide covers these concepts. If you prefer to get started right away, see our guide on [Generating Embeddings](/docs/guides/ai/quickstarts/generate-text-embeddings).\n\n## What are embeddings? [\\#](\\#what-are-embeddings)\n\nEmbeddings capture the \"relatedness\" of text, images, video, or other types of information. This relatedness is most commonly used for:\n\n- **Search:** how similar is a search term to a body of text?\n- **Recommendations:** how similar are two products?\n- **Classifications:** how do we categorize a body of text?\n- **Clustering:** how do we identify trends?\n\nLet's explore an example of text embeddings. Say we have three phrases:\n\n1. \"The cat chases the mouse\"\n2. \"The kitten hunts rodents\"\n3. \"I like ham sandwiches\"\n\nYour job is to group phrases with similar meaning. If you are a human, this should be obvious. Phrases 1 and 2 are almost identical, while phrase 3 has a completely different meaning.\n\nAlthough phrases 1 and 2 are similar, they share no common vocabulary (besides \"the\"). Yet their meanings are nearly identical. How can we teach a computer that these are the same?\n\n## Human language [\\#](\\#human-language)\n\nHumans use words and symbols to communicate language. But words in isolation are mostly meaningless - we need to draw from shared knowledge & experience in order to make sense of them. The phrase \u201cYou should Google it\u201d only makes sense if you know that Google is a search engine and that people have been using it as a verb.\n\nIn the same way, we need to train a neural network model to understand human language. An effective model should be trained on millions of different examples to understand what each word, phrase, sentence, or paragraph could mean in different contexts.\n\nSo how does this relate to embeddings?\n\n## How do embeddings work? [\\#](\\#how-do-embeddings-work)\n\nEmbeddings compress discrete information (words & symbols) into distributed continuous-valued data (vectors). If we took our phrases from before and plot them on a chart, it might look something like this:\n\n![Vector similarity](https://supabase.com/docs/img/ai/vector-similarity.png)\n\nPhrases 1 and 2 would be plotted close to each other, since their meanings are similar. We would expect phrase 3 to live somewhere far away since it isn't related. If we had a fourth phrase, \u201cSally ate Swiss cheese\u201d, this might exist somewhere between phrase 3 (cheese can go on sandwiches) and phrase 1 (mice like Swiss cheese).\n\nIn this example we only have 2 dimensions: the X and Y axis. In reality, we would need many more dimensions to effectively capture the complexities of human language.\n\n## Using embeddings [\\#](\\#using-embeddings)\n\nCompared to our 2-dimensional example above, most embedding models will output many more dimensions. For example the open source [`gte-small`](https://huggingface.co/Supabase/gte-small) model outputs 384 dimensions.\n\nWhy is this useful? Once we have generated embeddings on multiple texts, it is trivial to calculate how similar they are using vector math operations like cosine distance. A common use case for this is search. Your process might look something like this:\n\n1. Pre-process your knowledge base and generate embeddings for each page\n2. Store your embeddings to be referenced later\n3. Build a search page that prompts your user for input\n4. Take user's input, generate a one-time embedding, then perform a similarity search against your pre-processed embeddings.\n5. Return the most similar pages to the user\n\n## See also [\\#](\\#see-also)\n\n- [Structured and Unstructured embeddings](/docs/guides/ai/structured-unstructured)",
      "html": "<!DOCTYPE html><html lang=\"en\" data-theme=\"light\" style=\"color-scheme: light;\"><body><div class=\"flex flex-col\"><div class=\"grow\"><div class=\"flex flex-col h-full w-full\"><div class=\"hidden lg:sticky w-full lg:flex top-0 left-0 right-0 z-50\"><!--$--><!--/$--></div><div class=\"flex flex-row h-full relative\"><main id=\"docs-content-container\" class=\"w-full transition-all ease-out relative lg:ml-0\"><div class=\"flex flex-col sticky top-0\"><div class=\"flex lg:hidden w-full top-0 left-0 right-0 z-50\"><!--$--><!--/$--></div><div class=\"sticky transition-all top-0 z-10 backdrop-blur backdrop-filter bg-background\"><div class=\"lg:hidden px-3.5 border-b z-10 transition-all ease-out top-0 flex items-center gap-1\"><button class=\"h-8 w-8 flex group items-center justify-center mr-1\"><div class=\"space-y-1 cursor-pointer relative w-4 h-[8px]\"><span class=\"transition-all ease-out block h-px bg-foreground-muted group-hover:bg-foreground w-4\"></span><span class=\"transition-all ease-out block h-px bg-foreground-muted group-hover:bg-foreground w-3 group-hover:w-4\"></span></div></button><span class=\"transition-all duration-200 text-foreground text-sm\">AI &amp; Vectors</span></div></div><div class=\"grow\"><div class=\"max-w-7xl px-5 mx-auto py-8 pb-0\"><div class=\"grid grid-cols-12 relative gap-4\"><div class=\"relative transition-all ease-out duration-100 col-span-12 md:col-span-9\"><article id=\"sb-docs-guide-main-article\" class=\"prose max-w-none\"><h1 class=\"mb-0\">Concepts</h1><hr class=\"not-prose border-t-0 border-b my-8\"><p>Embeddings are core to many AI and vector applications. This guide covers these concepts. If you prefer to get started right away, see our guide on <a href=\"/docs/guides/ai/quickstarts/generate-text-embeddings\">Generating Embeddings</a>.</p>\n<h2 id=\"what-are-embeddings\" class=\"group scroll-mt-24\">What are embeddings?<a href=\"#what-are-embeddings\" aria-hidden=\"true\" class=\"ml-2 opacity-0 group-hover:opacity-100 transition\"><span aria-hidden=\"true\">#</span></a></h2>\n<p>Embeddings capture the \"relatedness\" of text, images, video, or other types of information. This relatedness is most commonly used for:</p>\n<ul>\n<li><strong>Search:</strong> how similar is a search term to a body of text?</li>\n<li><strong>Recommendations:</strong> how similar are two products?</li>\n<li><strong>Classifications:</strong> how do we categorize a body of text?</li>\n<li><strong>Clustering:</strong> how do we identify trends?</li>\n</ul>\n<p>Let's explore an example of text embeddings. Say we have three phrases:</p>\n<ol>\n<li>\"The cat chases the mouse\"</li>\n<li>\"The kitten hunts rodents\"</li>\n<li>\"I like ham sandwiches\"</li>\n</ol>\n<p>Your job is to group phrases with similar meaning. If you are a human, this should be obvious. Phrases 1 and 2 are almost identical, while phrase 3 has a completely different meaning.</p>\n<p>Although phrases 1 and 2 are similar, they share no common vocabulary (besides \"the\"). Yet their meanings are nearly identical. How can we teach a computer that these are the same?</p>\n<h2 id=\"human-language\" class=\"group scroll-mt-24\">Human language<a href=\"#human-language\" aria-hidden=\"true\" class=\"ml-2 opacity-0 group-hover:opacity-100 transition\"><span aria-hidden=\"true\">#</span></a></h2>\n<p>Humans use words and symbols to communicate language. But words in isolation are mostly meaningless - we need to draw from shared knowledge &amp; experience in order to make sense of them. The phrase \u201cYou should Google it\u201d only makes sense if you know that Google is a search engine and that people have been using it as a verb.</p>\n<p>In the same way, we need to train a neural network model to understand human language. An effective model should be trained on millions of different examples to understand what each word, phrase, sentence, or paragraph could mean in different contexts.</p>\n<p>So how does this relate to embeddings?</p>\n<h2 id=\"how-do-embeddings-work\" class=\"group scroll-mt-24\">How do embeddings work?<a href=\"#how-do-embeddings-work\" aria-hidden=\"true\" class=\"ml-2 opacity-0 group-hover:opacity-100 transition\"><span aria-hidden=\"true\">#</span></a></h2>\n<p>Embeddings compress discrete information (words &amp; symbols) into distributed continuous-valued data (vectors). If we took our phrases from before and plot them on a chart, it might look something like this:</p>\n<img src=\"/docs/img/ai/vector-similarity.png\" alt=\"Vector similarity\" width=\"640\" height=\"640\">\n<p>Phrases 1 and 2 would be plotted close to each other, since their meanings are similar. We would expect phrase 3 to live somewhere far away since it isn't related. If we had a fourth phrase, \u201cSally ate Swiss cheese\u201d, this might exist somewhere between phrase 3 (cheese can go on sandwiches) and phrase 1 (mice like Swiss cheese).</p>\n<p>In this example we only have 2 dimensions: the X and Y axis. In reality, we would need many more dimensions to effectively capture the complexities of human language.</p>\n<h2 id=\"using-embeddings\" class=\"group scroll-mt-24\">Using embeddings<a href=\"#using-embeddings\" aria-hidden=\"true\" class=\"ml-2 opacity-0 group-hover:opacity-100 transition\"><span aria-hidden=\"true\">#</span></a></h2>\n<p>Compared to our 2-dimensional example above, most embedding models will output many more dimensions. For example the open source <a href=\"https://huggingface.co/Supabase/gte-small\"><code>gte-small</code></a> model outputs 384 dimensions.</p>\n<p>Why is this useful? Once we have generated embeddings on multiple texts, it is trivial to calculate how similar they are using vector math operations like cosine distance. A common use case for this is search. Your process might look something like this:</p>\n<ol>\n<li>Pre-process your knowledge base and generate embeddings for each page</li>\n<li>Store your embeddings to be referenced later</li>\n<li>Build a search page that prompts your user for input</li>\n<li>Take user's input, generate a one-time embedding, then perform a similarity search against your pre-processed embeddings.</li>\n<li>Return the most similar pages to the user</li>\n</ol>\n<h2 id=\"see-also\" class=\"group scroll-mt-24\">See also<a href=\"#see-also\" aria-hidden=\"true\" class=\"ml-2 opacity-0 group-hover:opacity-100 transition\"><span aria-hidden=\"true\">#</span></a></h2>\n<ul>\n<li><a href=\"/docs/guides/ai/structured-unstructured\">Structured and Unstructured embeddings</a></li>\n</ul></article></div></div></div><!--$--><div class=\"max-w-7xl px-5 mx-auto py-8 pt-0\"></div><!--/$--></div><div class=\"left-0 right-0 z-10 backdrop-blur-sm backdrop-filter bg-alternative/90 hidden h-0 lg:hidden\"></div></div></main></div></div></div></div></body></html>",
      "metadata": {
        "ogUrl": "https://supabase.com/docs/guides/ai/concepts",
        "title": "Concepts | Supabase Docs",
        "robots": "index, follow",
        "ogImage": "https://obuldanrptloktxcffvn.supabase.co/functions/v1/og-images?site=docs&type=ai&title=Concepts&description=Learn%20about%20embeddings%20within%20AI%20and%20vector%20applications.",
        "ogTitle": "Concepts | Supabase Docs",
        "language": "en",
        "sourceURL": "https://supabase.com/docs/guides/ai/concepts",
        "description": "Learn about embeddings within AI and vector applications.",
        "modifiedTime": "2024-09-10T20:36:24.564Z",
        "ogDescription": "Learn about embeddings within AI and vector applications.",
        "publishedTime": "2024-09-10T20:36:24.564Z",
        "ogLocaleAlternate": [],
        "statusCode": 200
      }
    },
    {
      "markdown": "AI & Vectors\n\n# Going to Production\n\n## Going to production checklist for AI applications.\n\n* * *\n\nThis guide will help you to prepare your application for production. We'll provide actionable steps to help you scale your application, ensure that it is reliable, can handle the load, and provide optimal accuracy for your use case.\n\nSee our [Engineering for Scale](/docs/guides/ai/engineering-for-scale) guide for more information about engineering at scale.\n\n## Do you need indexes? [\\#](\\#do-you-need-indexes)\n\nSequential scans will result in significantly higher latencies and lower throughput, guaranteeing 100% accuracy and not being RAM bound.\n\nThere are a couple of cases where you might not need indexes:\n\n- You have a small dataset and don't need to scale it.\n- You are not expecting high amounts of vector search queries per second.\n- You need to guarantee 100% accuracy.\n\nYou don't have to create indexes in these cases and can use sequential scans instead. This type of workload will not be RAM bound and will not require any additional resources but will result in higher latencies and lower throughput. Extra CPU cores may help to improve queries per second, but it will not help to improve latency.\n\nOn the other hand, if you need to scale your application, you will need to [create indexes](/docs/guides/ai/vector-indexes). This will result in lower latencies and higher throughput, but will require additional RAM to make use of Postgres Caching. Also, using indexes will result in lower accuracy, since you are replacing exact (KNN) search with approximate (ANN) search.\n\n## HNSW vs IVFFlat indexes [\\#](\\#hnsw-vs-ivfflat-indexes)\n\n`pgvector` supports two types of indexes: HNSW and IVFFlat. We recommend using [HNSW](/docs/guides/ai/vector-indexes/hnsw-indexes) because of its [performance](https://supabase.com/blog/increase-performance-pgvector-hnsw#hnsw-performance-1536-dimensions) and [robustness against changing data](/docs/guides/ai/vector-indexes/hnsw-indexes#when-should-you-create-hnsw-indexes).\n\n## HNSW, understanding `ef_construction`, `ef_search`, and `m` [\\#](\\#hnsw-understanding-efconstruction--efsearch--and-m)\n\nIndex build parameters:\n\n- `m` is the number of bi-directional links created for every new element during construction. Higher `m` is suitable for datasets with high dimensionality and/or high accuracy requirements. Reasonable values for `m` are between 2 and 100. Range 12-48 is a good starting point for most use cases (16 is the default value).\n\n- `ef_construction` is the size of the dynamic list for the nearest neighbors (used during the construction algorithm). Higher `ef_construction` will result in better index quality and higher accuracy, but it will also increase the time required to build the index. `ef_construction` has to be at least 2 \\* `m` (64 is the default value). At some point, increasing `ef_construction` does not improve the quality of the index. You can measure accuracy when `ef_search` = `ef_construction`: if accuracy is lower than 0.9, then there is room for improvement.\n\n\nSearch parameters:\n\n- `ef_search` is the size of the dynamic list for the nearest neighbors (used during the search). Increasing `ef_search` will result in better accuracy, but it will also increase the time required to execute a query (40 is the default value).\n\n## IVFFlat, understanding `probes` and `lists` [\\#](\\#ivfflat-understanding-probes-and-lists)\n\nIndexes used for approximate vector similarity search in pgvector divides a dataset into partitions. The number of these partitions is defined by the `lists` constant. The `probes` controls how many lists are going to be searched during a query.\n\nThe values of lists and probes directly affect accuracy and queries per second (QPS).\n\n- Higher `lists` means an index will be built slower, but you can achieve better QPS and accuracy.\n- Higher `probes` means that select queries will be slower, but you can achieve better accuracy.\n- `lists` and `probes` are not independent. Higher `lists` means that you will have to use higher `probes` to achieve the same accuracy.\n\nYou can find more examples of how `lists` and `probes` constants affect accuracy and QPS in [pgvector 0.4.0 performance](https://supabase.com/blog/pgvector-performance) blogpost.\n\n## Performance tips when using indexes [\\#](\\#performance-tips-when-using-indexes)\n\nFirst, a few generic tips which you can pick and choose from:\n\n1. The Supabase managed platform will automatically optimize Postgres configs for you based on your compute addon. But if you self-host, consider **adjusting your Postgres config** based on RAM & CPU cores. See [example optimizations](https://gist.github.com/egor-romanov/323e2847851bbd758081511785573c08) for more details.\n2. Prefer `inner-product` to `L2` or `Cosine` distances if your vectors are normalized (like `text-embedding-ada-002`). If embeddings are not normalized, `Cosine` distance should give the best results with an index.\n3. **Pre-warm your database.** Implement the warm-up technique before transitioning to production or running benchmarks.\n   - Use [pg\\_prewarm](https://www.postgresql.org/docs/current/pgprewarm.html) to load the index into RAM `select pg_prewarm('vecs.docs_vec_idx');`. This will help to avoid cold cache issues.\n   - Execute 10,000 to 50,000 \"warm-up\" queries before each benchmark/prod. This will help to utilize cache and buffers more efficiently.\n4. **Establish your workload.** Finetune `m` and `ef_construction` or `lists` constants for the pgvector index to accelerate your queries (at the expense of a slower build times). For instance, for benchmarks with 1,000,000 OpenAI embeddings, we set `m` and `ef_construction` to 32 and 80, and it resulted in 35% higher QPS than 24 and 56 values respectively.\n5. **Benchmark your own specific workloads.** Doing this during cache warm-up helps gauge the best value for the index build parameters, balancing accuracy with queries per second (QPS).\n\n## Going into production [\\#](\\#going-into-production)\n\n1. Decide if you are going to use indexes or not. You can skip the rest of this guide if you do not use indexes.\n2. Over-provision RAM during preparation. You can scale down in step `5`, but it's better to start with a larger size to get the best results for RAM requirements. (We'd recommend at least 8XL if you're using Supabase.)\n3. Upload your data to the database. If you use the [`vecs`](/docs/guides/ai/python/api) library, it will automatically generate an index with default parameters.\n4. Run a benchmark using randomly generated queries and observe the results. Again, you can use the `vecs` library with the `ann-benchmarks` tool. Do it with default values for index build parameters, you can later adjust them to get the best results.\n5. Monitor the RAM usage, and save it as a note for yourself. You would likely want to use a compute add-on in the future that has the same amount of RAM that was used at the moment (both actual RAM usage and RAM used for cache and buffers).\n6. Scale down your compute add-on to the one that would have the same amount of RAM used at the moment.\n7. Repeat step 3 to load the data into RAM. You should see QPS increase on subsequent runs, and stop when it no longer increases.\n8. Run a benchmark using real queries and observe the results. You can use the `vecs` library for that as well with `ann-benchmarks` tool. Tweak `ef_search` for HNSW or `probes` for IVFFlat until you see that both accuracy and QPS match your requirements.\n9. If you want higher QPS you can increase `m` and `ef_construction` for HNSW or `lists` for IVFFlat parameters (consider switching from IVF to HNSW). You have to rebuild the index with a higher `m` and `ef_construction` values and repeat steps 6-7 to find the best combination of `m`, `ef_construction` and `ef_search` constants to achieve the best QPS and accuracy values. Higher `m`, `ef_construction` mean that index will build slower, but you can achieve better QPS and accuracy. Higher `ef_search` mean that select queries will be slower, but you can achieve better accuracy.\n\n## Useful links [\\#](\\#useful-links)\n\nDon't forget to check out the general [Production Checklist](/docs/guides/platform/going-into-prod) to ensure your project is secure, performant, and will remain available for your users.\n\nYou can look at our [Choosing Compute Add-on](/docs/guides/ai/choosing-compute-addon) guide to get a basic understanding of how much compute you might need for your workload.\n\nOr take a look at our [pgvector 0.5.0 performance](https://supabase.com/blog/increase-performance-pgvector-hnsw) and [pgvector 0.4.0 performance](https://supabase.com/blog/pgvector-performance) blog posts to see what pgvector is capable of and how the above technique can be used to achieve the best results.",
      "html": "<!DOCTYPE html><html lang=\"en\" data-theme=\"light\" style=\"color-scheme: light;\"><body><div class=\"flex flex-col\"><div class=\"grow\"><div class=\"flex flex-col h-full w-full\"><div class=\"hidden lg:sticky w-full lg:flex top-0 left-0 right-0 z-50\"><!--$--><!--/$--></div><div class=\"flex flex-row h-full relative\"><main id=\"docs-content-container\" class=\"w-full transition-all ease-out relative lg:ml-0\"><div class=\"flex flex-col sticky top-0\"><div class=\"flex lg:hidden w-full top-0 left-0 right-0 z-50\"><!--$--><!--/$--></div><div class=\"sticky transition-all top-0 z-10 backdrop-blur backdrop-filter bg-background\"><div class=\"lg:hidden px-3.5 border-b z-10 transition-all ease-out top-0 flex items-center gap-1\"><button class=\"h-8 w-8 flex group items-center justify-center mr-1\"><div class=\"space-y-1 cursor-pointer relative w-4 h-[8px]\"><span class=\"transition-all ease-out block h-px bg-foreground-muted group-hover:bg-foreground w-4\"></span><span class=\"transition-all ease-out block h-px bg-foreground-muted group-hover:bg-foreground w-3 group-hover:w-4\"></span></div></button><span class=\"transition-all duration-200 text-foreground text-sm\">AI &amp; Vectors</span></div></div><div class=\"grow\"><div class=\"max-w-7xl px-5 mx-auto py-8 pb-0\"><div class=\"grid grid-cols-12 relative gap-4\"><div class=\"relative transition-all ease-out duration-100 col-span-12 md:col-span-9\"><article id=\"sb-docs-guide-main-article\" class=\"prose max-w-none\"><h1 class=\"mb-0\">Going to Production</h1><h2 class=\"mt-3 text-xl text-foreground-light\">Going to production checklist for AI applications.</h2><hr class=\"not-prose border-t-0 border-b my-8\"><p>This guide will help you to prepare your application for production. We'll provide actionable steps to help you scale your application, ensure that it is reliable, can handle the load, and provide optimal accuracy for your use case.</p>\n<p>See our <a href=\"/docs/guides/ai/engineering-for-scale\">Engineering for Scale</a> guide for more information about engineering at scale.</p>\n<h2 id=\"do-you-need-indexes\" class=\"group scroll-mt-24\">Do you need indexes?<a href=\"#do-you-need-indexes\" aria-hidden=\"true\" class=\"ml-2 opacity-0 group-hover:opacity-100 transition\"><span aria-hidden=\"true\">#</span></a></h2>\n<p>Sequential scans will result in significantly higher latencies and lower throughput, guaranteeing 100% accuracy and not being RAM bound.</p>\n<p>There are a couple of cases where you might not need indexes:</p>\n<ul>\n<li>You have a small dataset and don't need to scale it.</li>\n<li>You are not expecting high amounts of vector search queries per second.</li>\n<li>You need to guarantee 100% accuracy.</li>\n</ul>\n<p>You don't have to create indexes in these cases and can use sequential scans instead. This type of workload will not be RAM bound and will not require any additional resources but will result in higher latencies and lower throughput. Extra CPU cores may help to improve queries per second, but it will not help to improve latency.</p>\n<p>On the other hand, if you need to scale your application, you will need to <a href=\"/docs/guides/ai/vector-indexes\">create indexes</a>. This will result in lower latencies and higher throughput, but will require additional RAM to make use of Postgres Caching. Also, using indexes will result in lower accuracy, since you are replacing exact (KNN) search with approximate (ANN) search.</p>\n<h2 id=\"hnsw-vs-ivfflat-indexes\" class=\"group scroll-mt-24\">HNSW vs IVFFlat indexes<a href=\"#hnsw-vs-ivfflat-indexes\" aria-hidden=\"true\" class=\"ml-2 opacity-0 group-hover:opacity-100 transition\"><span aria-hidden=\"true\">#</span></a></h2>\n<p><code>pgvector</code> supports two types of indexes: HNSW and IVFFlat. We recommend using <a href=\"/docs/guides/ai/vector-indexes/hnsw-indexes\">HNSW</a> because of its <a href=\"https://supabase.com/blog/increase-performance-pgvector-hnsw#hnsw-performance-1536-dimensions\">performance</a> and <a href=\"/docs/guides/ai/vector-indexes/hnsw-indexes#when-should-you-create-hnsw-indexes\">robustness against changing data</a>.</p>\n<!-- -->\n<h2 id=\"hnsw-understanding-efconstruction--efsearch--and-m\" class=\"group scroll-mt-24\">HNSW, understanding <code>ef_construction</code>, <code>ef_search</code>, and <code>m</code><a href=\"#hnsw-understanding-efconstruction--efsearch--and-m\" aria-hidden=\"true\" class=\"ml-2 opacity-0 group-hover:opacity-100 transition\"><span aria-hidden=\"true\">#</span></a></h2>\n<p>Index build parameters:</p>\n<ul>\n<li>\n<p><code>m</code> is the number of bi-directional links created for every new element during construction. Higher <code>m</code> is suitable for datasets with high dimensionality and/or high accuracy requirements. Reasonable values for <code>m</code> are between 2 and 100. Range 12-48 is a good starting point for most use cases (16 is the default value).</p>\n</li>\n<li>\n<p><code>ef_construction</code> is the size of the dynamic list for the nearest neighbors (used during the construction algorithm). Higher <code>ef_construction</code> will result in better index quality and higher accuracy, but it will also increase the time required to build the index. <code>ef_construction</code> has to be at least 2 * <code>m</code> (64 is the default value). At some point, increasing <code>ef_construction</code> does not improve the quality of the index. You can measure accuracy when <code>ef_search</code>=<code>ef_construction</code>: if accuracy is lower than 0.9, then there is room for improvement.</p>\n</li>\n</ul>\n<p>Search parameters:</p>\n<ul>\n<li><code>ef_search</code> is the size of the dynamic list for the nearest neighbors (used during the search). Increasing <code>ef_search</code> will result in better accuracy, but it will also increase the time required to execute a query (40 is the default value).</li>\n</ul>\n<!-- -->\n<h2 id=\"ivfflat-understanding-probes-and-lists\" class=\"group scroll-mt-24\">IVFFlat, understanding <code>probes</code> and <code>lists</code><a href=\"#ivfflat-understanding-probes-and-lists\" aria-hidden=\"true\" class=\"ml-2 opacity-0 group-hover:opacity-100 transition\"><span aria-hidden=\"true\">#</span></a></h2>\n<p>Indexes used for approximate vector similarity search in pgvector divides a dataset into partitions. The number of these partitions is defined by the <code>lists</code> constant. The <code>probes</code> controls how many lists are going to be searched during a query.</p>\n<p>The values of lists and probes directly affect accuracy and queries per second (QPS).</p>\n<ul>\n<li>Higher <code>lists</code> means an index will be built slower, but you can achieve better QPS and accuracy.</li>\n<li>Higher <code>probes</code> means that select queries will be slower, but you can achieve better accuracy.</li>\n<li><code>lists</code> and <code>probes</code> are not independent. Higher <code>lists</code> means that you will have to use higher <code>probes</code> to achieve the same accuracy.</li>\n</ul>\n<p>You can find more examples of how <code>lists</code> and <code>probes</code> constants affect accuracy and QPS in <a href=\"https://supabase.com/blog/pgvector-performance\">pgvector 0.4.0 performance</a> blogpost.</p>\n<!-- -->\n<h2 id=\"performance-tips-when-using-indexes\" class=\"group scroll-mt-24\">Performance tips when using indexes<a href=\"#performance-tips-when-using-indexes\" aria-hidden=\"true\" class=\"ml-2 opacity-0 group-hover:opacity-100 transition\"><span aria-hidden=\"true\">#</span></a></h2>\n<p>First, a few generic tips which you can pick and choose from:</p>\n<ol>\n<li>The Supabase managed platform will automatically optimize Postgres configs for you based on your compute addon. But if you self-host, consider <strong>adjusting your Postgres config</strong> based on RAM &amp; CPU cores. See <a href=\"https://gist.github.com/egor-romanov/323e2847851bbd758081511785573c08\">example optimizations</a> for more details.</li>\n<li>Prefer <code>inner-product</code> to <code>L2</code> or <code>Cosine</code> distances if your vectors are normalized (like <code>text-embedding-ada-002</code>). If embeddings are not normalized, <code>Cosine</code> distance should give the best results with an index.</li>\n<li><strong>Pre-warm your database.</strong> Implement the warm-up technique before transitioning to production or running benchmarks.<!-- -->\n<ul>\n<li>Use <a href=\"https://www.postgresql.org/docs/current/pgprewarm.html\">pg_prewarm</a> to load the index into RAM <code>select pg_prewarm('vecs.docs_vec_idx');</code>. This will help to avoid cold cache issues.</li>\n<li>Execute 10,000 to 50,000 \"warm-up\" queries before each benchmark/prod. This will help to utilize cache and buffers more efficiently.</li>\n</ul>\n</li>\n<li><strong>Establish your workload.</strong> Finetune <code>m</code> and <code>ef_construction</code> or <code>lists</code> constants for the pgvector index to accelerate your queries (at the expense of a slower build times). For instance, for benchmarks with 1,000,000 OpenAI embeddings, we set <code>m</code> and <code>ef_construction</code> to 32 and 80, and it resulted in 35% higher QPS than 24 and 56 values respectively.</li>\n<li><strong>Benchmark your own specific workloads.</strong> Doing this during cache warm-up helps gauge the best value for the index build parameters, balancing accuracy with queries per second (QPS).</li>\n</ol>\n<h2 id=\"going-into-production\" class=\"group scroll-mt-24\">Going into production<a href=\"#going-into-production\" aria-hidden=\"true\" class=\"ml-2 opacity-0 group-hover:opacity-100 transition\"><span aria-hidden=\"true\">#</span></a></h2>\n<ol>\n<li>Decide if you are going to use indexes or not. You can skip the rest of this guide if you do not use indexes.</li>\n<li>Over-provision RAM during preparation. You can scale down in step <code>5</code>, but it's better to start with a larger size to get the best results for RAM requirements. (We'd recommend at least 8XL if you're using Supabase.)</li>\n<li>Upload your data to the database. If you use the <a href=\"/docs/guides/ai/python/api\"><code>vecs</code></a> library, it will automatically generate an index with default parameters.</li>\n<li>Run a benchmark using randomly generated queries and observe the results. Again, you can use the <code>vecs</code> library with the <code>ann-benchmarks</code> tool. Do it with default values for index build parameters, you can later adjust them to get the best results.</li>\n<li>Monitor the RAM usage, and save it as a note for yourself. You would likely want to use a compute add-on in the future that has the same amount of RAM that was used at the moment (both actual RAM usage and RAM used for cache and buffers).</li>\n<li>Scale down your compute add-on to the one that would have the same amount of RAM used at the moment.</li>\n<li>Repeat step 3 to load the data into RAM. You should see QPS increase on subsequent runs, and stop when it no longer increases.</li>\n<li>Run a benchmark using real queries and observe the results. You can use the <code>vecs</code> library for that as well with <code>ann-benchmarks</code> tool. Tweak <code>ef_search</code> for HNSW or <code>probes</code> for IVFFlat until you see that both accuracy and QPS match your requirements.</li>\n<li>If you want higher QPS you can increase <code>m</code> and <code>ef_construction</code> for HNSW or <code>lists</code> for IVFFlat parameters (consider switching from IVF to HNSW). You have to rebuild the index with a higher <code>m</code> and <code>ef_construction</code> values and repeat steps 6-7 to find the best combination of <code>m</code>, <code>ef_construction</code> and <code>ef_search</code> constants to achieve the best QPS and accuracy values. Higher <code>m</code>, <code>ef_construction</code> mean that index will build slower, but you can achieve better QPS and accuracy. Higher <code>ef_search</code> mean that select queries will be slower, but you can achieve better accuracy.</li>\n</ol>\n<h2 id=\"useful-links\" class=\"group scroll-mt-24\">Useful links<a href=\"#useful-links\" aria-hidden=\"true\" class=\"ml-2 opacity-0 group-hover:opacity-100 transition\"><span aria-hidden=\"true\">#</span></a></h2>\n<p>Don't forget to check out the general <a href=\"/docs/guides/platform/going-into-prod\">Production Checklist</a> to ensure your project is secure, performant, and will remain available for your users.</p>\n<p>You can look at our <a href=\"/docs/guides/ai/choosing-compute-addon\">Choosing Compute Add-on</a> guide to get a basic understanding of how much compute you might need for your workload.</p>\n<p>Or take a look at our <a href=\"https://supabase.com/blog/increase-performance-pgvector-hnsw\">pgvector 0.5.0 performance</a> and <a href=\"https://supabase.com/blog/pgvector-performance\">pgvector 0.4.0 performance</a> blog posts to see what pgvector is capable of and how the above technique can be used to achieve the best results.</p>\n<!-- --></article></div></div></div><!--$--><div class=\"max-w-7xl px-5 mx-auto py-8 pt-0\"></div><!--/$--></div><div class=\"left-0 right-0 z-10 backdrop-blur-sm backdrop-filter bg-alternative/90 hidden h-0 lg:hidden\"></div></div></main></div></div></div></div></body></html>",
      "metadata": {
        "ogUrl": "https://supabase.com/docs/guides/ai/going-to-prod",
        "title": "Going to Production | Supabase Docs",
        "robots": "index, follow",
        "ogImage": "https://obuldanrptloktxcffvn.supabase.co/functions/v1/og-images?site=docs&type=ai&title=Going%20to%20Production&description=Checklist%20for%20going%20to%20production%20with%20your%20AI%20application.",
        "ogTitle": "Going to Production | Supabase Docs",
        "language": "en",
        "sourceURL": "https://supabase.com/docs/guides/ai/going-to-prod",
        "description": "Checklist for going to production with your AI application.",
        "modifiedTime": "2024-09-10T20:36:24.564Z",
        "ogDescription": "Checklist for going to production with your AI application.",
        "publishedTime": "2024-09-10T20:36:24.564Z",
        "ogLocaleAlternate": [],
        "statusCode": 200
      }
    },
    {
      "markdown": "AI & Vectors\n\n# AI & Vectors\n\n## The best vector database is the database you already have.\n\n* * *\n\nSupabase provides an open source toolkit for developing AI applications using Postgres and pgvector. Use the Supabase client libraries to store, index, and query your vector embeddings at scale.\n\nThe toolkit includes:\n\n- A [vector store](/docs/guides/ai/vector-columns) and embeddings support using Postgres and pgvector.\n- A [Python client](/docs/guides/ai/vecs-python-client) for managing unstructured embeddings.\n- An [embedding generation](/docs/guides/ai/quickstarts/generate-text-embeddings) process using open source models directly in Edge Functions.\n- [Database migrations](/docs/guides/ai/examples/headless-vector-search#prepare-your-database) for managing structured embeddings.\n- Integrations with all popular AI providers, such as [OpenAI](/docs/guides/ai/examples/openai), [Hugging Face](/docs/guides/ai/hugging-face), [LangChain](/docs/guides/ai/langchain), and more.\n\nYou can use Supabase to build different types of search features for your app, including:\n\n- [Semantic search](/docs/guides/ai/semantic-search): search by meaning rather than exact keywords\n- [Keyword search](/docs/guides/ai/keyword-search): search by words or phrases\n- [Hybrid search](/docs/guides/ai/hybrid-search): combine semantic search with keyword search\n\n## Examples [\\#](\\#examples)\n\nCheck out all of the AI [templates and examples](https://github.com/supabase/supabase/tree/master/examples/ai) in our GitHub repository.\n\n[![Headless Vector Search](https://supabase.com/docs/img/icons/github-icon-light.svg)\\\\\n\\\\\nHeadless Vector Search\\\\\n\\\\\nA toolkit to perform vector similarity search on your knowledge base embeddings.](/docs/guides/ai/examples/headless-vector-search)\n\n[![Image Search with OpenAI CLIP](https://supabase.com/docs/img/icons/github-icon-light.svg)\\\\\n\\\\\nImage Search with OpenAI CLIP\\\\\n\\\\\nImplement image search with the OpenAI CLIP Model and Supabase Vector.](/docs/guides/ai/examples/image-search-openai-clip)\n\n[![Hugging Face inference](https://supabase.com/docs/img/icons/github-icon-light.svg)\\\\\n\\\\\nHugging Face inference\\\\\n\\\\\nGenerate image captions using Hugging Face.](/docs/guides/ai/examples/huggingface-image-captioning)\n\n[![OpenAI completions](https://supabase.com/docs/img/icons/github-icon-light.svg)\\\\\n\\\\\nOpenAI completions\\\\\n\\\\\nGenerate GPT text completions using OpenAI in Edge Functions.](/docs/guides/ai/examples/openai)\n\n[![Building ChatGPT Plugins](https://supabase.com/docs/img/icons/github-icon-light.svg)\\\\\n\\\\\nBuilding ChatGPT Plugins\\\\\n\\\\\nUse Supabase as a Retrieval Store for your ChatGPT plugin.](/docs/guides/ai/examples/building-chatgpt-plugins)\n\n[![Vector search with Next.js and OpenAI](https://supabase.com/docs/img/icons/github-icon-light.svg)\\\\\n\\\\\nVector search with Next.js and OpenAI\\\\\n\\\\\nLearn how to build a ChatGPT-style doc search powered by Next.js, OpenAI, and Supabase.](/docs/guides/ai/examples/nextjs-vector-search)\n\n## Integrations [\\#](\\#integrations)\n\n[OpenAI\\\\\n\\\\\nOpenAI is an AI research and deployment company. Supabase provides a simple way to use OpenAI in your applications.](/docs/guides/ai/examples/building-chatgpt-plugins)\n\n[Amazon Bedrock\\\\\n\\\\\nA fully managed service that offers a choice of high-performing foundation models from leading AI companies.](/docs/guides/ai/integrations/amazon-bedrock)\n\n[Hugging Face\\\\\n\\\\\nHugging Face is an open-source provider of NLP technologies. Supabase provides a simple way to use Hugging Face's models in your applications.](/docs/guides/ai/hugging-face)\n\n[LangChain\\\\\n\\\\\nLangChain is a language-agnostic, open-source, and self-hosted API for text translation, summarization, and sentiment analysis.](/docs/guides/ai/langchain)\n\n[LlamaIndex\\\\\n\\\\\nLlamaIndex is a data framework for your LLM applications.](/docs/guides/ai/integrations/llamaindex)\n\n## Case studies [\\#](\\#case-studies)\n\n[Berri AI Boosts Productivity by Migrating from AWS RDS to Supabase with pgvector\\\\\n\\\\\nLearn how Berri AI overcame challenges with self-hosting their vector database on AWS RDS and successfully migrated to Supabase.](https://supabase.com/customers/berriai)\n\n[Mendable switches from Pinecone to Supabase for PostgreSQL vector embeddings\\\\\n\\\\\nHow Mendable boosts efficiency and accuracy of chat powered search for documentation using Supabase with pgvector](https://supabase.com/customers/mendableai)\n\n[Markprompt: GDPR-Compliant AI Chatbots for Docs and Websites\\\\\n\\\\\nAI-powered chatbot platform, Markprompt, empowers developers to deliver efficient and GDPR-compliant prompt experiences on top of their content, by leveraging Supabase's secure and privacy-focused database and authentication solutions](https://supabase.com/customers/markprompt)",
      "html": "<!DOCTYPE html><html lang=\"en\" data-theme=\"light\" style=\"color-scheme: light;\"><body><div class=\"flex flex-col\"><div class=\"grow\"><div class=\"flex flex-col h-full w-full\"><div class=\"hidden lg:sticky w-full lg:flex top-0 left-0 right-0 z-50\"><!--$--><!--/$--></div><div class=\"flex flex-row h-full relative\"><main id=\"docs-content-container\" class=\"w-full transition-all ease-out relative lg:ml-0\"><div class=\"flex flex-col sticky top-0\"><div class=\"flex lg:hidden w-full top-0 left-0 right-0 z-50\"><!--$--><!--/$--></div><div class=\"sticky transition-all top-0 z-10 backdrop-blur backdrop-filter bg-background\"><div class=\"lg:hidden px-3.5 border-b z-10 transition-all ease-out top-0 flex items-center gap-1\"><button class=\"h-8 w-8 flex group items-center justify-center mr-1\"><div class=\"space-y-1 cursor-pointer relative w-4 h-[8px]\"><span class=\"transition-all ease-out block h-px bg-foreground-muted group-hover:bg-foreground w-4\"></span><span class=\"transition-all ease-out block h-px bg-foreground-muted group-hover:bg-foreground w-3 group-hover:w-4\"></span></div></button><span class=\"transition-all duration-200 text-foreground text-sm\">AI &amp; Vectors</span></div></div><div class=\"grow\"><div class=\"max-w-7xl px-5 mx-auto py-8 pb-0\"><div class=\"grid grid-cols-12 relative gap-4\"><div class=\"relative transition-all ease-out duration-100 col-span-12\"><article id=\"sb-docs-guide-main-article\" class=\"prose max-w-none\"><h1 class=\"mb-0\">AI &amp; Vectors</h1><h2 class=\"mt-3 text-xl text-foreground-light\">The best vector database is the database you already have.</h2><hr class=\"not-prose border-t-0 border-b my-8\"><p>Supabase provides an open source toolkit for developing AI applications using Postgres and pgvector. Use the Supabase client libraries to store, index, and query your vector embeddings at scale.</p>\n<p>The toolkit includes:</p>\n<ul>\n<li>A <a href=\"/docs/guides/ai/vector-columns\">vector store</a> and embeddings support using Postgres and pgvector.</li>\n<li>A <a href=\"/docs/guides/ai/vecs-python-client\">Python client</a> for managing unstructured embeddings.</li>\n<li>An <a href=\"/docs/guides/ai/quickstarts/generate-text-embeddings\">embedding generation</a> process using open source models directly in Edge Functions.</li>\n<li><a href=\"/docs/guides/ai/examples/headless-vector-search#prepare-your-database\">Database migrations</a> for managing structured embeddings.</li>\n<li>Integrations with all popular AI providers, such as <a href=\"/docs/guides/ai/examples/openai\">OpenAI</a>, <a href=\"/docs/guides/ai/hugging-face\">Hugging Face</a>, <a href=\"/docs/guides/ai/langchain\">LangChain</a>, and more.</li>\n</ul>\n\n<p>You can use Supabase to build different types of search features for your app, including:</p>\n<ul>\n<li><a href=\"/docs/guides/ai/semantic-search\">Semantic search</a>: search by meaning rather than exact keywords</li>\n<li><a href=\"/docs/guides/ai/keyword-search\">Keyword search</a>: search by words or phrases</li>\n<li><a href=\"/docs/guides/ai/hybrid-search\">Hybrid search</a>: combine semantic search with keyword search</li>\n</ul>\n<h2 id=\"examples\" class=\"group scroll-mt-24\">Examples<a href=\"#examples\" aria-hidden=\"true\" class=\"ml-2 opacity-0 group-hover:opacity-100 transition\"><span aria-hidden=\"true\">#</span></a></h2>\n<p>Check out all of the AI <a href=\"https://github.com/supabase/supabase/tree/master/examples/ai\">templates and examples</a> in our GitHub repository.</p>\n<!-- -->\n<div class=\"grid md:grid-cols-12 gap-4 not-prose\"><div class=\"col-span-4\"><a href=\"/docs/guides/ai/examples/headless-vector-search\"><div class=\"relative h-full group cursor-pointer overflow-hidden border rounded-lg text-left hover:border-strong bg-surface-75 transition\"><div class=\"px-8 pb-8 relative flex flex-col h-full gap-6 pt-8\"><div class=\"flex items-center gap-3\"><div class=\"shrink-0\"><img class=\"w-5\" alt=\"Headless Vector Search\" src=\"/docs/img/icons/github-icon-light.svg\"></div><p class=\"text-base text-foreground\">Headless Vector Search</p></div><span class=\"text-sm text-foreground-light flex-grow\">A toolkit to perform vector similarity search on your knowledge base embeddings.</span></div></div></a></div><div class=\"col-span-4\"><a href=\"/docs/guides/ai/examples/image-search-openai-clip\"><div class=\"relative h-full group cursor-pointer overflow-hidden border rounded-lg text-left hover:border-strong bg-surface-75 transition\"><div class=\"px-8 pb-8 relative flex flex-col h-full gap-6 pt-8\"><div class=\"flex items-center gap-3\"><div class=\"shrink-0\"><img class=\"w-5\" alt=\"Image Search with OpenAI CLIP\" src=\"/docs/img/icons/github-icon-light.svg\"></div><p class=\"text-base text-foreground\">Image Search with OpenAI CLIP</p></div><span class=\"text-sm text-foreground-light flex-grow\">Implement image search with the OpenAI CLIP Model and Supabase Vector.</span></div></div></a></div><div class=\"col-span-4\"><a href=\"/docs/guides/ai/examples/huggingface-image-captioning\"><div class=\"relative h-full group cursor-pointer overflow-hidden border rounded-lg text-left hover:border-strong bg-surface-75 transition\"><div class=\"px-8 pb-8 relative flex flex-col h-full gap-6 pt-8\"><div class=\"flex items-center gap-3\"><div class=\"shrink-0\"><img class=\"w-5\" alt=\"Hugging Face inference\" src=\"/docs/img/icons/github-icon-light.svg\"></div><p class=\"text-base text-foreground\">Hugging Face inference</p></div><span class=\"text-sm text-foreground-light flex-grow\">Generate image captions using Hugging Face.</span></div></div></a></div><div class=\"col-span-4\"><a href=\"/docs/guides/ai/examples/openai\"><div class=\"relative h-full group cursor-pointer overflow-hidden border rounded-lg text-left hover:border-strong bg-surface-75 transition\"><div class=\"px-8 pb-8 relative flex flex-col h-full gap-6 pt-8\"><div class=\"flex items-center gap-3\"><div class=\"shrink-0\"><img class=\"w-5\" alt=\"OpenAI completions\" src=\"/docs/img/icons/github-icon-light.svg\"></div><p class=\"text-base text-foreground\">OpenAI completions</p></div><span class=\"text-sm text-foreground-light flex-grow\">Generate GPT text completions using OpenAI in Edge Functions.</span></div></div></a></div><div class=\"col-span-4\"><a href=\"/docs/guides/ai/examples/building-chatgpt-plugins\"><div class=\"relative h-full group cursor-pointer overflow-hidden border rounded-lg text-left hover:border-strong bg-surface-75 transition\"><div class=\"px-8 pb-8 relative flex flex-col h-full gap-6 pt-8\"><div class=\"flex items-center gap-3\"><div class=\"shrink-0\"><img class=\"w-5\" alt=\"Building ChatGPT Plugins\" src=\"/docs/img/icons/github-icon-light.svg\"></div><p class=\"text-base text-foreground\">Building ChatGPT Plugins</p></div><span class=\"text-sm text-foreground-light flex-grow\">Use Supabase as a Retrieval Store for your ChatGPT plugin.</span></div></div></a></div><div class=\"col-span-4\"><a href=\"/docs/guides/ai/examples/nextjs-vector-search\"><div class=\"relative h-full group cursor-pointer overflow-hidden border rounded-lg text-left hover:border-strong bg-surface-75 transition\"><div class=\"px-8 pb-8 relative flex flex-col h-full gap-6 pt-8\"><div class=\"flex items-center gap-3\"><div class=\"shrink-0\"><img class=\"w-5\" alt=\"Vector search with Next.js and OpenAI\" src=\"/docs/img/icons/github-icon-light.svg\"></div><p class=\"text-base text-foreground\">Vector search with Next.js and OpenAI</p></div><span class=\"text-sm text-foreground-light flex-grow\">Learn how to build a ChatGPT-style doc search powered by Next.js, OpenAI, and Supabase.</span></div></div></a></div></div>\n<!-- -->\n<!-- -->\n<h2 id=\"integrations\" class=\"group scroll-mt-24\">Integrations<a href=\"#integrations\" aria-hidden=\"true\" class=\"ml-2 opacity-0 group-hover:opacity-100 transition\"><span aria-hidden=\"true\">#</span></a></h2>\n<!-- -->\n<div class=\"grid md:grid-cols-12 gap-4 not-prose\"><div class=\"col-span-4\"><a href=\"/docs/guides/ai/examples/building-chatgpt-plugins\"><div class=\"relative h-full group cursor-pointer overflow-hidden border rounded-lg text-left hover:border-strong bg-surface-75 transition\"><div class=\"px-8 pb-8 relative flex flex-col h-full gap-2 pt-8\"><div class=\"flex items-center gap-3\"><p class=\"text-base text-foreground\">OpenAI</p></div><span class=\"text-sm text-foreground-light flex-grow\">OpenAI is an AI research and deployment company. Supabase provides a simple way to use OpenAI in your applications.</span></div></div></a></div><div class=\"col-span-4\"><a href=\"/docs/guides/ai/integrations/amazon-bedrock\"><div class=\"relative h-full group cursor-pointer overflow-hidden border rounded-lg text-left hover:border-strong bg-surface-75 transition\"><div class=\"px-8 pb-8 relative flex flex-col h-full gap-2 pt-8\"><div class=\"flex items-center gap-3\"><p class=\"text-base text-foreground\">Amazon Bedrock</p></div><span class=\"text-sm text-foreground-light flex-grow\">A fully managed service that offers a choice of high-performing foundation models from leading AI companies.</span></div></div></a></div><div class=\"col-span-4\"><a href=\"/docs/guides/ai/hugging-face\"><div class=\"relative h-full group cursor-pointer overflow-hidden border rounded-lg text-left hover:border-strong bg-surface-75 transition\"><div class=\"px-8 pb-8 relative flex flex-col h-full gap-2 pt-8\"><div class=\"flex items-center gap-3\"><p class=\"text-base text-foreground\">Hugging Face</p></div><span class=\"text-sm text-foreground-light flex-grow\">Hugging Face is an open-source provider of NLP technologies. Supabase provides a simple way to use Hugging Face's models in your applications.</span></div></div></a></div><div class=\"col-span-4\"><a href=\"/docs/guides/ai/langchain\"><div class=\"relative h-full group cursor-pointer overflow-hidden border rounded-lg text-left hover:border-strong bg-surface-75 transition\"><div class=\"px-8 pb-8 relative flex flex-col h-full gap-2 pt-8\"><div class=\"flex items-center gap-3\"><p class=\"text-base text-foreground\">LangChain</p></div><span class=\"text-sm text-foreground-light flex-grow\">LangChain is a language-agnostic, open-source, and self-hosted API for text translation, summarization, and sentiment analysis.</span></div></div></a></div><div class=\"col-span-4\"><a href=\"/docs/guides/ai/integrations/llamaindex\"><div class=\"relative h-full group cursor-pointer overflow-hidden border rounded-lg text-left hover:border-strong bg-surface-75 transition\"><div class=\"px-8 pb-8 relative flex flex-col h-full gap-2 pt-8\"><div class=\"flex items-center gap-3\"><p class=\"text-base text-foreground\">LlamaIndex</p></div><span class=\"text-sm text-foreground-light flex-grow\">LlamaIndex is a data framework for your LLM applications.</span></div></div></a></div></div>\n<!-- -->\n<!-- -->\n<h2 id=\"case-studies\" class=\"group scroll-mt-24\">Case studies<a href=\"#case-studies\" aria-hidden=\"true\" class=\"ml-2 opacity-0 group-hover:opacity-100 transition\"><span aria-hidden=\"true\">#</span></a></h2>\n<!-- -->\n<div class=\"grid md:grid-cols-12 gap-4 not-prose\"><div class=\"col-span-4\"><a href=\"https://supabase.com/customers/berriai\"><div class=\"relative h-full group cursor-pointer overflow-hidden border rounded-lg text-left hover:border-strong bg-surface-75 transition\"><div class=\"px-8 pb-8 relative flex flex-col h-full gap-2 pt-8\"><div class=\"flex items-center gap-3\"><p class=\"text-base text-foreground\">Berri AI Boosts Productivity by Migrating from AWS RDS to Supabase with pgvector</p></div><span class=\"text-sm text-foreground-light flex-grow\">Learn how Berri AI overcame challenges with self-hosting their vector database on AWS RDS and successfully migrated to Supabase.</span></div></div></a></div><div class=\"col-span-4\"><a href=\"https://supabase.com/customers/mendableai\"><div class=\"relative h-full group cursor-pointer overflow-hidden border rounded-lg text-left hover:border-strong bg-surface-75 transition\"><div class=\"px-8 pb-8 relative flex flex-col h-full gap-2 pt-8\"><div class=\"flex items-center gap-3\"><p class=\"text-base text-foreground\">Mendable switches from Pinecone to Supabase for PostgreSQL vector embeddings</p></div><span class=\"text-sm text-foreground-light flex-grow\">How Mendable boosts efficiency and accuracy of chat powered search for documentation using Supabase with pgvector</span></div></div></a></div><div class=\"col-span-4\"><a href=\"https://supabase.com/customers/markprompt\"><div class=\"relative h-full group cursor-pointer overflow-hidden border rounded-lg text-left hover:border-strong bg-surface-75 transition\"><div class=\"px-8 pb-8 relative flex flex-col h-full gap-2 pt-8\"><div class=\"flex items-center gap-3\"><p class=\"text-base text-foreground\">Markprompt: GDPR-Compliant AI Chatbots for Docs and Websites</p></div><span class=\"text-sm text-foreground-light flex-grow\">AI-powered chatbot platform, Markprompt, empowers developers to deliver efficient and GDPR-compliant prompt experiences on top of their content, by leveraging Supabase's secure and privacy-focused database and authentication solutions</span></div></div></a></div></div>\n<!-- --></article></div></div></div><!--$--><div class=\"max-w-7xl px-5 mx-auto py-8 pt-0\"></div><!--/$--></div><div class=\"left-0 right-0 z-10 backdrop-blur-sm backdrop-filter bg-alternative/90 hidden h-0 lg:hidden\"></div></div></main></div></div></div></div></body></html>",
      "metadata": {
        "ogUrl": "https://supabase.com/docs/guides/ai",
        "title": "AI & Vectors | Supabase Docs",
        "robots": "index, follow",
        "ogImage": "https://obuldanrptloktxcffvn.supabase.co/functions/v1/og-images?site=docs&type=ai&title=AI%20%26%20Vectors&description=The%20best%20vector%20database%20is%20the%20database%20you%20already%20have.",
        "ogTitle": "AI & Vectors | Supabase Docs",
        "language": "en",
        "sourceURL": "https://supabase.com/docs/guides/ai",
        "description": "The best vector database is the database you already have.",
        "modifiedTime": "2024-09-10T20:36:24.980Z",
        "ogDescription": "The best vector database is the database you already have.",
        "publishedTime": "2024-09-10T20:36:24.980Z",
        "ogLocaleAlternate": [],
        "statusCode": 200
      }
    }
  ]
}