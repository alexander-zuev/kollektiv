<!DOCTYPE html><html lang="en" data-theme="light" style="color-scheme: light;"><body><div class="flex flex-col"><div class="grow"><div class="flex flex-col h-full w-full"><div class="hidden lg:sticky w-full lg:flex top-0 left-0 right-0 z-50"></div><div class="flex flex-row h-full relative"><main id="docs-content-container" class="w-full transition-all ease-out relative lg:ml-0"><div class="flex flex-col sticky top-0"><div class="flex lg:hidden w-full top-0 left-0 right-0 z-50"></div><div class="sticky transition-all top-0 z-10 backdrop-blur backdrop-filter bg-background"><div class="lg:hidden px-3.5 border-b z-10 transition-all ease-out top-0 flex items-center gap-1"><button class="h-8 w-8 flex group items-center justify-center mr-1"><div class="space-y-1 cursor-pointer relative w-4 h-[8px]"><span class="transition-all ease-out block h-px bg-foreground-muted group-hover:bg-foreground w-4"></span><span class="transition-all ease-out block h-px bg-foreground-muted group-hover:bg-foreground w-3 group-hover:w-4"></span></div></button><span class="transition-all duration-200 text-foreground text-sm">AI &amp; Vectors</span></div></div><div class="grow"><div class="max-w-7xl px-5 mx-auto py-8 pb-0"><div class="grid grid-cols-12 relative gap-4"><div class="relative transition-all ease-out duration-100 col-span-12 md:col-span-9"><article id="sb-docs-guide-main-article" class="prose max-w-none"><h1 class="mb-0">Vector search with Next.js and OpenAI</h1><h2 class="mt-3 text-xl text-foreground-light">Learn how to build a ChatGPT-style doc search powered by Next.js, OpenAI, and Supabase.</h2><hr class="not-prose border-t-0 border-b my-8">
<p>While our <a href="/docs/guides/ai/examples/headless-vector-search">Headless Vector search</a> provides a toolkit for generative Q&amp;A, in this tutorial we'll go more in-depth, build a custom ChatGPT-like search experience from the ground-up using Next.js. You will:</p>
<ol>
<li>Convert your markdown into embeddings using OpenAI.</li>
<li>Store you embeddings in Postgres using pgvector.</li>
<li>Deploy a function for answering your users' questions.</li>
</ol>
<p>You can read our <a href="https://supabase.com/blog/chatgpt-supabase-docs">Supabase Clippy</a> blog post for a full example.</p>
<p>We assume that you have a Next.js project with a collection of <code>.mdx</code> files nested inside your <code>pages</code> directory. We will start developing locally with the Supabase CLI and then push our local database changes to our hosted Supabase project. You can find the <a href="https://github.com/supabase-community/nextjs-openai-doc-search">full Next.js example on GitHub</a>.</p>
<h2 id="create-a-project" class="group scroll-mt-24">Create a project<a href="#create-a-project" aria-hidden="true" class="ml-2 opacity-0 group-hover:opacity-100 transition"><span aria-hidden="true">#</span></a></h2>
<ol>
<li><a href="https://supabase.com/dashboard">Create a new project</a> in the Supabase Dashboard.</li>
<li>Enter your project details.</li>
<li>Wait for the new database to launch.</li>
</ol>
<h2 id="prepare-the-database" class="group scroll-mt-24">Prepare the database<a href="#prepare-the-database" aria-hidden="true" class="ml-2 opacity-0 group-hover:opacity-100 transition"><span aria-hidden="true">#</span></a></h2>
<p>Let's prepare the database schema. We can use the "OpenAI Vector Search" quickstart in the <a href="https://supabase.com/dashboard/project/_/sql">SQL Editor</a>, or you can copy/paste the SQL below and run it yourself.</p>
<div dir="ltr" data-orientation="horizontal" class="w-full justify-between space-y-4 "><div role="tablist" aria-orientation="horizontal" class=" flex items-center border-b border-secondary  overflow-auto whitespace-nowrap no-scrollbar mask-fadeout-right flex-wrap" tabindex="0" data-orientation="horizontal" style="outline:none"><button type="button" role="tab" aria-selected="true" aria-controls="radix-:Rae9jtsn7qb6ra:-content-dashboard" data-state="active" id="radix-:Rae9jtsn7qb6ra:-trigger-dashboard" class=" relative cursor-pointer text-foreground-lighter flex items-center space-x-2 text-center transition focus:outline-none focus-visible:ring focus-visible:ring-foreground-muted focus-visible:border-foreground-muted  text-sm leading-4 px-3 py-2  !text-foreground border-b-2 border-foreground " tabindex="-1" data-orientation="horizontal" data-radix-collection-item=""><span>Dashboard</span></button><button type="button" role="tab" aria-selected="false" aria-controls="radix-:Rae9jtsn7qb6ra:-content-sql" data-state="inactive" id="radix-:Rae9jtsn7qb6ra:-trigger-sql" class=" relative cursor-pointer text-foreground-lighter flex items-center space-x-2 text-center transition focus:outline-none focus-visible:ring focus-visible:ring-foreground-muted focus-visible:border-foreground-muted  text-sm leading-4 px-3 py-2  hover:text-foreground " tabindex="-1" data-orientation="horizontal" data-radix-collection-item=""><span>SQL</span></button></div><div data-state="active" data-orientation="horizontal" role="tabpanel" aria-labelledby="radix-:Rae9jtsn7qb6ra:-trigger-dashboard" id="radix-:Rae9jtsn7qb6ra:-content-dashboard" tabindex="0" class="focus:outline-none transition-height " style="animation-duration:0s"><ol>
<li>Go to the <a href="https://supabase.com/dashboard/project/_/sql">SQL Editor</a> page in the Dashboard.</li>
<li>Click <strong>OpenAI Vector Search</strong>.</li>
<li>Click <strong>Run</strong>.</li>
</ol></div><div data-state="inactive" data-orientation="horizontal" role="tabpanel" aria-labelledby="radix-:Rae9jtsn7qb6ra:-trigger-sql" hidden="" id="radix-:Rae9jtsn7qb6ra:-content-sql" tabindex="0" class="focus:outline-none transition-height "></div></div>
<h2 id="pre-process-the-knowledge-base-at-build-time" class="group scroll-mt-24">Pre-process the knowledge base at build time<a href="#pre-process-the-knowledge-base-at-build-time" aria-hidden="true" class="ml-2 opacity-0 group-hover:opacity-100 transition"><span aria-hidden="true">#</span></a></h2>
<p>With our database set up, we need to process and store all <code>.mdx</code> files in the <code>pages</code> directory. You can find the full script <a href="https://github.com/supabase-community/nextjs-openai-doc-search/blob/main/lib/generate-embeddings.ts">here</a>, or follow the steps below:</p>
<div class="py-8"><div class="relative pb-8 group"><div class=" absolute w-px left-[11px] pt-1 h-full "><div class=" absolute w-full h-full py-1 bg-border-control group-last:bg-transparent "></div></div><div class=" absolute left-0 flex gap-3 items-center not-prose "><div class="flex items-center gap-6"><div class="border bg-surface-100 border-control flex items-center justify-center rounded-full w-6 h-6 text-xs text-foreground font-normal font-mono dropshadow-sm ">1</div></div></div><div class="grid grid-cols-1 lg:grid-cols-12 lg:gap-10 lg:ml-12"><div class="col-span-5 ml-12 lg:ml-0"><h3 class="mt-0 text-foreground text-base">Generate Embeddings</h3><p>Create a new file <code>lib/generate-embeddings.ts</code> and copy the code over from <a href="https://github.com/supabase-community/nextjs-openai-doc-search/blob/main/lib/generate-embeddings.ts">GitHub</a>.</p></div><div class="col-span-7 not-prose"><div class="ch-codeblock not-prose " data-ch-theme="supabase"><div class="ch-code-wrapper ch-code" data-ch-measured="true"><code class="ch-code-scroll-parent" data-ch-lang="bash" style="width: 495.5px; height: 112px; position: relative; overflow: auto;"><div class="ch-code-scroll-content" style="position: absolute; top: 0px; left: 0px; transform-origin: left top; width: 808.5px; height: 95px; overflow: hidden;"><div style="position: absolute; top: 0px; left: 0px; transform: translateX(0px) translateY(19px) scale(1); transform-origin: left top; width: 808.5px; height: 57px;"><span class="ch-code-line-number" style="position: absolute; top: 0px; left: 0px; transform: translate(0px, 0px); width: 31.5px; opacity: 0.99;">1</span><div style="position: absolute; top: 0px; left: 0px; transform: translate(31.5px, 0px); width: 777px;"><div style="display: inline-block; width: 100%;"><span style="opacity: 0.99;"><span style="color: var(--ch-3);">curl </span><span style="color: var(--ch-2);">\</span></span><br></div></div><span class="ch-code-line-number" style="position: absolute; top: 0px; left: 0px; transform: translate(0px, 19px); width: 31.5px; opacity: 0.99;">2</span><div style="position: absolute; top: 0px; left: 0px; transform: translate(31.5px, 19px); width: 777px;"><div style="display: inline-block; width: 100%;"><span style="opacity: 0.99;"><span style="color: var(--ch-4);">https://raw.githubusercontent.com/supabase-community/nextjs-openai-doc-search/main/lib/generate-embeddings.ts </span><span style="color: var(--ch-2);">\</span></span><br></div></div><span class="ch-code-line-number" style="position: absolute; top: 0px; left: 0px; transform: translate(0px, 38px); width: 31.5px; opacity: 0.99;">3</span><div style="position: absolute; top: 0px; left: 0px; transform: translate(31.5px, 38px); width: 777px;"><div style="display: inline-block; width: 100%;"><span style="opacity: 0.99;"><span style="color: var(--ch-4);">-o </span><span style="color: var(--ch-8);">"lib/generate-embeddings.ts"</span></span><br></div></div></div></div></code><button type="button" title="Copy code" class="ch-code-button"><svg fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="1.6px" d="M8 16H6a2 2 0 01-2-2V6a2 2 0 012-2h8a2 2 0 012 2v2m-6 12h8a2 2 0 002-2v-8a2 2 0 00-2-2h-8a2 2 0 00-2 2v8a2 2 0 002 2z"></path></svg></button></div></div></div></div></div><div class="relative pb-8 group"><div class=" absolute w-px left-[11px] pt-1 h-full "><div class=" absolute w-full h-full py-1 bg-border-control group-last:bg-transparent "></div></div><div class=" absolute left-0 flex gap-3 items-center not-prose "><div class="flex items-center gap-6"><div class="border bg-surface-100 border-control flex items-center justify-center rounded-full w-6 h-6 text-xs text-foreground font-normal font-mono dropshadow-sm ">2</div></div></div><div class="grid grid-cols-1 lg:grid-cols-12 lg:gap-10 lg:ml-12"><div class="col-span-5 ml-12 lg:ml-0"><h3 class="mt-0 text-foreground text-base">Set up environment variables</h3><p>We need some environment variables to run the script. Add them to your <code>.env</code> file and make sure your <code>.env</code> file is not committed to source control!
You can get your local Supabase credentials by running <code>supabase status</code>.</p></div><div class="col-span-7 not-prose"><div class="ch-codeblock not-prose " data-ch-theme="supabase"><div class="ch-code-wrapper ch-code" data-ch-measured="true"><code class="ch-code-scroll-parent" data-ch-lang="bash" style="width: 495.5px; height: 154px; position: relative; overflow: auto;"><div class="ch-code-scroll-content" style="position: absolute; top: 0px; left: 0px; transform-origin: left top; width: 493.5px; height: 152px; overflow: hidden;"><div style="position: absolute; top: 0px; left: 0px; transform: translateX(0px) translateY(19px) scale(1); transform-origin: left top; width: 493.5px; height: 114px;"><span class="ch-code-line-number" style="position: absolute; top: 0px; left: 0px; transform: translate(0px, 0px); width: 31.5px; opacity: 0.99;">1</span><div style="position: absolute; top: 0px; left: 0px; transform: translate(31.5px, 0px); width: 434px;"><div style="display: inline-block; width: 100%;"><span style="opacity: 0.99;"><span style="color: var(--ch-4);">NEXT_PUBLIC_SUPABASE_URL</span><span style="color: var(--ch-7);">=</span></span><br></div></div><span class="ch-code-line-number" style="position: absolute; top: 0px; left: 0px; transform: translate(0px, 19px); width: 31.5px; opacity: 0.99;">2</span><div style="position: absolute; top: 0px; left: 0px; transform: translate(31.5px, 19px); width: 434px;"><div style="display: inline-block; width: 100%;"><span style="opacity: 0.99;"><span style="color: var(--ch-4);">NEXT_PUBLIC_SUPABASE_ANON_KEY</span><span style="color: var(--ch-7);">=</span></span><br></div></div><span class="ch-code-line-number" style="position: absolute; top: 0px; left: 0px; transform: translate(0px, 38px); width: 31.5px; opacity: 0.99;">3</span><div style="position: absolute; top: 0px; left: 0px; transform: translate(31.5px, 38px); width: 434px;"><div style="display: inline-block; width: 100%;"><span style="opacity: 0.99;"><span style="color: var(--ch-4);">SUPABASE_SERVICE_ROLE_KEY</span><span style="color: var(--ch-7);">=</span></span><br></div></div><span class="ch-code-line-number" style="position: absolute; top: 0px; left: 0px; transform: translate(0px, 57px); width: 31.5px; opacity: 0.99;">4</span><div style="position: absolute; top: 0px; left: 0px; transform: translate(31.5px, 57px); width: 434px;"><div style="display: inline-block; width: 100%;"><span style="opacity: 0.99;"><span style="color: var(--ch-4);"></span></span><br></div></div><span class="ch-code-line-number" style="position: absolute; top: 0px; left: 0px; transform: translate(0px, 76px); width: 31.5px; opacity: 0.99;">5</span><div style="position: absolute; top: 0px; left: 0px; transform: translate(31.5px, 76px); width: 434px;"><div style="display: inline-block; width: 100%;"><span style="opacity: 0.99;"><span style="color: var(--ch-1);"># Get your key at https://platform.openai.com/account/api-keys</span></span><br></div></div><span class="ch-code-line-number" style="position: absolute; top: 0px; left: 0px; transform: translate(0px, 95px); width: 31.5px; opacity: 0.99;">6</span><div style="position: absolute; top: 0px; left: 0px; transform: translate(31.5px, 95px); width: 434px;"><div style="display: inline-block; width: 100%;"><span style="opacity: 0.99;"><span style="color: var(--ch-4);">OPENAI_API_KEY</span><span style="color: var(--ch-7);">=</span></span><br></div></div></div></div></code><button type="button" title="Copy code" class="ch-code-button"><svg fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="1.6px" d="M8 16H6a2 2 0 01-2-2V6a2 2 0 012-2h8a2 2 0 012 2v2m-6 12h8a2 2 0 002-2v-8a2 2 0 00-2-2h-8a2 2 0 00-2 2v8a2 2 0 002 2z"></path></svg></button></div></div></div></div></div><div class="relative pb-8 group"><div class=" absolute w-px left-[11px] pt-1 h-full "><div class=" absolute w-full h-full py-1 bg-border-control group-last:bg-transparent "></div></div><div class=" absolute left-0 flex gap-3 items-center not-prose "><div class="flex items-center gap-6"><div class="border bg-surface-100 border-control flex items-center justify-center rounded-full w-6 h-6 text-xs text-foreground font-normal font-mono dropshadow-sm ">3</div></div></div><div class="grid grid-cols-1 lg:grid-cols-12 lg:gap-10 lg:ml-12"><div class="col-span-5 ml-12 lg:ml-0"><h3 class="mt-0 text-foreground text-base">Run script at build time</h3><p>Include the script in your <code>package.json</code> script commands to enable Vercel to automaticall run it at build time.</p></div><div class="col-span-7 not-prose"><div class="ch-codeblock not-prose " data-ch-theme="supabase"><div class="ch-code-wrapper ch-code" data-ch-measured="true"><code class="ch-code-scroll-parent" data-ch-lang="json" style="width: 495.5px; height: 154px; position: relative; overflow: auto;"><div class="ch-code-scroll-content" style="position: absolute; top: 0px; left: 0px; transform-origin: left top; width: 493.5px; height: 152px; overflow: hidden;"><div style="position: absolute; top: 0px; left: 0px; transform: translateX(0px) translateY(19px) scale(1); transform-origin: left top; width: 493.5px; height: 114px;"><span class="ch-code-line-number" style="position: absolute; top: 0px; left: 0px; transform: translate(0px, 0px); width: 31.5px; opacity: 0.99;">1</span><div style="position: absolute; top: 0px; left: 0px; transform: translate(31.5px, 0px); width: 336px;"><div style="display: inline-block; width: 100%;"><span style="opacity: 0.99;"><span style="color: var(--ch-8);">"scripts"</span><span style="color: var(--ch-4);">: {</span></span><br></div></div><span class="ch-code-line-number" style="position: absolute; top: 0px; left: 0px; transform: translate(0px, 19px); width: 31.5px; opacity: 0.99;">2</span><div style="position: absolute; top: 0px; left: 0px; transform: translate(31.5px, 19px); width: 336px;"><div style="display: inline-block; width: 100%;"><span style="opacity: 0.99;"><span style="color: var(--ch-6);">  "dev"</span><span style="color: var(--ch-4);">: </span><span style="color: var(--ch-8);">"next dev"</span><span style="color: var(--ch-4);">,</span></span><br></div></div><span class="ch-code-line-number" style="position: absolute; top: 0px; left: 0px; transform: translate(0px, 38px); width: 31.5px; opacity: 0.99;">3</span><div style="position: absolute; top: 0px; left: 0px; transform: translate(31.5px, 38px); width: 336px;"><div style="display: inline-block; width: 100%;"><span style="opacity: 0.99;"><span style="color: var(--ch-6);">  "build"</span><span style="color: var(--ch-4);">: </span><span style="color: var(--ch-8);">"pnpm run embeddings &amp;&amp; next build"</span><span style="color: var(--ch-4);">,</span></span><br></div></div><span class="ch-code-line-number" style="position: absolute; top: 0px; left: 0px; transform: translate(0px, 57px); width: 31.5px; opacity: 0.99;">4</span><div style="position: absolute; top: 0px; left: 0px; transform: translate(31.5px, 57px); width: 336px;"><div style="display: inline-block; width: 100%;"><span style="opacity: 0.99;"><span style="color: var(--ch-6);">  "start"</span><span style="color: var(--ch-4);">: </span><span style="color: var(--ch-8);">"next start"</span><span style="color: var(--ch-4);">,</span></span><br></div></div><span class="ch-code-line-number" style="position: absolute; top: 0px; left: 0px; transform: translate(0px, 76px); width: 31.5px; opacity: 0.99;">5</span><div style="position: absolute; top: 0px; left: 0px; transform: translate(31.5px, 76px); width: 336px;"><div style="display: inline-block; width: 100%;"><span style="opacity: 0.99;"><span style="color: var(--ch-6);">  "embeddings"</span><span style="color: var(--ch-4);">: </span><span style="color: var(--ch-8);">"tsx lib/generate-embeddings.ts"</span></span><br></div></div><span class="ch-code-line-number" style="position: absolute; top: 0px; left: 0px; transform: translate(0px, 95px); width: 31.5px; opacity: 0.99;">6</span><div style="position: absolute; top: 0px; left: 0px; transform: translate(31.5px, 95px); width: 336px;"><div style="display: inline-block; width: 100%;"><span style="opacity: 0.99;"><span style="color: var(--ch-4);">},</span></span><br></div></div></div></div></code><button type="button" title="Copy code" class="ch-code-button"><svg fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="1.6px" d="M8 16H6a2 2 0 01-2-2V6a2 2 0 012-2h8a2 2 0 012 2v2m-6 12h8a2 2 0 002-2v-8a2 2 0 00-2-2h-8a2 2 0 00-2 2v8a2 2 0 002 2z"></path></svg></button></div></div></div></div></div></div>
<h2 id="create-text-completion-with-openai-api" class="group scroll-mt-24">Create text completion with OpenAI API<a href="#create-text-completion-with-openai-api" aria-hidden="true" class="ml-2 opacity-0 group-hover:opacity-100 transition"><span aria-hidden="true">#</span></a></h2>
<p>Anytime a user asks a question, we need to create an embedding for their question, perform a similarity search, and then send a text completion request to the OpenAI API with the query and then context content merged together into a prompt.</p>
<p>All of this is glued together in a <a href="https://vercel.com/docs/concepts/functions/edge-functions">Vercel Edge Function</a>, the code for which can be found on <a href="https://github.com/supabase-community/nextjs-openai-doc-search/blob/main/pages/api/vector-search.ts">GitHub</a>.</p>
<div class="py-8"><div class="relative pb-8 group"><div class=" absolute w-px left-[11px] pt-1 h-full "><div class=" absolute w-full h-full py-1 bg-border-control group-last:bg-transparent "></div></div><div class=" absolute left-0 flex gap-3 items-center not-prose "><div class="flex items-center gap-6"><div class="border bg-surface-100 border-control flex items-center justify-center rounded-full w-6 h-6 text-xs text-foreground font-normal font-mono dropshadow-sm ">1</div></div></div><div class="grid grid-cols-1 lg:grid-cols-12 lg:gap-10 lg:ml-12"><div class="col-span-5 ml-12 lg:ml-0"><h3 class="mt-0 text-foreground text-base">Create Embedding for Question</h3><p>In order to perform similarity search we need to turn the question into an embedding.</p></div><div class="col-span-7 not-prose"><div class="ch-codeblock not-prose " data-ch-theme="supabase"><div class="ch-code-wrapper ch-code" data-ch-measured="true"><code class="ch-code-scroll-parent" data-ch-lang="ts" style="width: 495.5px; height: 416px; position: relative; overflow: auto;"><div class="ch-code-scroll-content" style="position: absolute; top: 0px; left: 0px; transform-origin: left top; width: 661.5px; height: 399px; overflow: hidden;"><div style="position: absolute; top: 0px; left: 0px; transform: translateX(0px) translateY(19px) scale(1); transform-origin: left top; width: 661.5px; height: 361px;"><span class="ch-code-line-number" style="position: absolute; top: 0px; left: 0px; transform: translate(0px, 0px); width: 31.5px; opacity: 0.99;">1</span><div style="position: absolute; top: 0px; left: 0px; transform: translate(31.5px, 0px); width: 630px;"><div style="display: inline-block; width: 100%;"><span style="opacity: 0.99;"><span style="color: var(--ch-7);">const </span><span style="color: var(--ch-2);">embeddingResponse </span><span style="color: var(--ch-7);">= await </span><span style="color: var(--ch-5);">fetch</span><span style="color: var(--ch-4);">(</span><span style="color: var(--ch-8);">'https://api.openai.com/v1/embeddings'</span><span style="color: var(--ch-4);">, {</span></span><br></div></div><span class="ch-code-line-number" style="position: absolute; top: 0px; left: 0px; transform: translate(0px, 19px); width: 31.5px; opacity: 0.99;">2</span><div style="position: absolute; top: 0px; left: 0px; transform: translate(31.5px, 19px); width: 630px;"><div style="display: inline-block; width: 100%;"><span style="opacity: 0.99;"><span style="color: var(--ch-4);">  method: </span><span style="color: var(--ch-8);">'POST'</span><span style="color: var(--ch-4);">,</span></span><br></div></div><span class="ch-code-line-number" style="position: absolute; top: 0px; left: 0px; transform: translate(0px, 38px); width: 31.5px; opacity: 0.99;">3</span><div style="position: absolute; top: 0px; left: 0px; transform: translate(31.5px, 38px); width: 630px;"><div style="display: inline-block; width: 100%;"><span style="opacity: 0.99;"><span style="color: var(--ch-4);">  headers: {</span></span><br></div></div><span class="ch-code-line-number" style="position: absolute; top: 0px; left: 0px; transform: translate(0px, 57px); width: 31.5px; opacity: 0.99;">4</span><div style="position: absolute; top: 0px; left: 0px; transform: translate(31.5px, 57px); width: 630px;"><div style="display: inline-block; width: 100%;"><span style="opacity: 0.99;"><span style="color: var(--ch-4);">    Authorization: </span><span style="color: var(--ch-8);">`Bearer ${</span><span style="color: var(--ch-4);">openAiKey</span><span style="color: var(--ch-8);">}`</span><span style="color: var(--ch-4);">,</span></span><br></div></div><span class="ch-code-line-number" style="position: absolute; top: 0px; left: 0px; transform: translate(0px, 76px); width: 31.5px; opacity: 0.99;">5</span><div style="position: absolute; top: 0px; left: 0px; transform: translate(31.5px, 76px); width: 630px;"><div style="display: inline-block; width: 100%;"><span style="opacity: 0.99;"><span style="color: var(--ch-8);">    'Content-Type'</span><span style="color: var(--ch-4);">: </span><span style="color: var(--ch-8);">'application/json'</span><span style="color: var(--ch-4);">,</span></span><br></div></div><span class="ch-code-line-number" style="position: absolute; top: 0px; left: 0px; transform: translate(0px, 95px); width: 31.5px; opacity: 0.99;">6</span><div style="position: absolute; top: 0px; left: 0px; transform: translate(31.5px, 95px); width: 630px;"><div style="display: inline-block; width: 100%;"><span style="opacity: 0.99;"><span style="color: var(--ch-4);">  },</span></span><br></div></div><span class="ch-code-line-number" style="position: absolute; top: 0px; left: 0px; transform: translate(0px, 114px); width: 31.5px; opacity: 0.99;">7</span><div style="position: absolute; top: 0px; left: 0px; transform: translate(31.5px, 114px); width: 630px;"><div style="display: inline-block; width: 100%;"><span style="opacity: 0.99;"><span style="color: var(--ch-4);">  body: </span><span style="color: var(--ch-2);">JSON</span><span style="color: var(--ch-4);">.</span><span style="color: var(--ch-5);">stringify</span><span style="color: var(--ch-4);">({</span></span><br></div></div><span class="ch-code-line-number" style="position: absolute; top: 0px; left: 0px; transform: translate(0px, 133px); width: 31.5px; opacity: 0.99;">8</span><div style="position: absolute; top: 0px; left: 0px; transform: translate(31.5px, 133px); width: 630px;"><div style="display: inline-block; width: 100%;"><span style="opacity: 0.99;"><span style="color: var(--ch-4);">    model: </span><span style="color: var(--ch-8);">'text-embedding-ada-002'</span><span style="color: var(--ch-4);">,</span></span><br></div></div><span class="ch-code-line-number" style="position: absolute; top: 0px; left: 0px; transform: translate(0px, 152px); width: 31.5px; opacity: 0.99;">9</span><div style="position: absolute; top: 0px; left: 0px; transform: translate(31.5px, 152px); width: 630px;"><div style="display: inline-block; width: 100%;"><span style="opacity: 0.99;"><span style="color: var(--ch-4);">    input: sanitizedQuery.</span><span style="color: var(--ch-5);">replaceAll</span><span style="color: var(--ch-4);">(</span><span style="color: var(--ch-8);">'</span><span style="color: var(--ch-2);">\n</span><span style="color: var(--ch-8);">'</span><span style="color: var(--ch-4);">, </span><span style="color: var(--ch-8);">' '</span><span style="color: var(--ch-4);">),</span></span><br></div></div><span class="ch-code-line-number" style="position: absolute; top: 0px; left: 0px; transform: translate(0px, 171px); width: 31.5px; opacity: 0.99;">10</span><div style="position: absolute; top: 0px; left: 0px; transform: translate(31.5px, 171px); width: 630px;"><div style="display: inline-block; width: 100%;"><span style="opacity: 0.99;"><span style="color: var(--ch-4);">  }),</span></span><br></div></div><span class="ch-code-line-number" style="position: absolute; top: 0px; left: 0px; transform: translate(0px, 190px); width: 31.5px; opacity: 0.99;">11</span><div style="position: absolute; top: 0px; left: 0px; transform: translate(31.5px, 190px); width: 630px;"><div style="display: inline-block; width: 100%;"><span style="opacity: 0.99;"><span style="color: var(--ch-4);">})</span></span><br></div></div><span class="ch-code-line-number" style="position: absolute; top: 0px; left: 0px; transform: translate(0px, 209px); width: 31.5px; opacity: 0.99;">12</span><div style="position: absolute; top: 0px; left: 0px; transform: translate(31.5px, 209px); width: 630px;"><div style="display: inline-block; width: 100%;"><span style="opacity: 0.99;"><span style="color: var(--ch-4);"></span></span><br></div></div><span class="ch-code-line-number" style="position: absolute; top: 0px; left: 0px; transform: translate(0px, 228px); width: 31.5px; opacity: 0.99;">13</span><div style="position: absolute; top: 0px; left: 0px; transform: translate(31.5px, 228px); width: 630px;"><div style="display: inline-block; width: 100%;"><span style="opacity: 0.99;"><span style="color: var(--ch-7);">if</span><span style="color: var(--ch-4);"> (embeddingResponse.status </span><span style="color: var(--ch-7);">!== </span><span style="color: var(--ch-2);">200</span><span style="color: var(--ch-4);">) {</span></span><br></div></div><span class="ch-code-line-number" style="position: absolute; top: 0px; left: 0px; transform: translate(0px, 247px); width: 31.5px; opacity: 0.99;">14</span><div style="position: absolute; top: 0px; left: 0px; transform: translate(31.5px, 247px); width: 630px;"><div style="display: inline-block; width: 100%;"><span style="opacity: 0.99;"><span style="color: var(--ch-7);">  throw new </span><span style="color: var(--ch-5);">ApplicationError</span><span style="color: var(--ch-4);">(</span><span style="color: var(--ch-8);">'Failed to create embedding for question'</span><span style="color: var(--ch-4);">, embeddingResponse)</span></span><br></div></div><span class="ch-code-line-number" style="position: absolute; top: 0px; left: 0px; transform: translate(0px, 266px); width: 31.5px; opacity: 0.99;">15</span><div style="position: absolute; top: 0px; left: 0px; transform: translate(31.5px, 266px); width: 630px;"><div style="display: inline-block; width: 100%;"><span style="opacity: 0.99;"><span style="color: var(--ch-4);">}</span></span><br></div></div><span class="ch-code-line-number" style="position: absolute; top: 0px; left: 0px; transform: translate(0px, 285px); width: 31.5px; opacity: 0.99;">16</span><div style="position: absolute; top: 0px; left: 0px; transform: translate(31.5px, 285px); width: 630px;"><div style="display: inline-block; width: 100%;"><span style="opacity: 0.99;"><span style="color: var(--ch-4);"></span></span><br></div></div><span class="ch-code-line-number" style="position: absolute; top: 0px; left: 0px; transform: translate(0px, 304px); width: 31.5px; opacity: 0.99;">17</span><div style="position: absolute; top: 0px; left: 0px; transform: translate(31.5px, 304px); width: 630px;"><div style="display: inline-block; width: 100%;"><span style="opacity: 0.99;"><span style="color: var(--ch-7);">const</span><span style="color: var(--ch-4);"> {</span></span><br></div></div><span class="ch-code-line-number" style="position: absolute; top: 0px; left: 0px; transform: translate(0px, 323px); width: 31.5px; opacity: 0.99;">18</span><div style="position: absolute; top: 0px; left: 0px; transform: translate(31.5px, 323px); width: 630px;"><div style="display: inline-block; width: 100%;"><span style="opacity: 0.99;"><span style="color: var(--ch-3);">  data</span><span style="color: var(--ch-4);">: [{ </span><span style="color: var(--ch-2);">embedding</span><span style="color: var(--ch-4);"> }],</span></span><br></div></div><span class="ch-code-line-number" style="position: absolute; top: 0px; left: 0px; transform: translate(0px, 342px); width: 31.5px; opacity: 0.99;">19</span><div style="position: absolute; top: 0px; left: 0px; transform: translate(31.5px, 342px); width: 630px;"><div style="display: inline-block; width: 100%;"><span style="opacity: 0.99;"><span style="color: var(--ch-4);">} </span><span style="color: var(--ch-7);">= await</span><span style="color: var(--ch-4);"> embeddingResponse.</span><span style="color: var(--ch-5);">json</span><span style="color: var(--ch-4);">()</span></span><br></div></div></div></div></code><button type="button" title="Copy code" class="ch-code-button"><svg fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="1.6px" d="M8 16H6a2 2 0 01-2-2V6a2 2 0 012-2h8a2 2 0 012 2v2m-6 12h8a2 2 0 002-2v-8a2 2 0 00-2-2h-8a2 2 0 00-2 2v8a2 2 0 002 2z"></path></svg></button></div></div></div></div></div><div class="relative pb-8 group"><div class=" absolute w-px left-[11px] pt-1 h-full "><div class=" absolute w-full h-full py-1 bg-border-control group-last:bg-transparent "></div></div><div class=" absolute left-0 flex gap-3 items-center not-prose "><div class="flex items-center gap-6"><div class="border bg-surface-100 border-control flex items-center justify-center rounded-full w-6 h-6 text-xs text-foreground font-normal font-mono dropshadow-sm ">2</div></div></div><div class="grid grid-cols-1 lg:grid-cols-12 lg:gap-10 lg:ml-12"><div class="col-span-5 ml-12 lg:ml-0"><h3 class="mt-0 text-foreground text-base">Perform similarity search</h3><p>Using the <code>embeddingResponse</code> we can now perform similarity search by performing an remote procedure call (RPC) to the database function we created earlier.</p></div><div class="col-span-7 not-prose"><div class="ch-codeblock not-prose " data-ch-theme="supabase"><div class="ch-code-wrapper ch-code" data-ch-measured="true"><code class="ch-code-scroll-parent" data-ch-lang="ts" style="width: 495.5px; height: 226px; position: relative; overflow: auto;"><div class="ch-code-scroll-content" style="position: absolute; top: 0px; left: 0px; transform-origin: left top; width: 556.5px; height: 209px; overflow: hidden;"><div style="position: absolute; top: 0px; left: 0px; transform: translateX(0px) translateY(19px) scale(1); transform-origin: left top; width: 556.5px; height: 171px;"><span class="ch-code-line-number" style="position: absolute; top: 0px; left: 0px; transform: translate(0px, 0px); width: 31.5px; opacity: 0.99;">1</span><div style="position: absolute; top: 0px; left: 0px; transform: translate(31.5px, 0px); width: 525px;"><div style="display: inline-block; width: 100%;"><span style="opacity: 0.99;"><span style="color: var(--ch-7);">const</span><span style="color: var(--ch-4);"> { </span><span style="color: var(--ch-3);">error</span><span style="color: var(--ch-4);">: </span><span style="color: var(--ch-2);">matchError</span><span style="color: var(--ch-4);">, </span><span style="color: var(--ch-3);">data</span><span style="color: var(--ch-4);">: </span><span style="color: var(--ch-2);">pageSections</span><span style="color: var(--ch-4);"> } </span><span style="color: var(--ch-7);">= await</span><span style="color: var(--ch-4);"> supabaseClient.</span><span style="color: var(--ch-5);">rpc</span><span style="color: var(--ch-4);">(</span></span><br></div></div><span class="ch-code-line-number" style="position: absolute; top: 0px; left: 0px; transform: translate(0px, 19px); width: 31.5px; opacity: 0.99;">2</span><div style="position: absolute; top: 0px; left: 0px; transform: translate(31.5px, 19px); width: 525px;"><div style="display: inline-block; width: 100%;"><span style="opacity: 0.99;"><span style="color: var(--ch-8);">  'match_page_sections'</span><span style="color: var(--ch-4);">,</span></span><br></div></div><span class="ch-code-line-number" style="position: absolute; top: 0px; left: 0px; transform: translate(0px, 38px); width: 31.5px; opacity: 0.99;">3</span><div style="position: absolute; top: 0px; left: 0px; transform: translate(31.5px, 38px); width: 525px;"><div style="display: inline-block; width: 100%;"><span style="opacity: 0.99;"><span style="color: var(--ch-4);">  {</span></span><br></div></div><span class="ch-code-line-number" style="position: absolute; top: 0px; left: 0px; transform: translate(0px, 57px); width: 31.5px; opacity: 0.99;">4</span><div style="position: absolute; top: 0px; left: 0px; transform: translate(31.5px, 57px); width: 525px;"><div style="display: inline-block; width: 100%;"><span style="opacity: 0.99;"><span style="color: var(--ch-4);">    embedding,</span></span><br></div></div><span class="ch-code-line-number" style="position: absolute; top: 0px; left: 0px; transform: translate(0px, 76px); width: 31.5px; opacity: 0.99;">5</span><div style="position: absolute; top: 0px; left: 0px; transform: translate(31.5px, 76px); width: 525px;"><div style="display: inline-block; width: 100%;"><span style="opacity: 0.99;"><span style="color: var(--ch-4);">    match_threshold: </span><span style="color: var(--ch-2);">0.78</span><span style="color: var(--ch-4);">,</span></span><br></div></div><span class="ch-code-line-number" style="position: absolute; top: 0px; left: 0px; transform: translate(0px, 95px); width: 31.5px; opacity: 0.99;">6</span><div style="position: absolute; top: 0px; left: 0px; transform: translate(31.5px, 95px); width: 525px;"><div style="display: inline-block; width: 100%;"><span style="opacity: 0.99;"><span style="color: var(--ch-4);">    match_count: </span><span style="color: var(--ch-2);">10</span><span style="color: var(--ch-4);">,</span></span><br></div></div><span class="ch-code-line-number" style="position: absolute; top: 0px; left: 0px; transform: translate(0px, 114px); width: 31.5px; opacity: 0.99;">7</span><div style="position: absolute; top: 0px; left: 0px; transform: translate(31.5px, 114px); width: 525px;"><div style="display: inline-block; width: 100%;"><span style="opacity: 0.99;"><span style="color: var(--ch-4);">    min_content_length: </span><span style="color: var(--ch-2);">50</span><span style="color: var(--ch-4);">,</span></span><br></div></div><span class="ch-code-line-number" style="position: absolute; top: 0px; left: 0px; transform: translate(0px, 133px); width: 31.5px; opacity: 0.99;">8</span><div style="position: absolute; top: 0px; left: 0px; transform: translate(31.5px, 133px); width: 525px;"><div style="display: inline-block; width: 100%;"><span style="opacity: 0.99;"><span style="color: var(--ch-4);">  }</span></span><br></div></div><span class="ch-code-line-number" style="position: absolute; top: 0px; left: 0px; transform: translate(0px, 152px); width: 31.5px; opacity: 0.99;">9</span><div style="position: absolute; top: 0px; left: 0px; transform: translate(31.5px, 152px); width: 525px;"><div style="display: inline-block; width: 100%;"><span style="opacity: 0.99;"><span style="color: var(--ch-4);">)</span></span><br></div></div></div></div></code><button type="button" title="Copy code" class="ch-code-button"><svg fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="1.6px" d="M8 16H6a2 2 0 01-2-2V6a2 2 0 012-2h8a2 2 0 012 2v2m-6 12h8a2 2 0 002-2v-8a2 2 0 00-2-2h-8a2 2 0 00-2 2v8a2 2 0 002 2z"></path></svg></button></div></div></div></div></div><div class="relative pb-8 group"><div class=" absolute w-px left-[11px] pt-1 h-full "><div class=" absolute w-full h-full py-1 bg-border-control group-last:bg-transparent "></div></div><div class=" absolute left-0 flex gap-3 items-center not-prose "><div class="flex items-center gap-6"><div class="border bg-surface-100 border-control flex items-center justify-center rounded-full w-6 h-6 text-xs text-foreground font-normal font-mono dropshadow-sm ">3</div></div></div><div class="grid grid-cols-1 lg:grid-cols-12 lg:gap-10 lg:ml-12"><div class="col-span-5 ml-12 lg:ml-0"><h3 class="mt-0 text-foreground text-base">Perform text completion request</h3><p>With the relevant content for the user's question identified, we can now build the prompt and make a text completion request via the OpenAI API.</p><p>If successful, the OpenAI API will respond with a <code>text/event-stream</code> response that we can simply forward to the client where we'll process the event stream to smoothly print the answer to the user.</p></div><div class="col-span-7 not-prose"><div class="ch-codeblock not-prose " data-ch-theme="supabase"><div class="ch-code-wrapper ch-code" data-ch-measured="true"><code class="ch-code-scroll-parent" data-ch-lang="ts" style="width: 495.5px; height: 967px; position: relative; overflow: auto;"><div class="ch-code-scroll-content" style="position: absolute; top: 0px; left: 0px; transform-origin: left top; width: 528.5px; height: 950px; overflow: hidden;"><div style="position: absolute; top: 0px; left: 0px; transform: translateX(0px) translateY(19px) scale(1); transform-origin: left top; width: 528.5px; height: 912px;"><span class="ch-code-line-number" style="position: absolute; top: 0px; left: 0px; transform: translate(0px, 0px); width: 31.5px; opacity: 0.99;">1</span><div style="position: absolute; top: 0px; left: 0px; transform: translate(31.5px, 0px); width: 497px;"><div style="display: inline-block; width: 100%;"><span style="opacity: 0.99;"><span style="color: var(--ch-7);">const </span><span style="color: var(--ch-2);">prompt </span><span style="color: var(--ch-7);">= </span><span style="color: var(--ch-5);">codeBlock</span><span style="color: var(--ch-8);">`</span></span><br></div></div><span class="ch-code-line-number" style="position: absolute; top: 0px; left: 0px; transform: translate(0px, 19px); width: 31.5px; opacity: 0.99;">2</span><div style="position: absolute; top: 0px; left: 0px; transform: translate(31.5px, 19px); width: 497px;"><div style="display: inline-block; width: 100%;"><span style="opacity: 0.99;"><span style="color: var(--ch-8);">  ${</span><span style="color: var(--ch-5);">oneLine</span><span style="color: var(--ch-8);">`</span></span><br></div></div><span class="ch-code-line-number" style="position: absolute; top: 0px; left: 0px; transform: translate(0px, 38px); width: 31.5px; opacity: 0.99;">3</span><div style="position: absolute; top: 0px; left: 0px; transform: translate(31.5px, 38px); width: 497px;"><div style="display: inline-block; width: 100%;"><span style="opacity: 0.99;"><span style="color: var(--ch-8);">    You are a very enthusiastic Supabase representative who loves</span></span><br></div></div><span class="ch-code-line-number" style="position: absolute; top: 0px; left: 0px; transform: translate(0px, 57px); width: 31.5px; opacity: 0.99;">4</span><div style="position: absolute; top: 0px; left: 0px; transform: translate(31.5px, 57px); width: 497px;"><div style="display: inline-block; width: 100%;"><span style="opacity: 0.99;"><span style="color: var(--ch-8);">    to help people! Given the following sections from the Supabase</span></span><br></div></div><span class="ch-code-line-number" style="position: absolute; top: 0px; left: 0px; transform: translate(0px, 76px); width: 31.5px; opacity: 0.99;">5</span><div style="position: absolute; top: 0px; left: 0px; transform: translate(31.5px, 76px); width: 497px;"><div style="display: inline-block; width: 100%;"><span style="opacity: 0.99;"><span style="color: var(--ch-8);">    documentation, answer the question using only that information,</span></span><br></div></div><span class="ch-code-line-number" style="position: absolute; top: 0px; left: 0px; transform: translate(0px, 95px); width: 31.5px; opacity: 0.99;">6</span><div style="position: absolute; top: 0px; left: 0px; transform: translate(31.5px, 95px); width: 497px;"><div style="display: inline-block; width: 100%;"><span style="opacity: 0.99;"><span style="color: var(--ch-8);">    outputted in markdown format. If you are unsure and the answer</span></span><br></div></div><span class="ch-code-line-number" style="position: absolute; top: 0px; left: 0px; transform: translate(0px, 114px); width: 31.5px; opacity: 0.99;">7</span><div style="position: absolute; top: 0px; left: 0px; transform: translate(31.5px, 114px); width: 497px;"><div style="display: inline-block; width: 100%;"><span style="opacity: 0.99;"><span style="color: var(--ch-8);">    is not explicitly written in the documentation, say</span></span><br></div></div><span class="ch-code-line-number" style="position: absolute; top: 0px; left: 0px; transform: translate(0px, 133px); width: 31.5px; opacity: 0.99;">8</span><div style="position: absolute; top: 0px; left: 0px; transform: translate(31.5px, 133px); width: 497px;"><div style="display: inline-block; width: 100%;"><span style="opacity: 0.99;"><span style="color: var(--ch-8);">    "Sorry, I don't know how to help with that."</span></span><br></div></div><span class="ch-code-line-number" style="position: absolute; top: 0px; left: 0px; transform: translate(0px, 152px); width: 31.5px; opacity: 0.99;">9</span><div style="position: absolute; top: 0px; left: 0px; transform: translate(31.5px, 152px); width: 497px;"><div style="display: inline-block; width: 100%;"><span style="opacity: 0.99;"><span style="color: var(--ch-8);">  `}</span></span><br></div></div><span class="ch-code-line-number" style="position: absolute; top: 0px; left: 0px; transform: translate(0px, 171px); width: 31.5px; opacity: 0.99;">10</span><div style="position: absolute; top: 0px; left: 0px; transform: translate(31.5px, 171px); width: 497px;"><div style="display: inline-block; width: 100%;"><span style="opacity: 0.99;"><span style="color: var(--ch-8);"></span></span><br></div></div><span class="ch-code-line-number" style="position: absolute; top: 0px; left: 0px; transform: translate(0px, 190px); width: 31.5px; opacity: 0.99;">11</span><div style="position: absolute; top: 0px; left: 0px; transform: translate(31.5px, 190px); width: 497px;"><div style="display: inline-block; width: 100%;"><span style="opacity: 0.99;"><span style="color: var(--ch-8);">  Context sections:</span></span><br></div></div><span class="ch-code-line-number" style="position: absolute; top: 0px; left: 0px; transform: translate(0px, 209px); width: 31.5px; opacity: 0.99;">12</span><div style="position: absolute; top: 0px; left: 0px; transform: translate(31.5px, 209px); width: 497px;"><div style="display: inline-block; width: 100%;"><span style="opacity: 0.99;"><span style="color: var(--ch-8);">  ${</span><span style="color: var(--ch-4);">contextText</span><span style="color: var(--ch-8);">}</span></span><br></div></div><span class="ch-code-line-number" style="position: absolute; top: 0px; left: 0px; transform: translate(0px, 228px); width: 31.5px; opacity: 0.99;">13</span><div style="position: absolute; top: 0px; left: 0px; transform: translate(31.5px, 228px); width: 497px;"><div style="display: inline-block; width: 100%;"><span style="opacity: 0.99;"><span style="color: var(--ch-8);"></span></span><br></div></div><span class="ch-code-line-number" style="position: absolute; top: 0px; left: 0px; transform: translate(0px, 247px); width: 31.5px; opacity: 0.99;">14</span><div style="position: absolute; top: 0px; left: 0px; transform: translate(31.5px, 247px); width: 497px;"><div style="display: inline-block; width: 100%;"><span style="opacity: 0.99;"><span style="color: var(--ch-8);">  Question: """</span></span><br></div></div><span class="ch-code-line-number" style="position: absolute; top: 0px; left: 0px; transform: translate(0px, 266px); width: 31.5px; opacity: 0.99;">15</span><div style="position: absolute; top: 0px; left: 0px; transform: translate(31.5px, 266px); width: 497px;"><div style="display: inline-block; width: 100%;"><span style="opacity: 0.99;"><span style="color: var(--ch-8);">  ${</span><span style="color: var(--ch-4);">sanitizedQuery</span><span style="color: var(--ch-8);">}</span></span><br></div></div><span class="ch-code-line-number" style="position: absolute; top: 0px; left: 0px; transform: translate(0px, 285px); width: 31.5px; opacity: 0.99;">16</span><div style="position: absolute; top: 0px; left: 0px; transform: translate(31.5px, 285px); width: 497px;"><div style="display: inline-block; width: 100%;"><span style="opacity: 0.99;"><span style="color: var(--ch-8);">  """</span></span><br></div></div><span class="ch-code-line-number" style="position: absolute; top: 0px; left: 0px; transform: translate(0px, 304px); width: 31.5px; opacity: 0.99;">17</span><div style="position: absolute; top: 0px; left: 0px; transform: translate(31.5px, 304px); width: 497px;"><div style="display: inline-block; width: 100%;"><span style="opacity: 0.99;"><span style="color: var(--ch-8);"></span></span><br></div></div><span class="ch-code-line-number" style="position: absolute; top: 0px; left: 0px; transform: translate(0px, 323px); width: 31.5px; opacity: 0.99;">18</span><div style="position: absolute; top: 0px; left: 0px; transform: translate(31.5px, 323px); width: 497px;"><div style="display: inline-block; width: 100%;"><span style="opacity: 0.99;"><span style="color: var(--ch-8);">  Answer as markdown (including related code snippets if available):</span></span><br></div></div><span class="ch-code-line-number" style="position: absolute; top: 0px; left: 0px; transform: translate(0px, 342px); width: 31.5px; opacity: 0.99;">19</span><div style="position: absolute; top: 0px; left: 0px; transform: translate(31.5px, 342px); width: 497px;"><div style="display: inline-block; width: 100%;"><span style="opacity: 0.99;"><span style="color: var(--ch-8);">`</span></span><br></div></div><span class="ch-code-line-number" style="position: absolute; top: 0px; left: 0px; transform: translate(0px, 361px); width: 31.5px; opacity: 0.99;">20</span><div style="position: absolute; top: 0px; left: 0px; transform: translate(31.5px, 361px); width: 497px;"><div style="display: inline-block; width: 100%;"><span style="opacity: 0.99;"><span style="color: var(--ch-4);"></span></span><br></div></div><span class="ch-code-line-number" style="position: absolute; top: 0px; left: 0px; transform: translate(0px, 380px); width: 31.5px; opacity: 0.99;">21</span><div style="position: absolute; top: 0px; left: 0px; transform: translate(31.5px, 380px); width: 497px;"><div style="display: inline-block; width: 100%;"><span style="opacity: 0.99;"><span style="color: var(--ch-7);">const </span><span style="color: var(--ch-2);">completionOptions</span><span style="color: var(--ch-7);">: </span><span style="color: var(--ch-3);">CreateCompletionRequest </span><span style="color: var(--ch-7);">=</span><span style="color: var(--ch-4);"> {</span></span><br></div></div><span class="ch-code-line-number" style="position: absolute; top: 0px; left: 0px; transform: translate(0px, 399px); width: 31.5px; opacity: 0.99;">22</span><div style="position: absolute; top: 0px; left: 0px; transform: translate(31.5px, 399px); width: 497px;"><div style="display: inline-block; width: 100%;"><span style="opacity: 0.99;"><span style="color: var(--ch-4);">  model: </span><span style="color: var(--ch-8);">'gpt-3.5-turbo-instruct'</span><span style="color: var(--ch-4);">,</span></span><br></div></div><span class="ch-code-line-number" style="position: absolute; top: 0px; left: 0px; transform: translate(0px, 418px); width: 31.5px; opacity: 0.99;">23</span><div style="position: absolute; top: 0px; left: 0px; transform: translate(31.5px, 418px); width: 497px;"><div style="display: inline-block; width: 100%;"><span style="opacity: 0.99;"><span style="color: var(--ch-4);">  prompt,</span></span><br></div></div><span class="ch-code-line-number" style="position: absolute; top: 0px; left: 0px; transform: translate(0px, 437px); width: 31.5px; opacity: 0.99;">24</span><div style="position: absolute; top: 0px; left: 0px; transform: translate(31.5px, 437px); width: 497px;"><div style="display: inline-block; width: 100%;"><span style="opacity: 0.99;"><span style="color: var(--ch-4);">  max_tokens: </span><span style="color: var(--ch-2);">512</span><span style="color: var(--ch-4);">,</span></span><br></div></div><span class="ch-code-line-number" style="position: absolute; top: 0px; left: 0px; transform: translate(0px, 456px); width: 31.5px; opacity: 0.99;">25</span><div style="position: absolute; top: 0px; left: 0px; transform: translate(31.5px, 456px); width: 497px;"><div style="display: inline-block; width: 100%;"><span style="opacity: 0.99;"><span style="color: var(--ch-4);">  temperature: </span><span style="color: var(--ch-2);">0</span><span style="color: var(--ch-4);">,</span></span><br></div></div><span class="ch-code-line-number" style="position: absolute; top: 0px; left: 0px; transform: translate(0px, 475px); width: 31.5px; opacity: 0.99;">26</span><div style="position: absolute; top: 0px; left: 0px; transform: translate(31.5px, 475px); width: 497px;"><div style="display: inline-block; width: 100%;"><span style="opacity: 0.99;"><span style="color: var(--ch-4);">  stream: </span><span style="color: var(--ch-2);">true</span><span style="color: var(--ch-4);">,</span></span><br></div></div><span class="ch-code-line-number" style="position: absolute; top: 0px; left: 0px; transform: translate(0px, 494px); width: 31.5px; opacity: 0.99;">27</span><div style="position: absolute; top: 0px; left: 0px; transform: translate(31.5px, 494px); width: 497px;"><div style="display: inline-block; width: 100%;"><span style="opacity: 0.99;"><span style="color: var(--ch-4);">}</span></span><br></div></div><span class="ch-code-line-number" style="position: absolute; top: 0px; left: 0px; transform: translate(0px, 513px); width: 31.5px; opacity: 0.99;">28</span><div style="position: absolute; top: 0px; left: 0px; transform: translate(31.5px, 513px); width: 497px;"><div style="display: inline-block; width: 100%;"><span style="opacity: 0.99;"><span style="color: var(--ch-4);"></span></span><br></div></div><span class="ch-code-line-number" style="position: absolute; top: 0px; left: 0px; transform: translate(0px, 532px); width: 31.5px; opacity: 0.99;">29</span><div style="position: absolute; top: 0px; left: 0px; transform: translate(31.5px, 532px); width: 497px;"><div style="display: inline-block; width: 100%;"><span style="opacity: 0.99;"><span style="color: var(--ch-7);">const </span><span style="color: var(--ch-2);">response </span><span style="color: var(--ch-7);">= await </span><span style="color: var(--ch-5);">fetch</span><span style="color: var(--ch-4);">(</span><span style="color: var(--ch-8);">'https://api.openai.com/v1/completions'</span><span style="color: var(--ch-4);">, {</span></span><br></div></div><span class="ch-code-line-number" style="position: absolute; top: 0px; left: 0px; transform: translate(0px, 551px); width: 31.5px; opacity: 0.99;">30</span><div style="position: absolute; top: 0px; left: 0px; transform: translate(31.5px, 551px); width: 497px;"><div style="display: inline-block; width: 100%;"><span style="opacity: 0.99;"><span style="color: var(--ch-4);">  method: </span><span style="color: var(--ch-8);">'POST'</span><span style="color: var(--ch-4);">,</span></span><br></div></div><span class="ch-code-line-number" style="position: absolute; top: 0px; left: 0px; transform: translate(0px, 570px); width: 31.5px; opacity: 0.99;">31</span><div style="position: absolute; top: 0px; left: 0px; transform: translate(31.5px, 570px); width: 497px;"><div style="display: inline-block; width: 100%;"><span style="opacity: 0.99;"><span style="color: var(--ch-4);">  headers: {</span></span><br></div></div><span class="ch-code-line-number" style="position: absolute; top: 0px; left: 0px; transform: translate(0px, 589px); width: 31.5px; opacity: 0.99;">32</span><div style="position: absolute; top: 0px; left: 0px; transform: translate(31.5px, 589px); width: 497px;"><div style="display: inline-block; width: 100%;"><span style="opacity: 0.99;"><span style="color: var(--ch-4);">    Authorization: </span><span style="color: var(--ch-8);">`Bearer ${</span><span style="color: var(--ch-4);">openAiKey</span><span style="color: var(--ch-8);">}`</span><span style="color: var(--ch-4);">,</span></span><br></div></div><span class="ch-code-line-number" style="position: absolute; top: 0px; left: 0px; transform: translate(0px, 608px); width: 31.5px; opacity: 0.99;">33</span><div style="position: absolute; top: 0px; left: 0px; transform: translate(31.5px, 608px); width: 497px;"><div style="display: inline-block; width: 100%;"><span style="opacity: 0.99;"><span style="color: var(--ch-8);">    'Content-Type'</span><span style="color: var(--ch-4);">: </span><span style="color: var(--ch-8);">'application/json'</span><span style="color: var(--ch-4);">,</span></span><br></div></div><span class="ch-code-line-number" style="position: absolute; top: 0px; left: 0px; transform: translate(0px, 627px); width: 31.5px; opacity: 0.99;">34</span><div style="position: absolute; top: 0px; left: 0px; transform: translate(31.5px, 627px); width: 497px;"><div style="display: inline-block; width: 100%;"><span style="opacity: 0.99;"><span style="color: var(--ch-4);">  },</span></span><br></div></div><span class="ch-code-line-number" style="position: absolute; top: 0px; left: 0px; transform: translate(0px, 646px); width: 31.5px; opacity: 0.99;">35</span><div style="position: absolute; top: 0px; left: 0px; transform: translate(31.5px, 646px); width: 497px;"><div style="display: inline-block; width: 100%;"><span style="opacity: 0.99;"><span style="color: var(--ch-4);">  body: </span><span style="color: var(--ch-2);">JSON</span><span style="color: var(--ch-4);">.</span><span style="color: var(--ch-5);">stringify</span><span style="color: var(--ch-4);">(completionOptions),</span></span><br></div></div><span class="ch-code-line-number" style="position: absolute; top: 0px; left: 0px; transform: translate(0px, 665px); width: 31.5px; opacity: 0.99;">36</span><div style="position: absolute; top: 0px; left: 0px; transform: translate(31.5px, 665px); width: 497px;"><div style="display: inline-block; width: 100%;"><span style="opacity: 0.99;"><span style="color: var(--ch-4);">})</span></span><br></div></div><span class="ch-code-line-number" style="position: absolute; top: 0px; left: 0px; transform: translate(0px, 684px); width: 31.5px; opacity: 0.99;">37</span><div style="position: absolute; top: 0px; left: 0px; transform: translate(31.5px, 684px); width: 497px;"><div style="display: inline-block; width: 100%;"><span style="opacity: 0.99;"><span style="color: var(--ch-4);"></span></span><br></div></div><span class="ch-code-line-number" style="position: absolute; top: 0px; left: 0px; transform: translate(0px, 703px); width: 31.5px; opacity: 0.99;">38</span><div style="position: absolute; top: 0px; left: 0px; transform: translate(31.5px, 703px); width: 497px;"><div style="display: inline-block; width: 100%;"><span style="opacity: 0.99;"><span style="color: var(--ch-7);">if</span><span style="color: var(--ch-4);"> (</span><span style="color: var(--ch-7);">!</span><span style="color: var(--ch-4);">response.ok) {</span></span><br></div></div><span class="ch-code-line-number" style="position: absolute; top: 0px; left: 0px; transform: translate(0px, 722px); width: 31.5px; opacity: 0.99;">39</span><div style="position: absolute; top: 0px; left: 0px; transform: translate(31.5px, 722px); width: 497px;"><div style="display: inline-block; width: 100%;"><span style="opacity: 0.99;"><span style="color: var(--ch-7);">  const </span><span style="color: var(--ch-2);">error </span><span style="color: var(--ch-7);">= await</span><span style="color: var(--ch-4);"> response.</span><span style="color: var(--ch-5);">json</span><span style="color: var(--ch-4);">()</span></span><br></div></div><span class="ch-code-line-number" style="position: absolute; top: 0px; left: 0px; transform: translate(0px, 741px); width: 31.5px; opacity: 0.99;">40</span><div style="position: absolute; top: 0px; left: 0px; transform: translate(31.5px, 741px); width: 497px;"><div style="display: inline-block; width: 100%;"><span style="opacity: 0.99;"><span style="color: var(--ch-7);">  throw new </span><span style="color: var(--ch-5);">ApplicationError</span><span style="color: var(--ch-4);">(</span><span style="color: var(--ch-8);">'Failed to generate completion'</span><span style="color: var(--ch-4);">, error)</span></span><br></div></div><span class="ch-code-line-number" style="position: absolute; top: 0px; left: 0px; transform: translate(0px, 760px); width: 31.5px; opacity: 0.99;">41</span><div style="position: absolute; top: 0px; left: 0px; transform: translate(31.5px, 760px); width: 497px;"><div style="display: inline-block; width: 100%;"><span style="opacity: 0.99;"><span style="color: var(--ch-4);">}</span></span><br></div></div><span class="ch-code-line-number" style="position: absolute; top: 0px; left: 0px; transform: translate(0px, 779px); width: 31.5px; opacity: 0.99;">42</span><div style="position: absolute; top: 0px; left: 0px; transform: translate(31.5px, 779px); width: 497px;"><div style="display: inline-block; width: 100%;"><span style="opacity: 0.99;"><span style="color: var(--ch-4);"></span></span><br></div></div><span class="ch-code-line-number" style="position: absolute; top: 0px; left: 0px; transform: translate(0px, 798px); width: 31.5px; opacity: 0.99;">43</span><div style="position: absolute; top: 0px; left: 0px; transform: translate(31.5px, 798px); width: 497px;"><div style="display: inline-block; width: 100%;"><span style="opacity: 0.99;"><span style="color: var(--ch-1);">// Proxy the streamed SSE response from OpenAI</span></span><br></div></div><span class="ch-code-line-number" style="position: absolute; top: 0px; left: 0px; transform: translate(0px, 817px); width: 31.5px; opacity: 0.99;">44</span><div style="position: absolute; top: 0px; left: 0px; transform: translate(31.5px, 817px); width: 497px;"><div style="display: inline-block; width: 100%;"><span style="opacity: 0.99;"><span style="color: var(--ch-7);">return new </span><span style="color: var(--ch-5);">Response</span><span style="color: var(--ch-4);">(response.body, {</span></span><br></div></div><span class="ch-code-line-number" style="position: absolute; top: 0px; left: 0px; transform: translate(0px, 836px); width: 31.5px; opacity: 0.99;">45</span><div style="position: absolute; top: 0px; left: 0px; transform: translate(31.5px, 836px); width: 497px;"><div style="display: inline-block; width: 100%;"><span style="opacity: 0.99;"><span style="color: var(--ch-4);">  headers: {</span></span><br></div></div><span class="ch-code-line-number" style="position: absolute; top: 0px; left: 0px; transform: translate(0px, 855px); width: 31.5px; opacity: 0.99;">46</span><div style="position: absolute; top: 0px; left: 0px; transform: translate(31.5px, 855px); width: 497px;"><div style="display: inline-block; width: 100%;"><span style="opacity: 0.99;"><span style="color: var(--ch-8);">    'Content-Type'</span><span style="color: var(--ch-4);">: </span><span style="color: var(--ch-8);">'text/event-stream'</span><span style="color: var(--ch-4);">,</span></span><br></div></div><span class="ch-code-line-number" style="position: absolute; top: 0px; left: 0px; transform: translate(0px, 874px); width: 31.5px; opacity: 0.99;">47</span><div style="position: absolute; top: 0px; left: 0px; transform: translate(31.5px, 874px); width: 497px;"><div style="display: inline-block; width: 100%;"><span style="opacity: 0.99;"><span style="color: var(--ch-4);">  },</span></span><br></div></div><span class="ch-code-line-number" style="position: absolute; top: 0px; left: 0px; transform: translate(0px, 893px); width: 31.5px; opacity: 0.99;">48</span><div style="position: absolute; top: 0px; left: 0px; transform: translate(31.5px, 893px); width: 497px;"><div style="display: inline-block; width: 100%;"><span style="opacity: 0.99;"><span style="color: var(--ch-4);">})</span></span><br></div></div></div></div></code><button type="button" title="Copy code" class="ch-code-button"><svg fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="1.6px" d="M8 16H6a2 2 0 01-2-2V6a2 2 0 012-2h8a2 2 0 012 2v2m-6 12h8a2 2 0 002-2v-8a2 2 0 00-2-2h-8a2 2 0 00-2 2v8a2 2 0 002 2z"></path></svg></button></div></div></div></div></div></div>
<h2 id="display-the-answer-on-the-frontend" class="group scroll-mt-24">Display the answer on the frontend<a href="#display-the-answer-on-the-frontend" aria-hidden="true" class="ml-2 opacity-0 group-hover:opacity-100 transition"><span aria-hidden="true">#</span></a></h2>
<p>In a last step, we need to process the event stream from the OpenAI API and print the answer to the user. The full code for this can be found on <a href="https://github.com/supabase-community/nextjs-openai-doc-search/blob/main/components/SearchDialog.tsx">GitHub</a>.</p>
<div class="ch-codeblock not-prose " data-ch-theme="supabase"><div class="ch-code-wrapper ch-code" data-ch-measured="true"><code class="ch-code-scroll-parent" data-ch-lang="ts" style="width: 926px; height: 1218px; position: relative; overflow: auto;"><div class="ch-code-scroll-content" style="position: absolute; top: 0px; left: 0px; transform-origin: left top; width: 924px; height: 1216px; overflow: hidden;"><div style="position: absolute; top: 0px; left: 0px; transform: translateX(0px) translateY(19px) scale(1); transform-origin: left top; width: 924px; height: 1178px;"><span class="ch-code-line-number" style="position: absolute; top: 0px; left: 0px; transform: translate(0px, 0px); width: 31.5px; opacity: 0.99;">1</span><div style="position: absolute; top: 0px; left: 0px; transform: translate(31.5px, 0px); width: 553px;"><div style="display: inline-block; width: 100%;"><span style="opacity: 0.99;"><span style="color: var(--ch-7);">const </span><span style="color: var(--ch-2);">handleConfirm </span><span style="color: var(--ch-7);">=</span><span style="color: var(--ch-4);"> React.</span><span style="color: var(--ch-5);">useCallback</span><span style="color: var(--ch-4);">(</span></span><br></div></div><span class="ch-code-line-number" style="position: absolute; top: 0px; left: 0px; transform: translate(0px, 19px); width: 31.5px; opacity: 0.99;">2</span><div style="position: absolute; top: 0px; left: 0px; transform: translate(31.5px, 19px); width: 553px;"><div style="display: inline-block; width: 100%;"><span style="opacity: 0.99;"><span style="color: var(--ch-7);">  async</span><span style="color: var(--ch-4);"> (</span><span style="color: var(--ch-3);">query</span><span style="color: var(--ch-7);">: </span><span style="color: var(--ch-2);">string</span><span style="color: var(--ch-4);">) </span><span style="color: var(--ch-7);">=&gt;</span><span style="color: var(--ch-4);"> {</span></span><br></div></div><span class="ch-code-line-number" style="position: absolute; top: 0px; left: 0px; transform: translate(0px, 38px); width: 31.5px; opacity: 0.99;">3</span><div style="position: absolute; top: 0px; left: 0px; transform: translate(31.5px, 38px); width: 553px;"><div style="display: inline-block; width: 100%;"><span style="opacity: 0.99;"><span style="color: var(--ch-5);">    setAnswer</span><span style="color: var(--ch-4);">(</span><span style="color: var(--ch-2);">undefined</span><span style="color: var(--ch-4);">)</span></span><br></div></div><span class="ch-code-line-number" style="position: absolute; top: 0px; left: 0px; transform: translate(0px, 57px); width: 31.5px; opacity: 0.99;">4</span><div style="position: absolute; top: 0px; left: 0px; transform: translate(31.5px, 57px); width: 553px;"><div style="display: inline-block; width: 100%;"><span style="opacity: 0.99;"><span style="color: var(--ch-5);">    setQuestion</span><span style="color: var(--ch-4);">(query)</span></span><br></div></div><span class="ch-code-line-number" style="position: absolute; top: 0px; left: 0px; transform: translate(0px, 76px); width: 31.5px; opacity: 0.99;">5</span><div style="position: absolute; top: 0px; left: 0px; transform: translate(31.5px, 76px); width: 553px;"><div style="display: inline-block; width: 100%;"><span style="opacity: 0.99;"><span style="color: var(--ch-5);">    setSearch</span><span style="color: var(--ch-4);">(</span><span style="color: var(--ch-8);">''</span><span style="color: var(--ch-4);">)</span></span><br></div></div><span class="ch-code-line-number" style="position: absolute; top: 0px; left: 0px; transform: translate(0px, 95px); width: 31.5px; opacity: 0.99;">6</span><div style="position: absolute; top: 0px; left: 0px; transform: translate(31.5px, 95px); width: 553px;"><div style="display: inline-block; width: 100%;"><span style="opacity: 0.99;"><span style="color: var(--ch-5);">    dispatchPromptData</span><span style="color: var(--ch-4);">({ index: promptIndex, answer: </span><span style="color: var(--ch-2);">undefined</span><span style="color: var(--ch-4);">, query })</span></span><br></div></div><span class="ch-code-line-number" style="position: absolute; top: 0px; left: 0px; transform: translate(0px, 114px); width: 31.5px; opacity: 0.99;">7</span><div style="position: absolute; top: 0px; left: 0px; transform: translate(31.5px, 114px); width: 553px;"><div style="display: inline-block; width: 100%;"><span style="opacity: 0.99;"><span style="color: var(--ch-5);">    setHasError</span><span style="color: var(--ch-4);">(</span><span style="color: var(--ch-2);">false</span><span style="color: var(--ch-4);">)</span></span><br></div></div><span class="ch-code-line-number" style="position: absolute; top: 0px; left: 0px; transform: translate(0px, 133px); width: 31.5px; opacity: 0.99;">8</span><div style="position: absolute; top: 0px; left: 0px; transform: translate(31.5px, 133px); width: 553px;"><div style="display: inline-block; width: 100%;"><span style="opacity: 0.99;"><span style="color: var(--ch-5);">    setIsLoading</span><span style="color: var(--ch-4);">(</span><span style="color: var(--ch-2);">true</span><span style="color: var(--ch-4);">)</span></span><br></div></div><span class="ch-code-line-number" style="position: absolute; top: 0px; left: 0px; transform: translate(0px, 152px); width: 31.5px; opacity: 0.99;">9</span><div style="position: absolute; top: 0px; left: 0px; transform: translate(31.5px, 152px); width: 553px;"><div style="display: inline-block; width: 100%;"><span style="opacity: 0.99;"><span style="color: var(--ch-4);"></span></span><br></div></div><span class="ch-code-line-number" style="position: absolute; top: 0px; left: 0px; transform: translate(0px, 171px); width: 31.5px; opacity: 0.99;">10</span><div style="position: absolute; top: 0px; left: 0px; transform: translate(31.5px, 171px); width: 553px;"><div style="display: inline-block; width: 100%;"><span style="opacity: 0.99;"><span style="color: var(--ch-7);">    const </span><span style="color: var(--ch-2);">eventSource </span><span style="color: var(--ch-7);">= new </span><span style="color: var(--ch-5);">SSE</span><span style="color: var(--ch-4);">(</span><span style="color: var(--ch-8);">`api/vector-search`</span><span style="color: var(--ch-4);">, {</span></span><br></div></div><span class="ch-code-line-number" style="position: absolute; top: 0px; left: 0px; transform: translate(0px, 190px); width: 31.5px; opacity: 0.99;">11</span><div style="position: absolute; top: 0px; left: 0px; transform: translate(31.5px, 190px); width: 553px;"><div style="display: inline-block; width: 100%;"><span style="opacity: 0.99;"><span style="color: var(--ch-4);">      headers: {</span></span><br></div></div><span class="ch-code-line-number" style="position: absolute; top: 0px; left: 0px; transform: translate(0px, 209px); width: 31.5px; opacity: 0.99;">12</span><div style="position: absolute; top: 0px; left: 0px; transform: translate(31.5px, 209px); width: 553px;"><div style="display: inline-block; width: 100%;"><span style="opacity: 0.99;"><span style="color: var(--ch-4);">        apikey: process.env.</span><span style="color: var(--ch-2);">NEXT_PUBLIC_SUPABASE_ANON_KEY </span><span style="color: var(--ch-7);">?? </span><span style="color: var(--ch-8);">''</span><span style="color: var(--ch-4);">,</span></span><br></div></div><span class="ch-code-line-number" style="position: absolute; top: 0px; left: 0px; transform: translate(0px, 228px); width: 31.5px; opacity: 0.99;">13</span><div style="position: absolute; top: 0px; left: 0px; transform: translate(31.5px, 228px); width: 553px;"><div style="display: inline-block; width: 100%;"><span style="opacity: 0.99;"><span style="color: var(--ch-4);">        Authorization: </span><span style="color: var(--ch-8);">`Bearer ${</span><span style="color: var(--ch-4);">process</span><span style="color: var(--ch-8);">.</span><span style="color: var(--ch-4);">env</span><span style="color: var(--ch-8);">.</span><span style="color: var(--ch-2);">NEXT_PUBLIC_SUPABASE_ANON_KEY</span><span style="color: var(--ch-8);">}`</span><span style="color: var(--ch-4);">,</span></span><br></div></div><span class="ch-code-line-number" style="position: absolute; top: 0px; left: 0px; transform: translate(0px, 247px); width: 31.5px; opacity: 0.99;">14</span><div style="position: absolute; top: 0px; left: 0px; transform: translate(31.5px, 247px); width: 553px;"><div style="display: inline-block; width: 100%;"><span style="opacity: 0.99;"><span style="color: var(--ch-8);">        'Content-Type'</span><span style="color: var(--ch-4);">: </span><span style="color: var(--ch-8);">'application/json'</span><span style="color: var(--ch-4);">,</span></span><br></div></div><span class="ch-code-line-number" style="position: absolute; top: 0px; left: 0px; transform: translate(0px, 266px); width: 31.5px; opacity: 0.99;">15</span><div style="position: absolute; top: 0px; left: 0px; transform: translate(31.5px, 266px); width: 553px;"><div style="display: inline-block; width: 100%;"><span style="opacity: 0.99;"><span style="color: var(--ch-4);">      },</span></span><br></div></div><span class="ch-code-line-number" style="position: absolute; top: 0px; left: 0px; transform: translate(0px, 285px); width: 31.5px; opacity: 0.99;">16</span><div style="position: absolute; top: 0px; left: 0px; transform: translate(31.5px, 285px); width: 553px;"><div style="display: inline-block; width: 100%;"><span style="opacity: 0.99;"><span style="color: var(--ch-4);">      payload: </span><span style="color: var(--ch-2);">JSON</span><span style="color: var(--ch-4);">.</span><span style="color: var(--ch-5);">stringify</span><span style="color: var(--ch-4);">({ query }),</span></span><br></div></div><span class="ch-code-line-number" style="position: absolute; top: 0px; left: 0px; transform: translate(0px, 304px); width: 31.5px; opacity: 0.99;">17</span><div style="position: absolute; top: 0px; left: 0px; transform: translate(31.5px, 304px); width: 553px;"><div style="display: inline-block; width: 100%;"><span style="opacity: 0.99;"><span style="color: var(--ch-4);">    })</span></span><br></div></div><span class="ch-code-line-number" style="position: absolute; top: 0px; left: 0px; transform: translate(0px, 323px); width: 31.5px; opacity: 0.99;">18</span><div style="position: absolute; top: 0px; left: 0px; transform: translate(31.5px, 323px); width: 553px;"><div style="display: inline-block; width: 100%;"><span style="opacity: 0.99;"><span style="color: var(--ch-4);"></span></span><br></div></div><span class="ch-code-line-number" style="position: absolute; top: 0px; left: 0px; transform: translate(0px, 342px); width: 31.5px; opacity: 0.99;">19</span><div style="position: absolute; top: 0px; left: 0px; transform: translate(31.5px, 342px); width: 553px;"><div style="display: inline-block; width: 100%;"><span style="opacity: 0.99;"><span style="color: var(--ch-7);">    function </span><span style="color: var(--ch-5);">handleError</span><span style="color: var(--ch-4);">&lt;</span><span style="color: var(--ch-3);">T</span><span style="color: var(--ch-4);">&gt;(</span><span style="color: var(--ch-3);">err</span><span style="color: var(--ch-7);">: </span><span style="color: var(--ch-3);">T</span><span style="color: var(--ch-4);">) {</span></span><br></div></div><span class="ch-code-line-number" style="position: absolute; top: 0px; left: 0px; transform: translate(0px, 361px); width: 31.5px; opacity: 0.99;">20</span><div style="position: absolute; top: 0px; left: 0px; transform: translate(31.5px, 361px); width: 553px;"><div style="display: inline-block; width: 100%;"><span style="opacity: 0.99;"><span style="color: var(--ch-5);">      setIsLoading</span><span style="color: var(--ch-4);">(</span><span style="color: var(--ch-2);">false</span><span style="color: var(--ch-4);">)</span></span><br></div></div><span class="ch-code-line-number" style="position: absolute; top: 0px; left: 0px; transform: translate(0px, 380px); width: 31.5px; opacity: 0.99;">21</span><div style="position: absolute; top: 0px; left: 0px; transform: translate(31.5px, 380px); width: 553px;"><div style="display: inline-block; width: 100%;"><span style="opacity: 0.99;"><span style="color: var(--ch-5);">      setHasError</span><span style="color: var(--ch-4);">(</span><span style="color: var(--ch-2);">true</span><span style="color: var(--ch-4);">)</span></span><br></div></div><span class="ch-code-line-number" style="position: absolute; top: 0px; left: 0px; transform: translate(0px, 399px); width: 31.5px; opacity: 0.99;">22</span><div style="position: absolute; top: 0px; left: 0px; transform: translate(31.5px, 399px); width: 553px;"><div style="display: inline-block; width: 100%;"><span style="opacity: 0.99;"><span style="color: var(--ch-4);">      console.</span><span style="color: var(--ch-5);">error</span><span style="color: var(--ch-4);">(err)</span></span><br></div></div><span class="ch-code-line-number" style="position: absolute; top: 0px; left: 0px; transform: translate(0px, 418px); width: 31.5px; opacity: 0.99;">23</span><div style="position: absolute; top: 0px; left: 0px; transform: translate(31.5px, 418px); width: 553px;"><div style="display: inline-block; width: 100%;"><span style="opacity: 0.99;"><span style="color: var(--ch-4);">    }</span></span><br></div></div><span class="ch-code-line-number" style="position: absolute; top: 0px; left: 0px; transform: translate(0px, 437px); width: 31.5px; opacity: 0.99;">24</span><div style="position: absolute; top: 0px; left: 0px; transform: translate(31.5px, 437px); width: 553px;"><div style="display: inline-block; width: 100%;"><span style="opacity: 0.99;"><span style="color: var(--ch-4);"></span></span><br></div></div><span class="ch-code-line-number" style="position: absolute; top: 0px; left: 0px; transform: translate(0px, 456px); width: 31.5px; opacity: 0.99;">25</span><div style="position: absolute; top: 0px; left: 0px; transform: translate(31.5px, 456px); width: 553px;"><div style="display: inline-block; width: 100%;"><span style="opacity: 0.99;"><span style="color: var(--ch-4);">    eventSource.</span><span style="color: var(--ch-5);">addEventListener</span><span style="color: var(--ch-4);">(</span><span style="color: var(--ch-8);">'error'</span><span style="color: var(--ch-4);">, handleError)</span></span><br></div></div><span class="ch-code-line-number" style="position: absolute; top: 0px; left: 0px; transform: translate(0px, 475px); width: 31.5px; opacity: 0.99;">26</span><div style="position: absolute; top: 0px; left: 0px; transform: translate(31.5px, 475px); width: 553px;"><div style="display: inline-block; width: 100%;"><span style="opacity: 0.99;"><span style="color: var(--ch-4);">    eventSource.</span><span style="color: var(--ch-5);">addEventListener</span><span style="color: var(--ch-4);">(</span><span style="color: var(--ch-8);">'message'</span><span style="color: var(--ch-4);">, (</span><span style="color: var(--ch-3);">e</span><span style="color: var(--ch-7);">: </span><span style="color: var(--ch-2);">any</span><span style="color: var(--ch-4);">) </span><span style="color: var(--ch-7);">=&gt;</span><span style="color: var(--ch-4);"> {</span></span><br></div></div><span class="ch-code-line-number" style="position: absolute; top: 0px; left: 0px; transform: translate(0px, 494px); width: 31.5px; opacity: 0.99;">27</span><div style="position: absolute; top: 0px; left: 0px; transform: translate(31.5px, 494px); width: 553px;"><div style="display: inline-block; width: 100%;"><span style="opacity: 0.99;"><span style="color: var(--ch-7);">      try</span><span style="color: var(--ch-4);"> {</span></span><br></div></div><span class="ch-code-line-number" style="position: absolute; top: 0px; left: 0px; transform: translate(0px, 513px); width: 31.5px; opacity: 0.99;">28</span><div style="position: absolute; top: 0px; left: 0px; transform: translate(31.5px, 513px); width: 553px;"><div style="display: inline-block; width: 100%;"><span style="opacity: 0.99;"><span style="color: var(--ch-5);">        setIsLoading</span><span style="color: var(--ch-4);">(</span><span style="color: var(--ch-2);">false</span><span style="color: var(--ch-4);">)</span></span><br></div></div><span class="ch-code-line-number" style="position: absolute; top: 0px; left: 0px; transform: translate(0px, 532px); width: 31.5px; opacity: 0.99;">29</span><div style="position: absolute; top: 0px; left: 0px; transform: translate(31.5px, 532px); width: 553px;"><div style="display: inline-block; width: 100%;"><span style="opacity: 0.99;"><span style="color: var(--ch-4);"></span></span><br></div></div><span class="ch-code-line-number" style="position: absolute; top: 0px; left: 0px; transform: translate(0px, 551px); width: 31.5px; opacity: 0.99;">30</span><div style="position: absolute; top: 0px; left: 0px; transform: translate(31.5px, 551px); width: 553px;"><div style="display: inline-block; width: 100%;"><span style="opacity: 0.99;"><span style="color: var(--ch-7);">        if</span><span style="color: var(--ch-4);"> (e.data </span><span style="color: var(--ch-7);">=== </span><span style="color: var(--ch-8);">'[DONE]'</span><span style="color: var(--ch-4);">) {</span></span><br></div></div><span class="ch-code-line-number" style="position: absolute; top: 0px; left: 0px; transform: translate(0px, 570px); width: 31.5px; opacity: 0.99;">31</span><div style="position: absolute; top: 0px; left: 0px; transform: translate(31.5px, 570px); width: 553px;"><div style="display: inline-block; width: 100%;"><span style="opacity: 0.99;"><span style="color: var(--ch-5);">          setPromptIndex</span><span style="color: var(--ch-4);">((</span><span style="color: var(--ch-3);">x</span><span style="color: var(--ch-4);">) </span><span style="color: var(--ch-7);">=&gt;</span><span style="color: var(--ch-4);"> {</span></span><br></div></div><span class="ch-code-line-number" style="position: absolute; top: 0px; left: 0px; transform: translate(0px, 589px); width: 31.5px; opacity: 0.99;">32</span><div style="position: absolute; top: 0px; left: 0px; transform: translate(31.5px, 589px); width: 553px;"><div style="display: inline-block; width: 100%;"><span style="opacity: 0.99;"><span style="color: var(--ch-7);">            return</span><span style="color: var(--ch-4);"> x </span><span style="color: var(--ch-7);">+ </span><span style="color: var(--ch-2);">1</span></span><br></div></div><span class="ch-code-line-number" style="position: absolute; top: 0px; left: 0px; transform: translate(0px, 608px); width: 31.5px; opacity: 0.99;">33</span><div style="position: absolute; top: 0px; left: 0px; transform: translate(31.5px, 608px); width: 553px;"><div style="display: inline-block; width: 100%;"><span style="opacity: 0.99;"><span style="color: var(--ch-4);">          })</span></span><br></div></div><span class="ch-code-line-number" style="position: absolute; top: 0px; left: 0px; transform: translate(0px, 627px); width: 31.5px; opacity: 0.99;">34</span><div style="position: absolute; top: 0px; left: 0px; transform: translate(31.5px, 627px); width: 553px;"><div style="display: inline-block; width: 100%;"><span style="opacity: 0.99;"><span style="color: var(--ch-7);">          return</span></span><br></div></div><span class="ch-code-line-number" style="position: absolute; top: 0px; left: 0px; transform: translate(0px, 646px); width: 31.5px; opacity: 0.99;">35</span><div style="position: absolute; top: 0px; left: 0px; transform: translate(31.5px, 646px); width: 553px;"><div style="display: inline-block; width: 100%;"><span style="opacity: 0.99;"><span style="color: var(--ch-4);">        }</span></span><br></div></div><span class="ch-code-line-number" style="position: absolute; top: 0px; left: 0px; transform: translate(0px, 665px); width: 31.5px; opacity: 0.99;">36</span><div style="position: absolute; top: 0px; left: 0px; transform: translate(31.5px, 665px); width: 553px;"><div style="display: inline-block; width: 100%;"><span style="opacity: 0.99;"><span style="color: var(--ch-4);"></span></span><br></div></div><span class="ch-code-line-number" style="position: absolute; top: 0px; left: 0px; transform: translate(0px, 684px); width: 31.5px; opacity: 0.99;">37</span><div style="position: absolute; top: 0px; left: 0px; transform: translate(31.5px, 684px); width: 553px;"><div style="display: inline-block; width: 100%;"><span style="opacity: 0.99;"><span style="color: var(--ch-7);">        const </span><span style="color: var(--ch-2);">completionResponse</span><span style="color: var(--ch-7);">: </span><span style="color: var(--ch-3);">CreateCompletionResponse </span><span style="color: var(--ch-7);">= </span><span style="color: var(--ch-2);">JSON</span><span style="color: var(--ch-4);">.</span><span style="color: var(--ch-5);">parse</span><span style="color: var(--ch-4);">(e.data)</span></span><br></div></div><span class="ch-code-line-number" style="position: absolute; top: 0px; left: 0px; transform: translate(0px, 703px); width: 31.5px; opacity: 0.99;">38</span><div style="position: absolute; top: 0px; left: 0px; transform: translate(31.5px, 703px); width: 553px;"><div style="display: inline-block; width: 100%;"><span style="opacity: 0.99;"><span style="color: var(--ch-7);">        const </span><span style="color: var(--ch-2);">text </span><span style="color: var(--ch-7);">=</span><span style="color: var(--ch-4);"> completionResponse.choices[</span><span style="color: var(--ch-2);">0</span><span style="color: var(--ch-4);">].text</span></span><br></div></div><span class="ch-code-line-number" style="position: absolute; top: 0px; left: 0px; transform: translate(0px, 722px); width: 31.5px; opacity: 0.99;">39</span><div style="position: absolute; top: 0px; left: 0px; transform: translate(31.5px, 722px); width: 553px;"><div style="display: inline-block; width: 100%;"><span style="opacity: 0.99;"><span style="color: var(--ch-4);"></span></span><br></div></div><span class="ch-code-line-number" style="position: absolute; top: 0px; left: 0px; transform: translate(0px, 741px); width: 31.5px; opacity: 0.99;">40</span><div style="position: absolute; top: 0px; left: 0px; transform: translate(31.5px, 741px); width: 553px;"><div style="display: inline-block; width: 100%;"><span style="opacity: 0.99;"><span style="color: var(--ch-5);">        setAnswer</span><span style="color: var(--ch-4);">((</span><span style="color: var(--ch-3);">answer</span><span style="color: var(--ch-4);">) </span><span style="color: var(--ch-7);">=&gt;</span><span style="color: var(--ch-4);"> {</span></span><br></div></div><span class="ch-code-line-number" style="position: absolute; top: 0px; left: 0px; transform: translate(0px, 760px); width: 31.5px; opacity: 0.99;">41</span><div style="position: absolute; top: 0px; left: 0px; transform: translate(31.5px, 760px); width: 553px;"><div style="display: inline-block; width: 100%;"><span style="opacity: 0.99;"><span style="color: var(--ch-7);">          const </span><span style="color: var(--ch-2);">currentAnswer </span><span style="color: var(--ch-7);">=</span><span style="color: var(--ch-4);"> answer </span><span style="color: var(--ch-7);">?? </span><span style="color: var(--ch-8);">''</span></span><br></div></div><span class="ch-code-line-number" style="position: absolute; top: 0px; left: 0px; transform: translate(0px, 779px); width: 31.5px; opacity: 0.99;">42</span><div style="position: absolute; top: 0px; left: 0px; transform: translate(31.5px, 779px); width: 553px;"><div style="display: inline-block; width: 100%;"><span style="opacity: 0.99;"><span style="color: var(--ch-4);"></span></span><br></div></div><span class="ch-code-line-number" style="position: absolute; top: 0px; left: 0px; transform: translate(0px, 798px); width: 31.5px; opacity: 0.99;">43</span><div style="position: absolute; top: 0px; left: 0px; transform: translate(31.5px, 798px); width: 553px;"><div style="display: inline-block; width: 100%;"><span style="opacity: 0.99;"><span style="color: var(--ch-5);">          dispatchPromptData</span><span style="color: var(--ch-4);">({</span></span><br></div></div><span class="ch-code-line-number" style="position: absolute; top: 0px; left: 0px; transform: translate(0px, 817px); width: 31.5px; opacity: 0.99;">44</span><div style="position: absolute; top: 0px; left: 0px; transform: translate(31.5px, 817px); width: 553px;"><div style="display: inline-block; width: 100%;"><span style="opacity: 0.99;"><span style="color: var(--ch-4);">            index: promptIndex,</span></span><br></div></div><span class="ch-code-line-number" style="position: absolute; top: 0px; left: 0px; transform: translate(0px, 836px); width: 31.5px; opacity: 0.99;">45</span><div style="position: absolute; top: 0px; left: 0px; transform: translate(31.5px, 836px); width: 553px;"><div style="display: inline-block; width: 100%;"><span style="opacity: 0.99;"><span style="color: var(--ch-4);">            answer: currentAnswer </span><span style="color: var(--ch-7);">+</span><span style="color: var(--ch-4);"> text,</span></span><br></div></div><span class="ch-code-line-number" style="position: absolute; top: 0px; left: 0px; transform: translate(0px, 855px); width: 31.5px; opacity: 0.99;">46</span><div style="position: absolute; top: 0px; left: 0px; transform: translate(31.5px, 855px); width: 553px;"><div style="display: inline-block; width: 100%;"><span style="opacity: 0.99;"><span style="color: var(--ch-4);">          })</span></span><br></div></div><span class="ch-code-line-number" style="position: absolute; top: 0px; left: 0px; transform: translate(0px, 874px); width: 31.5px; opacity: 0.99;">47</span><div style="position: absolute; top: 0px; left: 0px; transform: translate(31.5px, 874px); width: 553px;"><div style="display: inline-block; width: 100%;"><span style="opacity: 0.99;"><span style="color: var(--ch-4);"></span></span><br></div></div><span class="ch-code-line-number" style="position: absolute; top: 0px; left: 0px; transform: translate(0px, 893px); width: 31.5px; opacity: 0.99;">48</span><div style="position: absolute; top: 0px; left: 0px; transform: translate(31.5px, 893px); width: 553px;"><div style="display: inline-block; width: 100%;"><span style="opacity: 0.99;"><span style="color: var(--ch-7);">          return</span><span style="color: var(--ch-4);"> (answer </span><span style="color: var(--ch-7);">?? </span><span style="color: var(--ch-8);">''</span><span style="color: var(--ch-4);">) </span><span style="color: var(--ch-7);">+</span><span style="color: var(--ch-4);"> text</span></span><br></div></div><span class="ch-code-line-number" style="position: absolute; top: 0px; left: 0px; transform: translate(0px, 912px); width: 31.5px; opacity: 0.99;">49</span><div style="position: absolute; top: 0px; left: 0px; transform: translate(31.5px, 912px); width: 553px;"><div style="display: inline-block; width: 100%;"><span style="opacity: 0.99;"><span style="color: var(--ch-4);">        })</span></span><br></div></div><span class="ch-code-line-number" style="position: absolute; top: 0px; left: 0px; transform: translate(0px, 931px); width: 31.5px; opacity: 0.99;">50</span><div style="position: absolute; top: 0px; left: 0px; transform: translate(31.5px, 931px); width: 553px;"><div style="display: inline-block; width: 100%;"><span style="opacity: 0.99;"><span style="color: var(--ch-4);">      } </span><span style="color: var(--ch-7);">catch</span><span style="color: var(--ch-4);"> (err) {</span></span><br></div></div><span class="ch-code-line-number" style="position: absolute; top: 0px; left: 0px; transform: translate(0px, 950px); width: 31.5px; opacity: 0.99;">51</span><div style="position: absolute; top: 0px; left: 0px; transform: translate(31.5px, 950px); width: 553px;"><div style="display: inline-block; width: 100%;"><span style="opacity: 0.99;"><span style="color: var(--ch-5);">        handleError</span><span style="color: var(--ch-4);">(err)</span></span><br></div></div><span class="ch-code-line-number" style="position: absolute; top: 0px; left: 0px; transform: translate(0px, 969px); width: 31.5px; opacity: 0.99;">52</span><div style="position: absolute; top: 0px; left: 0px; transform: translate(31.5px, 969px); width: 553px;"><div style="display: inline-block; width: 100%;"><span style="opacity: 0.99;"><span style="color: var(--ch-4);">      }</span></span><br></div></div><span class="ch-code-line-number" style="position: absolute; top: 0px; left: 0px; transform: translate(0px, 988px); width: 31.5px; opacity: 0.99;">53</span><div style="position: absolute; top: 0px; left: 0px; transform: translate(31.5px, 988px); width: 553px;"><div style="display: inline-block; width: 100%;"><span style="opacity: 0.99;"><span style="color: var(--ch-4);">    })</span></span><br></div></div><span class="ch-code-line-number" style="position: absolute; top: 0px; left: 0px; transform: translate(0px, 1007px); width: 31.5px; opacity: 0.99;">54</span><div style="position: absolute; top: 0px; left: 0px; transform: translate(31.5px, 1007px); width: 553px;"><div style="display: inline-block; width: 100%;"><span style="opacity: 0.99;"><span style="color: var(--ch-4);"></span></span><br></div></div><span class="ch-code-line-number" style="position: absolute; top: 0px; left: 0px; transform: translate(0px, 1026px); width: 31.5px; opacity: 0.99;">55</span><div style="position: absolute; top: 0px; left: 0px; transform: translate(31.5px, 1026px); width: 553px;"><div style="display: inline-block; width: 100%;"><span style="opacity: 0.99;"><span style="color: var(--ch-4);">    eventSource.</span><span style="color: var(--ch-5);">stream</span><span style="color: var(--ch-4);">()</span></span><br></div></div><span class="ch-code-line-number" style="position: absolute; top: 0px; left: 0px; transform: translate(0px, 1045px); width: 31.5px; opacity: 0.99;">56</span><div style="position: absolute; top: 0px; left: 0px; transform: translate(31.5px, 1045px); width: 553px;"><div style="display: inline-block; width: 100%;"><span style="opacity: 0.99;"><span style="color: var(--ch-4);"></span></span><br></div></div><span class="ch-code-line-number" style="position: absolute; top: 0px; left: 0px; transform: translate(0px, 1064px); width: 31.5px; opacity: 0.99;">57</span><div style="position: absolute; top: 0px; left: 0px; transform: translate(31.5px, 1064px); width: 553px;"><div style="display: inline-block; width: 100%;"><span style="opacity: 0.99;"><span style="color: var(--ch-4);">    eventSourceRef.current </span><span style="color: var(--ch-7);">=</span><span style="color: var(--ch-4);"> eventSource</span></span><br></div></div><span class="ch-code-line-number" style="position: absolute; top: 0px; left: 0px; transform: translate(0px, 1083px); width: 31.5px; opacity: 0.99;">58</span><div style="position: absolute; top: 0px; left: 0px; transform: translate(31.5px, 1083px); width: 553px;"><div style="display: inline-block; width: 100%;"><span style="opacity: 0.99;"><span style="color: var(--ch-4);"></span></span><br></div></div><span class="ch-code-line-number" style="position: absolute; top: 0px; left: 0px; transform: translate(0px, 1102px); width: 31.5px; opacity: 0.99;">59</span><div style="position: absolute; top: 0px; left: 0px; transform: translate(31.5px, 1102px); width: 553px;"><div style="display: inline-block; width: 100%;"><span style="opacity: 0.99;"><span style="color: var(--ch-5);">    setIsLoading</span><span style="color: var(--ch-4);">(</span><span style="color: var(--ch-2);">true</span><span style="color: var(--ch-4);">)</span></span><br></div></div><span class="ch-code-line-number" style="position: absolute; top: 0px; left: 0px; transform: translate(0px, 1121px); width: 31.5px; opacity: 0.99;">60</span><div style="position: absolute; top: 0px; left: 0px; transform: translate(31.5px, 1121px); width: 553px;"><div style="display: inline-block; width: 100%;"><span style="opacity: 0.99;"><span style="color: var(--ch-4);">  },</span></span><br></div></div><span class="ch-code-line-number" style="position: absolute; top: 0px; left: 0px; transform: translate(0px, 1140px); width: 31.5px; opacity: 0.99;">61</span><div style="position: absolute; top: 0px; left: 0px; transform: translate(31.5px, 1140px); width: 553px;"><div style="display: inline-block; width: 100%;"><span style="opacity: 0.99;"><span style="color: var(--ch-4);">  [promptIndex, promptData]</span></span><br></div></div><span class="ch-code-line-number" style="position: absolute; top: 0px; left: 0px; transform: translate(0px, 1159px); width: 31.5px; opacity: 0.99;">62</span><div style="position: absolute; top: 0px; left: 0px; transform: translate(31.5px, 1159px); width: 553px;"><div style="display: inline-block; width: 100%;"><span style="opacity: 0.99;"><span style="color: var(--ch-4);">)</span></span><br></div></div></div></div></code><button type="button" title="Copy code" class="ch-code-button"><svg fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="1.6px" d="M8 16H6a2 2 0 01-2-2V6a2 2 0 012-2h8a2 2 0 012 2v2m-6 12h8a2 2 0 002-2v-8a2 2 0 00-2-2h-8a2 2 0 00-2 2v8a2 2 0 002 2z"></path></svg></button></div></div>
<h2 id="learn-more" class="group scroll-mt-24">Learn more<a href="#learn-more" aria-hidden="true" class="ml-2 opacity-0 group-hover:opacity-100 transition"><span aria-hidden="true">#</span></a></h2>
<p>Want to learn more about the awesome tech that is powering this?</p>
<ul>
<li>Read about how we built <a href="https://supabase.com/blog/chatgpt-supabase-docs">ChatGPT for the Supabase Docs</a>.</li>
<li>Read the pgvector Docs for <a href="https://supabase.com/docs/guides/database/extensions/pgvector">Embeddings and vector similarity</a></li>
<li>Watch Greg's video for a full breakdown:</li>
</ul>
<div class="video-container"></div></article></div><div class="border-l thin-scrollbar overflow-y-auto px-2 hidden md:block col-span-3 self-start sticky top-[calc(var(--header-height)+1px+2rem)] max-h-[calc(100vh-var(--header-height)-3rem)]"><div class="relative mb-6 pl-5"><button class="w-full"><div class="video-container overflow-hidden rounded hover:cursor-pointer"><div class=" absolute inset-0 z-10 text-white flex flex-col gap-3 items-center justify-center before:content[''] before:absolute before:inset-0 before:bg-black before:opacity-30 before:-z-10 hover:before:opacity-50 before:transition-opacity "><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-play w-5 h-5"><polygon points="6 3 20 12 6 21 6 3"></polygon></svg><p class="text-sm">Watch video guide</p></div><img alt="Video guide preview" loading="lazy" decoding="async" data-nimg="fill" class="absolute inset-0 object-cover blur-sm scale-105" sizes="100%" srcset="/docs/_next/image?url=http%3A%2F%2Fimg.youtube.com%2Fvi%2FxmfNUCjszh4%2F0.jpg&amp;w=16&amp;q=75&amp;dpl=dpl_8T75GeYs2RqN59z5hY7ru4dxhiVp 16w, /docs/_next/image?url=http%3A%2F%2Fimg.youtube.com%2Fvi%2FxmfNUCjszh4%2F0.jpg&amp;w=32&amp;q=75&amp;dpl=dpl_8T75GeYs2RqN59z5hY7ru4dxhiVp 32w, /docs/_next/image?url=http%3A%2F%2Fimg.youtube.com%2Fvi%2FxmfNUCjszh4%2F0.jpg&amp;w=48&amp;q=75&amp;dpl=dpl_8T75GeYs2RqN59z5hY7ru4dxhiVp 48w, /docs/_next/image?url=http%3A%2F%2Fimg.youtube.com%2Fvi%2FxmfNUCjszh4%2F0.jpg&amp;w=64&amp;q=75&amp;dpl=dpl_8T75GeYs2RqN59z5hY7ru4dxhiVp 64w, /docs/_next/image?url=http%3A%2F%2Fimg.youtube.com%2Fvi%2FxmfNUCjszh4%2F0.jpg&amp;w=96&amp;q=75&amp;dpl=dpl_8T75GeYs2RqN59z5hY7ru4dxhiVp 96w, /docs/_next/image?url=http%3A%2F%2Fimg.youtube.com%2Fvi%2FxmfNUCjszh4%2F0.jpg&amp;w=128&amp;q=75&amp;dpl=dpl_8T75GeYs2RqN59z5hY7ru4dxhiVp 128w, /docs/_next/image?url=http%3A%2F%2Fimg.youtube.com%2Fvi%2FxmfNUCjszh4%2F0.jpg&amp;w=256&amp;q=75&amp;dpl=dpl_8T75GeYs2RqN59z5hY7ru4dxhiVp 256w, /docs/_next/image?url=http%3A%2F%2Fimg.youtube.com%2Fvi%2FxmfNUCjszh4%2F0.jpg&amp;w=384&amp;q=75&amp;dpl=dpl_8T75GeYs2RqN59z5hY7ru4dxhiVp 384w, /docs/_next/image?url=http%3A%2F%2Fimg.youtube.com%2Fvi%2FxmfNUCjszh4%2F0.jpg&amp;w=640&amp;q=75&amp;dpl=dpl_8T75GeYs2RqN59z5hY7ru4dxhiVp 640w, /docs/_next/image?url=http%3A%2F%2Fimg.youtube.com%2Fvi%2FxmfNUCjszh4%2F0.jpg&amp;w=750&amp;q=75&amp;dpl=dpl_8T75GeYs2RqN59z5hY7ru4dxhiVp 750w, /docs/_next/image?url=http%3A%2F%2Fimg.youtube.com%2Fvi%2FxmfNUCjszh4%2F0.jpg&amp;w=828&amp;q=75&amp;dpl=dpl_8T75GeYs2RqN59z5hY7ru4dxhiVp 828w, /docs/_next/image?url=http%3A%2F%2Fimg.youtube.com%2Fvi%2FxmfNUCjszh4%2F0.jpg&amp;w=1080&amp;q=75&amp;dpl=dpl_8T75GeYs2RqN59z5hY7ru4dxhiVp 1080w, /docs/_next/image?url=http%3A%2F%2Fimg.youtube.com%2Fvi%2FxmfNUCjszh4%2F0.jpg&amp;w=1200&amp;q=75&amp;dpl=dpl_8T75GeYs2RqN59z5hY7ru4dxhiVp 1200w, /docs/_next/image?url=http%3A%2F%2Fimg.youtube.com%2Fvi%2FxmfNUCjszh4%2F0.jpg&amp;w=1920&amp;q=75&amp;dpl=dpl_8T75GeYs2RqN59z5hY7ru4dxhiVp 1920w, /docs/_next/image?url=http%3A%2F%2Fimg.youtube.com%2Fvi%2FxmfNUCjszh4%2F0.jpg&amp;w=2048&amp;q=75&amp;dpl=dpl_8T75GeYs2RqN59z5hY7ru4dxhiVp 2048w, /docs/_next/image?url=http%3A%2F%2Fimg.youtube.com%2Fvi%2FxmfNUCjszh4%2F0.jpg&amp;w=3840&amp;q=75&amp;dpl=dpl_8T75GeYs2RqN59z5hY7ru4dxhiVp 3840w" src="/docs/_next/image?url=http%3A%2F%2Fimg.youtube.com%2Fvi%2FxmfNUCjszh4%2F0.jpg&amp;w=3840&amp;q=75&amp;dpl=dpl_8T75GeYs2RqN59z5hY7ru4dxhiVp" style="position: absolute; height: 100%; width: 100%; inset: 0px; color: transparent;"></div></button></div><section class="@container px-5 mb-6" aria-labelledby="feedback-title"><h3 id="feedback-title" class="block font-mono text-xs uppercase text-foreground mb-4">Is this helpful?</h3><div class="relative flex flex-col gap-y-4 mb-2 @[12rem]:flex-row @[12rem]:items-center"><div class="relative flex gap-[var(--container-flex-gap)] items-center" style="--container-flex-gap: 0.5rem;"><button data-size="tiny" type="button" class="relative justify-center cursor-pointer inline-flex items-center space-x-2 text-center font-regular ease-out duration-200 outline-none transition-all outline-0 focus-visible:outline-4 focus-visible:outline-offset-1 border text-foreground bg-transparent border-strong focus-visible:outline-border-strong data-[state=open]:border-stronger data-[state=open]:outline-border-strong text-xs py-1 h-[26px] rounded-full px-1 hover:text-brand-600 hover:border-brand-500 [transition-property:opacity,transform,color] [transition-duration:150ms,300ms,300ms] motion-reduce:[transition-duration:150ms,1ms,300ms]"> <span class="truncate"><svg xmlns="http://www.w3.org/2000/svg" width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="3" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-check"><path d="M20 6 9 17l-5-5"></path></svg><span class="sr-only">Yes</span></span> </button><button data-size="tiny" type="button" class="relative justify-center cursor-pointer inline-flex items-center space-x-2 text-center font-regular ease-out duration-200 outline-none transition-all outline-0 focus-visible:outline-4 focus-visible:outline-offset-1 border text-foreground bg-transparent border-strong focus-visible:outline-border-strong data-[state=open]:border-stronger data-[state=open]:outline-border-strong text-xs py-1 h-[26px] rounded-full px-1 hover:text-warning-600 hover:border-warning-500 [transition-property:opacity,transform,color] [transition-duration:150ms,300ms,300ms] motion-reduce:[transition-duration:150ms,1ms,300ms]"> <span class="truncate"><svg xmlns="http://www.w3.org/2000/svg" width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="3" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-x"><path d="M18 6 6 18"></path><path d="m6 6 12 12"></path></svg><span class="sr-only">No</span></span> </button></div><div class="flex flex-col gap-1 text-xs opacity-0 invisible text-left -translate-x-[0.25rem] @[12rem]:-translate-x-[1.25rem] [transition-property:opacity,transform] [transition-duration:150ms,300ms] motion-reduce:[transition-duration:150ms,1ms] delay-300"><span class="text-foreground-light">Thanks for your feedback!</span></div></div></section><span class="block font-mono text-xs uppercase text-foreground px-5 mb-6">On this page</span><ul class="toc-menu list-none pl-5 text-[0.8rem] grid gap-2"><li class=""><a href="#create-a-project" class="text-foreground-lighter hover:text-brand-link transition-colors">Create a project</a></li><li class=""><a href="#prepare-the-database" class="text-foreground-lighter hover:text-brand-link transition-colors">Prepare the database</a></li><li class=""><a href="#pre-process-the-knowledge-base-at-build-time" class="text-foreground-lighter hover:text-brand-link transition-colors">Pre-process the knowledge base at build time</a></li><li class=""><a href="#create-text-completion-with-openai-api" class="text-foreground-lighter hover:text-brand-link transition-colors">Create text completion with OpenAI API</a></li><li class=""><a href="#display-the-answer-on-the-frontend" class="text-foreground-lighter hover:text-brand-link transition-colors">Display the answer on the frontend</a></li><li class=""><a href="#learn-more" class="text-foreground-lighter hover:text-brand-link transition-colors">Learn more</a></li></ul></div></div></div><div class="max-w-7xl px-5 mx-auto py-8 pt-0"></div></div><div class="left-0 right-0 z-10 backdrop-blur-sm backdrop-filter bg-alternative/90 hidden h-0 lg:hidden"></div></div></main></div></div></div></div><next-route-announcer style="position: absolute;"></next-route-announcer><section aria-label="Notifications alt+T" tabindex="-1"><ol dir="ltr" tabindex="-1" class="toaster group pointer-events-auto" data-sonner-toaster="true" data-theme="light" data-y-position="top" data-x-position="right" style="--front-toast-height: 112px; --offset: 32px; --width: 356px; --gap: 14px; font-family: inherit;"></ol><ol dir="ltr" tabindex="-1" class="toaster group pointer-events-auto" data-sonner-toaster="true" data-theme="light" data-y-position="bottom" data-x-position="right" style="--front-toast-height: 112px; --offset: 32px; --width: 356px; --gap: 14px; font-family: inherit;"><li aria-live="polite" aria-atomic="true" role="status" tabindex="0" class="group toast w-full rounded-md py-3 px-5 flex gap-2 items-start font-normal text-sm group-[.toaster]:bg-overlay group-[.toaster]:text-foreground group-[.toaster]:border group-[.toaster]:border-overlay group-[.toaster]:shadow-lg" data-sonner-toast="" data-styled="false" data-mounted="true" data-promise="false" data-removed="false" data-visible="true" data-y-position="bottom" data-x-position="right" data-index="0" data-front="true" data-swiping="false" data-dismissible="true" data-swipe-out="false" data-expanded="false" style="--index: 0; --toasts-before: 0; --z-index: 1; --offset: 0px; --initial-height: 112px;"><button aria-label="Close toast" data-disabled="false" data-close-button="true" class="absolute right-2 top-2 rounded-md text-foreground/50 opacity-0 transition-opacity hover:text-foreground focus:opacity-100 focus:outline-none focus:ring-2 group-hover:opacity-100 group-[.destructive]:text-destructive-300 group-[.destructive]:hover:text-destructive-50 group-[.destructive]:focus:ring-destructive-400 group-[.destructive]:focus:ring-offset-destructive-600 left-auto transform-none bg-transparent border-0 border-transparent hover:!bg-transparent hover:border-transparent"><svg xmlns="http://www.w3.org/2000/svg" width="12" height="12" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"><line x1="18" y1="6" x2="6" y2="18"></line><line x1="6" y1="6" x2="18" y2="18"></line></svg></button><div class="space-y-3 py-1 flex flex-col w-full"><div><p class="text-foreground">We only collect analytics essential to ensuring smooth operation of our services. <a class="inline sm:hidden underline text-light" target="_blank" rel="noreferrer" href="https://supabase.com/privacy">Learn more</a></p></div><div class="flex items-center space-x-2"><button data-size="tiny" type="button" class="relative justify-center cursor-pointer inline-flex items-center space-x-2 text-center font-regular ease-out duration-200 rounded-md outline-none transition-all outline-0 focus-visible:outline-4 focus-visible:outline-offset-1 border text-foreground bg-alternative dark:bg-muted hover:bg-selection border-strong hover:border-stronger focus-visible:outline-brand-600 data-[state=open]:bg-selection data-[state=open]:outline-brand-600 data-[state=open]:border-button-hover text-xs px-2.5 py-1 h-[26px]"> <span class="truncate">Accept</span> </button><button data-size="tiny" type="button" class="relative justify-center cursor-pointer inline-flex items-center space-x-2 text-center font-regular ease-out duration-200 rounded-md outline-none transition-all outline-0 focus-visible:outline-4 focus-visible:outline-offset-1 border text-foreground hover:bg-surface-300 shadow-none focus-visible:outline-border-strong data-[state=open]:bg-surface-300 data-[state=open]:outline-border-strong border-transparent text-xs px-2.5 py-1 h-[26px]"> <span class="truncate">Opt out</span> </button><a target="_blank" rel="noreferrer" data-size="tiny" type="button" class="relative justify-center cursor-pointer items-center space-x-2 text-center font-regular ease-out duration-200 rounded-md outline-none transition-all outline-0 focus-visible:outline-4 focus-visible:outline-offset-1 border hover:bg-surface-300 shadow-none focus-visible:outline-border-strong data-[state=open]:bg-surface-300 data-[state=open]:outline-border-strong border-transparent text-xs px-2.5 py-1 h-[26px] hidden sm:block text-light hover:text-foreground" href="https://supabase.com/privacy"><span class="truncate">Learn more</span></a></div></div></li></ol></section></body></html><hr>
<!DOCTYPE html><html lang="en" data-theme="light" style="color-scheme: light;"><body><div class="flex flex-col"><div class="grow"><div class="flex flex-col h-full w-full"><div class="hidden lg:sticky w-full lg:flex top-0 left-0 right-0 z-50"><!--$--><!--/$--></div><div class="flex flex-row h-full relative"><main id="docs-content-container" class="w-full transition-all ease-out relative lg:ml-0"><div class="flex flex-col sticky top-0"><div class="flex lg:hidden w-full top-0 left-0 right-0 z-50"><!--$--><!--/$--></div><div class="sticky transition-all top-0 z-10 backdrop-blur backdrop-filter bg-background"><div class="lg:hidden px-3.5 border-b z-10 transition-all ease-out top-0 flex items-center gap-1"><button class="h-8 w-8 flex group items-center justify-center mr-1"><div class="space-y-1 cursor-pointer relative w-4 h-[8px]"><span class="transition-all ease-out block h-px bg-foreground-muted group-hover:bg-foreground w-4"></span><span class="transition-all ease-out block h-px bg-foreground-muted group-hover:bg-foreground w-3 group-hover:w-4"></span></div></button><span class="transition-all duration-200 text-foreground text-sm">AI &amp; Vectors</span></div></div><div class="grow"><div class="max-w-7xl px-5 mx-auto py-8 pb-0"><div class="grid grid-cols-12 relative gap-4"><div class="relative transition-all ease-out duration-100 col-span-12 md:col-span-9"><article id="sb-docs-guide-main-article" class="prose max-w-none"><h1 class="mb-0">API</h1><hr class="not-prose border-t-0 border-b my-8">
<h1 id="api">API</h1>
<p><code>vecs</code> is a python client for managing and querying vector stores in PostgreSQL with the <a href="https://github.com/pgvector/pgvector">pgvector extension</a>. This guide will help you get started with using vecs.</p>
<p>If you don't have a Postgres database with the pgvector ready, see <a href="https://supabase.github.io/vecs/hosting">hosting</a> for easy options.</p>
<h2 id="installation" class="group scroll-mt-24">Installation<a href="#installation" aria-hidden="true" class="ml-2 opacity-0 group-hover:opacity-100 transition"><span aria-hidden="true">#</span></a></h2>
<p>Requires:</p>
<ul>
<li>Python 3.7+</li>
</ul>
<p>You can install vecs using pip:</p>
<div class="ch-codeblock not-prose " data-ch-theme="supabase"><div class="ch-code-wrapper ch-code" data-ch-measured="false"><code class="ch-code-scroll-parent"><br><div><span class="ch-code-line-number">_<!-- -->10</span><div style="display:inline-block;margin-left:16px"><span>pip install vecs</span></div></div><br></code></div></div>
<h2 id="usage" class="group scroll-mt-24">Usage<a href="#usage" aria-hidden="true" class="ml-2 opacity-0 group-hover:opacity-100 transition"><span aria-hidden="true">#</span></a></h2>
<h2 id="connecting" class="group scroll-mt-24">Connecting<a href="#connecting" aria-hidden="true" class="ml-2 opacity-0 group-hover:opacity-100 transition"><span aria-hidden="true">#</span></a></h2>
<p>Before you can interact with vecs, create the client to communicate with Postgres. If you haven't started a Postgres instance yet, see <a href="https://supabase.github.io/vecs/hosting">hosting</a>.</p>
<div class="ch-codeblock not-prose " data-ch-theme="supabase"><div class="ch-code-wrapper ch-code" data-ch-measured="false"><code class="ch-code-scroll-parent"><br><div><span class="ch-code-line-number">_<!-- -->10</span><div style="display:inline-block;margin-left:16px"><span>import vecs</span></div></div><div><span class="ch-code-line-number">_<!-- -->10</span><div style="display:inline-block;margin-left:16px"><span></span></div></div><div><span class="ch-code-line-number">_<!-- -->10</span><div style="display:inline-block;margin-left:16px"><span>DB_CONNECTION = "postgresql://&lt;user&gt;:&lt;password&gt;@&lt;host&gt;:&lt;port&gt;/&lt;db_name&gt;"</span></div></div><div><span class="ch-code-line-number">_<!-- -->10</span><div style="display:inline-block;margin-left:16px"><span></span></div></div><div><span class="ch-code-line-number">_<!-- -->10</span><div style="display:inline-block;margin-left:16px"><span># create vector store client</span></div></div><div><span class="ch-code-line-number">_<!-- -->10</span><div style="display:inline-block;margin-left:16px"><span>vx = vecs.create_client(DB_CONNECTION)</span></div></div><br></code></div></div>
<h2 id="get-or-create-a-collection" class="group scroll-mt-24">Get or Create a Collection<a href="#get-or-create-a-collection" aria-hidden="true" class="ml-2 opacity-0 group-hover:opacity-100 transition"><span aria-hidden="true">#</span></a></h2>
<p>You can get a collection (or create if it doesn't exist), specifying the collection's name and the number of dimensions for the vectors you intend to store.</p>
<div class="ch-codeblock not-prose " data-ch-theme="supabase"><div class="ch-code-wrapper ch-code" data-ch-measured="false"><code class="ch-code-scroll-parent"><br><div><span class="ch-code-line-number">_<!-- -->10</span><div style="display:inline-block;margin-left:16px"><span>docs = vx.get_or_create_collection(name="docs", dimension=3)</span></div></div><br></code></div></div>
<h2 id="upserting-vectors" class="group scroll-mt-24">Upserting vectors<a href="#upserting-vectors" aria-hidden="true" class="ml-2 opacity-0 group-hover:opacity-100 transition"><span aria-hidden="true">#</span></a></h2>
<p><code>vecs</code> combines the concepts of "insert" and "update" into "upsert". Upserting records adds them to the collection if the <code>id</code> is not present, or updates the existing record if the <code>id</code> does exist.</p>
<div class="ch-codeblock not-prose " data-ch-theme="supabase"><div class="ch-code-wrapper ch-code" data-ch-measured="false"><code class="ch-code-scroll-parent"><br><div><span class="ch-code-line-number">_<!-- -->15</span><div style="display:inline-block;margin-left:16px"><span># add records to the collection</span></div></div><div><span class="ch-code-line-number">_<!-- -->15</span><div style="display:inline-block;margin-left:16px"><span>docs.upsert(</span></div></div><div><span class="ch-code-line-number">_<!-- -->15</span><div style="display:inline-block;margin-left:16px"><span>    records=[</span></div></div><div><span class="ch-code-line-number">_<!-- -->15</span><div style="display:inline-block;margin-left:16px"><span>        (</span></div></div><div><span class="ch-code-line-number">_<!-- -->15</span><div style="display:inline-block;margin-left:16px"><span>         "vec0",           # the vector's identifier</span></div></div><div><span class="ch-code-line-number">_<!-- -->15</span><div style="display:inline-block;margin-left:16px"><span>         [0.1, 0.2, 0.3],  # the vector. list or np.array</span></div></div><div><span class="ch-code-line-number">_<!-- -->15</span><div style="display:inline-block;margin-left:16px"><span>         {"year": 1973}    # associated  metadata</span></div></div><div><span class="ch-code-line-number">_<!-- -->15</span><div style="display:inline-block;margin-left:16px"><span>        ),</span></div></div><div><span class="ch-code-line-number">_<!-- -->15</span><div style="display:inline-block;margin-left:16px"><span>        (</span></div></div><div><span class="ch-code-line-number">_<!-- -->15</span><div style="display:inline-block;margin-left:16px"><span>         "vec1",</span></div></div><div><span class="ch-code-line-number">_<!-- -->15</span><div style="display:inline-block;margin-left:16px"><span>         [0.7, 0.8, 0.9],</span></div></div><div><span class="ch-code-line-number">_<!-- -->15</span><div style="display:inline-block;margin-left:16px"><span>         {"year": 2012}</span></div></div><div><span class="ch-code-line-number">_<!-- -->15</span><div style="display:inline-block;margin-left:16px"><span>        )</span></div></div><div><span class="ch-code-line-number">_<!-- -->15</span><div style="display:inline-block;margin-left:16px"><span>    ]</span></div></div><div><span class="ch-code-line-number">_<!-- -->15</span><div style="display:inline-block;margin-left:16px"><span>)</span></div></div><br></code></div></div>
<h2 id="deleting-vectors" class="group scroll-mt-24">Deleting vectors<a href="#deleting-vectors" aria-hidden="true" class="ml-2 opacity-0 group-hover:opacity-100 transition"><span aria-hidden="true">#</span></a></h2>
<p>Deleting records removes them from the collection. To delete records, specify a list of <code>ids</code> or metadata filters to the <code>delete</code> method. The ids of the sucessfully deleted records are returned from the method. Note that attempting to delete non-existent records does not raise an error.</p>
<div class="ch-codeblock not-prose " data-ch-theme="supabase"><div class="ch-code-wrapper ch-code" data-ch-measured="false"><code class="ch-code-scroll-parent"><br><div><span class="ch-code-line-number">_<!-- -->10</span><div style="display:inline-block;margin-left:16px"><span>docs.delete(ids=["vec0", "vec1"])</span></div></div><div><span class="ch-code-line-number">_<!-- -->10</span><div style="display:inline-block;margin-left:16px"><span># or delete by a metadata filter</span></div></div><div><span class="ch-code-line-number">_<!-- -->10</span><div style="display:inline-block;margin-left:16px"><span>docs.delete(filters={"year": {"$eq": 2012}})</span></div></div><br></code></div></div>
<h2 id="create-an-index" class="group scroll-mt-24">Create an index<a href="#create-an-index" aria-hidden="true" class="ml-2 opacity-0 group-hover:opacity-100 transition"><span aria-hidden="true">#</span></a></h2>
<p>Collections can be queried immediately after being created.
However, for good throughput, the collection should be indexed after records have been upserted.</p>
<p>Only one index may exist per-collection. By default, creating an index will replace any existing index.</p>
<p>To create an index:</p>
<div class="ch-codeblock not-prose " data-ch-theme="supabase"><div class="ch-code-wrapper ch-code" data-ch-measured="false"><code class="ch-code-scroll-parent"><br><div><span class="ch-code-line-number">_<!-- -->10</span><div style="display:inline-block;margin-left:16px"><span>docs.create_index()</span></div></div><br></code></div></div>
<p>You may optionally provide a distance measure and index method.</p>
<p>Available options for distance <code>measure</code> are:</p>
<ul>
<li><code>vecs.IndexMeasure.cosine_distance</code></li>
<li><code>vecs.IndexMeasure.l2_distance</code></li>
<li><code>vecs.IndexMeasure.max_inner_product</code></li>
</ul>
<p>which correspond to different methods for comparing query vectors to the vectors in the database.</p>
<p>If you aren't sure which to use, the default of cosine_distance is the most widely compatible with off-the-shelf embedding methods.</p>
<p>Available options for index <code>method</code> are:</p>
<ul>
<li><code>vecs.IndexMethod.auto</code></li>
<li><code>vecs.IndexMethod.hnsw</code></li>
<li><code>vecs.IndexMethod.ivfflat</code></li>
</ul>
<p>Where <code>auto</code> selects the best available index method, <code>hnsw</code> uses the <a href="https://github.com/pgvector/pgvector#hnsw">HNSW</a> method and <code>ivfflat</code> uses <a href="https://github.com/pgvector/pgvector#ivfflat">IVFFlat</a>.</p>
<p>HNSW and IVFFlat indexes both allow for parameterization to control the speed/accuracy tradeoff. vecs provides sane defaults for these parameters. For a greater level of control you can optionally pass an instance of <code>vecs.IndexArgsIVFFlat</code> or <code>vecs.IndexArgsHNSW</code> to <code>create_index</code>'s <code>index_arguments</code> argument. Descriptions of the impact for each parameter are available in the <a href="https://github.com/pgvector/pgvector">pgvector docs</a>.</p>
<p>When using IVFFlat indexes, the index must be created <strong>after</strong> the collection has been populated with records. Building an IVFFlat index on an empty collection will result in significantly reduced recall. You can continue upserting new documents after the index has been created, but should rebuild the index if the size of the collection more than doubles since the last index operation.</p>
<p>HNSW indexes can be created immediately after the collection without populating records.</p>
<p>To manually specify <code>method</code>, <code>measure</code>, and <code>index_arguments</code> add them as arguments to <code>create_index</code> for example:</p>
<div class="ch-codeblock not-prose " data-ch-theme="supabase"><div class="ch-code-wrapper ch-code" data-ch-measured="false"><code class="ch-code-scroll-parent"><br><div><span class="ch-code-line-number">_<!-- -->10</span><div style="display:inline-block;margin-left:16px"><span>docs.create_index(</span></div></div><div><span class="ch-code-line-number">_<!-- -->10</span><div style="display:inline-block;margin-left:16px"><span>    method=IndexMethod.hnsw,</span></div></div><div><span class="ch-code-line-number">_<!-- -->10</span><div style="display:inline-block;margin-left:16px"><span>    measure=IndexMeasure.cosine_distance,</span></div></div><div><span class="ch-code-line-number">_<!-- -->10</span><div style="display:inline-block;margin-left:16px"><span>    index_arguments=IndexArgsHNSW(m=8),</span></div></div><div><span class="ch-code-line-number">_<!-- -->10</span><div style="display:inline-block;margin-left:16px"><span>)</span></div></div><br></code></div></div>
<div role="alert" class="relative w-full text-sm rounded-lg p-4 [&amp;>svg~*]:pl-10 [&amp;>svg+div]:translate-y-[-3px] [&amp;>svg]:absolute [&amp;>svg]:left-4 [&amp;>svg]:top-4 [&amp;>svg]:w-[23px] [&amp;>svg]:h-[23px] [&amp;>svg]:p-1 [&amp;>svg]:flex [&amp;>svg]:rounded text-foreground [&amp;>svg]:text-background [&amp;>svg]:bg-foreground mb-2 [&amp;_svg]:bg-foreground-muted [&amp;_svg]:text-background-muted bg-surface-200/25 border border-default"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 21 20" class="w-6 h-6" fill="currentColor"><path fill-rule="evenodd" clip-rule="evenodd" d="M0.625 9.8252C0.625 4.44043 4.99023 0.0751953 10.375 0.0751953C15.7598 0.0751953 20.125 4.44043 20.125 9.8252C20.125 15.21 15.7598 19.5752 10.375 19.5752C4.99023 19.5752 0.625 15.21 0.625 9.8252ZM9.3584 4.38135C9.45117 4.28857 9.55518 4.20996 9.66699 4.14648C9.88086 4.02539 10.1245 3.96045 10.375 3.96045C10.5845 3.96045 10.7896 4.00586 10.9766 4.09229C11.1294 4.1626 11.2705 4.26025 11.3916 4.38135C11.6611 4.65088 11.8125 5.0166 11.8125 5.39795C11.8125 5.5249 11.7959 5.6499 11.7637 5.77002C11.6987 6.01172 11.5718 6.23438 11.3916 6.41455C11.1221 6.68408 10.7563 6.83545 10.375 6.83545C9.99365 6.83545 9.62793 6.68408 9.3584 6.41455C9.08887 6.14502 8.9375 5.7793 8.9375 5.39795C8.9375 5.29492 8.94873 5.19287 8.97021 5.09375C9.02783 4.82568 9.16162 4.57812 9.3584 4.38135ZM10.375 15.6899C10.0933 15.6899 9.82275 15.5781 9.62354 15.3789C9.42432 15.1797 9.3125 14.9092 9.3125 14.6274V9.31494C9.3125 9.0332 9.42432 8.7627 9.62354 8.56348C9.82275 8.36426 10.0933 8.25244 10.375 8.25244C10.6567 8.25244 10.9272 8.36426 11.1265 8.56348C11.3257 8.7627 11.4375 9.0332 11.4375 9.31494V14.6274C11.4375 14.7944 11.3979 14.9575 11.3242 15.104C11.2739 15.2046 11.2075 15.2979 11.1265 15.3789C10.9272 15.5781 10.6567 15.6899 10.375 15.6899Z"></path></svg><div class="text mt [&amp;_p]:mb-1.5 [&amp;_p]:mt-0 mt-0.5 [&amp;_p:last-child]:mb-0">The time required to create an index grows with the number of records and size of vectors.
For a few thousand records expect sub-minute a response in under a minute. It may take a few
minutes for larger collections.</div></div>
<h2 id="query" class="group scroll-mt-24">Query<a href="#query" aria-hidden="true" class="ml-2 opacity-0 group-hover:opacity-100 transition"><span aria-hidden="true">#</span></a></h2>
<p>Given a collection <code>docs</code> with several records:</p>
<h3 id="basic" class="group scroll-mt-24">Basic<a href="#basic" aria-hidden="true" class="ml-2 opacity-0 group-hover:opacity-100 transition"><span aria-hidden="true">#</span></a></h3>
<p>The simplest form of search is to provide a query vector.</p>
<div role="alert" class="relative w-full text-sm rounded-lg p-4 [&amp;>svg~*]:pl-10 [&amp;>svg+div]:translate-y-[-3px] [&amp;>svg]:absolute [&amp;>svg]:left-4 [&amp;>svg]:top-4 [&amp;>svg]:w-[23px] [&amp;>svg]:h-[23px] [&amp;>svg]:p-1 [&amp;>svg]:flex [&amp;>svg]:rounded text-foreground [&amp;>svg]:text-background [&amp;>svg]:bg-foreground mb-2 [&amp;_svg]:bg-foreground-muted [&amp;_svg]:text-background-muted bg-surface-200/25 border border-default"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 21 20" class="w-6 h-6" fill="currentColor"><path fill-rule="evenodd" clip-rule="evenodd" d="M0.625 9.8252C0.625 4.44043 4.99023 0.0751953 10.375 0.0751953C15.7598 0.0751953 20.125 4.44043 20.125 9.8252C20.125 15.21 15.7598 19.5752 10.375 19.5752C4.99023 19.5752 0.625 15.21 0.625 9.8252ZM9.3584 4.38135C9.45117 4.28857 9.55518 4.20996 9.66699 4.14648C9.88086 4.02539 10.1245 3.96045 10.375 3.96045C10.5845 3.96045 10.7896 4.00586 10.9766 4.09229C11.1294 4.1626 11.2705 4.26025 11.3916 4.38135C11.6611 4.65088 11.8125 5.0166 11.8125 5.39795C11.8125 5.5249 11.7959 5.6499 11.7637 5.77002C11.6987 6.01172 11.5718 6.23438 11.3916 6.41455C11.1221 6.68408 10.7563 6.83545 10.375 6.83545C9.99365 6.83545 9.62793 6.68408 9.3584 6.41455C9.08887 6.14502 8.9375 5.7793 8.9375 5.39795C8.9375 5.29492 8.94873 5.19287 8.97021 5.09375C9.02783 4.82568 9.16162 4.57812 9.3584 4.38135ZM10.375 15.6899C10.0933 15.6899 9.82275 15.5781 9.62354 15.3789C9.42432 15.1797 9.3125 14.9092 9.3125 14.6274V9.31494C9.3125 9.0332 9.42432 8.7627 9.62354 8.56348C9.82275 8.36426 10.0933 8.25244 10.375 8.25244C10.6567 8.25244 10.9272 8.36426 11.1265 8.56348C11.3257 8.7627 11.4375 9.0332 11.4375 9.31494V14.6274C11.4375 14.7944 11.3979 14.9575 11.3242 15.104C11.2739 15.2046 11.2075 15.2979 11.1265 15.3789C10.9272 15.5781 10.6567 15.6899 10.375 15.6899Z"></path></svg><div class="text mt [&amp;_p]:mb-1.5 [&amp;_p]:mt-0 mt-0.5 [&amp;_p:last-child]:mb-0">Indexes are essential for good performance. See <a href="#create-an-index">creating an index</a> for more info.<p>If you do not create an index, every query will return a warning</p><div class="ch-codeblock not-prose " data-ch-theme="supabase"><div class="ch-code-wrapper ch-code" data-ch-measured="false"><code class="ch-code-scroll-parent"><br><div><span class="ch-code-line-number">_<!-- -->10</span><div style="display:inline-block;margin-left:16px"><span>query does not have a covering index for cosine_similarity. See Collection.create_index</span></div></div><br></code></div></div><p>that incldues the <code>IndexMeasure</code> you should index.</p></div></div>
<div class="ch-codeblock not-prose " data-ch-theme="supabase"><div class="ch-code-wrapper ch-code" data-ch-measured="false"><code class="ch-code-scroll-parent"><br><div><span class="ch-code-line-number">_<!-- -->10</span><div style="display:inline-block;margin-left:16px"><span>docs.query(</span></div></div><div><span class="ch-code-line-number">_<!-- -->10</span><div style="display:inline-block;margin-left:16px"><span>    data=[0.4,0.5,0.6],          # required</span></div></div><div><span class="ch-code-line-number">_<!-- -->10</span><div style="display:inline-block;margin-left:16px"><span>    limit=5,                     # number of records to return</span></div></div><div><span class="ch-code-line-number">_<!-- -->10</span><div style="display:inline-block;margin-left:16px"><span>    filters={},                  # metadata filters</span></div></div><div><span class="ch-code-line-number">_<!-- -->10</span><div style="display:inline-block;margin-left:16px"><span>    measure="cosine_distance",   # distance measure to use</span></div></div><div><span class="ch-code-line-number">_<!-- -->10</span><div style="display:inline-block;margin-left:16px"><span>    include_value=False,         # should distance measure values be returned?</span></div></div><div><span class="ch-code-line-number">_<!-- -->10</span><div style="display:inline-block;margin-left:16px"><span>    include_metadata=False,      # should record metadata be returned?</span></div></div><div><span class="ch-code-line-number">_<!-- -->10</span><div style="display:inline-block;margin-left:16px"><span>)</span></div></div><br></code></div></div>
<p>Which returns a list of vector record <code>ids</code>.</p>
<h3 id="metadata-filtering" class="group scroll-mt-24">Metadata Filtering<a href="#metadata-filtering" aria-hidden="true" class="ml-2 opacity-0 group-hover:opacity-100 transition"><span aria-hidden="true">#</span></a></h3>
<p>The metadata that is associated with each record can also be filtered during a query.</p>
<p>As an example, <code>{"year": {"$eq": 2005}}</code> filters a <code>year</code> metadata key to be equal to 2005</p>
<p>In context:</p>
<div class="ch-codeblock not-prose " data-ch-theme="supabase"><div class="ch-code-wrapper ch-code" data-ch-measured="false"><code class="ch-code-scroll-parent"><br><div><span class="ch-code-line-number">_<!-- -->10</span><div style="display:inline-block;margin-left:16px"><span>docs.query(</span></div></div><div><span class="ch-code-line-number">_<!-- -->10</span><div style="display:inline-block;margin-left:16px"><span>    data=[0.4,0.5,0.6],</span></div></div><div><span class="ch-code-line-number">_<!-- -->10</span><div style="display:inline-block;margin-left:16px"><span>    filters={"year": {"$eq": 2012}}, # metadata filters</span></div></div><div><span class="ch-code-line-number">_<!-- -->10</span><div style="display:inline-block;margin-left:16px"><span>)</span></div></div><br></code></div></div>
<p>For a complete reference, see the <a href="metadata">metadata guide</a>.</p>
<h3 id="disconnect" class="group scroll-mt-24">Disconnect<a href="#disconnect" aria-hidden="true" class="ml-2 opacity-0 group-hover:opacity-100 transition"><span aria-hidden="true">#</span></a></h3>
<p>When you're done with a collection, be sure to disconnect the client from the database.</p>
<div class="ch-codeblock not-prose " data-ch-theme="supabase"><div class="ch-code-wrapper ch-code" data-ch-measured="false"><code class="ch-code-scroll-parent"><br><div><span class="ch-code-line-number">_<!-- -->10</span><div style="display:inline-block;margin-left:16px"><span>vx.disconnect()</span></div></div><br></code></div></div>
<p>alternatively, use the client as a context manager and it will automatically close the connection on exit.</p>
<div class="ch-codeblock not-prose " data-ch-theme="supabase"><div class="ch-code-wrapper ch-code" data-ch-measured="false"><code class="ch-code-scroll-parent"><br><div><span class="ch-code-line-number">_<!-- -->10</span><div style="display:inline-block;margin-left:16px"><span>import vecs</span></div></div><div><span class="ch-code-line-number">_<!-- -->10</span><div style="display:inline-block;margin-left:16px"><span></span></div></div><div><span class="ch-code-line-number">_<!-- -->10</span><div style="display:inline-block;margin-left:16px"><span>DB_CONNECTION = "postgresql://&lt;user&gt;:&lt;password&gt;@&lt;host&gt;:&lt;port&gt;/&lt;db_name&gt;"</span></div></div><div><span class="ch-code-line-number">_<!-- -->10</span><div style="display:inline-block;margin-left:16px"><span></span></div></div><div><span class="ch-code-line-number">_<!-- -->10</span><div style="display:inline-block;margin-left:16px"><span># create vector store client</span></div></div><div><span class="ch-code-line-number">_<!-- -->10</span><div style="display:inline-block;margin-left:16px"><span>with vecs.create_client(DB_CONNECTION) as vx:</span></div></div><div><span class="ch-code-line-number">_<!-- -->10</span><div style="display:inline-block;margin-left:16px"><span>    # do some work here</span></div></div><div><span class="ch-code-line-number">_<!-- -->10</span><div style="display:inline-block;margin-left:16px"><span>    pass</span></div></div><div><span class="ch-code-line-number">_<!-- -->10</span><div style="display:inline-block;margin-left:16px"><span></span></div></div><div><span class="ch-code-line-number">_<!-- -->10</span><div style="display:inline-block;margin-left:16px"><span># connections are now closed</span></div></div><br></code></div></div>
<h2 id="adapters" class="group scroll-mt-24">Adapters<a href="#adapters" aria-hidden="true" class="ml-2 opacity-0 group-hover:opacity-100 transition"><span aria-hidden="true">#</span></a></h2>
<p>Adapters are an optional feature to transform data before adding to or querying from a collection. Adapters make it possible to interact with a collection using only your project's native data type (eg. just raw text), rather than manually handling vectors.</p>
<p>For a complete list of available adapters, see <a href="https://supabase.github.io/vecs/concepts_adapters#built-in-adapters">built-in adapters</a>.</p>
<p>As an example, we'll create a collection with an adapter that chunks text into paragraphs and converts each chunk into an embedding vector using the <code>all-MiniLM-L6-v2</code> model.</p>
<p>First, install <code>vecs</code> with optional dependencies for text embeddings:</p>
<div class="ch-codeblock not-prose " data-ch-theme="supabase"><div class="ch-code-wrapper ch-code" data-ch-measured="false"><code class="ch-code-scroll-parent"><br><div><span class="ch-code-line-number">_<!-- -->10</span><div style="display:inline-block;margin-left:16px"><span>pip install "vecs[text_embedding]"</span></div></div><br></code></div></div>
<p>Then create a collection with an adapter to chunk text into paragraphs and embed each paragraph using the <code>all-MiniLM-L6-v2</code> 384 dimensional text embedding model.</p>
<div class="ch-codeblock not-prose " data-ch-theme="supabase"><div class="ch-code-wrapper ch-code" data-ch-measured="false"><code class="ch-code-scroll-parent"><br><div><span class="ch-code-line-number">_<!-- -->16</span><div style="display:inline-block;margin-left:16px"><span>import vecs</span></div></div><div><span class="ch-code-line-number">_<!-- -->16</span><div style="display:inline-block;margin-left:16px"><span>from vecs.adapter import Adapter, ParagraphChunker, TextEmbedding</span></div></div><div><span class="ch-code-line-number">_<!-- -->16</span><div style="display:inline-block;margin-left:16px"><span></span></div></div><div><span class="ch-code-line-number">_<!-- -->16</span><div style="display:inline-block;margin-left:16px"><span># create vector store client</span></div></div><div><span class="ch-code-line-number">_<!-- -->16</span><div style="display:inline-block;margin-left:16px"><span>vx = vecs.Client("postgresql://&lt;user&gt;:&lt;password&gt;@&lt;host&gt;:&lt;port&gt;/&lt;db_name&gt;")</span></div></div><div><span class="ch-code-line-number">_<!-- -->16</span><div style="display:inline-block;margin-left:16px"><span></span></div></div><div><span class="ch-code-line-number">_<!-- -->16</span><div style="display:inline-block;margin-left:16px"><span># create a collection with an adapter</span></div></div><div><span class="ch-code-line-number">_<!-- -->16</span><div style="display:inline-block;margin-left:16px"><span>docs = vx.get_or_create_collection(</span></div></div><div><span class="ch-code-line-number">_<!-- -->16</span><div style="display:inline-block;margin-left:16px"><span>    name="docs",</span></div></div><div><span class="ch-code-line-number">_<!-- -->16</span><div style="display:inline-block;margin-left:16px"><span>    adapter=Adapter(</span></div></div><div><span class="ch-code-line-number">_<!-- -->16</span><div style="display:inline-block;margin-left:16px"><span>        [</span></div></div><div><span class="ch-code-line-number">_<!-- -->16</span><div style="display:inline-block;margin-left:16px"><span>            ParagraphChunker(skip_during_query=True),</span></div></div><div><span class="ch-code-line-number">_<!-- -->16</span><div style="display:inline-block;margin-left:16px"><span>            TextEmbedding(model='all-MiniLM-L6-v2'),</span></div></div><div><span class="ch-code-line-number">_<!-- -->16</span><div style="display:inline-block;margin-left:16px"><span>        ]</span></div></div><div><span class="ch-code-line-number">_<!-- -->16</span><div style="display:inline-block;margin-left:16px"><span>    )</span></div></div><div><span class="ch-code-line-number">_<!-- -->16</span><div style="display:inline-block;margin-left:16px"><span>)</span></div></div><br></code></div></div>
<p>With the adapter registered against the collection, we can upsert records into the collection passing in text rather than vectors.</p>
<div class="ch-codeblock not-prose " data-ch-theme="supabase"><div class="ch-code-wrapper ch-code" data-ch-measured="false"><code class="ch-code-scroll-parent"><br><div><span class="ch-code-line-number">_<!-- -->15</span><div style="display:inline-block;margin-left:16px"><span># add records to the collection using text as the media type</span></div></div><div><span class="ch-code-line-number">_<!-- -->15</span><div style="display:inline-block;margin-left:16px"><span>docs.upsert(</span></div></div><div><span class="ch-code-line-number">_<!-- -->15</span><div style="display:inline-block;margin-left:16px"><span>    records=[</span></div></div><div><span class="ch-code-line-number">_<!-- -->15</span><div style="display:inline-block;margin-left:16px"><span>        (</span></div></div><div><span class="ch-code-line-number">_<!-- -->15</span><div style="display:inline-block;margin-left:16px"><span>         "vec0",</span></div></div><div><span class="ch-code-line-number">_<!-- -->15</span><div style="display:inline-block;margin-left:16px"><span>         "four score and ....", # &lt;- note that we can now pass text here</span></div></div><div><span class="ch-code-line-number">_<!-- -->15</span><div style="display:inline-block;margin-left:16px"><span>         {"year": 1973}</span></div></div><div><span class="ch-code-line-number">_<!-- -->15</span><div style="display:inline-block;margin-left:16px"><span>        ),</span></div></div><div><span class="ch-code-line-number">_<!-- -->15</span><div style="display:inline-block;margin-left:16px"><span>        (</span></div></div><div><span class="ch-code-line-number">_<!-- -->15</span><div style="display:inline-block;margin-left:16px"><span>         "vec1",</span></div></div><div><span class="ch-code-line-number">_<!-- -->15</span><div style="display:inline-block;margin-left:16px"><span>         "hello, world!",</span></div></div><div><span class="ch-code-line-number">_<!-- -->15</span><div style="display:inline-block;margin-left:16px"><span>         {"year": "2012"}</span></div></div><div><span class="ch-code-line-number">_<!-- -->15</span><div style="display:inline-block;margin-left:16px"><span>        )</span></div></div><div><span class="ch-code-line-number">_<!-- -->15</span><div style="display:inline-block;margin-left:16px"><span>    ]</span></div></div><div><span class="ch-code-line-number">_<!-- -->15</span><div style="display:inline-block;margin-left:16px"><span>)</span></div></div><br></code></div></div>
<p>Similarly, we can query the collection using text.</p>
<div class="ch-codeblock not-prose " data-ch-theme="supabase"><div class="ch-code-wrapper ch-code" data-ch-measured="false"><code class="ch-code-scroll-parent"><br><div><span class="ch-code-line-number">_<!-- -->10</span><div style="display:inline-block;margin-left:16px"><span></span></div></div><div><span class="ch-code-line-number">_<!-- -->10</span><div style="display:inline-block;margin-left:16px"><span># search by text</span></div></div><div><span class="ch-code-line-number">_<!-- -->10</span><div style="display:inline-block;margin-left:16px"><span>docs.query(data="foo bar")</span></div></div><br></code></div></div>
<hr>
<h2 id="deprecated" class="group scroll-mt-24">Deprecated<a href="#deprecated" aria-hidden="true" class="ml-2 opacity-0 group-hover:opacity-100 transition"><span aria-hidden="true">#</span></a></h2>
<h3 id="create-collection" class="group scroll-mt-24">Create collection<a href="#create-collection" aria-hidden="true" class="ml-2 opacity-0 group-hover:opacity-100 transition"><span aria-hidden="true">#</span></a></h3>
<div role="alert" class="relative w-full text-sm rounded-lg p-4 [&amp;>svg~*]:pl-10 [&amp;>svg+div]:translate-y-[-3px] [&amp;>svg]:absolute [&amp;>svg]:left-4 [&amp;>svg]:top-4 [&amp;>svg]:w-[23px] [&amp;>svg]:h-[23px] [&amp;>svg]:p-1 [&amp;>svg]:flex [&amp;>svg]:rounded text-foreground [&amp;>svg]:text-background [&amp;>svg]:bg-foreground mb-2 [&amp;_svg]:bg-foreground-muted [&amp;_svg]:text-background-muted bg-surface-200/25 border border-default"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 21 20" class="w-6 h-6" fill="currentColor"><path fill-rule="evenodd" clip-rule="evenodd" d="M0.625 9.8252C0.625 4.44043 4.99023 0.0751953 10.375 0.0751953C15.7598 0.0751953 20.125 4.44043 20.125 9.8252C20.125 15.21 15.7598 19.5752 10.375 19.5752C4.99023 19.5752 0.625 15.21 0.625 9.8252ZM9.3584 4.38135C9.45117 4.28857 9.55518 4.20996 9.66699 4.14648C9.88086 4.02539 10.1245 3.96045 10.375 3.96045C10.5845 3.96045 10.7896 4.00586 10.9766 4.09229C11.1294 4.1626 11.2705 4.26025 11.3916 4.38135C11.6611 4.65088 11.8125 5.0166 11.8125 5.39795C11.8125 5.5249 11.7959 5.6499 11.7637 5.77002C11.6987 6.01172 11.5718 6.23438 11.3916 6.41455C11.1221 6.68408 10.7563 6.83545 10.375 6.83545C9.99365 6.83545 9.62793 6.68408 9.3584 6.41455C9.08887 6.14502 8.9375 5.7793 8.9375 5.39795C8.9375 5.29492 8.94873 5.19287 8.97021 5.09375C9.02783 4.82568 9.16162 4.57812 9.3584 4.38135ZM10.375 15.6899C10.0933 15.6899 9.82275 15.5781 9.62354 15.3789C9.42432 15.1797 9.3125 14.9092 9.3125 14.6274V9.31494C9.3125 9.0332 9.42432 8.7627 9.62354 8.56348C9.82275 8.36426 10.0933 8.25244 10.375 8.25244C10.6567 8.25244 10.9272 8.36426 11.1265 8.56348C11.3257 8.7627 11.4375 9.0332 11.4375 9.31494V14.6274C11.4375 14.7944 11.3979 14.9575 11.3242 15.104C11.2739 15.2046 11.2075 15.2979 11.1265 15.3789C10.9272 15.5781 10.6567 15.6899 10.375 15.6899Z"></path></svg><div class="text mt [&amp;_p]:mb-1.5 [&amp;_p]:mt-0 mt-0.5 [&amp;_p:last-child]:mb-0">Deprecated: use <a href="#get-or-create-a-collection">get_or_create_collection</a></div></div>
<p>You can create a collection to store vectors specifying the collections name and the number of dimensions in the vectors you intend to store.</p>
<div class="ch-codeblock not-prose " data-ch-theme="supabase"><div class="ch-code-wrapper ch-code" data-ch-measured="false"><code class="ch-code-scroll-parent"><br><div><span class="ch-code-line-number">_<!-- -->10</span><div style="display:inline-block;margin-left:16px"><span>docs = vx.create_collection(name="docs", dimension=3)</span></div></div><br></code></div></div>
<h3 id="get-an-existing-collection" class="group scroll-mt-24">Get an existing collection<a href="#get-an-existing-collection" aria-hidden="true" class="ml-2 opacity-0 group-hover:opacity-100 transition"><span aria-hidden="true">#</span></a></h3>
<div role="alert" class="relative w-full text-sm rounded-lg p-4 [&amp;>svg~*]:pl-10 [&amp;>svg+div]:translate-y-[-3px] [&amp;>svg]:absolute [&amp;>svg]:left-4 [&amp;>svg]:top-4 [&amp;>svg]:w-[23px] [&amp;>svg]:h-[23px] [&amp;>svg]:p-1 [&amp;>svg]:flex [&amp;>svg]:rounded text-foreground [&amp;>svg]:text-background [&amp;>svg]:bg-foreground mb-2 [&amp;_svg]:bg-foreground-muted [&amp;_svg]:text-background-muted bg-surface-200/25 border border-default"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 21 20" class="w-6 h-6" fill="currentColor"><path fill-rule="evenodd" clip-rule="evenodd" d="M0.625 9.8252C0.625 4.44043 4.99023 0.0751953 10.375 0.0751953C15.7598 0.0751953 20.125 4.44043 20.125 9.8252C20.125 15.21 15.7598 19.5752 10.375 19.5752C4.99023 19.5752 0.625 15.21 0.625 9.8252ZM9.3584 4.38135C9.45117 4.28857 9.55518 4.20996 9.66699 4.14648C9.88086 4.02539 10.1245 3.96045 10.375 3.96045C10.5845 3.96045 10.7896 4.00586 10.9766 4.09229C11.1294 4.1626 11.2705 4.26025 11.3916 4.38135C11.6611 4.65088 11.8125 5.0166 11.8125 5.39795C11.8125 5.5249 11.7959 5.6499 11.7637 5.77002C11.6987 6.01172 11.5718 6.23438 11.3916 6.41455C11.1221 6.68408 10.7563 6.83545 10.375 6.83545C9.99365 6.83545 9.62793 6.68408 9.3584 6.41455C9.08887 6.14502 8.9375 5.7793 8.9375 5.39795C8.9375 5.29492 8.94873 5.19287 8.97021 5.09375C9.02783 4.82568 9.16162 4.57812 9.3584 4.38135ZM10.375 15.6899C10.0933 15.6899 9.82275 15.5781 9.62354 15.3789C9.42432 15.1797 9.3125 14.9092 9.3125 14.6274V9.31494C9.3125 9.0332 9.42432 8.7627 9.62354 8.56348C9.82275 8.36426 10.0933 8.25244 10.375 8.25244C10.6567 8.25244 10.9272 8.36426 11.1265 8.56348C11.3257 8.7627 11.4375 9.0332 11.4375 9.31494V14.6274C11.4375 14.7944 11.3979 14.9575 11.3242 15.104C11.2739 15.2046 11.2075 15.2979 11.1265 15.3789C10.9272 15.5781 10.6567 15.6899 10.375 15.6899Z"></path></svg><div class="text mt [&amp;_p]:mb-1.5 [&amp;_p]:mt-0 mt-0.5 [&amp;_p:last-child]:mb-0">Deprecated: use <a href="#get-or-create-a-collection">get_or_create_collection</a></div></div>
<p>To access a previously created collection, use <code>get_collection</code> to retrieve it by name</p>
<div class="ch-codeblock not-prose " data-ch-theme="supabase"><div class="ch-code-wrapper ch-code" data-ch-measured="false"><code class="ch-code-scroll-parent"><br><div><span class="ch-code-line-number">_<!-- -->10</span><div style="display:inline-block;margin-left:16px"><span>docs = vx.get_collection(name="docs")</span></div></div><br></code></div></div></article></div></div></div><!--$--><div class="max-w-7xl px-5 mx-auto py-8 pt-0"></div><!--/$--></div><div class="left-0 right-0 z-10 backdrop-blur-sm backdrop-filter bg-alternative/90 hidden h-0 lg:hidden"></div></div></main></div></div></div></div></body></html><hr>
<!DOCTYPE html><html lang="en" data-theme="light" style="color-scheme: light;"><body><div class="flex flex-col"><div class="grow"><div class="flex flex-col h-full w-full"><div class="hidden lg:sticky w-full lg:flex top-0 left-0 right-0 z-50"><!--$--><!--/$--></div><div class="flex flex-row h-full relative"><main id="docs-content-container" class="w-full transition-all ease-out relative lg:ml-0"><div class="flex flex-col sticky top-0"><div class="flex lg:hidden w-full top-0 left-0 right-0 z-50"><!--$--><!--/$--></div><div class="sticky transition-all top-0 z-10 backdrop-blur backdrop-filter bg-background"><div class="lg:hidden px-3.5 border-b z-10 transition-all ease-out top-0 flex items-center gap-1"><button class="h-8 w-8 flex group items-center justify-center mr-1"><div class="space-y-1 cursor-pointer relative w-4 h-[8px]"><span class="transition-all ease-out block h-px bg-foreground-muted group-hover:bg-foreground w-4"></span><span class="transition-all ease-out block h-px bg-foreground-muted group-hover:bg-foreground w-3 group-hover:w-4"></span></div></button><span class="transition-all duration-200 text-foreground text-sm">AI &amp; Vectors</span></div></div><div class="grow"><div class="max-w-7xl px-5 mx-auto py-8 pb-0"><div class="grid grid-cols-12 relative gap-4"><div class="relative transition-all ease-out duration-100 col-span-12 md:col-span-9"><article id="sb-docs-guide-main-article" class="prose max-w-none"><h1 class="mb-0">LangChain</h1><hr class="not-prose border-t-0 border-b my-8">
<p><a href="https://langchain.com/">LangChain</a> is a popular framework for working with AI, Vectors, and embeddings. LangChain supports using Supabase as a <a href="https://js.langchain.com/docs/modules/indexes/vector_stores/integrations/supabase">vector store</a>, using the <code>pgvector</code> extension.</p>
<h2 id="initializing-your-database" class="group scroll-mt-24">Initializing your database<a href="#initializing-your-database" aria-hidden="true" class="ml-2 opacity-0 group-hover:opacity-100 transition"><span aria-hidden="true">#</span></a></h2>
<p>Prepare you database with the relevant tables:</p>
<div dir="ltr" data-orientation="horizontal" class="w-full justify-between space-y-4 "><div role="tablist" aria-orientation="horizontal" class=" flex items-center border-b border-secondary  overflow-auto whitespace-nowrap no-scrollbar mask-fadeout-right flex-wrap" tabindex="-1" data-orientation="horizontal" style="outline:none"><button type="button" role="tab" aria-selected="true" aria-controls="radix-:R969jtsn7qb6ra:-content-dashboard" data-state="active" id="radix-:R969jtsn7qb6ra:-trigger-dashboard" class=" relative cursor-pointer text-foreground-lighter flex items-center space-x-2 text-center transition focus:outline-none focus-visible:ring focus-visible:ring-foreground-muted focus-visible:border-foreground-muted  text-sm leading-4 px-3 py-2  !text-foreground border-b-2 border-foreground " tabindex="-1" data-orientation="horizontal" data-radix-collection-item=""><span>Dashboard</span></button><button type="button" role="tab" aria-selected="false" aria-controls="radix-:R969jtsn7qb6ra:-content-sql" data-state="inactive" id="radix-:R969jtsn7qb6ra:-trigger-sql" class=" relative cursor-pointer text-foreground-lighter flex items-center space-x-2 text-center transition focus:outline-none focus-visible:ring focus-visible:ring-foreground-muted focus-visible:border-foreground-muted  text-sm leading-4 px-3 py-2  hover:text-foreground " tabindex="-1" data-orientation="horizontal" data-radix-collection-item=""><span>SQL</span></button></div><div data-state="active" data-orientation="horizontal" role="tabpanel" aria-labelledby="radix-:R969jtsn7qb6ra:-trigger-dashboard" id="radix-:R969jtsn7qb6ra:-content-dashboard" tabindex="0" class="focus:outline-none transition-height " style="animation-duration:0s"><ol>
<li>Go to the <a href="https://supabase.com/dashboard/project/_/sql">SQL Editor</a> page in the Dashboard.</li>
<li>Click <strong>LangChain</strong> in the Quick start section.</li>
<li>Click <strong>Run</strong>.</li>
</ol></div><div data-state="inactive" data-orientation="horizontal" role="tabpanel" aria-labelledby="radix-:R969jtsn7qb6ra:-trigger-sql" hidden="" id="radix-:R969jtsn7qb6ra:-content-sql" tabindex="0" class="focus:outline-none transition-height "></div></div>
<h2 id="usage" class="group scroll-mt-24">Usage<a href="#usage" aria-hidden="true" class="ml-2 opacity-0 group-hover:opacity-100 transition"><span aria-hidden="true">#</span></a></h2>
<p>You can now search your documents using any Node.js application. This is intended to be run on a secure server route.</p>
<div class="ch-codeblock not-prose " data-ch-theme="supabase"><div class="ch-code-wrapper ch-code" data-ch-measured="false"><code class="ch-code-scroll-parent"><br><div><span class="ch-code-line-number">_<!-- -->28</span><div style="display:inline-block;margin-left:16px"><span>import { SupabaseVectorStore } from 'langchain/vectorstores/supabase'</span></div></div><div><span class="ch-code-line-number">_<!-- -->28</span><div style="display:inline-block;margin-left:16px"><span>import { OpenAIEmbeddings } from 'langchain/embeddings/openai'</span></div></div><div><span class="ch-code-line-number">_<!-- -->28</span><div style="display:inline-block;margin-left:16px"><span>import { createClient } from '@supabase/supabase-js'</span></div></div><div><span class="ch-code-line-number">_<!-- -->28</span><div style="display:inline-block;margin-left:16px"><span></span></div></div><div><span class="ch-code-line-number">_<!-- -->28</span><div style="display:inline-block;margin-left:16px"><span>const supabaseKey = process.env.SUPABASE_SERVICE_ROLE_KEY</span></div></div><div><span class="ch-code-line-number">_<!-- -->28</span><div style="display:inline-block;margin-left:16px"><span>if (!supabaseKey) throw new Error(`Expected SUPABASE_SERVICE_ROLE_KEY`)</span></div></div><div><span class="ch-code-line-number">_<!-- -->28</span><div style="display:inline-block;margin-left:16px"><span></span></div></div><div><span class="ch-code-line-number">_<!-- -->28</span><div style="display:inline-block;margin-left:16px"><span>const url = process.env.SUPABASE_URL</span></div></div><div><span class="ch-code-line-number">_<!-- -->28</span><div style="display:inline-block;margin-left:16px"><span>if (!url) throw new Error(`Expected env var SUPABASE_URL`)</span></div></div><div><span class="ch-code-line-number">_<!-- -->28</span><div style="display:inline-block;margin-left:16px"><span></span></div></div><div><span class="ch-code-line-number">_<!-- -->28</span><div style="display:inline-block;margin-left:16px"><span>export const run = async () =&gt; {</span></div></div><div><span class="ch-code-line-number">_<!-- -->28</span><div style="display:inline-block;margin-left:16px"><span>  const client = createClient(url, supabaseKey)</span></div></div><div><span class="ch-code-line-number">_<!-- -->28</span><div style="display:inline-block;margin-left:16px"><span></span></div></div><div><span class="ch-code-line-number">_<!-- -->28</span><div style="display:inline-block;margin-left:16px"><span>  const vectorStore = await SupabaseVectorStore.fromTexts(</span></div></div><div><span class="ch-code-line-number">_<!-- -->28</span><div style="display:inline-block;margin-left:16px"><span>    ['Hello world', 'Bye bye', "What's this?"],</span></div></div><div><span class="ch-code-line-number">_<!-- -->28</span><div style="display:inline-block;margin-left:16px"><span>    [{ id: 2 }, { id: 1 }, { id: 3 }],</span></div></div><div><span class="ch-code-line-number">_<!-- -->28</span><div style="display:inline-block;margin-left:16px"><span>    new OpenAIEmbeddings(),</span></div></div><div><span class="ch-code-line-number">_<!-- -->28</span><div style="display:inline-block;margin-left:16px"><span>    {</span></div></div><div><span class="ch-code-line-number">_<!-- -->28</span><div style="display:inline-block;margin-left:16px"><span>      client,</span></div></div><div><span class="ch-code-line-number">_<!-- -->28</span><div style="display:inline-block;margin-left:16px"><span>      tableName: 'documents',</span></div></div><div><span class="ch-code-line-number">_<!-- -->28</span><div style="display:inline-block;margin-left:16px"><span>      queryName: 'match_documents',</span></div></div><div><span class="ch-code-line-number">_<!-- -->28</span><div style="display:inline-block;margin-left:16px"><span>    }</span></div></div><div><span class="ch-code-line-number">_<!-- -->28</span><div style="display:inline-block;margin-left:16px"><span>  )</span></div></div><div><span class="ch-code-line-number">_<!-- -->28</span><div style="display:inline-block;margin-left:16px"><span></span></div></div><div><span class="ch-code-line-number">_<!-- -->28</span><div style="display:inline-block;margin-left:16px"><span>  const resultOne = await vectorStore.similaritySearch('Hello world', 1)</span></div></div><div><span class="ch-code-line-number">_<!-- -->28</span><div style="display:inline-block;margin-left:16px"><span></span></div></div><div><span class="ch-code-line-number">_<!-- -->28</span><div style="display:inline-block;margin-left:16px"><span>  console.log(resultOne)</span></div></div><div><span class="ch-code-line-number">_<!-- -->28</span><div style="display:inline-block;margin-left:16px"><span>}</span></div></div><br></code></div></div>
<h3 id="simple-metadata-filtering" class="group scroll-mt-24">Simple metadata filtering<a href="#simple-metadata-filtering" aria-hidden="true" class="ml-2 opacity-0 group-hover:opacity-100 transition"><span aria-hidden="true">#</span></a></h3>
<p>Given the above <code>match_documents</code> Postgres function, you can also pass a filter parameter to only return documents with a specific metadata field value. This filter parameter is a JSON object, and the <code>match_documents</code> function will use the Postgres JSONB Containment operator <code>@&gt;</code> to filter documents by the metadata field values you specify. See details on the <a href="https://www.postgresql.org/docs/current/datatype-json.html#JSON-CONTAINMENT">Postgres JSONB Containment operator</a> for more information.</p>
<div class="ch-codeblock not-prose " data-ch-theme="supabase"><div class="ch-code-wrapper ch-code" data-ch-measured="false"><code class="ch-code-scroll-parent"><br><div><span class="ch-code-line-number">_<!-- -->32</span><div style="display:inline-block;margin-left:16px"><span>import { SupabaseVectorStore } from 'langchain/vectorstores/supabase'</span></div></div><div><span class="ch-code-line-number">_<!-- -->32</span><div style="display:inline-block;margin-left:16px"><span>import { OpenAIEmbeddings } from 'langchain/embeddings/openai'</span></div></div><div><span class="ch-code-line-number">_<!-- -->32</span><div style="display:inline-block;margin-left:16px"><span>import { createClient } from '@supabase/supabase-js'</span></div></div><div><span class="ch-code-line-number">_<!-- -->32</span><div style="display:inline-block;margin-left:16px"><span></span></div></div><div><span class="ch-code-line-number">_<!-- -->32</span><div style="display:inline-block;margin-left:16px"><span>// First, follow set-up instructions above</span></div></div><div><span class="ch-code-line-number">_<!-- -->32</span><div style="display:inline-block;margin-left:16px"><span></span></div></div><div><span class="ch-code-line-number">_<!-- -->32</span><div style="display:inline-block;margin-left:16px"><span>const privateKey = process.env.SUPABASE_SERVICE_ROLE_KEY</span></div></div><div><span class="ch-code-line-number">_<!-- -->32</span><div style="display:inline-block;margin-left:16px"><span>if (!privateKey) throw new Error(`Expected env var SUPABASE_SERVICE_ROLE_KEY`)</span></div></div><div><span class="ch-code-line-number">_<!-- -->32</span><div style="display:inline-block;margin-left:16px"><span></span></div></div><div><span class="ch-code-line-number">_<!-- -->32</span><div style="display:inline-block;margin-left:16px"><span>const url = process.env.SUPABASE_URL</span></div></div><div><span class="ch-code-line-number">_<!-- -->32</span><div style="display:inline-block;margin-left:16px"><span>if (!url) throw new Error(`Expected env var SUPABASE_URL`)</span></div></div><div><span class="ch-code-line-number">_<!-- -->32</span><div style="display:inline-block;margin-left:16px"><span></span></div></div><div><span class="ch-code-line-number">_<!-- -->32</span><div style="display:inline-block;margin-left:16px"><span>export const run = async () =&gt; {</span></div></div><div><span class="ch-code-line-number">_<!-- -->32</span><div style="display:inline-block;margin-left:16px"><span>  const client = createClient(url, privateKey)</span></div></div><div><span class="ch-code-line-number">_<!-- -->32</span><div style="display:inline-block;margin-left:16px"><span></span></div></div><div><span class="ch-code-line-number">_<!-- -->32</span><div style="display:inline-block;margin-left:16px"><span>  const vectorStore = await SupabaseVectorStore.fromTexts(</span></div></div><div><span class="ch-code-line-number">_<!-- -->32</span><div style="display:inline-block;margin-left:16px"><span>    ['Hello world', 'Hello world', 'Hello world'],</span></div></div><div><span class="ch-code-line-number">_<!-- -->32</span><div style="display:inline-block;margin-left:16px"><span>    [{ user_id: 2 }, { user_id: 1 }, { user_id: 3 }],</span></div></div><div><span class="ch-code-line-number">_<!-- -->32</span><div style="display:inline-block;margin-left:16px"><span>    new OpenAIEmbeddings(),</span></div></div><div><span class="ch-code-line-number">_<!-- -->32</span><div style="display:inline-block;margin-left:16px"><span>    {</span></div></div><div><span class="ch-code-line-number">_<!-- -->32</span><div style="display:inline-block;margin-left:16px"><span>      client,</span></div></div><div><span class="ch-code-line-number">_<!-- -->32</span><div style="display:inline-block;margin-left:16px"><span>      tableName: 'documents',</span></div></div><div><span class="ch-code-line-number">_<!-- -->32</span><div style="display:inline-block;margin-left:16px"><span>      queryName: 'match_documents',</span></div></div><div><span class="ch-code-line-number">_<!-- -->32</span><div style="display:inline-block;margin-left:16px"><span>    }</span></div></div><div><span class="ch-code-line-number">_<!-- -->32</span><div style="display:inline-block;margin-left:16px"><span>  )</span></div></div><div><span class="ch-code-line-number">_<!-- -->32</span><div style="display:inline-block;margin-left:16px"><span></span></div></div><div><span class="ch-code-line-number">_<!-- -->32</span><div style="display:inline-block;margin-left:16px"><span>  const result = await vectorStore.similaritySearch('Hello world', 1, {</span></div></div><div><span class="ch-code-line-number">_<!-- -->32</span><div style="display:inline-block;margin-left:16px"><span>    user_id: 3,</span></div></div><div><span class="ch-code-line-number">_<!-- -->32</span><div style="display:inline-block;margin-left:16px"><span>  })</span></div></div><div><span class="ch-code-line-number">_<!-- -->32</span><div style="display:inline-block;margin-left:16px"><span></span></div></div><div><span class="ch-code-line-number">_<!-- -->32</span><div style="display:inline-block;margin-left:16px"><span>  console.log(result)</span></div></div><div><span class="ch-code-line-number">_<!-- -->32</span><div style="display:inline-block;margin-left:16px"><span>}</span></div></div><br></code></div></div>
<h3 id="advanced-metadata-filtering" class="group scroll-mt-24">Advanced metadata filtering<a href="#advanced-metadata-filtering" aria-hidden="true" class="ml-2 opacity-0 group-hover:opacity-100 transition"><span aria-hidden="true">#</span></a></h3>
<p>You can also use query builder-style filtering (<a href="https://supabase.com/docs/reference/javascript/using-filters">similar to how the Supabase JavaScript library works</a>) instead of passing an object. Note that since the filter properties will be in the metadata column, you need to use arrow operators (<code>-&gt;</code> for integer or <code>-&gt;&gt;</code> for text) as defined in <a href="https://postgrest.org/en/stable/references/api/tables_views.html?highlight=operators#json-columns">Postgrest API documentation</a> and specify the data type of the property (e.g. the column should look something like <code>metadata-&gt;some_int_value::int</code>).</p>
<div class="ch-codeblock not-prose " data-ch-theme="supabase"><div class="ch-code-wrapper ch-code" data-ch-measured="false"><code class="ch-code-scroll-parent"><br><div><span class="ch-code-line-number">_<!-- -->62</span><div style="display:inline-block;margin-left:16px"><span>import { SupabaseFilterRPCCall, SupabaseVectorStore } from 'langchain/vectorstores/supabase'</span></div></div><div><span class="ch-code-line-number">_<!-- -->62</span><div style="display:inline-block;margin-left:16px"><span>import { OpenAIEmbeddings } from 'langchain/embeddings/openai'</span></div></div><div><span class="ch-code-line-number">_<!-- -->62</span><div style="display:inline-block;margin-left:16px"><span>import { createClient } from '@supabase/supabase-js'</span></div></div><div><span class="ch-code-line-number">_<!-- -->62</span><div style="display:inline-block;margin-left:16px"><span></span></div></div><div><span class="ch-code-line-number">_<!-- -->62</span><div style="display:inline-block;margin-left:16px"><span>// First, follow set-up instructions above</span></div></div><div><span class="ch-code-line-number">_<!-- -->62</span><div style="display:inline-block;margin-left:16px"><span></span></div></div><div><span class="ch-code-line-number">_<!-- -->62</span><div style="display:inline-block;margin-left:16px"><span>const privateKey = process.env.SUPABASE_SERVICE_ROLE_KEY</span></div></div><div><span class="ch-code-line-number">_<!-- -->62</span><div style="display:inline-block;margin-left:16px"><span>if (!privateKey) throw new Error(`Expected env var SUPABASE_SERVICE_ROLE_KEY`)</span></div></div><div><span class="ch-code-line-number">_<!-- -->62</span><div style="display:inline-block;margin-left:16px"><span></span></div></div><div><span class="ch-code-line-number">_<!-- -->62</span><div style="display:inline-block;margin-left:16px"><span>const url = process.env.SUPABASE_URL</span></div></div><div><span class="ch-code-line-number">_<!-- -->62</span><div style="display:inline-block;margin-left:16px"><span>if (!url) throw new Error(`Expected env var SUPABASE_URL`)</span></div></div><div><span class="ch-code-line-number">_<!-- -->62</span><div style="display:inline-block;margin-left:16px"><span></span></div></div><div><span class="ch-code-line-number">_<!-- -->62</span><div style="display:inline-block;margin-left:16px"><span>export const run = async () =&gt; {</span></div></div><div><span class="ch-code-line-number">_<!-- -->62</span><div style="display:inline-block;margin-left:16px"><span>  const client = createClient(url, privateKey)</span></div></div><div><span class="ch-code-line-number">_<!-- -->62</span><div style="display:inline-block;margin-left:16px"><span></span></div></div><div><span class="ch-code-line-number">_<!-- -->62</span><div style="display:inline-block;margin-left:16px"><span>  const embeddings = new OpenAIEmbeddings()</span></div></div><div><span class="ch-code-line-number">_<!-- -->62</span><div style="display:inline-block;margin-left:16px"><span></span></div></div><div><span class="ch-code-line-number">_<!-- -->62</span><div style="display:inline-block;margin-left:16px"><span>  const store = new SupabaseVectorStore(embeddings, {</span></div></div><div><span class="ch-code-line-number">_<!-- -->62</span><div style="display:inline-block;margin-left:16px"><span>    client,</span></div></div><div><span class="ch-code-line-number">_<!-- -->62</span><div style="display:inline-block;margin-left:16px"><span>    tableName: 'documents',</span></div></div><div><span class="ch-code-line-number">_<!-- -->62</span><div style="display:inline-block;margin-left:16px"><span>  })</span></div></div><div><span class="ch-code-line-number">_<!-- -->62</span><div style="display:inline-block;margin-left:16px"><span></span></div></div><div><span class="ch-code-line-number">_<!-- -->62</span><div style="display:inline-block;margin-left:16px"><span>  const docs = [</span></div></div><div><span class="ch-code-line-number">_<!-- -->62</span><div style="display:inline-block;margin-left:16px"><span>    {</span></div></div><div><span class="ch-code-line-number">_<!-- -->62</span><div style="display:inline-block;margin-left:16px"><span>      pageContent:</span></div></div><div><span class="ch-code-line-number">_<!-- -->62</span><div style="display:inline-block;margin-left:16px"><span>        'This is a long text, but it actually means something because vector database does not understand Lorem Ipsum. So I would need to expand upon the notion of quantum fluff, a theoretical concept where subatomic particles coalesce to form transient multidimensional spaces. Yet, this abstraction holds no real-world application or comprehensible meaning, reflecting a cosmic puzzle.',</span></div></div><div><span class="ch-code-line-number">_<!-- -->62</span><div style="display:inline-block;margin-left:16px"><span>      metadata: { b: 1, c: 10, stuff: 'right' },</span></div></div><div><span class="ch-code-line-number">_<!-- -->62</span><div style="display:inline-block;margin-left:16px"><span>    },</span></div></div><div><span class="ch-code-line-number">_<!-- -->62</span><div style="display:inline-block;margin-left:16px"><span>    {</span></div></div><div><span class="ch-code-line-number">_<!-- -->62</span><div style="display:inline-block;margin-left:16px"><span>      pageContent:</span></div></div><div><span class="ch-code-line-number">_<!-- -->62</span><div style="display:inline-block;margin-left:16px"><span>        'This is a long text, but it actually means something because vector database does not understand Lorem Ipsum. So I would need to proceed by discussing the echo of virtual tweets in the binary corridors of the digital universe. Each tweet, like a pixelated canary, hums in an unseen frequency, a fascinatingly perplexing phenomenon that, while conjuring vivid imagery, lacks any concrete implication or real-world relevance, portraying a paradox of multidimensional spaces in the age of cyber folklore.',</span></div></div><div><span class="ch-code-line-number">_<!-- -->62</span><div style="display:inline-block;margin-left:16px"><span>      metadata: { b: 2, c: 9, stuff: 'right' },</span></div></div><div><span class="ch-code-line-number">_<!-- -->62</span><div style="display:inline-block;margin-left:16px"><span>    },</span></div></div><div><span class="ch-code-line-number">_<!-- -->62</span><div style="display:inline-block;margin-left:16px"><span>    { pageContent: 'hello', metadata: { b: 1, c: 9, stuff: 'right' } },</span></div></div><div><span class="ch-code-line-number">_<!-- -->62</span><div style="display:inline-block;margin-left:16px"><span>    { pageContent: 'hello', metadata: { b: 1, c: 9, stuff: 'wrong' } },</span></div></div><div><span class="ch-code-line-number">_<!-- -->62</span><div style="display:inline-block;margin-left:16px"><span>    { pageContent: 'hi', metadata: { b: 2, c: 8, stuff: 'right' } },</span></div></div><div><span class="ch-code-line-number">_<!-- -->62</span><div style="display:inline-block;margin-left:16px"><span>    { pageContent: 'bye', metadata: { b: 3, c: 7, stuff: 'right' } },</span></div></div><div><span class="ch-code-line-number">_<!-- -->62</span><div style="display:inline-block;margin-left:16px"><span>    { pageContent: "what's this", metadata: { b: 4, c: 6, stuff: 'right' } },</span></div></div><div><span class="ch-code-line-number">_<!-- -->62</span><div style="display:inline-block;margin-left:16px"><span>  ]</span></div></div><div><span class="ch-code-line-number">_<!-- -->62</span><div style="display:inline-block;margin-left:16px"><span></span></div></div><div><span class="ch-code-line-number">_<!-- -->62</span><div style="display:inline-block;margin-left:16px"><span>  await store.addDocuments(docs)</span></div></div><div><span class="ch-code-line-number">_<!-- -->62</span><div style="display:inline-block;margin-left:16px"><span></span></div></div><div><span class="ch-code-line-number">_<!-- -->62</span><div style="display:inline-block;margin-left:16px"><span>  const funcFilterA: SupabaseFilterRPCCall = (rpc) =&gt;</span></div></div><div><span class="ch-code-line-number">_<!-- -->62</span><div style="display:inline-block;margin-left:16px"><span>    rpc</span></div></div><div><span class="ch-code-line-number">_<!-- -->62</span><div style="display:inline-block;margin-left:16px"><span>      .filter('metadata-&gt;b::int', 'lt', 3)</span></div></div><div><span class="ch-code-line-number">_<!-- -->62</span><div style="display:inline-block;margin-left:16px"><span>      .filter('metadata-&gt;c::int', 'gt', 7)</span></div></div><div><span class="ch-code-line-number">_<!-- -->62</span><div style="display:inline-block;margin-left:16px"><span>      .textSearch('content', `'multidimensional' &amp; 'spaces'`, {</span></div></div><div><span class="ch-code-line-number">_<!-- -->62</span><div style="display:inline-block;margin-left:16px"><span>        config: 'english',</span></div></div><div><span class="ch-code-line-number">_<!-- -->62</span><div style="display:inline-block;margin-left:16px"><span>      })</span></div></div><div><span class="ch-code-line-number">_<!-- -->62</span><div style="display:inline-block;margin-left:16px"><span></span></div></div><div><span class="ch-code-line-number">_<!-- -->62</span><div style="display:inline-block;margin-left:16px"><span>  const resultA = await store.similaritySearch('quantum', 4, funcFilterA)</span></div></div><div><span class="ch-code-line-number">_<!-- -->62</span><div style="display:inline-block;margin-left:16px"><span></span></div></div><div><span class="ch-code-line-number">_<!-- -->62</span><div style="display:inline-block;margin-left:16px"><span>  const funcFilterB: SupabaseFilterRPCCall = (rpc) =&gt;</span></div></div><div><span class="ch-code-line-number">_<!-- -->62</span><div style="display:inline-block;margin-left:16px"><span>    rpc</span></div></div><div><span class="ch-code-line-number">_<!-- -->62</span><div style="display:inline-block;margin-left:16px"><span>      .filter('metadata-&gt;b::int', 'lt', 3)</span></div></div><div><span class="ch-code-line-number">_<!-- -->62</span><div style="display:inline-block;margin-left:16px"><span>      .filter('metadata-&gt;c::int', 'gt', 7)</span></div></div><div><span class="ch-code-line-number">_<!-- -->62</span><div style="display:inline-block;margin-left:16px"><span>      .filter('metadata-&gt;&gt;stuff', 'eq', 'right')</span></div></div><div><span class="ch-code-line-number">_<!-- -->62</span><div style="display:inline-block;margin-left:16px"><span></span></div></div><div><span class="ch-code-line-number">_<!-- -->62</span><div style="display:inline-block;margin-left:16px"><span>  const resultB = await store.similaritySearch('hello', 2, funcFilterB)</span></div></div><div><span class="ch-code-line-number">_<!-- -->62</span><div style="display:inline-block;margin-left:16px"><span></span></div></div><div><span class="ch-code-line-number">_<!-- -->62</span><div style="display:inline-block;margin-left:16px"><span>  console.log(resultA, resultB)</span></div></div><div><span class="ch-code-line-number">_<!-- -->62</span><div style="display:inline-block;margin-left:16px"><span>}</span></div></div><br></code></div></div>
<h2 id="hybrid-search" class="group scroll-mt-24">Hybrid search<a href="#hybrid-search" aria-hidden="true" class="ml-2 opacity-0 group-hover:opacity-100 transition"><span aria-hidden="true">#</span></a></h2>
<p>LangChain supports the concept of a hybrid search, which combines Similarity Search with Full Text Search. Read the official docs to get started: <a href="https://js.langchain.com/docs/modules/indexes/retrievers/supabase-hybrid">Supabase Hybrid Search</a>.</p>
<p>You can install the LangChain Hybrid Search function though our <a href="https://database.dev/langchain/hybrid_search">database.dev package manager</a>.</p>
<h2 id="resources" class="group scroll-mt-24">Resources<a href="#resources" aria-hidden="true" class="ml-2 opacity-0 group-hover:opacity-100 transition"><span aria-hidden="true">#</span></a></h2>
<ul>
<li>Official <a href="https://langchain.com/">LangChain site</a>.</li>
<li>Official <a href="https://js.langchain.com/docs/modules/indexes/vector_stores/integrations/supabase">LangChain docs</a>.</li>
<li>Supabase <a href="https://js.langchain.com/docs/modules/indexes/retrievers/supabase-hybrid">Hybrid Search</a>.</li>
</ul></article></div></div></div><!--$--><div class="max-w-7xl px-5 mx-auto py-8 pt-0"></div><!--/$--></div><div class="left-0 right-0 z-10 backdrop-blur-sm backdrop-filter bg-alternative/90 hidden h-0 lg:hidden"></div></div></main></div></div></div></div></body></html><hr>